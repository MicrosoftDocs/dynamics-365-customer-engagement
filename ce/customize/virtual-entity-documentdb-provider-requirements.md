---
title: "Preview Feature: Use the Azure Cosmos DB for SQL API Data Provider with Dynamics 365 Customer Engagement | MicrosoftDocs"
description: "Learn how to configure the Azure Cosmos DB for SQL API Data Provider to use with Dynamics 365 virtual entities."
keywords: "SQL API"
ms.date: 1/2/2018
ms.service: crm-online
ms.custom: 
ms.topic: article
applies_to:
  - "Dynamics 365 (online)"
  - "Dynamics 365 Version 9.x"
ms.assetid: d0031ffc-8754-4a12-b8c1-e08edc49ff73
author: Mattp123
ms.author: matp
manager: brycho
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
caps.latest.revision: 
topic-status: Drafting
---

# Preview feature: Azure Cosmos DB SQL API Data Provider requirements

This topic describes the requirements for the [!INCLUDE [cc-docdb-api-data-provider](../includes/cc-docdb-api-data-provider.md)] as well as how to configure and recommended best practices when you use the [!INCLUDE [cc-docdb-api-data-provider](../includes/cc-docdb-api-data-provider.md)] with [!INCLUDE [pn-crm-shortest](../includes/pn-crm-shortest.md)] virtual entities. 

> [!IMPORTANT]
> - [!INCLUDE [cc-preview-features-definition](../includes/cc-preview-features-definition.md)]
> - [!INCLUDE [cc-preview-features-definition](../includes/cc-preview-features-expect-changes.md)]
> - [!INCLUDE [cc-preview-features-definition](../includes/cc-preview-features-no-ms-support.md)]


## What is Azure Cosmos DB?

[!INCLUDE [cc-azure-cosmos-db](../includes/cc-azure-cosmos-db.md)] is Microsoft's globally distributed multi-model database service for mission-critical applications. It provides rich and familiar SQL query capabilities with consistent low latencies over schema-less JSON data. More information: [Introduction to Azure Cosmos DB: SQL API](https://docs.microsoft.com/azure/cosmos-db/sql-api-introduction)

## Requirements

- Azure subscription that includes [!INCLUDE [cc-azure-cosmos-db](../includes/cc-azure-cosmos-db.md)].
- An [!INCLUDE [cc-docdb-api-long](../includes/cc-docdb-api-long.md)] collection.
- The [!INCLUDE [cc-azure-cosmos-db](../includes/cc-azure-cosmos-db.md)] database type should be SQL. 

## Data type mapping

Suppose you have an [!INCLUDE [cc-azure-cosmos-db](../includes/cc-azure-cosmos-db.md)] document in a collection named *Orders* that has the following JSON structure.

![Example JSON for SQL API document.](media/documentdbexample.png)

This table indicates the data type mappings for the [!INCLUDE [cc-docdb-api-short](../includes/cc-docdb-api-short.md)] document in the *Orders* collection with [!INCLUDE [pn-crm-shortest](../includes/pn-crm-shortest.md)] data types.

|[!INCLUDE [cc-docdb-api-short](../includes/cc-docdb-api-short.md)] Data  | [!INCLUDE [pn-crm-shortest](../includes/pn-crm-shortest.md)] Data Type  |
|---------|---------|
|id     |     Primary Key    |
|name     | Single Line of Text        |
|quantity     | Whole Number        |
|orderid     | Single line of text        |
|ordertype     |  Option Set       |
|amount     | Decimal Number or Currency        |
|delivered     | Two Options        |
|datetimeoffset     | Date and Time        |

> [!NOTE]
> - Attributes with an underscore (_) prefix are generated by the [!INCLUDE [cc-docdb-api-short](../includes/cc-docdb-api-short.md)].
> - Attributes that are configured as optional in the [!INCLUDE [cc-docdb-api-short](../includes/cc-docdb-api-short.md)] document and are mapped in [!INCLUDE [pn-crm-shortest](../includes/pn-crm-shortest.md)] as **Business Required** will cause a runtime error.
> - id attribute values must be guids.
> - For more information about using dates in [!INCLUDE [cc-docdb-api-short](../includes/cc-docdb-api-short.md)], see [Working with Dates in Azure Cosmos DB](https://azure.microsoft.com/blog/working-with-dates-in-azure-documentdb-4/).

## Supported SQL query filtering

SQL query filtering supports the following operators. 

- Comparison operators:<,>,<=, >=,!=
- Logical operators: and, or 
- Set operators: in, not in
- String operators: like, contains, begins with, ends with

> [!NOTE]
> Usage of the like operator is translated to the equivalent contains/begins with/ends with operators. The  [!INCLUDE [cc-docdb-api-short](../includes/cc-docdb-api-short.md)] does not support pattern arguments as described in the topic [Like (Transact-SQL)](https://docs.microsoft.com/sql/t-sql/language-elements/like-transact-sql). The [!INCLUDE [cc-docdb-api-data-provider](../includes/cc-docdb-api-data-provider.md)] can translate the single special case Like(‘[aA]%’) to BeginsWith(‘a’) OR BeginsWith(‘A’). Notice that string comparison in the [!INCLUDE [cc-docdb-api-short](../includes/cc-docdb-api-short.md)] is case sensitive.

## Add a data source using the Azure Cosmos DB for SQL API Data Provider

1. Go to [AppSource](https://appsource.microsoft.com/product/dynamics-365/mscrm.documentdb_data_provider?tab=Overview), click **GET IT NOW**, and follow the instructions to add the application to your [!INCLUDE [pn-crm-9-0-0-online](../includes/pn-crm-9-0-0-online.md)] or later instance.
2. After the solution is installed, sign in to the [!INCLUDE [pn-crm-shortest](../includes/pn-crm-shortest.md)] instance and go to **Settings** > **Administration** > **Virtual Entity Data Sources**.
3. On the Actions toolbar click **NEW**, and in the **Select Data Provider** dialog box select **Azure Cosmos DB for SQL API Data Provider**, and then click **OK**.
![Select the Azure Cosmos DB for SQL API Data Provider.](media/createdatasource.png)
1. Enter the following information, and then click **SAVE & CLOSE**.
  - **Name**. Type a name that describes the data source.
  - **Collection Name**. The id of the [!INCLUDE [cc-azure-cosmos-db](../includes/cc-azure-cosmos-db.md)] database collection containing the data you want to surface in a virtual entity.  
  - **Authorization Key**. The primary or secondary key for the [!INCLUDE [cc-azure-cosmos-db](../includes/cc-azure-cosmos-db.md)] account. You can find the key from the Azure admin portal under the **Keys** setting under your [!INCLUDE [cc-azure-cosmos-db](../includes/cc-azure-cosmos-db.md)] account.
  - **Uri**. The URI of the resource group where the [!INCLUDE [cc-azure-cosmos-db](../includes/cc-azure-cosmos-db.md)] collection is located. The URI is formed similar to https://contoso/documents.azure.com:443. You can find the URI from the Azure admin portal under the **Keys** setting for the [!INCLUDE [cc-azure-cosmos-db](../includes/cc-azure-cosmos-db.md)] account. 
  - **Timeout in seconds**. Enter the number of seconds to wait for a response from the [!INCLUDE [cc-azure-cosmos-db](../includes/cc-azure-cosmos-db.md)] service before a data request time-out. For example, enter 30 to wait a maximum of thirty seconds before a time-out occurs. The default timeout is 120 seconds.

![Create the data source using the SQL API Data Provider.](media/cosmosdb-datasource.png)

## Best practices and limitations

- Notice the following when you use [!INCLUDE [cc-azure-cosmos-db](../includes/cc-azure-cosmos-db.md)] as a Data Source:
   - Each [!INCLUDE [cc-azure-cosmos-db](../includes/cc-azure-cosmos-db.md)] Data Source can only be associated with a single virtual entity.
   - You can connect multiple Data Sources to the same Collection in the [!INCLUDE [cc-azure-cosmos-db](../includes/cc-azure-cosmos-db.md)].
- You can’t segment the data in a collection by entity.
- [!INCLUDE [cc-azure-cosmos-db](../includes/cc-azure-cosmos-db.md)] databases do not require a schema, however the data within the [!INCLUDE [cc-azure-cosmos-db](../includes/cc-azure-cosmos-db.md)] must be structured using a predictable schema. 
- Although the [!INCLUDE [cc-docdb-api-data-provider](../includes/cc-docdb-api-data-provider.md)] implements query translation of projection, filtering, and sorting operators, it does not support join operations.
- You can only filter by a single column with [!INCLUDE [cc-docdb-api-short](../includes/cc-docdb-api-short.md)].

## See also

[Create and edit virtual entities that contain data from an external data source](create-edit-virtual-entities.md)
