(window.wordOnlineExpChunks=window.wordOnlineExpChunks||[]).push([[319],{2877:function(e,t,o){"use strict";o.r(t);var n=function(){this.retryCount=3,this.forcePdfDevEnv=!1,this.documentId="",this.publicScriptPath="",this.userType="",this.wacCluster="",this.disableVhsFileCache=!1,this.isStaticVersionDisplayEnabled=!1},r=o(1222),i=o(2465),s=o(1390),a=o(1226),c=o(451),d=o(4),l=o(28),u=o(50),h=o(814),p=Object(h.c)((function(){return{root:Object(u.eb)({height:"100%",width:"100%",position:"relative",display:"flex",flexDirection:"column",flex:"0 0 auto"}),document:Object(u.eb)({overflowY:"auto",overflowX:"auto",top:"0px",bottom:"22px",width:"100%",backgroundColor:"#E4E4E4",textAlign:"center",alignItems:"center",display:"flex",position:"absolute",flexDirection:"column",flexGrow:"1"}),page:Object(u.eb)({margin:"auto",marginBottom:"10px",marginTop:"10px",boxShadow:"0 4px 4px 0 rgba(0,0,0,0.2);",flex:"0 0 auto"}),spinnerStyle:Object(u.eb)({selectors:{"& .ms-Spinner-circle":{borderColor:"#DDDDDD",borderTopColor:"#2A579A"}}}),statusBarContainer:Object(u.eb)({position:"absolute",height:"22px",bottom:"0px",width:"100%",flexShrink:0})}})),f=function(){function e(e,t){this.docDiv=null,this.crypto=window.crypto||window.msCrypto,this.hasPdf=!1,this.hasRenderError=!1,this.rootDiv=t,this.docContainer=document.createElement("div"),this.docContainer.className="DocViewerRootContainer",this.docContainer.style.height="100%",this.docContainer.style.width="100%",this.docContainer.style.position="relative",this.docContainer.style.flex="1",this.docContainer.id="DocViewerRootContainer"+this.crypto.getRandomValues(new Int32Array(6));var o=p();this.loadSpinnerDiv=this.createLoadDiv(),l.render(d.createElement(a.a,{className:o.spinnerStyle,size:c.a.large}),this.loadSpinnerDiv),this.docContainer.appendChild(this.loadSpinnerDiv),this.renderPdf(e),this.rootDiv.appendChild(this.docContainer)}return e.prototype.createDocDiv=function(){var e=document.createElement("div");return e.className="ReactPdfDocContainerDiv",e.id="ReactPdfDocContainerDiv"+this.crypto.getRandomValues(new Int32Array(6)),e.style.height="100%",e.style.width="100%",e.style.position="absolute",e.tabIndex=-1,e},e.prototype.createLoadDiv=function(){var e=document.createElement("div");return e.className="LoadSpinnerDiv",e.style.height="100%",e.style.width="100%",e.style.justifyContent="center",e.style.alignItems="center",e.style.backgroundColor="#EDEBE9",e.style.display="flex",e.style.position="absolute",e},e.prototype.renderPdf=function(e){this.docDiv=this.createDocDiv(),l.render(e,this.docDiv),this.docContainer.appendChild(this.docDiv),this.hasPdf=!0},e.prototype.pdfHasBeenRendered=function(){return this.hasPdf},e.prototype.hasPdfRenderFailed=function(){return this.hasRenderError},e.prototype.setPdfRenderFailed=function(){this.hasRenderError=!0},e.prototype.show=function(){this.docContainer.style.display="block"},e.prototype.hide=function(){this.docContainer.style.display="none",this.hasPdf||r.a.sendTraceTag(537995229,i.a.msoulscat_Wac_WordVersionHistory,s.a.Warning,"DocController being hidden before PDF has been rendered")},e}(),v=o(5),g=o(2493),D=o(1028),y=Object(h.c)((function(e){return{root:Object(u.eb)({height:"22px",width:"100%",bottom:"0px",backgroundColor:"#ffffff",borderTop:"1px solid #e1e1e1",borderBottom:"1px solid #e1e1e1",position:"absolute",textAlign:"center"}),statusBarLeft:Object(u.eb)({position:"relative",lineHeight:"22px",float:"left",paddingLeft:"14px",verticalAlign:"middle"}),statusBarCenter:Object(u.eb)({left:e.pageNumber.toString(),margin:"0 auto",position:"relative",display:"inline-block",verticalAlign:"middle"}),statusBarRight:Object(u.eb)({position:"relative",float:"right",paddingRight:"14px",verticalAlign:"middle"})}})),m=function(e){function t(t){var o=e.call(this,t)||this;return o.styles=y(t),o}return Object(v.__extends)(t,e),t.prototype.componentWillReceiveProps=function(e){this.styles=y(e)},t.prototype.render=function(){var e=OfficeVersionHistoryStrings;return d.createElement("div",{className:this.styles.root},d.createElement("span",{className:this.styles.statusBarLeft},d.createElement("span",null,e.WordPageNumber.replace("{pagenumber}",this.props.pageNumber.toString()).replace("{pagecount}",this.props.pageTotal.toString()))))},t}(d.PureComponent);o(695);var E,C=o(395),T=function(e){function t(t){var o=e.call(this,t)||this;if(o.ticking=null,o.scrollPos=0,o.docRef=d.createRef(),o.id=Object(g.a)(),o.pageHeight=1056,o.pageWidth=816,o.filePath="",o.onDocumentLoadSuccess=function(e){var t=e.numPages;o.setState({numPages:t,isLoaded:!0}),o.props.onLoadAction("pdf loaded")},o.onDocumentDownloaded=function(){o.props.onDownloadedAction("pdf downloaded")},o.customTextRenderer=function(e){return d.createElement("span",{tabIndex:0,style:{userSelect:"text",msUserSelect:"text",WebkitUserSelect:"text",MozUserSelect:"text"}},e.str)},o.onRenderError=function(e,t){r.a.sendTraceTag(589108893,i.a.msoulscat_Wac_WordVersionHistory,s.a.Error,"".concat(t,"Error: ").concat(e.name,": ").concat(e.message,", status: ").concat(e.status));var n=o.state.retryCount;0===n?"UnexpectedResponseException"===e.name?o.props.onErrorAction("".concat(e.name,": ").concat(e.status)):"MissingPDFException"===e.name?o.props.onErrorAction(e.name):o.props.onErrorAction(e.message):o.setState({retryCount:n-1})},o.onError=function(e){o.onRenderError(e,"")},o.onSourceError=function(e){o.onRenderError(e,"Source")},o.onLoadError=function(e){o.onRenderError(e,"Load")},o.scrollHandler=function(e){o.scrollPos=e.target.scrollTop,o.ticking&&clearTimeout(o.ticking),o.ticking=setTimeout((function(){var t=Math.floor((o.scrollPos+e.target.offsetHeight/2)/(e.target.scrollHeight/o.state.numPages))+1;o.setState({pageNumber:t}),o.ticking=null}),100)},""===t.publicScriptPath)r.a.sendTraceTag(595711565,i.a.msoulscat_Wac_WordVersionHistory,s.a.Error,"PublicScriptPath is not set");else{var n=null;n=t.forcePdfDevEnv?"pdf.worker.js":"pdf.worker.min.js",C.GlobalWorkerOptions.workerSrc=t.publicScriptPath+n}return o.state={numPages:1,pageNumber:1,hasLoaded:!1,retryCount:t.retryCount},o.scrollHandler=o.scrollHandler.bind(o),o.filePath=null!=t.pdfHeader?{url:t.pdfURL,httpHeaders:t.pdfHeader}:t.pdfURL,o}return Object(v.__extends)(t,e),t.prototype.createPageArray=function(e,t){for(var o=[],n=0;n<e;n+=1)o[n]=d.createElement(D.Page,{key:"page_".concat(n+1),pageNumber:n+1,height:this.pageHeight,width:this.pageWidth,className:t.page,customTextRenderer:this.customTextRenderer,renderAnnotationLayer:!this.props.isStaticDisplayEnabled});return o},t.prototype.componentDidMount=function(){var e=this.docRef.current;e&&(e.addEventListener("scroll",this.scrollHandler),e.tabIndex=0)},t.prototype.componentWillUnmount=function(){var e=this.docRef.current;e&&e.removeEventListener("scroll",this.scrollHandler)},t.prototype.render=function(){var e=p(),t=this.state,o=t.numPages,n=t.pageNumber,r=t.isLoaded,i=t.retryCount,s={pageNumber:n,pageTotal:o,wordCount:45781};return d.createElement("div",{className:e.root,style:{display:r?"flex":"none"}},d.createElement(D.Document,{key:i,id:this.id,file:this.filePath,onError:this.onError,onLoadSuccess:this.onDocumentLoadSuccess,onSourceSuccess:this.onDocumentDownloaded,onSourceError:this.onSourceError,onLoadError:this.onLoadError,className:e.document,renderTextLayer:!0,inputRef:this.docRef,renderMode:"svg"},this.createPageArray(o,e)),d.createElement(m,Object(v.__assign)({key:0},s)))},t}(d.PureComponent);!function(e){e.convertToPdf="convertToPdf",e.convertToPdfDiff="pdfDiff"}(E||(E={}));var L,S=function(){function e(){}return e.init=function(e,t,o){this.userSessionId=e,this.userType=t,this.wacCluster=o},e.calcHashCode=function(e){if(!e)return"";for(var t=5381,o=t,n=e.length,r=0;r<n&&(t=4294967295&((t<<5)+t^e.charCodeAt(r)),r!==n-1);r+=2)o=4294967295&((o<<5)+o^e.charCodeAt(r+1));var i=t+35685*o+(23896*o<<16)&4294967295;return i<0&&(i+=4294967296),i.toString()},e.constructEndpointUrl=function(e){var t="/"+this.dest+"?operationName="+e.toString()+"&endpointName="+this.endpointName+"&fileExtension="+this.fileExtension;return this.wacCluster&&this.wacCluster.length>0&&(t=t+"&waccluster="+this.wacCluster),t},e.createRequestUrlHashed=function(t,o,n,a,c){var d=this.requestUrl;return c?(d=(d+=this.constructEndpointUrl(a?E.convertToPdfDiff:E.convertToPdf))+"&revId="+n,a&&(d=d+"&baseRevId="+a),d+="#toolbar=0&page=1&view=FitB"):o&&o.length>0?d=d+this.constructEndpointUrl(E.convertToPdfDiff)+"&revDocUrl="+e.calcHashCode(encodeURIComponent(t))+"&baseDocUrl="+e.calcHashCode(encodeURIComponent(o))+"#toolbar=0&page=1&view=FitB":(r.a.sendTraceTag(595715333,i.a.msoulscat_Wac_WordVersionHistory,s.a.Info,"Fallback to convertToPdf with revDocUrl"),d=d+this.constructEndpointUrl(E.convertToPdf)+"&docUrl="+e.calcHashCode(encodeURIComponent(t))+"#toolbar=0&page=1&view=FitB"),d},e.createRequestData=function(e,t,o,n,r,i){var s={};return s["X-UserSessionId"]=this.userSessionId,this.userType&&(s["X-UserType"]=this.userType),this.wacCluster&&this.wacCluster.length>0&&(s["X-WacCluster"]=this.wacCluster),i?(s["X-NoSpoCache"]="1",s["X-DocId"]=e,s["X-RevRevisionId"]=n,r&&r.length>0&&(s["X-BaseRevisionId"]=r)):o&&o.length>0?(s["X-RevDocUrl"]=encodeURIComponent(t),s["X-BaseDocUrl"]=encodeURIComponent(o)):s["X-DocUrl"]=encodeURIComponent(t),s},e.createPdfViewer=function(t,o,n,r,i,s,a,c,l,u,h,p,f){var v={pdfURL:e.createRequestUrlHashed(o,n,r,i,h),pdfHeader:e.createRequestData(t,o,n,r,i,h),retryCount:p||0,onLoadAction:s,onErrorAction:a,onDownloadedAction:c,publicScriptPath:l,forcePdfDevEnv:f,isStaticDisplayEnabled:u};return d.createElement(T,v)},e.requestUrl="/we",e.dest="WordEditPdfRender.ashx",e.endpointName="WordWRS",e.fileExtension="docx",e.userSessionId="",e.wacCluster="",e}();!function(e){e.ShowVersionHistoryDialog="ShowVersionHistoryDialog",e.LoadVersionListStart="LoadVersionListStart",e.LoadVersionListEnd="LoadVersionListEnd",e.LoadVersionListFailure="LoadVersionListFailure",e.OnVersionSelectStart="OnVersionSelectStart",e.OnVersionSelectEnd="OnVersionSelectEnd",e.OnVersionSelectFailure="OnVersionSelectFailure",e.LoadVersionHistoryList="LoadVersionHistoryList",e.OnVersionDownloaded="OnVersionDownloaded"}(L||(L={}));var w=function(){function e(){}return Object.defineProperty(e,"appTelemetryDictionary",{set:function(t){e._appTelemetryDictionary=t},enumerable:!1,configurable:!0}),e.addAppPLTEventToLog=function(t){e._appTelemetryDictionary[t]=Date.now().toString()},e.addDocPLTEventToLog=function(t,o,n){try{e.setValueForDocPLTEvent(t,o,n,Date.now().toString()),n!==L.OnVersionSelectEnd||e.isPageLoadForFirstTime&&e.isVersionLoadForFirstTime[t][o?1:0]||e.flushPLTEventsToLog(t,o)}catch(e){}},e.setIsPageLoadForFirstTime=function(t){e.isPageLoadForFirstTime=t,e._appTelemetryDictionary.set("isFirstPageLoad",t?"true":"false")},e.setIsVersionLoadForFirstTime=function(t,o,n){null==e.isVersionLoadForFirstTime[t]&&(e.isVersionLoadForFirstTime[t]={});var r=o?1:0;e.isVersionLoadForFirstTime[t][r]=n,e.setValueForDocPLTEvent(t,o,"isVersionLoadForFirstTime",n?"true":"false")},e.logEplapsedTime=function(e,t,o,n){r.a.sendTraceTag(595904208,i.a.msoulscat_Wac_WordVersionHistory,t,e+" StartTime: "+o+", EndTime: "+n+", ElapsedTime: "+(n-o)+".")},e.setValueForDocPLTEvent=function(t,o,n,r){var i=o?1:0;try{null==e._docPLTEventDictionary[t]&&(e._docPLTEventDictionary[t]={}),null==e._docPLTEventDictionary[t][i]&&(e._docPLTEventDictionary[t][i]={}),e._docPLTEventDictionary[t][i][n]=r}catch(e){}},e.flushPLTEventsToLog=function(t,o){try{e.setValueForDocPLTEvent(t,o,"revisionID",t),e.setValueForDocPLTEvent(t,o,"showsVersionChanges",o);var n=Object(v.__assign)(Object(v.__assign)({},e._appTelemetryDictionary),e._docPLTEventDictionary[t][o?1:0]),a=JSON.stringify(n);r.a.sendTraceTag(595904209,i.a.msoulscat_Wac_WordVersionHistory,s.a.Info,a),e._appTelemetryDictionary={},e._docPLTEventDictionary[t][o?1:0]={}}catch(e){}},e.isPageLoadForFirstTime=!1,e.isVersionLoadForFirstTime={},e._appTelemetryDictionary={},e._docPLTEventDictionary={},e}(),b=function(){function e(){this._listeners=[]}return e.prototype.fireEvent=function(e){this._listeners.forEach((function(t){return t(e)}))},e.prototype.addListener=function(e){e&&this._listeners.push(e)},e.prototype.removeListener=function(e){this._listeners=this._listeners.filter((function(t){return t!==e}))},e}(),P=function(){function e(e,t){var o,n,i=this;this.docControllersWithDiffsCache={},this.docControllersWithoutDiffsCache={},this.onRenderFailureEvent=new b,this.onLoadEvent=new b,this.onDocumentDownloadedEvent=new b,this.selectedRevisionID="",this.baseRevisionID="",this.settings=e,this.rootDiv=t,this.currentShowsVersionChanges=!0,this.forcePdfDevEnv=null!==(o=this.settings.forcePdfDevEnv)&&void 0!==o&&o,this.userSessionId=null!==(n=this.settings.userSessionId)&&void 0!==n?n:"",r.a.setLogger(this.settings.logger),S.init(this.userSessionId,this.settings.userType,this.settings.wacCluster),this.onLoadEvent.addListener((function(){i.logLoadFinish(i.selectedRevisionID,i.currentShowsVersionChanges)})),this.onRenderFailureEvent.addListener((function(e){var t=i.getDocControllerFromCache(i.selectedRevisionID,i.baseRevisionID,i.currentShowsVersionChanges);null==t||t.setPdfRenderFailed(),i.logLoadError(i.selectedRevisionID,i.currentShowsVersionChanges,!0,new Error(e))})),this.onDocumentDownloadedEvent.addListener((function(){i.logDownloaded(i.selectedRevisionID,i.currentShowsVersionChanges)}))}return e.prototype.onVersionSelected=function(e,t,o,n){var a,c,d,l;void 0===o&&(o={}),void 0===n&&(n=!0);try{var u=null!==(a=e.RevisionID)&&void 0!==a?a:"",h=null!==(c=e.DownloadUrl)&&void 0!==c?c:"",p=null!==(d=null==t?void 0:t.RevisionID)&&void 0!==d?d:"",v=n&&null!==(l=null==t?void 0:t.DownloadUrl)&&void 0!==l?l:"";w.appTelemetryDictionary=o,w.addDocPLTEventToLog(u,n,L.OnVersionSelectStart),w.setIsVersionLoadForFirstTime(u,n,!1),r.a.sendTraceTag(520147600,i.a.msoulscat_Wac_WordVersionHistory,s.a.Info,"onVersionSelected: RevisionID: "+u);var g=this.isVersionCurrentlyDisplayed(u,p,n),D=this.getDocControllerFromCache(u,p,n);if(g&&D&&!D.hasPdfRenderFailed())return r.a.sendTraceTag(520147598,i.a.msoulscat_Wac_WordVersionHistory,s.a.Info,"onVersionSelected: version is already displayed, RevisionID: "+this.selectedRevisionID+", ShowsVersionChanges: "+this.currentShowsVersionChanges),w.addDocPLTEventToLog(this.selectedRevisionID,n,L.OnVersionSelectEnd),void this.onLoadEvent.fireEvent("");g&&!D&&r.a.sendTraceTag(520147599,i.a.msoulscat_Wac_WordVersionHistory,s.a.Error,"onVersionSelected: currently displayed version is not in cache, RevisionID: "+this.selectedRevisionID+", ShowsVersionChanges: "+this.currentShowsVersionChanges);var y=D,m=!D||D.hasPdfRenderFailed();m&&(w.setIsVersionLoadForFirstTime(u,n,!0),y=new f(this.createPdfData(h,v,u,p),this.rootDiv),this.addDocControllerToCache(u,p,n,y));var E=this.getDocControllerFromCache(this.selectedRevisionID,this.baseRevisionID,this.currentShowsVersionChanges);E&&E.hide(),this.selectedRevisionID=u,this.baseRevisionID=p,this.currentShowsVersionChanges=n,m||this.onLoadEvent.fireEvent(""),y.show()}catch(t){this.logLoadError(e.RevisionID,n,!1,t)}},e.prototype.getDocControllerFromCache=function(e,t,o){return o?this.docControllersWithDiffsCache[e]?this.docControllersWithDiffsCache[e][t]:null:this.docControllersWithoutDiffsCache[e]},e.prototype.addDocControllerToCache=function(e,t,o,n){o?(this.docControllersWithDiffsCache[e]||(this.docControllersWithDiffsCache[e]={}),this.docControllersWithDiffsCache[e][t]=n):this.docControllersWithoutDiffsCache[e]=n},e.prototype.isVersionCurrentlyDisplayed=function(e,t,o){return this.selectedRevisionID===e&&(this.currentShowsVersionChanges===o&&this.baseRevisionID===t)},e.prototype.createPdfData=function(e,t,o,n){return S.createPdfViewer(this.settings.documentId,e,t,o,n,this.onLoadEvent.fireEvent.bind(this.onLoadEvent),this.onRenderFailureEvent.fireEvent.bind(this.onRenderFailureEvent),this.onDocumentDownloadedEvent.fireEvent.bind(this.onDocumentDownloadedEvent),this.settings.publicScriptPath,this.settings.isStaticVersionDisplayEnabled,this.settings.disableVhsFileCache,this.settings.retryCount,this.forcePdfDevEnv)},e.prototype.logLoadFinish=function(e,t){w.addDocPLTEventToLog(e,t,L.OnVersionSelectEnd),r.a.sendTraceTag(595907803,i.a.msoulscat_Wac_WordVersionHistory,s.a.Info,"created PDF object: RevisionID: "+e+", ShowsVersionChanges: "+t+", CurrentTime: "+Date.now()+".")},e.prototype.logDownloaded=function(e,t){w.addDocPLTEventToLog(e,t,L.OnVersionDownloaded),r.a.sendTraceTag(595736131,i.a.msoulscat_Wac_WordVersionHistory,s.a.Info,"downloaded PDF file: RevisionID: "+e+", ShowsVersionChanges: "+t+", CurrentTime: "+Date.now()+".")},e.prototype.logLoadError=function(e,t,o,n){w.addDocPLTEventToLog(e,t,L.OnVersionSelectFailure),r.a.sendTraceTag(595907804,i.a.msoulscat_Wac_WordVersionHistory,s.a.Error,"onVersionSelected exception: RevisionID: "+e+", ShowsVersionChanges: "+t+", CurrentTime: "+Date.now()+", IsRenderFailure: "+o+", e: "+n+".")},e.prototype.getRenderFailureEvent=function(){return this.onRenderFailureEvent},e.prototype.getLoadFinishEvent=function(){return this.onLoadEvent},e}();o.d(t,"AppBootSettings",(function(){return n})),o.d(t,"AppVersionControllerImpl",(function(){return P})),o.d(t,"StyleDisplayBlock",(function(){return"block"})),o.d(t,"StyleDisplayNone",(function(){return"none"})),o.d(t,"StyleDisplayFlex",(function(){return"flex"})),o.d(t,"DocControllerImpl",(function(){return f})),o.d(t,"DocProxy",(function(){return S})),o.d(t,"PLTEventType",(function(){return L})),o.d(t,"VersionHistoryLogHelper",(function(){return w})),o.d(t,"Event",(function(){return b})),o.d(t,"AppStatusBar",(function(){return m})),o.d(t,"DocViewerPane",(function(){return T})),o.d(t,"getStyles",(function(){return p}))}}]);
//# sourceMappingURL=wordVersionHistory.min.js.map