/* Office runtime JavaScript library */

/*
	Copyright (c) Microsoft Corporation.  All rights reserved.
*/


/*
    Your use of this file is governed by the Microsoft Services Agreement http://go.microsoft.com/fwlink/?LinkId=266419.

    This file also contains the following Promise implementation (with a few small modifications):
        * @overview es6-promise - a tiny implementation of Promises/A+.
        * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
        * @license   Licensed under MIT license
        *            See https://raw.githubusercontent.com/jakearchibald/es6-promise/master/LICENSE
        * @version   2.3.0
*/
var __extends=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),__awaiter=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function a(e){try{l(i.next(e))}catch(e){r(e)}}function s(e){try{l(i.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((i=i.apply(e,t||[])).next())}))},__generator=this&&this.__generator||function(e,t){var n,i,o,r,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(r){return function(s){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,i=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==r[0]&&2!==r[0])){a=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){a.label=r[1];break}if(6===r[0]&&a.label<o[1]){a.label=o[1],o=r;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(r);break}o[2]&&a.ops.pop(),a.trys.pop();continue}r=t.call(e,a)}catch(e){r=[6,e],i=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,s])}}},__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},DEBUG=!0;!function(e){var t=function(){function e(){}return e.prototype.isMsAjaxLoaded=function(){return!!("undefined"!=typeof Sys&&"undefined"!=typeof Type&&Sys.StringBuilder&&"function"==typeof Sys.StringBuilder&&Type.registerNamespace&&"function"==typeof Type.registerNamespace&&Type.registerClass&&"function"==typeof Type.registerClass&&"function"==typeof Function._validateParams&&Sys.Serialization&&Sys.Serialization.JavaScriptSerializer&&"function"==typeof Sys.Serialization.JavaScriptSerializer.serialize)},e.prototype.loadMsAjaxFull=function(e){var t=("https:"===window.location.protocol.toLowerCase()?"https:":"http:")+"//ajax.aspnetcdn.com/ajax/3.5/MicrosoftAjax.js";OSF.OUtil.loadScript(t,e)},Object.defineProperty(e.prototype,"msAjaxError",{get:function(){return null==this._msAjaxError&&this.isMsAjaxLoaded()&&(this._msAjaxError=Error),this._msAjaxError},set:function(e){this._msAjaxError=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"msAjaxString",{get:function(){return null==this._msAjaxString&&this.isMsAjaxLoaded()&&(this._msAjaxString=String),this._msAjaxString},set:function(e){this._msAjaxString=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"msAjaxDebug",{get:function(){return null==this._msAjaxDebug&&this.isMsAjaxLoaded()&&(this._msAjaxDebug=Sys.Debug),this._msAjaxDebug},set:function(e){this._msAjaxDebug=e},enumerable:!1,configurable:!0}),e}();e.MicrosoftAjaxFactory=t}(OfficeExt||(OfficeExt={}));var OsfMsAjaxFactory=new OfficeExt.MicrosoftAjaxFactory,URL_DELIM="$";!function(e){var t=function(){function e(e){this._internalStorage=e}return e.prototype.getItem=function(e){try{return this._internalStorage&&this._internalStorage.getItem(e)}catch(e){return null}},e.prototype.setItem=function(e,t){try{this._internalStorage&&this._internalStorage.setItem(e,t)}catch(e){}},e.prototype.clear=function(){try{this._internalStorage&&this._internalStorage.clear()}catch(e){}},e.prototype.removeItem=function(e){try{this._internalStorage&&this._internalStorage.removeItem(e)}catch(e){}},e.prototype.getKeysWithPrefix=function(e){var t=[];try{for(var n=this._internalStorage&&this._internalStorage.length||0,i=0;i<n;i++){var o=this._internalStorage.key(i);0===o.indexOf(e)&&t.push(o)}}catch(e){}return t},e.prototype.isLocalStorageAvailable=function(){return null!=this._internalStorage},e}();e.SafeStorage=t}(OfficeExt||(OfficeExt={}));try{OSF.Flights=OSF.OUtil.parseFlights(!0),OSF.DisabledChangeGates=OSF.OUtil.parseDisabledChangeGates(!0)}catch(e){}function XDM_DEBUG(e){OsfMsAjaxFactory.msAjaxDebug.trace(e)}!function(e){!function(e){e.BaseFrameName="baseFrameName",e.HostInfo="hostInfo",e.XdmInfo="xdmInfo",e.SerializerVersion="serializerVersion",e.AppContext="appContext",e.Flights="flights",e.DisabledChangeGates="disabledChangeGates",e.OfficeJsUrl="officeJsUrl"}(e.WindowNameItemKeys||(e.WindowNameItemKeys={})),function(e){e.ConversationUrl="ConversationUrl",e.AppId="AppId"}(e.XdmFieldName||(e.XdmFieldName={})),e.Settings||(e.Settings={}),function(t){t[t.UseOriginNotUrl=0]="UseOriginNotUrl",t[t.AddinEnforceHttps=2]="AddinEnforceHttps",t[t.FirstPartyAnonymousProxyReadyCheckTimeout=6]="FirstPartyAnonymousProxyReadyCheckTimeout",t[t.AddinRibbonIdAllowUnknown=9]="AddinRibbonIdAllowUnknown",t[t.ManifestParserDevConsoleLog=15]="ManifestParserDevConsoleLog",t[t.AddinActionDefinitionHybridMode=18]="AddinActionDefinitionHybridMode",t[t.UseActionIdForUILessCommand=20]="UseActionIdForUILessCommand",t[t.SetFocusToTaskpaneIsEnabled=22]="SetFocusToTaskpaneIsEnabled",t[t.ShortcutInfoArrayInUserPreferenceData=23]="ShortcutInfoArrayInUserPreferenceData",t[t.OSFTestFlight1000=e.TestFlightStart]="OSFTestFlight1000",t[t.OSFTestFlight1001=e.TestFlightStart+1]="OSFTestFlight1001",t[t.OSFTestFlight1002=e.TestFlightStart+2]="OSFTestFlight1002",t[t.OSFTestFlight1003=e.TestFlightStart+3]="OSFTestFlight1003",t[t.OSFTestFlight1004=e.TestFlightStart+4]="OSFTestFlight1004",t[t.OSFTestFlight1005=e.TestFlightStart+5]="OSFTestFlight1005",t[t.OSFTestFlight1006=e.TestFlightStart+6]="OSFTestFlight1006",t[t.OSFTestFlight1007=e.TestFlightStart+7]="OSFTestFlight1007",t[t.OSFTestFlight1008=e.TestFlightStart+8]="OSFTestFlight1008",t[t.OSFTestFlight1009=e.TestFlightEnd]="OSFTestFlight1009"}(e.FlightNames||(e.FlightNames={})),function(e){e[e.TrustUXExperimentA=0]="TrustUXExperimentA",e[e.TrustUXExperimentB=1]="TrustUXExperimentB",e[e.TrustUXExperimentC=2]="TrustUXExperimentC"}(e.TrustUXFlightValues||(e.TrustUXFlightValues={})),function(e){e.CheckProxyIsReadyRetry="Microsoft.Office.SharedOnline.OEP.CheckProxyIsReadyRetry",e.InsertionDialogFixesEnabled="Microsoft.Office.SharedOnline.InsertionDialogFixesEnabled",e.WopiPreinstalledAddInsEnabled="Microsoft.Office.SharedOnline.WopiPreinstalledAddInsEnabled",e.WopiUseNewActivate="Microsoft.Office.SharedOnline.WopiUseNewActivate",e.EnsureStringsBeforeTrustErrorKill="Microsoft.Office.SharedOnline.EnsureStringsBeforeTrustErrorKill",e.MosManifestEnabled="Microsoft.Office.SharedOnline.OEP.MosManifest",e.MosForOmexEnabled="Microsoft.Office.SharedOnline.MosForOmexEnabled",e.MosForPrivateCatalogEnabled="Microsoft.Office.SharedOnline.MosForPrivateCatalogEnabled",e.ContextSlideShowEnvironmentEnabled="Microsoft.Office.SharedOnline.ContextSlideShowEnvironmentEnabled",e.CheckRequiredGroupIconsEnabled="Microsoft.Office.SharedOnline.OEP.CheckRequiredGroupIconsEnabled",e.OSFJSEUDB="Microsoft.Office.SharedOnline.OSFJS.EUDB",e.HostTrustDialog="Microsoft.Office.SharedOnline.HostTrustDialog",e.RequirementSetRibbonApiOnePointThreePrime="Microsoft.Office.SharedOnline.RequirementSetRibbonApiOnePointThreePrime",e.AddinDetailsServiceSupportEnabled="Microsoft.Office.SharedOnline.AddinDetailsServiceSupportEnabled",e.GetAddinFlyoutEnabled="Microsoft.Office.SharedOnline.GetAddinFlyoutEnabled"}(e.FlightTreatmentNames||(e.FlightTreatmentNames={})),e.TestFlightEnd=1009,e.TestFlightStart=1e3,e.Flights=[],e.DisabledChangeGates=[],e.IntFlights={};var t=function(){function t(){var e;this._uniqueId=-1,this._xdmInfoKey="&_xdm_Info=",this._serializerVersionKey="&_serializer_version=",this._flightsKey="&_flights=",this._disabledChangeGatesKey="&_disabledChangeGates=",this._xdmSessionKeyPrefix="_xdm_",this._serializerVersionKeyPrefix="_serializer_version=",this._flightsKeyPrefix="_flights=",this._disabledChangeGatesKeyPrefix="_disabledChangeGates=",this._fragmentSeparator="#",this._fragmentInfoDelimiter="&",this._classN="class",this._loadedScripts={},this._defaultScriptLoadingTimeout=3e4,this._safeSessionStorage=OfficeExt.IBasicStorage=null,this._safeLocalStorage=OfficeExt.IBasicStorage=null,this._rndentropy=(new Date).getTime(),this._random=function(){var e=2147483647*Math.random();return(e^=this._rndentropy^(new Date).getMilliseconds()<<Math.floor(21*Math.random())).toString(16)},this._getSessionStorage=function(){if(!this._safeSessionStorage){try{var e=window.sessionStorage}catch(t){e=null}this._safeSessionStorage=new OfficeExt.SafeStorage(e)}return this._safeSessionStorage},this._reOrderTabbableElements=function(e){var t,n,i=[],o=[],r=e.length;for(t=0;t<r;t++)(n=e[t]).tabIndex?n.tabIndex>0?o.push(n):0===n.tabIndex&&i.push(n):i.push(n);return o=o.sort((function(e,t){var n=e.tabIndex-t.tabIndex;return 0===n&&(n=o.indexOf(e)-o.indexOf(t)),n})),[].concat(o,i)},this.Guid=(e=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],{generateNewGuid:function(){for(var t="",n=(new Date).getTime(),i=0;i<32&&n>0;i++)8!=i&&12!=i&&16!=i&&20!=i||(t+="-"),t+=e[n%16],n=Math.floor(n/16);for(;i<32;i++)8!=i&&12!=i&&16!=i&&20!=i||(t+="-"),t+=e[Math.floor(16*Math.random())];return t}})}return t.prototype.isChangeGateEnabled=function(t){var n="Microsoft.Office.SharedOnline."+t.slice(t.indexOf("_")+1)+"KillSwitch";return-1===e.DisabledChangeGates.indexOf(t)&&!this.checkFlight(n)},t.prototype.set_entropy=function(e){if("string"==typeof e)for(var t=0;t<e.length;t+=4){for(var n=0,i=0;i<4&&t+i<e.length;i++)n=(n<<8)+e.charCodeAt(t+i);this._rndentropy^=n}else this._rndentropy^="number"==typeof e?e:2147483647*Math.random();this._rndentropy&=2147483647},t.prototype.extend=function(e,t){var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.uber=t.prototype,t.prototype.constructor===Object.prototype.constructor&&(t.prototype.constructor=t)},t.prototype.setNamespace=function(e,t){t&&e&&!t[e]&&(t[e]={})},t.prototype.unsetNamespace=function(e,t){t&&e&&t[e]&&delete t[e]},t.prototype.serializeSettings=function(t){var n={};for(var i in t){var o=t[i];try{o=JSON?JSON.stringify(o,(function(t,n){return e.OUtil.isDate(this[t])?e.DDA.SettingsManager.DateJSONPrefix+this[t].getTime()+e.DDA.SettingsManager.DataJSONSuffix:n})):Sys.Serialization.JavaScriptSerializer.serialize(o),n[i]=o}catch(e){}}return n},t.prototype.deserializeSettings=function(t){var n={};for(var i in t=t||{}){var o=t[i];try{o=JSON?JSON.parse(o,(function(t,n){var i;return"string"==typeof n&&n&&n.length>6&&n.slice(0,5)===e.DDA.SettingsManager.DateJSONPrefix&&n.slice(-1)===e.DDA.SettingsManager.DataJSONSuffix&&(i=new Date(parseInt(n.slice(5,-1))))?i:n})):Sys.Serialization.JavaScriptSerializer.deserialize(o,!0),n[i]=o}catch(e){}}return n},t.prototype.loadScript=function(e,t,n){var i=this;if(e&&t){var o=window.document,r=this._loadedScripts[e];if(r)r.loaded?t():r.pendingCallbacks.push(t);else{var a=o.createElement("script");a.type="text/javascript",r={loaded:!1,pendingCallbacks:[t],timer:null},this._loadedScripts[e]=r;var s=function(){null!=r.timer&&(clearTimeout(r.timer),delete r.timer),r.loaded=!0;for(var e=r.pendingCallbacks.length,t=0;t<e;t++){r.pendingCallbacks.shift()()}},l=function(t,n){delete t._loadedScripts[e],null!=r.timer&&(clearTimeout(r.timer),delete r.timer);for(var i=r.pendingCallbacks.length,o=0;o<i;o++){r.pendingCallbacks.shift()()}};a.readyState?a.onreadystatechange=function(){"loaded"!=a.readyState&&"complete"!=a.readyState||(a.onreadystatechange=null,s())}:a.onload=s,a.onerror=function(){l(i,new Event("Script load timed out"))},n=n||this._defaultScriptLoadingTimeout,r.timer=setTimeout((function(){var e;e=i,window.navigator.userAgent.indexOf("Trident")>0?l(e,null):l(e,new Event("Script load timed out"))}),n),a.setAttribute("crossOrigin","anonymous"),a.src=e,o.getElementsByTagName("head")[0].appendChild(a)}}},t.prototype.loadCSS=function(e){if(e){var t=window.document,n=t.createElement("link");n.type="text/css",n.rel="stylesheet",n.href=e,t.getElementsByTagName("head")[0].appendChild(n)}},t.prototype.parseEnum=function(e,t){var n=t[e.trim()];if(void 0===n)throw OsfMsAjaxFactory.msAjaxDebug.trace("invalid enumeration string:"+e),OsfMsAjaxFactory.msAjaxError.argument("str");return n},t.prototype.delayExecutionAndCache=function(){var e={calc:arguments[0]};return function(){return e.calc&&(e.val=e.calc.apply(this,arguments),delete e.calc),e.val}},t.prototype.getUniqueId=function(){return this._uniqueId=this._uniqueId+1,this._uniqueId.toString()},t.prototype.formatString=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e[0];return n.replace(/{(\d+)}/gm,(function(t,n){var i=parseInt(n,10)+1;return void 0===e[i]?"{"+n+"}":e[i]}))},t.prototype.generateConversationId=function(){return[this._random(),this._random(),(new Date).getTime().toString()].join("_")},t.prototype.getFrameName=function(e){return this._xdmSessionKeyPrefix+e+this.generateConversationId()},t.prototype.addXdmInfoAsHash=function(t,n){return e.OUtil.addInfoAsHash(t,this._xdmInfoKey,n,!1)},t.prototype.addSerializerVersionAsHash=function(t,n){return e.OUtil.addInfoAsHash(t,this._serializerVersionKey,n,!0)},t.prototype.addFlightsAsHash=function(t,n){return e.OUtil.addInfoAsHash(t,this._flightsKey,n,!0)},t.prototype.addDisabledChangeGatesAsHash=function(t,n){return e.OUtil.addInfoAsHash(t,this._disabledChangeGatesKey,n,!0)},t.prototype.addInfoAsHash=function(e,t,n,i){var o,r=(e=e.trim()||"").split(this._fragmentSeparator),a=r.shift(),s=r.join(this._fragmentSeparator);return o=i?[t,encodeURIComponent(n),s].join(""):[s,t,n].join(""),[a,this._fragmentSeparator,o].join("")},t.prototype.parseHostInfoFromWindowName=function(t,n){return e.OUtil.parseInfoFromWindowName(t,n,e.WindowNameItemKeys.HostInfo)},t.prototype.parseXdmInfo=function(t){var n=e.OUtil.parseXdmInfoWithGivenFragment(t,window.location.hash);return n||(n=e.OUtil.parseXdmInfoFromWindowName(t,window.name)),n},t.prototype.parseXdmInfoFromWindowName=function(t,n){return e.OUtil.parseInfoFromWindowName(t,n,e.WindowNameItemKeys.XdmInfo)},t.prototype.parseXdmInfoWithGivenFragment=function(t,n){return e.OUtil.parseInfoWithGivenFragment(this._xdmInfoKey,this._xdmSessionKeyPrefix,!1,t,n)},t.prototype.parseSerializerVersion=function(t){var n=e.OUtil.parseSerializerVersionWithGivenFragment(t,window.location.hash);return isNaN(n)&&(n=e.OUtil.parseSerializerVersionFromWindowName(t,window.name)),n},t.prototype.parseSerializerVersionFromWindowName=function(t,n){return parseInt(e.OUtil.parseInfoFromWindowName(t,n,e.WindowNameItemKeys.SerializerVersion))},t.prototype.parseSerializerVersionWithGivenFragment=function(t,n){return parseInt(e.OUtil.parseInfoWithGivenFragment(this._serializerVersionKey,this._serializerVersionKeyPrefix,!0,t,n))},t.prototype.parseFlights=function(t){var n=e.OUtil.parseFlightsWithGivenFragment(t,window.location.hash);return 0==n.length&&(n=e.OUtil.parseFlightsFromWindowName(t,window.name)),n},t.prototype.parseDisabledChangeGates=function(t){var n=e.OUtil.parseDisabledChangeGatesWithGivenFragment(t,window.location.hash);return 0==n.length&&(n=e.OUtil.parseDisabledChangeGatesFromWindowName(t,window.name)),n},t.prototype.checkFlight=function(t){return e.Flights&&e.Flights.indexOf(t)>=0},t.prototype.pushFlight=function(t){return e.Flights.indexOf(t)<0&&(e.Flights.push(t),!0)},t.prototype.getBooleanSetting=function(t){return e.OUtil.getBooleanFromDictionary(e.Settings,t)},t.prototype.getBooleanFromDictionary=function(e,t){var n=e&&t&&void 0!==e[t]&&e[t]&&("string"==typeof e[t]&&"TRUE"===e[t].toUpperCase()||"boolean"==typeof e[t]&&e[t]);return void 0!==n&&n},t.prototype.getIntFromDictionary=function(e,t){return e&&t&&void 0!==e[t]&&"string"==typeof e[t]?parseInt(e[t]):NaN},t.prototype.pushIntFlight=function(t,n){return!(t in e.IntFlights)&&(e.IntFlights[t]=n,!0)},t.prototype.getIntFlight=function(t){return e.IntFlights&&t in e.IntFlights?e.IntFlights[t]:NaN},t.prototype.parseFlightsFromWindowName=function(t,n){return e.OUtil.parseArrayWithDefault(e.OUtil.parseInfoFromWindowName(t,n,e.WindowNameItemKeys.Flights))},t.prototype.parseFlightsWithGivenFragment=function(t,n){return e.OUtil.parseArrayWithDefault(e.OUtil.parseInfoWithGivenFragment(this._flightsKey,this._flightsKeyPrefix,!0,t,n))},t.prototype.parseDisabledChangeGatesFromWindowName=function(t,n){return e.OUtil.parseArrayWithDefault(e.OUtil.parseInfoFromWindowName(t,n,e.WindowNameItemKeys.DisabledChangeGates))},t.prototype.parseDisabledChangeGatesWithGivenFragment=function(t,n){return e.OUtil.parseArrayWithDefault(e.OUtil.parseInfoWithGivenFragment(this._disabledChangeGatesKey,this._disabledChangeGatesKeyPrefix,!0,t,n))},t.prototype.parseArrayWithDefault=function(e){var t=[];try{t=JSON.parse(e)}catch(e){}return Array.isArray(t)||(t=[]),t},t.prototype.parseInfoFromWindowName=function(t,n,i){try{var o=JSON.parse(n),r=null!=o?o[i]:null,a=this._getSessionStorage();if(!t&&a&&null!=o){var s=o[e.WindowNameItemKeys.BaseFrameName]+i;r?a.setItem(s,r):r=a.getItem(s)}return r}catch(e){return null}},t.prototype.parseInfoWithGivenFragment=function(e,t,n,i,o){var r=o.split(e),a=r.length>1?r[r.length-1]:null;n&&null!=a&&(a.indexOf(this._fragmentInfoDelimiter)>=0&&(a=a.split(this._fragmentInfoDelimiter)[0]),a=decodeURIComponent(a));var s=this._getSessionStorage();if(!i&&s){var l=window.name.indexOf(t);if(l>-1){var c=window.name.indexOf(";",l);-1==c&&(c=window.name.length);var u=window.name.substring(l,c);a?s.setItem(u,a):a=s.getItem(u)}}return a},t.prototype.getConversationId=function(){var e=window.location.search,t=null;if(e){var n=e.indexOf("&");(t=n>0?e.substring(1,n):e.substr(1))&&"="===t.charAt(t.length-1)&&(t=t.substring(0,t.length-1))&&(t=decodeURIComponent(t))}return t},t.prototype.getInfoItems=function(e){var t=e.split(URL_DELIM);return void 0===t[1]&&(t=e.split("|")),void 0===t[1]&&(t=e.split("%7C")),t},t.prototype.getXdmFieldValue=function(t,n){var i="",o=e.OUtil.parseXdmInfo(n);if(o){var r=e.OUtil.getInfoItems(o);if(null!=r&&r.length>=3)switch(t){case e.XdmFieldName.ConversationUrl:i=r[2];break;case e.XdmFieldName.AppId:i=r[1]}}return i},t.prototype.validateParamObject=function(e,t,n){var i=Function._validateParams(arguments,[{name:"params",type:Object,mayBeNull:!1},{name:"expectedProperties",type:Object,mayBeNull:!1},{name:"callback",type:Function,mayBeNull:!0}]);if(i)throw i;for(var o in t)if(i=Function._validateParameter(e[o],t[o],o))throw i},t.prototype.writeProfilerMark=function(e){window.msWriteProfilerMark&&(window.msWriteProfilerMark(e),OsfMsAjaxFactory.msAjaxDebug.trace(e))},t.prototype.outputDebug=function(e){void 0!==OsfMsAjaxFactory&&OsfMsAjaxFactory.msAjaxDebug&&OsfMsAjaxFactory.msAjaxDebug.trace&&OsfMsAjaxFactory.msAjaxDebug.trace(e)},t.prototype.defineNondefaultProperty=function(e,t,n,i){for(var o in n=n||{},i){var r=i[o];null==n[r]&&(n[r]=!0)}return Object.defineProperty(e,t,n),e},t.prototype.defineNondefaultProperties=function(t,n,i){for(var o in n=n||{})e.OUtil.defineNondefaultProperty(t,o,n[o],i);return t},t.prototype.defineEnumerableProperty=function(t,n,i){return e.OUtil.defineNondefaultProperty(t,n,i,["enumerable"])},t.prototype.defineEnumerableProperties=function(t,n){return e.OUtil.defineNondefaultProperties(t,n,["enumerable"])},t.prototype.defineMutableProperty=function(t,n,i){return e.OUtil.defineNondefaultProperty(t,n,i,["writable","enumerable","configurable"])},t.prototype.defineMutableProperties=function(t,n){return e.OUtil.defineNondefaultProperties(t,n,["writable","enumerable","configurable"])},t.prototype.finalizeProperties=function(e,t){t=t||{};for(var n=Object.getOwnPropertyNames(e),i=n.length,o=0;o<i;o++){var r=n[o],a=Object.getOwnPropertyDescriptor(e,r);a.get||a.set||(a.writable=t.writable||!1),a.configurable=t.configurable||!1,a.enumerable=t.enumerable||!0,Object.defineProperty(e,r,a)}return e},t.prototype.mapList=function(e,t){var n=[];if(e)for(var i in e)n.push(t(e[i]));return n},t.prototype.listContainsKey=function(e,t){for(var n in e)if(t==n)return!0;return!1},t.prototype.listContainsValue=function(e,t){for(var n in e)if(t==e[n])return!0;return!1},t.prototype.augmentList=function(e,t){var n=e.push?function(t,n){e.push(n)}:function(t,n){e[t]=n};for(var i in t)n(i,t[i])},t.prototype.redefineList=function(e,t){for(var n in e)delete e[n];for(var i in t)e[i]=t[i]},t.prototype.isArray=function(e){return"[object Array]"===Object.prototype.toString.apply(e)},t.prototype.isFunction=function(e){return"[object Function]"===Object.prototype.toString.apply(e)},t.prototype.isDate=function(e){return"[object Date]"===Object.prototype.toString.apply(e)},t.prototype.addEventListener=function(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):Sys.Browser.agent===Sys.Browser.InternetExplorer&&e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n},t.prototype.removeEventListener=function(e,t,n){e.removeEventListener?e.removeEventListener(t,n,!1):Sys.Browser.agent===Sys.Browser.InternetExplorer&&e.detachEvent?e.detachEvent("on"+t,n):e["on"+t]=null},t.prototype.xhrGet=function(e,t,n){var i;try{(i=new XMLHttpRequest).onreadystatechange=function(){4==i.readyState&&(200==i.status?t(i.responseText):n(i.status))},i.open("GET",e,!0),i.send()}catch(e){n(e)}},t.prototype.encodeBase64=function(e){if(!e)return e;var t,n,i,o,r,a,s,l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",c=[],u=[],d=0,p=e.length;do{t=e.charCodeAt(d++),n=e.charCodeAt(d++),i=e.charCodeAt(d++),s=0,o=255&t,r=t>>8,a=255&n,u[s++]=o>>2,u[s++]=(3&o)<<4|r>>4,u[s++]=(15&r)<<2|a>>6,u[s++]=63&a,isNaN(n)||(o=n>>8,r=255&i,a=i>>8,u[s++]=o>>2,u[s++]=(3&o)<<4|r>>4,u[s++]=(15&r)<<2|a>>6,u[s++]=63&a),isNaN(n)?u[s-1]=64:isNaN(i)&&(u[s-2]=64,u[s-1]=64);for(var f=0;f<s;f++)c.push(l.charAt(u[f]))}while(d<p);return c.join("")},t.prototype.getSessionStorage=function(){return this._getSessionStorage()},t.prototype.getLocalStorage=function(){if(!this._safeLocalStorage){try{var e=window.localStorage}catch(t){e=null}this._safeLocalStorage=new OfficeExt.SafeStorage(e)}return this._safeLocalStorage},t.prototype.convertIntToCssHexColor=function(e){return"#"+(Number(e)+16777216).toString(16).slice(-6)},t.prototype.attachClickHandler=function(e,t){e.onclick=function(e){t()},e.ontouchend=function(e){t(),e.preventDefault()}},t.prototype.getQueryStringParamValue=function(e,t){var n=Function._validateParams(arguments,[{name:"queryString",type:String,mayBeNull:!1},{name:"paramName",type:String,mayBeNull:!1}]);if(n)return OsfMsAjaxFactory.msAjaxDebug.trace("OSF_Outil_getQueryStringParamValue: Parameters cannot be null."),"";var i=new RegExp("[\\?&]"+t+"=([^&#]*)","i");return i.test(e)?i.exec(e)[1]:(OsfMsAjaxFactory.msAjaxDebug.trace("OSF_Outil_getQueryStringParamValue: The parameter is not found."),"")},t.prototype.getHostnamePortionForLogging=function(e){var t=Function._validateParams(arguments,[{name:"hostname",type:String,mayBeNull:!1}]);if(t)return"";var n=e.split("."),i=n.length;return i>=2?n[i-2]+"."+n[i-1]:1==i?n[0]:void 0},t.prototype.isiOS=function(){return!!window.navigator.userAgent.match(/(iPad|iPhone|iPod)/g)},t.prototype.isChrome=function(){return window.navigator.userAgent.indexOf("Chrome")>0&&!e.OUtil.isEdge()},t.prototype.isEdge=function(){return window.navigator.userAgent.indexOf("Edge")>0},t.prototype.isIE=function(){var e=!1;try{e=window.navigator.userAgent.indexOf("Trident")>0}catch(e){}return e},t.prototype.isFirefox=function(){return window.navigator.userAgent.indexOf("Firefox")>0},t.prototype.doesUrlHaveSupportedProtocol=function(t){var n=!1;if(t)try{var i=e.OUtil.parseUrl(t,!1);n="https:"===i.protocol||"http:"===i.protocol}catch(e){this.sendTelemetryEvent("Office.Extensibility.UrlParsingForProtocolCheck",[{name:"errorMessage",string:"Fix for bug 7142881 exception hit in officeutils.ts function doesUrlHaveSupportedProtocol."},{name:"tag",string:"0x1e88019a"}]),n=null!=decodeURIComponent(t).match(/^https?:\/\/.+$/gi)}return n},t.prototype.startsWith=function(e,t,n){return n?e.substr(0,t.length)===t:e.startsWith(t)},t.prototype.containsPort=function(e,t,n,i){return this.startsWith(e,t+"//"+n+":"+i,!0)||this.startsWith(e,n+":"+i,!0)},t.prototype.getRedundandPortString=function(e,t){return e&&t?"https:"==t.protocol&&this.containsPort(e,"https:",t.hostname,"443")?":443":"http:"==t.protocol&&this.containsPort(e,"http:",t.hostname,"80")?":80":"":""},t.prototype.removeChar=function(e,t){return t<e.length-1?e.substring(0,t)+e.substring(t+1):t==e.length-1?e.substring(0,e.length-1):e},t.prototype.cleanUrlOfChar=function(e,t){var n;for(n=0;n<e.length;n++)if(e.charAt(n)===t){if(n+1>=e.length)return this.removeChar(e,n);if("/"===t){if("?"===e.charAt(n+1)||"#"===e.charAt(n+1))return this.removeChar(e,n)}else if("?"===t&&"#"===e.charAt(n+1))return this.removeChar(e,n)}return e},t.prototype.cleanUrl=function(e){if(e=this.cleanUrlOfChar(e,"/"),e=this.cleanUrlOfChar(e,"?"),"https://"==(e=this.cleanUrlOfChar(e,"#")).substr(0,8))-1!=(t=e.indexOf(":443"))&&(t!=e.length-4&&"/"!=e.charAt(t+4)&&"?"!=e.charAt(t+4)&&"#"!=e.charAt(t+4)||(e=e.substring(0,t)+e.substring(t+4)));else if("http://"==e.substr(0,7)){var t;-1!=(t=e.indexOf(":80"))&&(t!=e.length-3&&"/"!=e.charAt(t+3)&&"?"!=e.charAt(t+3)&&"#"!=e.charAt(t+3)||(e=e.substring(0,t)+e.substring(t+3)))}return e},t.prototype.parseUrl=function(t,n){if(void 0===n&&(n=!1),void 0!==t&&t){var i="NotHttps",o=this.isIE(),r={protocol:void 0,hostname:void 0,host:void 0,port:void 0,pathname:void 0,search:void 0,hash:void 0,isPortPartOfUrl:void 0};try{if(o){var a=document.createElement("a");if(a.href=t,!(a&&a.protocol&&a.host&&a.hostname&&a.href&&this.cleanUrl(a.href).toLowerCase()===this.cleanUrl(t).toLowerCase()))throw"InvalidUrl";if(e.OUtil.checkFlight(e.FlightNames.AddinEnforceHttps)&&n&&"https:"!=a.protocol)throw new Error(i);var s=this.getRedundandPortString(t,a);r.protocol=a.protocol,r.hostname=a.hostname,r.port=""==s?a.port:"",r.host=""!=s?a.hostname:a.host,r.pathname=(o?"/":"")+a.pathname,r.search=a.search,r.hash=a.hash,r.isPortPartOfUrl=this.containsPort(t,a.protocol,a.hostname,a.port)}else{var l=new URL(t);if(l&&l.protocol&&l.host&&l.hostname){if(e.OUtil.checkFlight(e.FlightNames.AddinEnforceHttps)&&n&&"https:"!=l.protocol)throw new Error(i);r.protocol=l.protocol,r.hostname=l.hostname,r.port=l.port,r.host=l.host,r.pathname=l.pathname,r.search=l.search,r.hash=l.hash,r.isPortPartOfUrl=l.host.lastIndexOf(":"+l.port)==l.host.length-l.port.length-1}}}catch(e){if(e.message===i)throw e}return r}},t.prototype.shallowCopy=function(e){if(null==e)return null;if(e instanceof Object){if(Array.isArray(e)){for(var t=[],n=0;n<e.length;n++)t.push(e[n]);return t}var i=e.constructor();for(var o in e)e.hasOwnProperty(o)&&(i[o]=e[o]);return i}return e},t.prototype.createObject=function(e){var t=null;if(e){t={};for(var n=e.length,i=0;i<n;i++)t[e[i].name]=e[i].value}return t},t.prototype.addClass=function(t,n){if(!e.OUtil.hasClass(t,n)){var i=t.getAttribute(this._classN);i?t.setAttribute(this._classN,i+" "+n):t.setAttribute(this._classN,n)}},t.prototype.removeClass=function(t,n){if(e.OUtil.hasClass(t,n)){var i=t.getAttribute(this._classN),o=new RegExp("(\\s|^)"+n+"(\\s|$)");i=i.replace(o,""),t.setAttribute(this._classN,i)}},t.prototype.hasClass=function(e,t){var n=e.getAttribute(this._classN);return n&&n.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))},t.prototype.focusToFirstTabbable=function(e,t){var n,i,o=!1,r=function(e){o=!0},a=function(e,t,n){return t<0||t>e||0===t&&n?-1:t!==e-1||n?n?t-1:t+1:-1};if(e=this._reOrderTabbableElements(e),n=t?e.length-1:0,0===e.length)return null;for(;!o&&n>=0&&n<e.length;)i=e[n],window.focus(),i.addEventListener("focus",r),i.focus(),i.removeEventListener("focus",r),n=a(e.length,n,t),o||i!==document.activeElement||(o=!0);return o?i:null},t.prototype.focusToNextTabbable=function(e,t,n){var i,o,r,a=!1,s=function(e){a=!0},l=function(e,t,n){return t<0||t>e||0===t&&n?-1:t!==e-1||n?n?t-1:t+1:-1};if(i=function(e,t){for(var n=0;n<e.length;n++)if(e[n]===t)return n;return-1}(e=this._reOrderTabbableElements(e),t),(o=l(e.length,i,n))<0)return null;for(;!a&&o>=0&&o<e.length;)(r=e[o]).addEventListener("focus",s),r.focus(),r.removeEventListener("focus",s),o=l(e.length,o,n),a||r!==document.activeElement||(a=!0);return a?r:null},t.prototype.isNullOrUndefined=function(e){return void 0===e||null===e},t.prototype.isArrayNullOrUndefinedOrEmpty=function(t){return e.OUtil.isNullOrUndefined(t)||0===t.length},t.prototype.stringEndsWith=function(t,n){if(!e.OUtil.isNullOrUndefined(t)&&!e.OUtil.isNullOrUndefined(n)){if(n.length>t.length)return!1;if(t.substr(t.length-n.length)===n)return!0}return!1},t.prototype.hashCode=function(t){var n=0;if(!e.OUtil.isNullOrUndefined(t))for(var i=0,o=t.length;i<o;)n=(n<<5)-n+t.charCodeAt(i++)|0;return n},t.prototype.getValue=function(t,n){return e.OUtil.isNullOrUndefined(t)?n:t},t.prototype.getBOMCodepointLength=function(e){return 65279===e.charCodeAt(0)?1:e.length>=3&&239===e.charCodeAt(0)&&187===e.charCodeAt(1)&&191===e.charCodeAt(2)?3:0},t.prototype.externalNativeFunctionExists=function(e){return"unknown"===e||"undefined"!==e},t.prototype.sendTelemetryEvent=function(e,t){return"undefined"!=typeof otel&&void 0!==otel.sendTelemetryEvent&&(otel.sendTelemetryEvent({name:e,dataFields:t}),!0)},t.prototype.sendActivityEvent=function(e,t,n,i){return"undefined"!=typeof otel&&void 0!==otel.sendActivityEvent&&(otel.sendActivityEvent({name:e,durationMs:t,succeeded:n,dataFields:i}),!0)},t}();e.OUtilClass=t,e.OUtil=new t}(OSF||(OSF={})),function(e){var t=function(){function e(){}return e.isInstanceOfType=function(e,t){if(null==t)return!1;if(t instanceof e)return!0;var n=t.constructor;return n&&"function"==typeof n&&n.__typeName&&"Object"!==n.__typeName||(n=Object),!(n!==e)||n.__typeName&&e.__typeName&&n.__typeName===e.__typeName},e}();e.MsAjaxTypeHelper=t;var n=function(){function e(){}return e.create=function(e,t){var n=new Error(e);if(n.message=e,t)for(var i in t)n[i]=t[i];return n.popStackFrame(),n},e.parameterCount=function(t){var n="Sys.ParameterCountException: "+(t||"Parameter count mismatch."),i=e.create(n,{name:"Sys.ParameterCountException"});return i.popStackFrame(),i},e.argument=function(t,n){var o="Sys.ArgumentException: "+(n||"Value does not fall within the expected range.");t&&(o+="\n"+i.format("Parameter name: {0}",t));var r=e.create(o,{name:"Sys.ArgumentException",paramName:t});return r.popStackFrame(),r},e.argumentNull=function(t,n){var o="Sys.ArgumentNullException: "+(n||"Value cannot be null.");t&&(o+="\n"+i.format("Parameter name: {0}",t));var r=e.create(o,{name:"Sys.ArgumentNullException",paramName:t});return r.popStackFrame(),r},e.argumentOutOfRange=function(t,n,o){var r="Sys.ArgumentOutOfRangeException: "+(o||"Specified argument was out of the range of valid values.");t&&(r+="\n"+i.format("Parameter name: {0}",t)),null!=n&&(r+="\n"+i.format("Actual value was {0}.",n));var a=e.create(r,{name:"Sys.ArgumentOutOfRangeException",paramName:t,actualValue:n});return a.popStackFrame(),a},e.argumentType=function(t,n,o,r){var a="Sys.ArgumentTypeException: ";a+=r||(n&&o?i.format("Object of type '{0}' cannot be converted to type '{1}'.",n.getName?n.getName():n,o.getName?o.getName():o):"Object cannot be converted to the required type."),t&&(a+="\n"+i.format("Parameter name: {0}",t));var s=e.create(a,{name:"Sys.ArgumentTypeException",paramName:t,actualType:n,expectedType:o});return s.popStackFrame(),s},e.argumentUndefined=function(t,n){var o="Sys.ArgumentUndefinedException: "+(n||"Value cannot be undefined.");t&&(o+="\n"+i.format("Parameter name: {0}",t));var r=e.create(o,{name:"Sys.ArgumentUndefinedException",paramName:t});return r.popStackFrame(),r},e.invalidOperation=function(t){var n="Sys.InvalidOperationException: "+(t||"Operation is not valid due to the current state of the object."),i=e.create(n,{name:"Sys.InvalidOperationException"});return i.popStackFrame(),i},e}();e.MsAjaxError=n;var i=function(){function e(){}return e.format=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var i=e;return i.replace(/{(\d+)}/gm,(function(e,n){var i=parseInt(n,10);return void 0===t[i]?"{"+n+"}":t[i]}))},e.startsWith=function(e,t){return e.substr(0,t.length)===t},e}();e.MsAjaxString=i;var o=function(){function e(){}return e.trace=function(e){},e}();if(e.MsAjaxDebug=o,!OsfMsAjaxFactory.isMsAjaxLoaded()){var r=function(e,t,n){void 0!==e.__typeName&&null!==e.__typeName||(e.__typeName=t),void 0!==e.__class&&null!==e.__class||(e.__class=n)};r(Function,"Function",!0),r(Error,"Error",!0),r(Object,"Object",!0),r(String,"String",!0),r(Boolean,"Boolean",!0),r(Date,"Date",!0),r(Number,"Number",!0),r(RegExp,"RegExp",!0),r(Array,"Array",!0),Function.createCallback||(Function.createCallback=function(e,t){var n=Function._validateParams(arguments,[{name:"method",type:Function},{name:"context",mayBeNull:!0}]);if(n)throw n;return function(){var n=arguments.length;if(n>0){for(var i=[],o=0;o<n;o++)i[o]=arguments[o];return i[n]=t,e.apply(this,i)}return e.call(this,t)}}),Function.createDelegate||(Function.createDelegate=function(e,t){var n=Function._validateParams(arguments,[{name:"instance",mayBeNull:!0},{name:"method",type:Function}]);if(n)throw n;return function(){return t.apply(e,arguments)}}),Function._validateParams||(Function._validateParams=function(e,t,n){var i,o=t.length;if(n=n||void 0===n,i=Function._validateParameterCount(e,t,n))return i.popStackFrame(),i;for(var r=0,a=e.length;r<a;r++){var s=t[Math.min(r,o-1)],l=s.name;if(s.parameterArray)l+="["+(r-o+1)+"]";else if(!n&&r>=o)break;if(i=Function._validateParameter(e[r],s,l))return i.popStackFrame(),i}return null}),Function._validateParameterCount||(Function._validateParameterCount=function(e,t,i){var o,r,a=t.length,s=e.length;if(s<a){var l=a;for(o=0;o<a;o++){var c=t[o];(c.optional||c.parameterArray)&&l--}s<l&&(r=!0)}else if(i&&s>a)for(r=!0,o=0;o<a;o++)if(t[o].parameterArray){r=!1;break}if(r){var u=n.parameterCount();return u.popStackFrame(),u}return null}),Function._validateParameter||(Function._validateParameter=function(e,t,n){var i,o=t.type,r=!!t.integer,a=!!t.domElement,s=!!t.mayBeNull;if(i=Function._validateParameterType(e,o,r,a,s,n))return i.popStackFrame(),i;var l=t.elementType,c=!!t.elementMayBeNull;if(o===Array&&null!=e&&(l||!c))for(var u=!!t.elementInteger,d=!!t.elementDomElement,p=0;p<e.length;p++){var f=e[p];if(i=Function._validateParameterType(f,l,u,d,c,n+"["+p+"]"))return i.popStackFrame(),i}return null}),Function._validateParameterType||(Function._validateParameterType=function(t,n,i,o,r,a){var s;return void 0===t?r?null:((s=e.MsAjaxError.argumentUndefined(a)).popStackFrame(),s):null===t?r?null:((s=e.MsAjaxError.argumentNull(a)).popStackFrame(),s):n&&!e.MsAjaxTypeHelper.isInstanceOfType(n,t)?((s=e.MsAjaxError.argumentType(a,typeof t,n)).popStackFrame(),s):null}),"undefined"==typeof window||window.Type||(window.Type=Function),"undefined"==typeof Type||Type.registerNamespace||(Type.registerNamespace=function(e){for(var t=e.split("."),n=window,i=0;i<t.length;i++)n[t[i]]=n[t[i]]||{},n=n[t[i]]}),"undefined"==typeof Type||Type.prototype.registerClass||(Type.prototype.registerClass=function(e){({})}),"undefined"==typeof Sys&&"undefined"!=typeof Type&&Type.registerNamespace("Sys"),Error.prototype.popStackFrame||(Error.prototype.popStackFrame=function(){if(0!==arguments.length)throw n.parameterCount();if(void 0!==this.stack&&null!==this.stack&&void 0!==this.fileName&&null!==this.fileName&&void 0!==this.lineNumber&&null!==this.lineNumber){for(var e=this.stack.split("\n"),t=e[0],i=this.fileName+":"+this.lineNumber;null!=t&&-1===t.indexOf(i);)e.shift(),t=e[0];var o=e[1];if(null!=o){var r=o.match(/@(.*):(\d+)$/);null!=r&&(this.fileName=r[1],this.lineNumber=parseInt(r[2]),e.shift(),this.stack=e.join("\n"))}}}),OsfMsAjaxFactory.msAjaxError=n,OsfMsAjaxFactory.msAjaxString=i,OsfMsAjaxFactory.msAjaxDebug=o}}(OfficeExt||(OfficeExt={})),function(e){e.appSpecificCheckOrigin=function(e,t,n,i){return!1}}(OfficeExt||(OfficeExt={})),function(e){!function(e){e[e.MsAjax=0]="MsAjax",e[e.Browser=1]="Browser"}(e.SerializerVersion||(e.SerializerVersion={}))}(OSF||(OSF={})),function(e){!function(t){!function(t){var n=function(){function t(t,n,i,o,r,a,s){var l=Function._validateParams(arguments,[{name:"requesterWindow",mayBeNull:!1},{name:"requesterUrl",type:String,mayBeNull:!1},{name:"actionName",type:String,mayBeNull:!1},{name:"conversationId",type:String,mayBeNull:!1},{name:"correlationId",mayBeNull:!1},{name:"responsetype",type:Number,maybeNull:!1},{name:"serializerVersion",type:Number,maybeNull:!0,optional:!0}]);if(l)throw l;this._requesterWindow=t,this._requesterUrl=n,this._actionName=i,this._conversationId=o,this._correlationId=r,this._invokeResultCode=e.Office.Common.InvokeResultCode.noError,this._responseType=a;var c=this;this._send=function(t){var n=function(t,n){var i=OSF.OUtil.parseUrl(t),o=OSF.OUtil.parseUrl(n);return i&&i.hostname&&o&&o.hostname?!!e.Office.Common.XdmCommunicationManager.urlCompare(i,o)||(XDM_DEBUG("Failed to execute 'postMessage' on 'DOMWindow': The target origin provided ('"+(i?i.protocol+"//"+i.hostname+(i.port?":"+i.port:""):"undefined")+"') does not match the recipient window's origin ('"+(o?o.protocol+"//"+o.hostname+(o.port?":"+o.port:""):"undefined")+"')."),!1):(XDM_DEBUG("Failed to execute 'postMessage' on 'DOMWindow': The target origin provided or the recipient window's origin are undefined."),!1)};try{if("dialogMessageReceived"===c._actionName&&"*"!==t.targetOrigin){if(t.targetOrigin&&!n(t.targetOrigin,c._requesterUrl))return}else if("dialogParentMessageReceived"===c._actionName&&t.targetOrigin&&"*"!==t.targetOrigin&&!n(t.targetOrigin,c._requesterUrl))return;var i=new e.Office.Common.Response(c._actionName,c._conversationId,c._correlationId,c._invokeResultCode,c._responseType,t),o=e.Office.Common.MessagePackager.envelope(i,s);c._requesterWindow.postMessage(o,c._requesterUrl)}catch(e){OsfMsAjaxFactory.msAjaxDebug.trace("ResponseSender._send error:"+e.message)}}}return t.prototype.getRequesterWindow=function(){return this._requesterWindow},t.prototype.getRequesterUrl=function(){return this._requesterUrl},t.prototype.getActionName=function(){return this._actionName},t.prototype.getConversationId=function(){return this._conversationId},t.prototype.getCorrelationId=function(){return this._correlationId},t.prototype.getSend=function(){return this._send},t.prototype.setResultCode=function(e){this._invokeResultCode=e},t}();t.ResponseSender=n;var i=function(t){function n(n,i,o,r,a,s,l){var c=t.call(this,n,i,o,r,a,e.Office.Common.ResponseType.forCalling,l)||this;c._postCallbackHandler=s;var u=c;return c._send=function(t,n){null!=n&&(u._invokeResultCode=n);try{var i=new e.Office.Common.Response(u._actionName,u._conversationId,u._correlationId,u._invokeResultCode,u._responseType,t),o=e.Office.Common.MessagePackager.envelope(i,l);u._requesterWindow.postMessage(o,u._requesterUrl),u._postCallbackHandler()}catch(e){OsfMsAjaxFactory.msAjaxDebug.trace("InvokeCompleteCallback._send error:"+e.message)}},c}return __extends(n,t),n}(n);t.InvokeCompleteCallback=i;var o=function(){function e(){}return e.envelope=function(e,t){return"object"==typeof e&&(e._serializerVersion=OSF.SerializerVersion.Browser),JSON.stringify(e)},e.unenvelope=function(e,t){return JSON.parse(e)},e}();t.MessagePackager=o,function(e){e[e.unknown=0]="unknown",e[e.untrusted=1]="untrusted",e[e.nothttps=2]="nothttps",e[e.trusted=3]="trusted"}(t.HostTrustStatus||(t.HostTrustStatus={})),function(e){e[e.forCalling=0]="forCalling",e[e.forEventing=1]="forEventing"}(t.ResponseType||(t.ResponseType={})),function(e){e[e.invoke=0]="invoke",e[e.registerEvent=1]="registerEvent",e[e.unregisterEvent=2]="unregisterEvent"}(t.ActionType||(t.ActionType={})),function(e){e[e.request=0]="request",e[e.response=1]="response"}(t.MessageType||(t.MessageType={})),function(e){e[e.noError=0]="noError",e[e.errorInRequest=-1]="errorInRequest",e[e.errorHandlingRequest=-2]="errorHandlingRequest",e[e.errorInResponse=-3]="errorInResponse",e[e.errorHandlingResponse=-4]="errorHandlingResponse",e[e.errorHandlingRequestAccessDenied=-5]="errorHandlingRequestAccessDenied",e[e.errorHandlingMethodCallTimedout=-6]="errorHandlingMethodCallTimedout"}(t.InvokeResultCode||(t.InvokeResultCode={})),function(e){e[e.async=0]="async",e[e.sync=1]="sync",e[e.asyncRegisterEvent=2]="asyncRegisterEvent",e[e.asyncUnregisterEvent=3]="asyncUnregisterEvent",e[e.syncRegisterEvent=4]="syncRegisterEvent",e[e.syncUnregisterEvent=5]="syncUnregisterEvent"}(t.InvokeType||(t.InvokeType={})),t.XdmCommunicationManager=function(){var t=[],n=null,i=null,o=!1,r=null,a=65e3,s=a,l={},c={},u=!1;function d(){null!==i?o||(t.length>0?p(t.shift()):(clearInterval(i),i=null)):OsfMsAjaxFactory.msAjaxDebug.trace("channel is not ready.")}function p(e){o=e.getInvokeBlockingFlag(),e.invoke(),n=(new Date).getTime()}function f(){if(r){var t,n,i=0,o=new Date;for(var a in c)for(var l in(t=c[a])._callbackList){var u=t._callbackList[l];if((n=u.timeout?u.timeout:s)>=0&&Math.abs(o.getTime()-u.createdOn)>=n)try{u.callback&&u.callback(e.Office.Common.InvokeResultCode.errorHandlingMethodCallTimedout,null)}finally{delete t._callbackList[l]}else i++}0===i&&(clearInterval(r),r=null)}else OsfMsAjaxFactory.msAjaxDebug.trace("channel is not ready.")}function m(){o=!1}function h(e,t){var n=!1;if(!(t&&"null"!==t&&t.length&&e&&e instanceof Array&&e.length))return n;var i=document.createElement("a"),o=document.createElement("a");i.href=t;for(var r=0;r<e.length&&!n;r++)-1!==e[r].indexOf("://")&&(OSF.OUtil.checkFlight(OSF.FlightNames.AddinEnforceHttps)?n=v(t,e[r]):(o.href=e[r],n=S(i,o)));return n}function g(e){if(!e||"null"===e)return!1;var t=new Array("^office-int\\.com$","^officeapps\\.live-int\\.com$","^.*\\.dod\\.online\\.office365\\.us$","^.*\\.gov\\.online\\.office365\\.us$","^.*\\.officeapps\\.live\\.com$","^.*\\.officeapps\\.live-int\\.com$","^.*\\.officeapps-df\\.live\\.com$","^.*\\.online\\.office\\.de$","^.*\\.partner\\.officewebapps\\.cn$","^.*\\.office\\.net$","^"+document.domain.replace(new RegExp("\\.","g"),"\\.")+"$");return new RegExp(t.join("|")).test(e)}function y(e,t){if(!e||!t||"null"===e||"null"===t)return!1;var n,i;OSF.OUtil.checkFlight(OSF.FlightNames.AddinEnforceHttps)?(n=OSF.OUtil.parseUrl(e,!0),i=OSF.OUtil.parseUrl(t,!0)):((n=document.createElement("a")).href=e,(i=document.createElement("a")).href=t);var o=n.protocol===i.protocol,r=n.port===i.port,a=i.hostname,s=n.hostname,l=a===s,c=!1;return!l&&a.length>s.length+1&&(c=a.slice(-(s.length+1))==="."+s),r&&o&&(l||c)}function v(e,t){return S(OSF.OUtil.parseUrl(e,!0),OSF.OUtil.parseUrl(t,!0))}function S(e,t){return!!(e&&t&&e.protocol&&t.protocol&&e.hostname&&t.hostname)&&(e.hostname==t.hostname&&e.protocol==t.protocol&&_(e,t))}function _(e,t){return e.port==t.port||""==e.port&&"http:"==e.protocol&&"80"==t.port||""==e.port&&"https:"==e.protocol&&"443"==t.port||""==t.port&&"http:"==t.protocol&&"80"==e.port||""==t.port&&"https:"==t.protocol&&"443"==e.port}function C(r){var a,s,u,f,_;if(OSF&&""!=r.data){var C,A=OSF.SerializerVersion.Browser,O=r.data;try{A=null!=(C=e.Office.Common.MessagePackager.unenvelope(O,OSF.SerializerVersion.Browser))._serializerVersion?C._serializerVersion:A}catch(e){return}if(C._messageType===e.Office.Common.MessageType.request){var T=null==r.origin||"null"===r.origin?C._origin:r.origin;try{var I=function(e){for(var t in l)if(l[t]._conversations[e])return l[t];throw OsfMsAjaxFactory.msAjaxDebug.trace("Unknown conversation Id."),OsfMsAjaxFactory.msAjaxError.argument("conversationId")}(C._conversationId),x=I._conversations[C._conversationId];A=null!=x.serializerVersion?x.serializerVersion:A;var E=[x.url].concat(I._appDomains[C._conversationId]);if(!h(E,r.origin))if(!OfficeExt.appSpecificCheckOrigin(E,r,C._origin,h))if(!y(x.url,r.origin))throw"Failed origin check";var M=null!=C._data?C._data:{};M.SecurityOrigin=r.origin;var F={controlId:x.controlId,securityOrigin:r.origin},b=I.getPolicyManager();if(b&&!b.checkPermission(C._conversationId,C._actionName,M))throw"Access Denied";var R=x.controlId;if(R){var P=function(e){if(!e)return null;var t=e._actionName;try{if(!t)throw new Error("actionName not found in messageObject");var n=void 0;switch(t){case"executeMethod":n=e._data.DdaMethod.ControlId;break;default:return null}if("string"!=typeof n)throw new Error("Failed to extract controlId from messageObject");return n}catch(e){return OsfMsAjaxFactory.msAjaxDebug.trace("XdmCommunicationManager._getControlIdFromMessageObject (actionName: "+t+") error: "+e.message),null}}(C);if(P&&P!==R)throw"Access Denied"}var N=function(t,n){var i=t._methodObjectList[n._actionName];if(!i)throw OsfMsAjaxFactory.msAjaxDebug.trace("The specified method is not registered on service endpoint:"+n._actionName),OsfMsAjaxFactory.msAjaxError.argument("messageObject");return n._actionType===e.Office.Common.ActionType.invoke?i:n._actionType===e.Office.Common.ActionType.registerEvent?i.getRegisterMethodObject():i.getUnregisterMethodObject()}(I,C),D=new e.Office.Common.InvokeCompleteCallback(r.source,T,C._actionName,C._conversationId,C._correlationId,m,A),U=new e.Office.Common.Invoker(N,M,D,I._eventHandlerProxyList,C._conversationId,C._actionName,A,F),w=!0;null==i&&((null==n||(new Date).getTime()-n>10)&&!o?(p(U),w=!1):i=setInterval(d,10)),w&&function(e){t.push(e)}(U)}catch(t){I&&I._onHandleRequestError&&I._onHandleRequestError(C,t);var L=e.Office.Common.InvokeResultCode.errorHandlingRequest;"Access Denied"==t&&(L=e.Office.Common.InvokeResultCode.errorHandlingRequestAccessDenied);var k=new e.Office.Common.Response(C._actionName,C._conversationId,C._correlationId,L,e.Office.Common.ResponseType.forCalling,t),B=e.Office.Common.MessagePackager.envelope(k,A),H=!1;try{H=!(!r.source||!r.source.postMessage)}catch(e){}var W=!1;if(window.location.href&&r.origin&&"null"!==r.origin&&y(window.location.href,r.origin))W=!0;else if(r.origin&&"null"!==r.origin)if(OSF.OUtil.checkFlight(OSF.FlightNames.AddinEnforceHttps)){W=g(OSF.OUtil.parseUrl(r.origin,!0).hostname)}else{var q=document.createElement("a");q.href=r.origin,W=g(q.hostname)}H&&W&&r.source.postMessage(B,T)}}else{if(C._messageType!==e.Office.Common.MessageType.response)return;var V=function(e){var t=c[e];return t||OsfMsAjaxFactory.msAjaxDebug.trace("Unknown conversation Id."),t}(C._conversationId);if(!V)return;if(V._serializerVersion=A,a=V._targetUrl,s=r.origin,_=!1,!(a&&s&&"null"!==a&&"null"!==s&&a.length&&s.length?(OSF.OUtil.checkFlight(OSF.FlightNames.AddinEnforceHttps)?_=v(a,s):(u=document.createElement("a"),f=document.createElement("a"),u.href=a,f.href=s,_=S(u,f)),_):_))throw"Failed orgin check";if(C._responseType===e.Office.Common.ResponseType.forCalling){var G=V._callbackList[C._correlationId];if(G)try{G.callback&&G.callback(C._errorCode,C._data)}finally{delete V._callbackList[C._correlationId]}}else{var X=V._eventHandlerList[C._actionName];null!=X&&X(C._data)}}}}function A(){u||(!function(e){if(window.addEventListener)window.addEventListener("message",e,!1);else{if(!(navigator.userAgent.indexOf("MSIE")>-1&&window.attachEvent))throw OsfMsAjaxFactory.msAjaxDebug.trace("Browser doesn't support the required API."),OsfMsAjaxFactory.msAjaxError.argument("Browser");window.attachEvent("onmessage",e)}}(C),u=!0)}return{connect:function(t,n,i,o){var r=c[t];return r||(A(),r=new e.Office.Common.ClientEndPoint(t,n,i,o),c[t]=r),r},getClientEndPoint:function(e){var t=Function._validateParams(arguments,[{name:"conversationId",type:String,mayBeNull:!1}]);if(t)throw t;return c[e]},createServiceEndPoint:function(t){A();var n=new e.Office.Common.ServiceEndPoint(t);return l[t]=n,n},getServiceEndPoint:function(e){var t=Function._validateParams(arguments,[{name:"serviceEndPointId",type:String,mayBeNull:!1}]);if(t)throw t;return l[e]},deleteClientEndPoint:function(e){var t=Function._validateParams(arguments,[{name:"conversationId",type:String,mayBeNull:!1}]);if(t)throw t;delete c[e]},deleteServiceEndPoint:function(e){var t=Function._validateParams(arguments,[{name:"serviceEndPointId",type:String,mayBeNull:!1}]);if(t)throw t;delete l[e]},urlCompare:function(e,t){return S(e,t)},checkUrlWithAppDomains:function(e,t){return h(e,t)},isTargetSubdomainOfSourceLocation:function(e,t){return y(e,t)},_setMethodTimeout:function(e){var t=Function._validateParams(arguments,[{name:"methodTimeout",type:Number,mayBeNull:!1}]);if(t)throw t;s=e<=0?a:e},_startMethodTimeoutTimer:function(){r||(r=setInterval(f,2e3))},isHostNameValidWacDomain:function(e){return g(e)},_hasSamePort:function(e,t){return _(e,t)}}}();var r=function(){function e(e,t,n){this._method=e,this._invokeType=t,this._blockingOthers=n}return e.prototype.getMethod=function(){return this._method},e.prototype.getInvokeType=function(){return this._invokeType},e.prototype.getBlockingFlag=function(){return this._blockingOthers},e}();t.MethodObject=r;var a=function(){function e(e,t){this._registerMethodObject=e,this._unregisterMethodObject=t}return e.prototype.getRegisterMethodObject=function(){return this._registerMethodObject},e.prototype.getUnregisterMethodObject=function(){return this._unregisterMethodObject},e}();t.EventMethodObject=a;var s=function(){function t(e){var t=Function._validateParams(arguments,[{name:"serviceEndPointId",type:String,mayBeNull:!1}]);if(t)throw t;this._methodObjectList={},this._eventHandlerProxyList={},this._Id=e,this._conversations={},this._policyManager=null,this._appDomains={},this._onHandleRequestError=null}return t.prototype.registerMethod=function(t,n,i,o){var r=Function._validateParams(arguments,[{name:"methodName",type:String,mayBeNull:!1},{name:"method",type:Function,mayBeNull:!1},{name:"invokeType",type:Number,mayBeNull:!1},{name:"blockingOthers",type:Boolean,mayBeNull:!1}]);if(r)throw r;if(i!==e.Office.Common.InvokeType.async&&i!==e.Office.Common.InvokeType.sync)throw OsfMsAjaxFactory.msAjaxError.argument("invokeType");var a=new e.Office.Common.MethodObject(n,i,o);this._methodObjectList[t]=a},t.prototype.unregisterMethod=function(e){var t=Function._validateParams(arguments,[{name:"methodName",type:String,mayBeNull:!1}]);if(t)throw t;delete this._methodObjectList[e]},t.prototype.registerEvent=function(t,n,i){var o=Function._validateParams(arguments,[{name:"eventName",type:String,mayBeNull:!1},{name:"registerMethod",type:Function,mayBeNull:!1},{name:"unregisterMethod",type:Function,mayBeNull:!1}]);if(o)throw o;var r=new e.Office.Common.EventMethodObject(new e.Office.Common.MethodObject(n,e.Office.Common.InvokeType.syncRegisterEvent,!1),new e.Office.Common.MethodObject(i,e.Office.Common.InvokeType.syncUnregisterEvent,!1));this._methodObjectList[t]=r},t.prototype.registerEventEx=function(t,n,i,o,r){var a=Function._validateParams(arguments,[{name:"eventName",type:String,mayBeNull:!1},{name:"registerMethod",type:Function,mayBeNull:!1},{name:"registerMethodInvokeType",type:Number,mayBeNull:!1},{name:"unregisterMethod",type:Function,mayBeNull:!1},{name:"unregisterMethodInvokeType",type:Number,mayBeNull:!1}]);if(a)throw a;var s=new e.Office.Common.EventMethodObject(new e.Office.Common.MethodObject(n,i,!1),new e.Office.Common.MethodObject(o,r,!1));this._methodObjectList[t]=s},t.prototype.unregisterEvent=function(e){var t=Function._validateParams(arguments,[{name:"eventName",type:String,mayBeNull:!1}]);if(t)throw t;this.unregisterMethod(e)},t.prototype.registerConversation=function(e,t,n,i){var o=Function._validateParams(arguments,[{name:"conversationId",type:String,mayBeNull:!1},{name:"conversationUrl",type:String,mayBeNull:!1,optional:!0},{name:"appDomains",type:Object,mayBeNull:!0,optional:!0},{name:"controlId",type:String,mayBeNull:!0,optional:!0}]);if(o)throw o;if(n){if(!(n instanceof Array))throw OsfMsAjaxFactory.msAjaxError.argument("appDomains");this._appDomains[e]=n}this._conversations[e]={url:t,controlId:i}},t.prototype.unregisterConversation=function(e){var t=Function._validateParams(arguments,[{name:"conversationId",type:String,mayBeNull:!1}]);if(t)throw t;delete this._conversations[e]},t.prototype.setPolicyManager=function(e){var t=Function._validateParams(arguments,[{name:"policyManager",type:Object,mayBeNull:!1}]);if(t)throw t;if(!e.checkPermission)throw OsfMsAjaxFactory.msAjaxError.argument("policyManager");this._policyManager=e},t.prototype.getPolicyManager=function(){return this._policyManager},t.prototype.dispose=function(){this._methodObjectList=null,this._eventHandlerProxyList=null,this._Id=null,this._conversations=null,this._policyManager=null,this._appDomains=null,this._onHandleRequestError=null},t}();t.ServiceEndPoint=s;var l=function(){function t(t,n,i,o){var r=Function._validateParams(arguments,[{name:"conversationId",type:String,mayBeNull:!1},{name:"targetWindow",mayBeNull:!1},{name:"targetUrl",type:String,mayBeNull:!1},{name:"serializerVersion",type:Number,mayBeNull:!0,optional:!0}]);if(r)throw r;try{if(!n.postMessage)throw OsfMsAjaxFactory.msAjaxError.argument("targetWindow")}catch(e){if(!Object.prototype.hasOwnProperty.call(n,"postMessage"))throw OsfMsAjaxFactory.msAjaxError.argument("targetWindow")}this._conversationId=t,this._targetWindow=n,this._targetUrl=i,this._callingIndex=0,this._callbackList={},this._eventHandlerList={},this._serializerVersion=null!=o?o:OSF.SerializerVersion.Browser,this._checkReceiverOriginAndRun=null,this._hostTrustCheckStatus=e.Office.Common.HostTrustStatus.unknown,this._checkStatusLogged=!1}return t.prototype.invoke=function(t,n,i,o){void 0===o&&(o=null);var r=Function._validateParams(arguments,[{name:"targetMethodName",type:String,mayBeNull:!1},{name:"callback",type:Function,mayBeNull:!0},{name:"param",mayBeNull:!0},{name:"trustedParams",mayBeNull:!0,optional:!0}]);if(r)throw r;var a=this,s=function(){var o=a._callingIndex++,r=new Date,s={callback:n,createdOn:r.getTime()};i&&"object"==typeof i&&"number"==typeof i.__timeout__&&(s.timeout=i.__timeout__,delete i.__timeout__),a._callbackList[o]=s;try{if(a._hostTrustCheckStatus!==e.Office.Common.HostTrustStatus.trusted&&"ContextActivationManager_getAppContextAsync"!==t)throw"Access Denied";var l=new e.Office.Common.Request(t,e.Office.Common.ActionType.invoke,a._conversationId,o,i),c=e.Office.Common.MessagePackager.envelope(l,a._serializerVersion);a._targetWindow.postMessage(c,a._targetUrl),e.Office.Common.XdmCommunicationManager._startMethodTimeoutTimer()}catch(t){try{null!==n&&n(e.Office.Common.InvokeResultCode.errorInRequest,t)}finally{delete a._callbackList[o]}}};a._checkReceiverOriginAndRun?a._checkReceiverOriginAndRun(s):(a._hostTrustCheckStatus=e.Office.Common.HostTrustStatus.trusted,s())},t.prototype.registerForEvent=function(t,n,i,o){var r=Function._validateParams(arguments,[{name:"targetEventName",type:String,mayBeNull:!1},{name:"eventHandler",type:Function,mayBeNull:!1},{name:"callback",type:Function,mayBeNull:!0},{name:"data",mayBeNull:!0,optional:!0}]);if(r)throw r;var a=this._callingIndex++,s=new Date;this._callbackList[a]={callback:i,createdOn:s.getTime()};try{var l=new e.Office.Common.Request(t,e.Office.Common.ActionType.registerEvent,this._conversationId,a,o),c=e.Office.Common.MessagePackager.envelope(l,this._serializerVersion);this._targetWindow.postMessage(c,this._targetUrl),e.Office.Common.XdmCommunicationManager._startMethodTimeoutTimer(),this._eventHandlerList[t]=n}catch(t){try{null!==i&&i(e.Office.Common.InvokeResultCode.errorInRequest,t)}finally{delete this._callbackList[a]}}},t.prototype.unregisterForEvent=function(t,n,i){var o=Function._validateParams(arguments,[{name:"targetEventName",type:String,mayBeNull:!1},{name:"callback",type:Function,mayBeNull:!0},{name:"data",mayBeNull:!0,optional:!0}]);if(o)throw o;var r=this._callingIndex++,a=new Date;this._callbackList[r]={callback:n,createdOn:a.getTime()};try{var s=new e.Office.Common.Request(t,e.Office.Common.ActionType.unregisterEvent,this._conversationId,r,i),l=e.Office.Common.MessagePackager.envelope(s,this._serializerVersion);this._targetWindow.postMessage(l,this._targetUrl),e.Office.Common.XdmCommunicationManager._startMethodTimeoutTimer()}catch(t){try{null!==n&&n(e.Office.Common.InvokeResultCode.errorInRequest,t)}finally{delete this._callbackList[r]}}finally{delete this._eventHandlerList[t]}},t}();t.ClientEndPoint=l;var c=function(){function e(e,t,n,i,o){var r=Function._validateParams(arguments,[{name:"messageType",type:Number,mayBeNull:!1},{name:"actionName",type:String,mayBeNull:!1},{name:"conversationId",type:String,mayBeNull:!1},{name:"correlationId",mayBeNull:!1},{name:"data",mayBeNull:!0,optional:!0}]);if(r)throw r;this._messageType=e,this._actionName=t,this._conversationId=n,this._correlationId=i,this._origin=window.location.origin,this._data=void 0===o?null:o}return e.prototype.getActionName=function(){return this._actionName},e.prototype.getConversationId=function(){return this._conversationId},e.prototype.getCorrelationId=function(){return this._correlationId},e.prototype.getOrigin=function(){return this._origin},e.prototype.getData=function(){return this._data},e.prototype.getMessageType=function(){return this._messageType},e}();t.Message=c;var u=function(t){function n(n,i,o,r,a){var s=t.call(this,e.Office.Common.MessageType.request,n,o,r,a)||this;return s._actionType=i,s}return __extends(n,t),n.prototype.getActionType=function(){return this._actionType},n}(c);t.Request=u;var d=function(t){function n(n,i,o,r,a,s){var l=t.call(this,e.Office.Common.MessageType.response,n,i,o,s)||this;return l._errorCode=r,l._responseType=a,l}return __extends(n,t),n.prototype.getErrorCode=function(){return this._errorCode},n.prototype.getResponseType=function(){return this._responseType},n}(c);t.Response=d;var p=function(){function t(e,t,n,i,o,r,a,s){void 0===s&&(s=null);var l=Function._validateParams(arguments,[{name:"methodObject",mayBeNull:!1},{name:"paramValue",mayBeNull:!0},{name:"invokeCompleteCallback",mayBeNull:!1},{name:"eventHandlerProxyList",mayBeNull:!0},{name:"conversationId",type:String,mayBeNull:!1},{name:"eventName",type:String,mayBeNull:!1},{name:"serializerVersion",type:Number,mayBeNull:!0,optional:!0},{name:"trustedParams",type:Object,mayBeNull:!0,optional:!0}]);if(l)throw l;this._methodObject=e,this._param=t,this._trustedParams=s,this._invokeCompleteCallback=n,this._eventHandlerProxyList=i,this._conversationId=o,this._eventName=r,this._serializerVersion=a}return t.prototype.invoke=function(){try{var t;switch(this._methodObject.getInvokeType()){case e.Office.Common.InvokeType.async:this._methodObject.getMethod()(this._param,this._invokeCompleteCallback.getSend(),this._trustedParams);break;case e.Office.Common.InvokeType.sync:t=this._methodObject.getMethod()(this._param,this._trustedParams),this._invokeCompleteCallback.getSend()(t);break;case e.Office.Common.InvokeType.syncRegisterEvent:var n=this._createEventHandlerProxyObject(this._invokeCompleteCallback);t=this._methodObject.getMethod()(n.getSend(),this._param,this._trustedParams),this._eventHandlerProxyList[this._conversationId+this._eventName]=n.getSend(),this._invokeCompleteCallback.getSend()(t);break;case e.Office.Common.InvokeType.syncUnregisterEvent:var i=this._eventHandlerProxyList[this._conversationId+this._eventName];t=this._methodObject.getMethod()(i,this._param,this._trustedParams),delete this._eventHandlerProxyList[this._conversationId+this._eventName],this._invokeCompleteCallback.getSend()(t);break;case e.Office.Common.InvokeType.asyncRegisterEvent:var o=this._createEventHandlerProxyObject(this._invokeCompleteCallback);this._methodObject.getMethod()(o.getSend(),this._invokeCompleteCallback.getSend(),this._param,this._trustedParams),this._eventHandlerProxyList[this._callerId+this._eventName]=o.getSend();break;case e.Office.Common.InvokeType.asyncUnregisterEvent:var r=this._eventHandlerProxyList[this._callerId+this._eventName];this._methodObject.getMethod()(r,this._invokeCompleteCallback.getSend(),this._param,this._trustedParams),delete this._eventHandlerProxyList[this._callerId+this._eventName]}}catch(t){this._invokeCompleteCallback.setResultCode(e.Office.Common.InvokeResultCode.errorInResponse),this._invokeCompleteCallback.getSend()(t)}},t.prototype.getInvokeBlockingFlag=function(){return this._methodObject.getBlockingFlag()},t.prototype._createEventHandlerProxyObject=function(t){return new e.Office.Common.ResponseSender(t.getRequesterWindow(),t.getRequesterUrl(),t.getActionName(),t.getConversationId(),t.getCorrelationId(),e.Office.Common.ResponseType.forEventing,this._serializerVersion)},t}();t.Invoker=p}(t.Common||(t.Common={}))}(e.Office||(e.Office={}))}(Microsoft||(Microsoft={})),function(e){!function(e){e[e.FetchBundleUrl=0]="FetchBundleUrl",e[e.LoadReactBundle=1]="LoadReactBundle",e[e.LoadBundleSuccess=2]="LoadBundleSuccess",e[e.LoadBundleError=3]="LoadBundleError"}(e.MessageIDs||(e.MessageIDs={}))}(OSF||(OSF={})),function(e){!function(e){e[e.Unsupported=0]="Unsupported",e[e.Excel=1]="Excel",e[e.Word=2]="Word",e[e.PowerPoint=4]="PowerPoint",e[e.Outlook=8]="Outlook",e[e.ExcelWebApp=16]="ExcelWebApp",e[e.WordWebApp=32]="WordWebApp",e[e.OutlookWebApp=64]="OutlookWebApp",e[e.Project=128]="Project",e[e.AccessWebApp=256]="AccessWebApp",e[e.PowerpointWebApp=512]="PowerpointWebApp",e[e.ExcelIOS=1024]="ExcelIOS",e[e.Sway=2048]="Sway",e[e.WordIOS=4096]="WordIOS",e[e.PowerPointIOS=8192]="PowerPointIOS",e[e.Access=16384]="Access",e[e.Lync=32768]="Lync",e[e.OutlookIOS=65536]="OutlookIOS",e[e.OneNoteWebApp=131072]="OneNoteWebApp",e[e.OneNote=262144]="OneNote",e[e.ExcelWinRT=524288]="ExcelWinRT",e[e.WordWinRT=1048576]="WordWinRT",e[e.PowerpointWinRT=2097152]="PowerpointWinRT",e[e.OutlookAndroid=4194304]="OutlookAndroid",e[e.OneNoteWinRT=8388608]="OneNoteWinRT",e[e.ExcelAndroid=8388609]="ExcelAndroid",e[e.VisioWebApp=8388610]="VisioWebApp",e[e.OneNoteIOS=8388611]="OneNoteIOS",e[e.WordAndroid=8388613]="WordAndroid",e[e.PowerpointAndroid=8388614]="PowerpointAndroid",e[e.Visio=8388615]="Visio",e[e.OneNoteAndroid=4194305]="OneNoteAndroid"}(e.AppName||(e.AppName={}))}(OSF||(OSF={})),function(e){!function(e){e[e.ReadOnly=0]="ReadOnly",e[e.ReadWrite=1]="ReadWrite"}(e.ClientMode||(e.ClientMode={})),function(e){e[e.DocumentLevel=0]="DocumentLevel",e[e.ContainerLevel=1]="ContainerLevel"}(e.OsfControlType||(e.OsfControlType={})),e.OfficeAppContext=function(e,t,n,i,o,r,a,s,l,c,u,d,p,f,m,h,g,y,v,S,_,C,A,O,T,I,x,E){this._id=e,this._appName=t,this._appVersion=n,this._appUILocale=i,this._dataLocale=o,this._docUrl=r,this._clientMode=a,this._settings=s,this._reason=l,this._osfControlType=c,this._eToken=u,this._correlationId=d,this._appInstanceId=p,this._touchEnabled=f,this._commerceAllowed=m,this._appMinorVersion=h,this._requirementMatrix=g,this._hostCustomMessage=y,this._hostFullVersion=v,this._isDialog=!1,this._clientWindowHeight=S,this._clientWindowWidth=_,this._addinName=C,this._appDomains=A,this._dialogRequirementMatrix=O,this._featureGates=T,this._officeTheme=I,this._initialDisplayMode=x,this._hostSettings=E,this.get_id=function(){return this._id},this.get_appName=function(){return this._appName},this.get_appVersion=function(){return this._appVersion},this.get_appUILocale=function(){return this._appUILocale},this.get_dataLocale=function(){return this._dataLocale},this.get_docUrl=function(){return this._docUrl},this.get_clientMode=function(){return this._clientMode},this.get_bindings=function(){return this._bindings},this.get_settings=function(){return this._settings},this.get_reason=function(){return this._reason},this.get_osfControlType=function(){return this._osfControlType},this.get_eToken=function(){return this._eToken},this.get_correlationId=function(){return this._correlationId},this.get_appInstanceId=function(){return this._appInstanceId},this.get_touchEnabled=function(){return this._touchEnabled},this.get_commerceAllowed=function(){return this._commerceAllowed},this.get_appMinorVersion=function(){return this._appMinorVersion},this.get_requirementMatrix=function(){return this._requirementMatrix},this.get_dialogRequirementMatrix=function(){return this._dialogRequirementMatrix},this.get_hostCustomMessage=function(){return this._hostCustomMessage},this.get_hostFullVersion=function(){return this._hostFullVersion},this.get_isDialog=function(){return this._isDialog},this.get_clientWindowHeight=function(){return this._clientWindowHeight},this.get_clientWindowWidth=function(){return this._clientWindowWidth},this.get_addinName=function(){return this._addinName},this.get_appDomains=function(){return this._appDomains},this.get_featureGates=function(){return this._featureGates},this.get_officeTheme=function(){return this._officeTheme},this.get_initialDisplayMode=function(){return this._initialDisplayMode?this._initialDisplayMode:0},this.get_hostSettings=function(){return this._hostSettings}},function(e){e[e.DialogMessageReceived=0]="DialogMessageReceived",e[e.DialogParentMessageReceived=1]="DialogParentMessageReceived",e[e.DialogClosed=12006]="DialogClosed"}(e.DialogMessageType||(e.DialogMessageType={})),function(e){e.NotificationConversationIdSuffix="_ntf"}(e.SharedConstants||(e.SharedConstants={})),function(e){e[e.Select=0]="Select",e[e.UnSelect=1]="UnSelect",e[e.CancelDialog=2]="CancelDialog",e[e.InsertAgave=3]="InsertAgave",e[e.CtrlF6In=4]="CtrlF6In",e[e.CtrlF6Exit=5]="CtrlF6Exit",e[e.CtrlF6ExitShift=6]="CtrlF6ExitShift",e[e.SelectWithError=7]="SelectWithError",e[e.NotifyHostError=8]="NotifyHostError",e[e.RefreshAddinCommands=9]="RefreshAddinCommands",e[e.PageIsReady=10]="PageIsReady",e[e.TabIn=11]="TabIn",e[e.TabInShift=12]="TabInShift",e[e.TabExit=13]="TabExit",e[e.TabExitShift=14]="TabExitShift",e[e.EscExit=15]="EscExit",e[e.F2Exit=16]="F2Exit",e[e.ExitNoFocusable=17]="ExitNoFocusable",e[e.ExitNoFocusableShift=18]="ExitNoFocusableShift",e[e.MouseEnter=19]="MouseEnter",e[e.MouseLeave=20]="MouseLeave",e[e.UpdateTargetUrl=21]="UpdateTargetUrl",e[e.InstallCustomFunctions=22]="InstallCustomFunctions",e[e.SendTelemetryEvent=23]="SendTelemetryEvent",e[e.UninstallCustomFunctions=24]="UninstallCustomFunctions",e[e.SendMessage=25]="SendMessage",e[e.LaunchExtensionComponent=26]="LaunchExtensionComponent",e[e.StopExtensionComponent=27]="StopExtensionComponent",e[e.RestartExtensionComponent=28]="RestartExtensionComponent",e[e.EnableTaskPaneHeaderButton=29]="EnableTaskPaneHeaderButton",e[e.DisableTaskPaneHeaderButton=30]="DisableTaskPaneHeaderButton",e[e.TaskPaneHeaderButtonClicked=31]="TaskPaneHeaderButtonClicked",e[e.RemoveAppCommandsAddin=32]="RemoveAppCommandsAddin",e[e.RefreshRibbonGallery=33]="RefreshRibbonGallery",e[e.GetOriginalControlId=34]="GetOriginalControlId",e[e.OfficeJsReady=35]="OfficeJsReady",e[e.InsertDevManifest=36]="InsertDevManifest",e[e.InsertDevManifestError=37]="InsertDevManifestError",e[e.SendCustomerContent=38]="SendCustomerContent",e[e.KeyboardShortcuts=39]="KeyboardShortcuts",e[e.OsfControlLoad=40]="OsfControlLoad",e[e.ClickTrust=41]="ClickTrust"}(e.AgaveHostAction||(e.AgaveHostAction={})),function(e){e.IssueCall="Agave.HostCall.IssueCall",e.ReceiveResponse="Agave.HostCall.ReceiveResponse",e.RuntimeExceptionRaised="Agave.HostCall.RuntimeExecptionRaised"}(e.HostCallPerfMarker||(e.HostCallPerfMarker={})),function(e){e.DataCoercionBegin="Agave.HostCall.CoerceDataStart",e.DataCoercionEnd="Agave.HostCall.CoerceDataEnd"}(e.InternalPerfMarker||(e.InternalPerfMarker={})),function(e){!function(e){e[e.dispidEventMin=0]="dispidEventMin",e[e.dispidInitializeEvent=0]="dispidInitializeEvent",e[e.dispidSettingsChangedEvent=1]="dispidSettingsChangedEvent",e[e.dispidDocumentSelectionChangedEvent=2]="dispidDocumentSelectionChangedEvent",e[e.dispidBindingSelectionChangedEvent=3]="dispidBindingSelectionChangedEvent",e[e.dispidBindingDataChangedEvent=4]="dispidBindingDataChangedEvent",e[e.dispidDocumentOpenEvent=5]="dispidDocumentOpenEvent",e[e.dispidDocumentCloseEvent=6]="dispidDocumentCloseEvent",e[e.dispidActiveViewChangedEvent=7]="dispidActiveViewChangedEvent",e[e.dispidDocumentThemeChangedEvent=8]="dispidDocumentThemeChangedEvent",e[e.dispidOfficeThemeChangedEvent=9]="dispidOfficeThemeChangedEvent",e[e.dispidDialogMessageReceivedEvent=10]="dispidDialogMessageReceivedEvent",e[e.dispidDialogNotificationShownInAddinEvent=11]="dispidDialogNotificationShownInAddinEvent",e[e.dispidDialogParentMessageReceivedEvent=12]="dispidDialogParentMessageReceivedEvent",e[e.dispidObjectDeletedEvent=13]="dispidObjectDeletedEvent",e[e.dispidObjectSelectionChangedEvent=14]="dispidObjectSelectionChangedEvent",e[e.dispidObjectDataChangedEvent=15]="dispidObjectDataChangedEvent",e[e.dispidContentControlAddedEvent=16]="dispidContentControlAddedEvent",e[e.dispidLiveShareStateChangedEvent=17]="dispidLiveShareStateChangedEvent",e[e.dispidActivationStatusChangedEvent=32]="dispidActivationStatusChangedEvent",e[e.dispidRichApiMessageEvent=33]="dispidRichApiMessageEvent",e[e.dispidAppCommandInvokedEvent=39]="dispidAppCommandInvokedEvent",e[e.dispidOlkItemSelectedChangedEvent=46]="dispidOlkItemSelectedChangedEvent",e[e.dispidOlkRecipientsChangedEvent=47]="dispidOlkRecipientsChangedEvent",e[e.dispidOlkAppointmentTimeChangedEvent=48]="dispidOlkAppointmentTimeChangedEvent",e[e.dispidOlkRecurrenceChangedEvent=49]="dispidOlkRecurrenceChangedEvent",e[e.dispidOlkAttachmentsChangedEvent=50]="dispidOlkAttachmentsChangedEvent",e[e.dispidOlkEnhancedLocationsChangedEvent=51]="dispidOlkEnhancedLocationsChangedEvent",e[e.dispidOlkInfobarClickedEvent=52]="dispidOlkInfobarClickedEvent",e[e.dispidTaskSelectionChangedEvent=56]="dispidTaskSelectionChangedEvent",e[e.dispidResourceSelectionChangedEvent=57]="dispidResourceSelectionChangedEvent",e[e.dispidViewSelectionChangedEvent=58]="dispidViewSelectionChangedEvent",e[e.dispidDataNodeAddedEvent=60]="dispidDataNodeAddedEvent",e[e.dispidDataNodeReplacedEvent=61]="dispidDataNodeReplacedEvent",e[e.dispidDataNodeDeletedEvent=62]="dispidDataNodeDeletedEvent",e[e.dispidEventMax=63]="dispidEventMax"}(e.EventDispId||(e.EventDispId={})),function(e){e[e.dispidMethodMin=64]="dispidMethodMin",e[e.dispidGetSelectedDataMethod=64]="dispidGetSelectedDataMethod",e[e.dispidSetSelectedDataMethod=65]="dispidSetSelectedDataMethod",e[e.dispidAddBindingFromSelectionMethod=66]="dispidAddBindingFromSelectionMethod",e[e.dispidAddBindingFromPromptMethod=67]="dispidAddBindingFromPromptMethod",e[e.dispidGetBindingMethod=68]="dispidGetBindingMethod",e[e.dispidReleaseBindingMethod=69]="dispidReleaseBindingMethod",e[e.dispidGetBindingDataMethod=70]="dispidGetBindingDataMethod",e[e.dispidSetBindingDataMethod=71]="dispidSetBindingDataMethod",e[e.dispidAddRowsMethod=72]="dispidAddRowsMethod",e[e.dispidClearAllRowsMethod=73]="dispidClearAllRowsMethod",e[e.dispidGetAllBindingsMethod=74]="dispidGetAllBindingsMethod",e[e.dispidLoadSettingsMethod=75]="dispidLoadSettingsMethod",e[e.dispidSaveSettingsMethod=76]="dispidSaveSettingsMethod",e[e.dispidGetDocumentCopyMethod=77]="dispidGetDocumentCopyMethod",e[e.dispidAddBindingFromNamedItemMethod=78]="dispidAddBindingFromNamedItemMethod",e[e.dispidAddColumnsMethod=79]="dispidAddColumnsMethod",e[e.dispidGetDocumentCopyChunkMethod=80]="dispidGetDocumentCopyChunkMethod",e[e.dispidReleaseDocumentCopyMethod=81]="dispidReleaseDocumentCopyMethod",e[e.dispidNavigateToMethod=82]="dispidNavigateToMethod",e[e.dispidGetActiveViewMethod=83]="dispidGetActiveViewMethod",e[e.dispidGetDocumentThemeMethod=84]="dispidGetDocumentThemeMethod",e[e.dispidGetOfficeThemeMethod=85]="dispidGetOfficeThemeMethod",e[e.dispidGetFilePropertiesMethod=86]="dispidGetFilePropertiesMethod",e[e.dispidClearFormatsMethod=87]="dispidClearFormatsMethod",e[e.dispidSetTableOptionsMethod=88]="dispidSetTableOptionsMethod",e[e.dispidSetFormatsMethod=89]="dispidSetFormatsMethod",e[e.dispidGetUserIdentityInfoMethod=92]="dispidGetUserIdentityInfoMethod",e[e.dispidExecuteRichApiRequestMethod=93]="dispidExecuteRichApiRequestMethod",e[e.dispidAppCommandInvocationCompletedMethod=94]="dispidAppCommandInvocationCompletedMethod",e[e.dispidCloseContainerMethod=97]="dispidCloseContainerMethod",e[e.dispidGetAccessTokenMethod=98]="dispidGetAccessTokenMethod",e[e.dispidGetAuthContextMethod=99]="dispidGetAuthContextMethod",e[e.dispidGetLiveShareStateMethod=100]="dispidGetLiveShareStateMethod",e[e.dispidSetLiveShareStateMethod=101]="dispidSetLiveShareStateMethod",e[e.dispidOpenBrowserWindow=102]="dispidOpenBrowserWindow",e[e.dispidCreateDocumentMethod=105]="dispidCreateDocumentMethod",e[e.dispidInsertFormMethod=106]="dispidInsertFormMethod",e[e.dispidDisplayRibbonCalloutAsyncMethod=109]="dispidDisplayRibbonCalloutAsyncMethod",e[e.dispidGetSelectedTaskMethod=110]="dispidGetSelectedTaskMethod",e[e.dispidGetSelectedResourceMethod=111]="dispidGetSelectedResourceMethod",e[e.dispidGetTaskMethod=112]="dispidGetTaskMethod",e[e.dispidGetResourceFieldMethod=113]="dispidGetResourceFieldMethod",e[e.dispidGetWSSUrlMethod=114]="dispidGetWSSUrlMethod",e[e.dispidGetTaskFieldMethod=115]="dispidGetTaskFieldMethod",e[e.dispidGetProjectFieldMethod=116]="dispidGetProjectFieldMethod",e[e.dispidGetSelectedViewMethod=117]="dispidGetSelectedViewMethod",e[e.dispidGetTaskByIndexMethod=118]="dispidGetTaskByIndexMethod",e[e.dispidGetResourceByIndexMethod=119]="dispidGetResourceByIndexMethod",e[e.dispidSetTaskFieldMethod=120]="dispidSetTaskFieldMethod",e[e.dispidSetResourceFieldMethod=121]="dispidSetResourceFieldMethod",e[e.dispidGetMaxTaskIndexMethod=122]="dispidGetMaxTaskIndexMethod",e[e.dispidGetMaxResourceIndexMethod=123]="dispidGetMaxResourceIndexMethod",e[e.dispidCreateTaskMethod=124]="dispidCreateTaskMethod",e[e.dispidAddDataPartMethod=128]="dispidAddDataPartMethod",e[e.dispidGetDataPartByIdMethod=129]="dispidGetDataPartByIdMethod",e[e.dispidGetDataPartsByNamespaceMethod=130]="dispidGetDataPartsByNamespaceMethod",e[e.dispidGetDataPartXmlMethod=131]="dispidGetDataPartXmlMethod",e[e.dispidGetDataPartNodesMethod=132]="dispidGetDataPartNodesMethod",e[e.dispidDeleteDataPartMethod=133]="dispidDeleteDataPartMethod",e[e.dispidGetDataNodeValueMethod=134]="dispidGetDataNodeValueMethod",e[e.dispidGetDataNodeXmlMethod=135]="dispidGetDataNodeXmlMethod",e[e.dispidGetDataNodesMethod=136]="dispidGetDataNodesMethod",e[e.dispidSetDataNodeValueMethod=137]="dispidSetDataNodeValueMethod",e[e.dispidSetDataNodeXmlMethod=138]="dispidSetDataNodeXmlMethod",e[e.dispidAddDataNamespaceMethod=139]="dispidAddDataNamespaceMethod",e[e.dispidGetDataUriByPrefixMethod=140]="dispidGetDataUriByPrefixMethod",e[e.dispidGetDataPrefixByUriMethod=141]="dispidGetDataPrefixByUriMethod",e[e.dispidGetDataNodeTextMethod=142]="dispidGetDataNodeTextMethod",e[e.dispidSetDataNodeTextMethod=143]="dispidSetDataNodeTextMethod",e[e.dispidMessageParentMethod=144]="dispidMessageParentMethod",e[e.dispidSendMessageMethod=145]="dispidSendMessageMethod",e[e.dispidExecuteFeature=146]="dispidExecuteFeature",e[e.dispidQueryFeature=147]="dispidQueryFeature",e[e.dispidMethodMax=147]="dispidMethodMax",e[e.dispidGetNestedAppAuthContextMethod=205]="dispidGetNestedAppAuthContextMethod"}(e.MethodDispId||(e.MethodDispId={})),e.getXdmEventName=function(e,t){return t==Microsoft.Office.WebExtension.EventType.BindingSelectionChanged||t==Microsoft.Office.WebExtension.EventType.BindingDataChanged||t==Microsoft.Office.WebExtension.EventType.DataNodeDeleted||t==Microsoft.Office.WebExtension.EventType.DataNodeInserted||t==Microsoft.Office.WebExtension.EventType.DataNodeReplaced?e+"_"+t:t},e.UI||(e.UI={}),e.ListDescriptors||(e.ListDescriptors={}),e.EventDescriptors||(e.EventDescriptors={}),function(e){e.AsyncResultStatus="AsyncResultStatus"}(e.PropertyDescriptors||(e.PropertyDescriptors={})),function(e){e[e.ReadOnly=1]="ReadOnly",e[e.ReadWrite=0]="ReadWrite"}(e.DocumentMode||(e.DocumentMode={}))}(e.DDA||(e.DDA={}))}(OSF||(OSF={})),function(e){!function(e){!function(e){!function(e){e.BindingType="bindingType",e.CoercionType="coercionType",e.ValueFormat="valueFormat",e.FilterType="filterType",e.Columns="columns",e.SampleData="sampleData",e.GoToType="goToType",e.SelectionMode="selectionMode",e.Id="id",e.PromptText="promptText",e.ItemName="itemName",e.FailOnCollision="failOnCollision",e.StartRow="startRow",e.StartColumn="startColumn",e.RowCount="rowCount",e.ColumnCount="columnCount",e.Callback="callback",e.AsyncContext="asyncContext",e.Data="data",e.Rows="rows",e.OverwriteIfStale="overwriteIfStale",e.FileType="fileType",e.EventType="eventType",e.Handler="handler",e.SliceSize="sliceSize",e.SliceIndex="sliceIndex",e.ActiveView="activeView",e.Status="status",e.PlatformType="platformType",e.HostType="hostType",e.Email="email",e.ForceConsent="forceConsent",e.ForceAddAccount="forceAddAccount",e.AuthChallenge="authChallenge",e.AllowConsentPrompt="allowConsentPrompt",e.ForMSGraphAccess="forMSGraphAccess",e.AllowSignInPrompt="allowSignInPrompt",e.JsonPayload="jsonPayload",e.EnableNewHosts="enableNewHosts",e.AccountTypeFilter="accountTypeFilter",e.AddinTrustId="addinTrustId",e.Reserved="reserved",e.Tcid="tcid",e.Xml="xml",e.Namespace="namespace",e.Prefix="prefix",e.XPath="xPath",e.Text="text",e.ImageLeft="imageLeft",e.ImageTop="imageTop",e.ImageWidth="imageWidth",e.ImageHeight="imageHeight",e.TaskId="taskId",e.FieldId="fieldId",e.FieldValue="fieldValue",e.ServerUrl="serverUrl",e.ListName="listName",e.ResourceId="resourceId",e.ViewType="viewType",e.ViewName="viewName",e.GetRawValue="getRawValue",e.CellFormat="cellFormat",e.TableOptions="tableOptions",e.TaskIndex="taskIndex",e.ResourceIndex="resourceIndex",e.CustomFieldId="customFieldId",e.Url="url",e.MessageHandler="messageHandler",e.Width="width",e.Height="height",e.RequireHTTPs="requireHTTPS",e.MessageToParent="messageToParent",e.DisplayInIframe="displayInIframe",e.MessageContent="messageContent",e.TargetOrigin="targetOrigin",e.HideTitle="hideTitle",e.UseDeviceIndependentPixels="useDeviceIndependentPixels",e.PromptBeforeOpen="promptBeforeOpen",e.EnforceAppDomain="enforceAppDomain",e.UrlNoHostInfo="urlNoHostInfo",e.Targetorigin="targetOrigin",e.AppCommandInvocationCompletedData="appCommandInvocationCompletedData",e.Base64="base64",e.FormId="formId"}(e.Parameters||(e.Parameters={})),function(e){e.All="all"}(e.FilterType||(e.FilterType={})),function(e){e.Unformatted="unformatted",e.Formatted="formatted"}(e.ValueFormat||(e.ValueFormat={})),function(e){e.Inserted="inserted",e.DocumentOpened="documentOpened",e.ControlActivation="controlActivation"}(e.InitializationReason||(e.InitializationReason={}))}(e.WebExtension||(e.WebExtension={}))}(e.Office||(e.Office={}))}(Microsoft||(Microsoft={}));var OSFLog,Telemetry,stringResourceFileValue="osfruntime_strings.js";(function(e){e.Constants={FileVersion:"0.0.0.0",ThreePartsFileVersion:"0.0.0",OmexAnonymousServiceName:"__omexExtensionAnonymousProxy",OmexAnonymousServiceExtension:"/anonymousserviceextension.aspx",OmexGatedServiceName:"__omexExtensionGatedProxy",OmexGatedServiceExtension:"/gatedserviceextension.aspx",OmexUnGatedServiceName:"__omexExtensionProxy",OmexUnGatedServiceExtension:"/ungatedserviceextension.aspx",OmexConsentNotificationPage:"/client/consentnotification.aspx",Http:"http",Https:"https",ProtocolSeparator:"://",SignInRedirectUrl:"/logontoliveforwac.aspx?returnurl=",ETokenParameterName:"et",ActivatedCacheKey:"__OSF_RUNTIME_.Activated.{0}.{1}.{2}",ConsentedCacheKey:"__OSF_RUNTIME_.Consented.{0}.{1}.{2}",AuthenticatedConnectMaxTries:3,IgnoreSandBoxSupport:"Ignore_SandBox_Support",IEUpgradeUrl:"https://office.microsoft.com/redir/HA102789344.aspx",OmexForceAnonymousParamName:"SKAV",OmexForceAnonymousParamValue:"274AE4CD-E50B-4342-970E-1E7F36C70037",EndPointInternalSuffix:"_internal",SPCatalogTrustedLocationsCacheKey:"__OSF_RUNTIME_.SPCatalog_TrustedLocations",StringResourceFile:stringResourceFileValue}})(OSF||(OSF={})),function(e){var t=function(){function t(){}return t.init=function(t){return e.ShortcutsMappingTableManager.init(t)},t.getShortcutInfoArrayFromShortcutKey=function(t,n){if(n<1||n>255)throw new e.OsfRuntimeError(e.OsfRuntimeErrorCode.invalidKeyCode,"Invalid parameter key code: "+n);if(0==t||!e.ActionMetadataManager.containsModifierKeys(t))throw new e.OsfRuntimeError(e.OsfRuntimeErrorCode.missingModifierKey,"Missing modifier key: "+t);return e.ShortcutsMappingTableManager.getShortcutsInfo(t,n)},t.containsModifierKeys=function(t){var n=e.ExtendedManifestUtility.getPlatformName()==e.ShortcutsMappingTableManager.s_shortcutPlatformMac;return 0!=(t&(e.ShortcutsMappingTableManager.modifierKeys.SHIFT|e.ShortcutsMappingTableManager.modifierKeys.CTRL|e.ShortcutsMappingTableManager.modifierKeys.ALT|(n?e.ShortcutsMappingTableManager.modifierKeys.COMMAND:0)))},t}();e.ActionMetadataManager=t}(OfficeExt||(OfficeExt={})),function(e){e.TelemetryProperties={ariaTenantToken:"db334b301e7b474db5e0f02f07c51a47-a1b5bc36-1bbe-482f-a64a-c2d9cb606706-7439",nexusTenantToken:1755};var t=function(){function t(){}return t.getShortcutsMappingTable=function(){return t.s_shortcutsMappingTable},t.getActionName=function(e,n){return null==t.s_actionTable?null:null!=t.s_actionTable[e]&&null!=t.s_actionTable[e][n]?t.s_actionTable[e][n]:null},t.getActionNamesByAddinId=function(e){return null==t.s_actionTable?null:t.s_actionTable[e]},t.getKeyCodeFromVirtualKey=function(e){if(!t.s_stringToKeyCodeMap){t.s_stringToKeyCodeMap={};var n=Object.keys(t.keyCodes);for(var i in n){var o=n[i],r=t.keyCodes[o],a=t.specialCharacters[r];a&&(t.s_stringToKeyCodeMap[a]=o),t.s_stringToKeyCodeMap[r.toUpperCase()]=o}}return t.s_stringToKeyCodeMap[e.toUpperCase()]},t.convertModifierKeyToNumber=function(e){var n=(e=e.trim()).toUpperCase();return null==t.modifierKeys[n]?1==n.length||t.keyCodes[n]?(Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Addin Shortcut Error: Multiple virtual key",null,null,523539530),null):(Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Addin Shortcut Error: Invalid modifier key",null,null,523539531),null):t.modifierKeys[n]},t.convertModifierKeys=function(e){for(var n=0,i=0;i<e.length;++i){if(null==e[i])return-1;var o=t.convertModifierKeyToNumber(e[i]);if(null==o)return-1;n|=o}return n},t.convertStringToKeys=function(e){var n=e.split("+");if(n.length<2)return Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Addin Shortcut Error: Invalid key combination",null,null,null),null;var i=n.splice(0,n.length-1),o=n[n.length-1],r=t.convertModifierKeys(i),a=t.convertVirtualKeyToInt(o);return-1==a||-1==r?(Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Addin Shortcut Error: Invalid key combination",null,null,523539532),null):{modifierKeys:r,virtualKey:a}},t.convertVirtualKeyToInt=function(e){var n=(e=e.trim()).toUpperCase();if(1==n.length)return n.charCodeAt(0);var i=t.getKeyCodeFromVirtualKey(n);return i||-1},t.getShortcutsInfo=function(e,n){var i=[];if(null==t.s_shortcutsMappingTable[n])return i;var o=t.s_shortcutsMappingTable[n][e];if(null==o)return i;for(var r in o)i.push({addinId:o[r].addinId,actionId:o[r].actionId,actionName:o[r].actionName});return i},t.getShortcutText=function(e,n,i){var o=t.keyCodes[n];return o||(o=String.fromCharCode(n)),t.getModifierKeyString(e,i)+"+"+o},t.getModifierKeyString=function(e,n){var i=[];return e&t.modifierKeys[t.s_controlKey.toUpperCase()]&&i.push(t.s_controlKey),e&t.modifierKeys[t.s_commandKey.toUpperCase()]&&i.push(t.s_commandKey),e&t.modifierKeys[t.s_shiftKey.toUpperCase()]&&i.push(t.s_shiftKey),e&t.modifierKeys[t.s_optionKey.toUpperCase()]&&(n||(n=t.s_shortcutPlatformWin32),n.toLowerCase()==t.s_shortcutPlatformMac?i.push(t.s_optionKey):i.push(t.s_altKey)),i.join("+")},t.getShortcutsMappingTableString=function(){return null==t.s_shortcutsMappingTable?null:JSON.stringify(t.s_shortcutsMappingTable)},t.getActionTableString=function(){return null==t.s_actionTable?null:JSON.stringify(t.s_actionTable)},t.getKeysFromShortcutPlatformAvailability=function(e){return"object"==typeof e?e[t.s_shortcutPlatformWeb]?e[t.s_shortcutPlatformWeb]:e[t.s_shortcutPlatformDefault]?e[t.s_shortcutPlatformDefault]:null:null},t.validateExtendedManifestShortcutKeys=function(n,i,o){var r=this;return e.OsfCache.get(e.OsfCache.c_osfCacheTableName,t.s_shortcutsTableCacheKey).then((function(a){var s=n.shortcuts;if(s){var l={},c={};try{a&&(c=JSON.parse(a))}catch(t){if(Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Addin Shortcut Error: Cannot parse shortcut table cache",null,null,523539533),o)throw new e.OsfRuntimeError(e.OsfRuntimeErrorCode.invalidExtendedOverride,"Addin Shortcut Error: Cannot parse shortcut table cache")}for(var u=0;u<s.length;u++){var d=t.getKeysFromShortcutPlatformAvailability(s[u].key),p=t.convertStringToKeys(d);if(null==p&&(Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Addin Shortcut Error: Invalid key combination",null,null,523539534),o))throw new e.OsfRuntimeError(e.OsfRuntimeErrorCode.invalidKeyCode,"Addin Shortcut Error: Invalid key combination");if(p.modifierKeys==r.modifierKeys.SHIFT&&(Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Addin Shortcut Error: Modifier key only contains SHIFT",null,null,523539535),o))throw new e.OsfRuntimeError(e.OsfRuntimeErrorCode.invalidKeyCode,"Addin Shortcut Error: Modifier key only contains SHIFT");if(c[p.virtualKey]&&c[p.virtualKey][p.modifierKeys]&&(c[p.virtualKey][p.modifierKeys].push({actionId:s[u].action,addinId:i}),Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("Warning: Duplicate key combination in existing cache",null,523539536)),null==l[p.virtualKey]&&(l[p.virtualKey]={}),l[p.virtualKey][p.modifierKeys]){for(var f in l[p.virtualKey][p.modifierKeys])if(l[p.virtualKey][p.modifierKeys][f].addinId==i)if(l[p.virtualKey][p.modifierKeys][f].actionId==s[u].action)Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("Addin Shortcut Error: Duplicate shortcut entry",null,523539537);else if(Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("Addin Shortcut Error: Duplicate key combination in the same add-in",null,523539538),o)throw new e.OsfRuntimeError(e.OsfRuntimeErrorCode.invalidExtendedOverride,"Addin Shortcut Error: Duplicate key combination in the same add-in")}else l[p.virtualKey][p.modifierKeys]=[];l[p.virtualKey][p.modifierKeys].push({actionId:s[u].action,addinId:i})}}}))},t.createActionsByIdTable=function(e){var t={};if(e)for(var n=0;n<e.length;n++)t[e[n].id]=e[n].name;return t},t.rebuildMappingTable=function(e){t.s_shortcutsMappingTable={},t.s_actionTable={};for(var n=0;n<e.length;n++){var i=e[n].extendedManifest.shortcuts,o=e[n].extendedManifest.actions,r=e[n].addinId,a=t.createActionsByIdTable(o);if(t.s_actionTable[r]=a,i){for(var s=0;s<i.length;s++){var l=t.getKeysFromShortcutPlatformAvailability(i[s].key),c=t.convertStringToKeys(l);if(null==c)return;var u=a[i[s].action],d={modifierKeys:c.modifierKeys,virtualKey:c.virtualKey,actionId:i[s].action,addinId:r,actionName:u||i[s].action};null==t.s_shortcutsMappingTable[c.virtualKey]&&(t.s_shortcutsMappingTable[c.virtualKey]={}),null==t.s_shortcutsMappingTable[c.virtualKey][c.modifierKeys]&&(t.s_shortcutsMappingTable[c.virtualKey][c.modifierKeys]=[]),t.s_shortcutsMappingTable[c.virtualKey][c.modifierKeys].push(d)}t.sendShortcutTelemetry(r,i.length)}}},t.sendShortcutTelemetry=function(t,n){setTimeout((function(){var i=new OSF.AddinIdInfo(t);i.getSolutionId()&&i.getStoreTypeId()?"undefined"!=typeof otel&&void 0!==otel.sendTelemetryEvent?OSF.OUtil.sendTelemetryEvent("Office.Extensibility.Shortcuts.InstallationInfo",[{name:"solutionId",string:i.getPrivacyCompliantSolutionId()},{name:"storeType",string:e.ManifestUtil.GetStoreTypeName(i.getStoreTypeId())},{name:"shortcutsCount",int64:n}])||otel.sendTelemetryEvent({name:"Office.Extensibility.Shortcuts.InstallationInfo",dataFields:[{name:"solutionId",string:i.getPrivacyCompliantSolutionId()},{name:"storeType",string:e.ManifestUtil.GetStoreTypeName(i.getStoreTypeId())},{name:"shortcutsCount",int64:n}]}):Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("The Otel isn't available, couldn't call sendOtelEvent for logging the shortcuts telemetry",null,523539540):Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("Couldn't get solutionid or storetype from the addinid",null,523539539)}),0)},t.getAllExtendedManifestAndBuildMappingTable=function(){return __awaiter(this,void 0,void 0,(function(){var n;return __generator(this,(function(i){switch(i.label){case 0:return[4,e.OsfExtendedManifestCache.getAll()];case 1:return n=i.sent(),t.rebuildMappingTable(n),[4,e.OsfCache.set(e.OsfCache.c_osfCacheTableName,t.s_shortcutsTableCacheKey,e.ShortcutsMappingTableManager.getShortcutsMappingTableString())];case 2:return i.sent(),[4,e.OsfCache.set(e.OsfCache.c_osfCacheTableName,t.s_actionTableCacheKey,e.ShortcutsMappingTableManager.getActionTableString())];case 3:return i.sent(),[2]}}))}))},t.init=function(n){return __awaiter(this,void 0,void 0,(function(){var i,o;return __generator(this,(function(r){switch(r.label){case 0:return n?[4,e.OsfCache.get(e.OsfCache.c_osfCacheTableName,t.s_shortcutsTableCacheKey)]:[3,6];case 1:return i=r.sent(),[4,e.OsfCache.get(e.OsfCache.c_osfCacheTableName,t.s_actionTableCacheKey)];case 2:return o=r.sent(),null!=i&&null!=o?[3,4]:[4,t.getAllExtendedManifestAndBuildMappingTable()];case 3:return r.sent(),[3,5];case 4:t.s_shortcutsMappingTable=JSON.parse(i),t.s_actionTable=JSON.parse(o),r.label=5;case 5:return[3,8];case 6:return[4,t.getAllExtendedManifestAndBuildMappingTable()];case 7:r.sent(),r.label=8;case 8:return[2]}}))}))},t.s_shortcutPlatformMac="macintosh",t.s_shortcutPlatformWin32="windows",t.s_shortcutsTableCacheKey="shortcutstablecache",t.s_shortcutsMappingTable={},t.s_shortcutPlatformWeb="web",t.s_shortcutPlatformDefault="default",t.s_altKey="Alt",t.s_optionKey="Option",t.s_shiftKey="Shift",t.s_controlKey="Ctrl",t.s_commandKey="Command",t.s_stringToKeyCodeMap=null,t.s_actionTableCacheKey="actiontablecache",t.s_actionTable={},t.keyCodes={18:"Alt",192:"BackQuote",220:"\\",8:"BackSpace",20:"CapsLock",188:",",17:"Ctrl",189:"-",46:"Del",40:"Down",35:"End",13:"Enter",187:"=",27:"Esc",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",36:"Home",45:"Ins",37:"Left",219:"[",91:"Meta",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",96:"NumPad0",97:"NumPad1",98:"NumPad2",99:"NumPad3",100:"NumPad4",101:"NumPad5",102:"NumPad6",103:"NumPad7",104:"NumPad8",105:"NumPad9",111:"NumPadDivide",110:"NumPadDot",109:"NumPadMinus",106:"NumPadMultiply",107:"NumPadPlus",34:"PageDown",33:"PageUp",179:"Pause",190:".",44:"PrintScreen",39:"Right",221:"]",145:"ScrollLock",186:";",222:"'",191:"/",32:"Space",9:"Tab",38:"Up",16:"Shift"},t.specialCharacters={"/":"SLASH","'":"SINGLEQUOTE",";":"SEMICOLON",".":"PERIOD","[":"LEFTBRACKET","]":"RIGHTBRACKET","=":"EQUALSIGN","-":"DASH",",":"COMMA","\\":"BACKSLASH"},t.modifierKeys={SHIFT:4,CTRL:8,CONTROL:8,ALT:32,OPTION:32,COMMAND:256},t.keyCodesToModifierKeys={4:"Shift",8:"Ctrl",32:"Alt",256:"Command"},t}();e.ShortcutsMappingTableManager=t}(OfficeExt||(OfficeExt={})),function(e){e.RibbonControlIdMap={},e.RibbonGroupIdMap={},e.RibbonGroupIdMapMLR={},e.RibbonGroupIdMapCommonMLR={},e.RibbonGroupIdMapCommonSLR={}}(OSF||(OSF={})),OSF.RibbonControlIdMap={},OSF.RibbonGroupIdMap={},OSF.RibbonGroupIdMapMLR={},OSF.RibbonGroupIdMapCommonMLR={},OSF.RibbonGroupIdMapCommonSLR={},function(e){function t(t,n,i,o){if(e.OUtil.isNullOrUndefined(i))return n;for(var r=n,a=0;a<i.length;a++)if(r=t.selectSingleNode(i[a],r),e.OUtil.isNullOrUndefined(r)){if(o)return null;break}return r}function n(t,n){var i=t;return!e.OUtil.isNullOrUndefined(n)&&n>e.VersionOverridesNumber.V1_0&&i===e.ParserStrings.Mailappor&&(i=e.ParserStrings.Mailappor.replace(":",e.VersionOverridesNumber[n]+":")),i}e.SelectSingleNode=t,e.SelectChildNodes=function(n,i,o,r,a){var s=t(n,o,r,a);return e.OUtil.isNullOrUndefined(s)?[]:n.selectNodes(i,s)},e.GetVersionOverridesString=function(t){var n="";return t>=e.VersionOverridesNumber.V1_0&&t<e.VersionOverridesNumber.Max&&(n="VersionOverridesV"+Math.floor(t/100)+"_"+t%100),n},e.GetVersionOverridesPath=function(t,i,o){var r=[];if(o>=e.VersionOverridesNumber.V1_0&&o<e.VersionOverridesNumber.Max)for(var a in e.VersionOverridesNumber){var s=Number(a);if(!isNaN(s)&&s<=o){var l=i;s>e.VersionOverridesNumber.V1_0&&(l=n(l,s),t.addNamespaceMapping(l.slice(0,-1),e.VersionOverridesNamespace[e.VersionOverridesNumber[s]])),r.push(l+e.ParserStrings.VersionOverrides)}}return r},e.GetVersionOverridesNamespace=n,e.GetNamespaceOrDefault=function(e){return e&&e.length>0?e:"ov:"}}(OSF||(OSF={})),function(e){!function(t){var n=function(e){this.name="AddinManifestError",this.message=this.name+": "+e,console.error(this.message)},i=function(e){this.name="AddinInternalError",this.message=e};function o(e,t){if(null==e)throw new n(t)}function r(e,t){for(var i="\r\n\f\b\v\t",o=0;o<i.length;++o)if(e.indexOf(i[o])>=0)throw new n(t)}var a=0,s=function(){function e(e,t,n){if(this.Images={},this.Urls={},this.LongStrings={},this.ShortStrings={},this.namespace=OSF.GetNamespaceOrDefault(t),e.manifest.getPayloadType()===OSF.PayloadType.OfficeAddin){var i,o=e.manifest._xmlProcessor,r=o.selectSingleNode("o:OfficeApp");if(e.manifest.isForOfficeAppManifest()){this.AllLocaleImages={},this.AllLocaleUrls={},this.AllLocaleLongStrings={},this.AllLocaleShortStrings={},OSF.OUtil.isNullOrUndefined(n)&&(n=OSF.VersionOverridesNumber.V1_0);var a=OSF.GetVersionOverridesPath(o,this.namespace,n);a.push(OSF.GetVersionOverridesNamespace(this.namespace,n)+OSF.ParserStrings.Resources),i=OSF.SelectSingleNode(o,r,a,!0),this.parseCollection(e,OSF.SelectChildNodes(o,"bt:Image",i,["bt:Images"]),this.Images,this.AllLocaleImages),this.parseCollection(e,OSF.SelectChildNodes(o,"bt:Url",i,["bt:Urls"]),this.Urls,this.AllLocaleUrls),this.parseCollection(e,OSF.SelectChildNodes(o,"bt:String",i,["bt:LongStrings"]),this.LongStrings,this.AllLocaleLongStrings),this.parseCollection(e,OSF.SelectChildNodes(o,"bt:String",i,["bt:ShortStrings"]),this.ShortStrings,this.AllLocaleShortStrings)}else i=OSF.SelectSingleNode(o,r,[this.namespace+"VersionOverrides",this.namespace+"Resources"]),this.parseCollection(e,OSF.SelectChildNodes(o,"bt:Image",i,["bt:Images"]),this.Images),this.parseCollection(e,OSF.SelectChildNodes(o,"bt:Url",i,["bt:Urls"]),this.Urls),this.parseCollection(e,OSF.SelectChildNodes(o,"bt:String",i,["bt:LongStrings"]),this.LongStrings),this.parseCollection(e,OSF.SelectChildNodes(o,"bt:String",i,["bt:ShortStrings"]),this.ShortStrings)}}return e.prototype.parseCollection=function(e,t,n,i){for(var o=t.length,r=0;r<o;r++){var a=t[r],s=a.getAttribute("id");OSF.OUtil.isNullOrUndefined(i)?n[s]=e.parseLocaleAwareSettingsAndGetValue(a):(i[s]={},n[s]=e.parseLocaleAwareSettingsAndGetValue(a,i[s]))}},e}();t.ManifestResourceManager=s;var l=function(){function e(e,t,n,i,o,r){this.hostType=e,this.formFactor=t,this.entitlement=n,this.manifest=i,this.namespace=OSF.GetNamespaceOrDefault(o),this.resources=new s(this,this.namespace,r),this.officeGroupCount=0,this.officeControlCount=0}return e.prototype.shouldParseNode=function(e){var t=this.manifest._xmlProcessor.selectSingleNode(this.namespace+"OverriddenByRibbonApi",e);return!(null!=t&&this.manifest._parseBooleanNode(t)&&!this.manifest.isForOfficeAppManifest())},e.prototype.shouldParseNodeFromMos=function(e){return!e.overriddenByRibbonApi},e.prototype.parseIdRequired=function(e){var t=e.getAttribute("id");return o(t,"Id required"),t},e.prototype.parseIdRequiredFromMos=function(e){var t=e.id;return o(t,"Id required"),t},e.prototype.parseLabel=function(e){var t=this.manifest._xmlProcessor.selectSingleNode(this.namespace+"Label",e);return null!=t?this.getShortString(t):null},e.prototype.parseLabelRequired=function(e){var t=this.parseLabel(e);return o(t,"Label required"),t},e.prototype.parseLabelRequiredFromMos=function(e){var t=e.label;return o(t,"Label required"),t},e.prototype.parseResId=function(e){return OSF.OUtil.isNullOrUndefined(e)?null:e.getAttribute("resid")},e.prototype.parseType=function(e){return OSF.OUtil.isNullOrUndefined(e)?null:e.getAttribute("type")},e.prototype.parseRequiredSuperTip=function(e){var t=this.parseSuperTip(e);return o(t,"SuperTip required"),t},e.prototype.parseRequiredSupertipFromMos=function(e){var t=this.parseSupertipFromMos(e);return o(t,"supertip required"),t},e.prototype.parseSuperTip=function(e){var t=null,n=this.manifest._xmlProcessor.selectSingleNode(this.namespace+"Supertip",e);if(null!=n){var i,r=n;o(n=this.manifest._xmlProcessor.selectSingleNode(this.namespace+"Title",r),"Title is necessary for SuperTip."),i=this.getShortString(n),o(n=this.manifest._xmlProcessor.selectSingleNode(this.namespace+"Description",r),"Description is necessary for SuperTip."),t={title:i,description:this.getLongString(n)},this.manifest.isForOfficeAppManifest()&&(n=this.manifest._xmlProcessor.selectSingleNode(this.namespace+"Title",r),t.titleResId=this.parseResId(n),n=this.manifest._xmlProcessor.selectSingleNode(this.namespace+"Description",r),t.descriptionResId=this.parseResId(n))}return t},e.prototype.parseSupertipFromMos=function(e){var t=null,n=e.supertip;if(null!=n){var i=n.title;o(i,"Title is necessary for Supertip."),r(i,"Invalid characters in text value: "+i);var a=n.description;o(a,"Description is necessary for Supertip."),r(a,"Invalid characters in text value: "+a),t={title:i,description:a}}return t},e.prototype.parseRequiredIcon=function(e){var t=this.parseIcon(e);return o(t,"Icon required"),t},e.prototype.parseRequiredIconFromMos=function(e){var t=this.parseIconFromMos(e);return o(t,"Icon required"),t},e.prototype.parseOptionalIcon=function(e){return this.parseIcon(e)},e.prototype.parseOptionalIconFromMos=function(e){return this.parseIcon(e)},e.prototype.parseIcon=function(e){var t=OSF.SelectChildNodes(this.manifest._xmlProcessor,"bt:Image",e,[this.namespace+"Icon"]),n=t.length;if(0==n)return null;for(var i={},o=0;o<n;o++){var r=t[o];i[r.getAttribute("size")]=this.getImageResource(r)}return i},e.prototype.parseIconFromMos=function(e){var t=e.icons,n=null==t?void 0:t.length;if(!n||0==n)return null;for(var i={},o=0,r=t;o<r.length;o++){var a=r[o];this.AddResourceMapAndGetIdHelper(a.file,this.resources.Images),i[a.size]=a.file}return i},e.prototype.parseIconResId=function(e){var t=OSF.SelectChildNodes(this.manifest._xmlProcessor,"bt:Image",e,[this.namespace+"Icon"]),n=t.length;if(0==n)return null;for(var i={},o=0;o<n;o++){var r=t[o],a=r.getAttribute("size");OSF.OUtil.isNullOrUndefined(a)||(i[a]=r.getAttribute("resid"))}return i},e.prototype.AddResourceMapAndGetIdHelper=function(e,t){o(t,"resourceMap is not found."),t[++a]=e},e.prototype.checkRequiredGroupIcons=function(e){o(e[16],"Icons are missing required size 16"),o(e[32],"Icons are missing required size 32"),o(e[80],"Icons are missing required size 80")},e.prototype.parseMultipleChildControls=function(e,t,n){for(var i=[],o=0;o<t.childNodes.length;o++)-1!==e.indexOf(t.childNodes[o].nodeName)&&i.push(t.childNodes[o]);return this.parseControls(i,n)},e.prototype.parseMultipleChildControlsFromMos=function(e,t,n){var i=[];if("Group"==e[0])for(var o=0,r=t.groups;o<r.length;o++){var a=r[o];i.push(a)}else for(var s=0,l=t.controls;s<l.length;s++){var c=l[s];i.push(c)}return this.parseControlsFromMos(i,n)},e.prototype.parseChildControls=function(e,t,n){var i=this.manifest._xmlProcessor.selectNodes(e,t);return this.parseControls(i,n)},e.prototype.parseChildControlsFromMos=function(e,t,n){var i=t.menus;return this.parseControlsFromMos(i,n)},e.prototype.parseControls=function(e,t){for(var n=[],i=e.length,r=0;r<i;r++){var a=e[r];if(this.shouldParseNode(a)){var s=t(this,a);o(s,"parser must return a control."),n.push(s)}}return n},e.prototype.parseControlsFromMos=function(e,t){for(var n=[],i=0,r=e;i<r.length;i++){var a=r[i];if(this.shouldParseNodeFromMos(a)){var s=t(this,a);o(s,"parseControlFromMos must return a control."),n.push(s)}}return n},e.prototype.parseGroupUnderTab=function(e){var t;switch(e.nodeName){case"OfficeGroup":t=new O(this.hostType),this.officeGroupCount++;break;default:t=new A(this.hostType)}return t.parse(this,e),t},e.prototype.parseGroupUnderTabFromMos=function(e){var t;return OSF.OUtil.isNullOrUndefined(e.id)?(t=new O(this.hostType),this.officeGroupCount++):t=new A(this.hostType),t.parseFromMos(this,e),t},e.prototype.parseControlInGroup=function(e){var t,i=this.manifest.getNodeXsiType(e);switch(i||"OfficeControl"!==e.nodeName||(i="OfficeControl"),i){case"Menu":t=new g(i,this.namespace);break;case"Button":t=new v(i,this.namespace);break;case"OfficeControl":t=new _,this.officeControlCount++;break;default:throw new n("Unsupported control type.")}return t.parse(this,e),t},e.prototype.parseControlInGroupFromMos=function(e){var t,i=e.type;switch(OSF.OUtil.isNullOrUndefined(i)&&(i="OfficeControl"),i){case"menu":t=new g("Menu");break;case"button":t=new v("Button");break;case"OfficeControl":t=new _,this.officeControlCount++;break;default:throw new n("Unsupported control type.")}return t.parseFromMos(this,e),t},e.prototype.parseMenuItem=function(e){var t=new S(this.namespace);return t.parse(this,e),t},e.prototype.parseMenuItemFromMos=function(e){var t=new S;return t.parseFromMos(this,e),t},e.prototype.parseLocaleAwareSettingsAndGetValue=function(e,t){var n=!OSF.OUtil.isNullOrUndefined(t),i=n?t:{},o=e.getAttribute("DefaultValue");i[this.manifest._defaultLocale]=o,i[this.manifest._defaultLocale.toLocaleLowerCase()]=o;var r=this.manifest._xmlProcessor.selectNodes("bt:Override",e);if(r)for(var a=r.length,s=0;s<a;s++){var l=(e=r[s]).getAttribute("Locale"),c=e.getAttribute("Value");n||(i[l]=c),i[l.toLocaleLowerCase()]=c,this.manifest.isForOfficeAppManifest()&&this.manifest.addLocaleSeen(l)}return this.manifest._getDefaultValue(i)},e.prototype.selectSingleNode=function(e,t){if(null==t)return e;for(var n=0;n<t.length&&null!=(e=this.manifest._xmlProcessor.selectSingleNode(t[n],e));n++);return e},e.prototype.selectChildNodes=function(e,t,n){return null==(t=this.selectSingleNode(t,n))?[]:this.manifest._xmlProcessor.selectNodes(e,t)},e.prototype.getSingleNodeValue=function(e,t){var n=this.manifest._xmlProcessor.selectSingleNode(e,t);return n?this.manifest._xmlProcessor.getNodeValue(n):""},e.prototype.getResourceByNode=function(e,t){var n=t.getAttribute("resid"),i=e[n];return this.manifest.isForOfficeAppManifest()&&OSF.OUtil.isNullOrUndefined(i)?(this.manifest.converterLogging()&&console.error("[31m%s[0m","WARNING: resid: "+n+" is not defined."),i=""):o(i,"resid: "+n+" not found"),i},e.prototype.getImageResource=function(e){return this.getResourceByNode(this.resources.Images,e)},e.prototype.getUrlResource=function(e){return this.getResourceByNode(this.resources.Urls,e)},e.prototype.getLongString=function(e){var t=this.getResourceByNode(this.resources.LongStrings,e);return r(t,"Invalid characters in text value: "+t),t},e.prototype.getShortString=function(e){var t=this.getResourceByNode(this.resources.ShortStrings,e);return r(t,"Invalid characters in text value: "+t),t},e.prototype.getContextMenuType=function(e){switch(null==e?void 0:e.type){case"cell":return"ContextMenuCell";case"text":return"ContextMenuText";default:throw new n("Unsupported context menu type.")}},e}();t.ParsingContext=l;var c=function(){function e(){}return e.buildControls=function(e,t){for(var n=t.length,i=0;i<n;i++){t[i].apply(e)}},e}(),u=function(e,t,n){void 0===n&&(n=!1),this.multipleCustomTabsEnabled=!1,this.functionFile=e,this.builder=t,this.multipleCustomTabsEnabled=n},d=function(){function e(e){this.namespace=OSF.GetNamespaceOrDefault(e)}return e.prototype.parse=function(e,t){var n=e.manifest._xmlProcessor,i=n.selectSingleNode(this.namespace+"Title",t);o(i,"Title is necessary for GetStarted."),this.title=e.getShortString(i);var r=n.selectSingleNode(this.namespace+"Description",t);o(r,"Description is necessary for GetStarted."),this.description=e.getLongString(r);var a=n.selectSingleNode(this.namespace+"LearnMoreUrl",t);this.learnMoreUrl=e.getUrlResource(a)},e.prototype.parseFromMos=function(e,t){this.title=t.title,this.description=t.description,this.learnMoreUrl=t.learnMoreUrl},e}(),p=function(){function e(e,t){this.type=e,this.namespace=OSF.GetNamespaceOrDefault(t)}return e.prototype.buildAction=function(e){},e.prototype.parse=function(e,t){},e.prototype.parseFromMos=function(e,t){},e}(),f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.pinnable=!1,t}return __extends(t,e),t.prototype.buildAction=function(e){return e.actionBuilder.buildShowTaskpane(this.sourceLocation,this.title,this.taskpaneId,this.sourceLocationResid)},t.prototype.parse=function(t,n){e.prototype.parse.call(this,t,n);var i=t.manifest._xmlProcessor.selectSingleNode(this.namespace+"TaskpaneId",n);if(null!=i&&(this.taskpaneId=i.firstChild.nodeValue),null!=(i=t.manifest._xmlProcessor.selectSingleNode(this.namespace+"SourceLocation ",n))&&(this.sourceLocationResid=i.getAttribute("resid")),null!=(i=t.manifest._xmlProcessor.selectSingleNode(this.namespace+"Title",n))&&(this.title=t.getShortString(i)),t.manifest.isForOfficeAppManifest()){var o=t.manifest._xmlProcessor.selectSingleNode(this.namespace+"SupportsPinning",n);null!=o&&(this.pinnable=t.manifest._parseBooleanNode(o))}},t.prototype.parseFromMos=function(t,n){e.prototype.parseFromMos.call(this,t,n);var i=t.manifest.getExtensionRuntimeByActionId(n.id);if(!OSF.OUtil.isNullOrUndefined(i)){this.sourceLocationResid=i.id,this.taskpaneId=null;var o=t.manifest.getExtensionActionById(n.id);OSF.OUtil.isNullOrUndefined(o)||OSF.OUtil.isNullOrUndefined(o.view)||(this.taskpaneId=o.view),OSF.OUtil.isNullOrUndefined(o.displayName)||(this.title=o.displayName)}},t}(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.title=null,t}return __extends(t,e),t.prototype.parse=function(e,t){var n=e.manifest._xmlProcessor.selectSingleNode(this.namespace+"SourceLocation",t);o(n,"SourceLocation is necessary for ShowTaskpane action"),this.sourceLocation=e.getUrlResource(n),e.manifest.addManifestUrl(this.sourceLocation)},t.prototype.parseFromMos=function(e,t){var n=e.manifest.getExtensionRuntimeByActionId(t.id);this.sourceLocation=n.code.page,e.manifest.addManifestUrl(this.sourceLocation)},t}(p)),m=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.buildAction=function(e){return o(e.functionFile,"Function file source url is necessary for ExecuteFunctionAction."),e.actionBuilder.buildCallFunction(e.functionFile,this.functionName,this.controlId)},t.prototype.parse=function(e,t){var n=e.manifest._xmlProcessor.selectSingleNode(this.namespace+"FunctionName",t);o(n,"FunctionName is necessary for ExecuteFunctionAction."),this.functionName=e.manifest._xmlProcessor.getNodeValue(n)},t.prototype.parseFromMos=function(e,t){var n=t.displayName;o(n,"Parsing from Mos: FunctionName is necessary for ExecuteFunctionAction."),this.functionName=n},t}(p),h=function(){function e(){}return e.prototype.parse=function(e,t){this.id=e.parseIdRequired(t),this.label=e.parseLabelRequired(t)},e.prototype.parseFromMos=function(e,t){this.id=e.parseIdRequiredFromMos(t),this.label=e.parseLabelRequiredFromMos(t)},e}(),g=function(e){function t(t,n){var i=e.call(this)||this;return i.controlType=t,i.namespace=OSF.GetNamespaceOrDefault(n),i}return __extends(t,e),t.prototype.apply=function(e){e.controlBuilder.startBuildMenu(this),c.buildControls(e,this.children),e.controlBuilder.endBuildMenu()},t.prototype.parse=function(t,n){if(t.shouldParseNode(n)){e.prototype.parse.call(this,t,n),this.icon=t.parseRequiredIcon(n),t.manifest.isForOfficeAppManifest()&&(this.iconResId=t.parseIconResId(n)),this.superTip=t.parseRequiredSuperTip(n);var i=OSF.SelectChildNodes(t.manifest._xmlProcessor,this.namespace+"Item",n,[this.namespace+"Items"]);if(t.manifest.isForOfficeAppManifest()){var o;o=t.manifest._xmlProcessor.selectSingleNode(t.namespace+"Label",n),this.labelResId=t.parseResId(o)}this.children=t.parseControls(i,(function(e,t){return e.parseMenuItem(t)}))}},t.prototype.parseFromMos=function(t,n){if(t.shouldParseNodeFromMos(n)){e.prototype.parseFromMos.call(this,t,n),this.icon=t.parseRequiredIconFromMos(n),this.superTip=t.parseRequiredSupertipFromMos(n);var i=n.items;this.children=t.parseControlsFromMos(i,(function(e,t){return e.parseMenuItemFromMos(t)}))}},t}(h);t.MenuControl=g;var y=function(e){function t(t,n){var i=e.call(this)||this;return i.enabled=!0,i.controlType=t,i.namespace=OSF.GetNamespaceOrDefault(n),i}return __extends(t,e),t.prototype.apply=function(e){var t=this.action.buildAction(e),n={id:this.id,label:this.label,icon:this.icon,superTip:this.superTip,actionType:this.actionType,action:t,enabled:this.enabled};this.applyControl(e,n)},t.prototype.parse=function(t,i){e.prototype.parse.call(this,t,i),this.icon=this.parseIcon(t,i),t.manifest.isForOfficeAppManifest()&&(this.iconResId=t.parseIconResId(i)),this.superTip=t.parseRequiredSuperTip(i);var r=t.manifest._xmlProcessor.selectSingleNode(this.namespace+"Action",i);o(r,"Action is necessary for itemControl.");var a,s=t.manifest.getNodeXsiType(r);switch(s){case"ShowTaskpane":a=new f(s,this.namespace);break;case"ExecuteFunction":(a=new m(s,this.namespace)).controlId=this.id;break;default:throw new n("Unsupported action type.")}a.parse(t,r),this.actionType=s,this.action=a;var l=t.manifest._xmlProcessor.selectSingleNode(this.namespace+"Enabled",i);if(null!=l&&(this.enabled=t.manifest._parseBooleanNode(l)),t.manifest.isForOfficeAppManifest()){var c;c=t.manifest._xmlProcessor.selectSingleNode(t.namespace+"Label",i),this.labelResId=t.parseResId(c)}},t.prototype.parseFromMos=function(t,i){e.prototype.parseFromMos.call(this,t,i),this.icon=this.parseIconFromMos(t,i),this.superTip=t.parseRequiredSupertipFromMos(i);var r=t.manifest.getExtensionActionById(i.actionId);o(r,"Parsing from Mos: Action is necessary for itemControl.");var a,s=function(e){var t=e.type;return"openPage"===t?"ShowTaskpane":"executeFunction"===t?"ExecuteFunction":t}(r);switch(s){case"ShowTaskpane":a=new f(s,this.namespace);break;case"ExecuteFunction":(a=new m(s,this.namespace)).controlId=this.id;break;default:throw new n("Parsing from Mos: Unsupported action type.")}a.parseFromMos(t,r),this.actionType=s,this.action=a,this.enabled=!i.enabled||i.enabled},t.prototype.applyControl=function(e,t){throw new i("Not implemented method applyControl for ItemControl.")},t.prototype.parseIcon=function(e,t){return e.parseIcon(t)},t.prototype.parseIconFromMos=function(e,t){return e.parseIconFromMos(t)},t}(h),v=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.applyControl=function(e,t){e.controlBuilder.addButton(t)},t.prototype.parseIcon=function(e,t){return e.parseRequiredIcon(t)},t}(y),S=function(e){function t(t){return e.call(this,"MenuItem",t)||this}return __extends(t,e),t.prototype.applyControl=function(e,t){e.controlBuilder.addMenuItem(t)},t}(y),_=function(e){function t(){var t=e.call(this,"OfficeControl")||this;return t.label=null,t.icon=null,t.superTip=null,t.actionType=null,t.action=null,t.enabled=!0,t}return __extends(t,e),t.prototype.apply=function(e){var t={id:this.id,label:this.label,icon:this.icon,superTip:this.superTip,actionType:this.actionType,action:this.action,enabled:this.enabled};this.applyControl(e,t)},t.prototype.parse=function(e,t){try{this.id=e.parseIdRequired(t)}catch(e){throw new n("Required id attribute missing for OfficeControl.")}if(OSF.RibbonControlIdMap&&OSF.RibbonControlIdMap[this.id])this.id=OSF.RibbonControlIdMap[this.id];else if(!OSF.OUtil.checkFlight(OSF.FlightNames.AddinRibbonIdAllowUnknown))throw new n("Unsupported control id for OfficeControl.")},t.prototype.parseFromMos=function(e,t){if(this.id=t.builtInControlId,o(this.id,"Built in control id is required."),OSF.RibbonControlIdMap&&OSF.RibbonControlIdMap[this.id])this.id=OSF.RibbonControlIdMap[this.id];else if(!OSF.OUtil.checkFlight(OSF.FlightNames.AddinRibbonIdAllowUnknown))throw new n("Unsupported control id for OfficeControl.")},t.prototype.applyControl=function(e,t){e.controlBuilder.addNativeControl(t)},t}(y),C=function(){function e(e,t){this.label=null,this.isOfficeTab=!1,this.visible=!0,this.children=[],this.tabType="default",this.insertBefore="",this.insertAfter="",this.autoFocus=!1,this.isOfficeTab=e,this.namespace=OSF.GetNamespaceOrDefault(t)}return e.prototype.apply=function(e){e.builder.ribbonBuilder.startBuildTab(this);for(var t=this.children.length,n=0;n<t;n++){this.children[n].apply(e)}e.builder.ribbonBuilder.endBuildTab()},e.prototype.parse=function(e,t){this.id=e.parseIdRequired(t),this.isOfficeTab||(this.label=e.parseLabelRequired(t),OSF.Settings.IsReactRibbonEnabled&&(this.insertBefore=e.getSingleNodeValue(this.namespace+"InsertBefore",t),this.insertAfter=e.getSingleNodeValue(this.namespace+"InsertAfter",t),this.insertBefore&&("TabHome"===this.insertBefore&&(this.autoFocus=!0),e.insertBefore=this.insertBefore),this.insertAfter&&(e.insertAfter=this.insertAfter))),OSF.Settings.IsReactRibbonEnabled?this.children=e.parseMultipleChildControls(["Group","OfficeGroup"],t,(function(e,t){return e.parseGroupUnderTab(t)})):this.children=e.parseMultipleChildControls(["Group"],t,(function(e,t){return e.parseGroupUnderTab(t)}))},e.prototype.parseFromMos=function(e,t){if(this.isOfficeTab)this.id=t.builtInTabId,o(this.id,"Built in tab id is required.");else if(this.id=e.parseIdRequiredFromMos(t),this.label=e.parseLabelRequiredFromMos(t),OSF.Settings.IsReactRibbonEnabled){var i=t.position.align;if("before"===i)this.insertBefore=t.position.builtInTabId,OSF.OUtil.isNullOrUndefined(this.insertBefore)||("TabHome"===this.insertBefore&&(this.autoFocus=!0),e.insertBefore=this.insertBefore);else{if("after"!==i)throw new n("Unsupported insert position");this.insertAfter=t.position.builtInTabId,OSF.OUtil.isNullOrUndefined(this.insertAfter)||(e.insertAfter=this.insertAfter)}}OSF.Settings.IsReactRibbonEnabled?this.children=e.parseMultipleChildControlsFromMos(["Group","OfficeGroup"],t,(function(e,t){return e.parseGroupUnderTabFromMos(t)})):this.children=e.parseMultipleChildControlsFromMos(["Group"],t,(function(e,t){return e.parseGroupUnderTabFromMos(t)}))},e}(),A=function(e){function t(t){var n=e.call(this)||this;return n.groupType="Custom",n.labelResId=null,n.hostType=t,n}return __extends(t,e),t.prototype.parse=function(t,n){if(t.shouldParseNode(n)){if(e.prototype.parse.call(this,t,n),t.manifest.isForOfficeAppManifest()){var i;i=t.manifest._xmlProcessor.selectSingleNode(t.namespace+"Label",n),this.labelResId=t.parseResId(i)}"MailHost"===this.hostType?this.icon=t.parseOptionalIcon(n):(this.icon=t.parseRequiredIcon(n),OSF.OUtil.checkFlight(OSF.FlightTreatmentNames.CheckRequiredGroupIconsEnabled)&&t.checkRequiredGroupIcons(this.icon)),t.manifest.isForOfficeAppManifest()&&(this.iconResId=t.parseIconResId(n)),OSF.Settings.IsReactRibbonEnabled?this.children=t.parseMultipleChildControls(["Control","OfficeControl"],n,(function(e,t){return e.parseControlInGroup(t)})):this.children=t.parseMultipleChildControls(["Control"],n,(function(e,t){return e.parseControlInGroup(t)}))}},t.prototype.parseFromMos=function(t,n){t.shouldParseNodeFromMos(n)&&(e.prototype.parseFromMos.call(this,t,n),"MailHost"===this.hostType?this.icon=t.parseOptionalIconFromMos(n):(this.icon=t.parseRequiredIconFromMos(n),OSF.OUtil.checkFlight(OSF.FlightTreatmentNames.CheckRequiredGroupIconsEnabled)&&t.checkRequiredGroupIcons(this.icon)),OSF.Settings.IsReactRibbonEnabled?this.children=t.parseMultipleChildControlsFromMos(["Control","OfficeControl"],n,(function(e,t){return e.parseControlInGroupFromMos(t)})):this.children=t.parseMultipleChildControlsFromMos(["Control"],n,(function(e,t){return e.parseControlInGroupFromMos(t)})))},t.prototype.apply=function(e){e.builder.ribbonBuilder.startBuildGroup(this),c.buildControls({functionFile:e.functionFile,actionBuilder:e.builder.actionBuilder,controlBuilder:e.builder.ribbonBuilder},this.children),e.builder.ribbonBuilder.endBuildGroup()},t}(h),O=function(e){function t(t){var n=e.call(this,t)||this;return n.mlrId="",n.children=null,n.label=null,n.icon=null,n.groupType="OfficeGroup",n}return __extends(t,e),t.prototype.parse=function(e,t){try{this.id=e.parseIdRequired(t)}catch(e){throw new n("Required id attribute missing for OfficeGroup.")}if(OSF.RibbonGroupIdMap&&OSF.RibbonGroupIdMap[this.id])OSF.RibbonGroupIdMapCommonMLR&&OSF.RibbonGroupIdMapCommonMLR[this.id]&&(this.mlrId=OSF.RibbonGroupIdMapCommonMLR[this.id]),this.id=OSF.RibbonGroupIdMap[this.id];else if(!OSF.OUtil.checkFlight(OSF.FlightNames.AddinRibbonIdAllowUnknown))throw new n("Unsupported id for OfficeGroup.")},t.prototype.parseFromMos=function(e,t){if(this.id=t.builtInGroupId,o(this.id,"Built in group id is required."),OSF.RibbonGroupIdMap&&OSF.RibbonGroupIdMap[this.id])OSF.RibbonGroupIdMapCommonMLR&&OSF.RibbonGroupIdMapCommonMLR[this.id]&&(this.mlrId=OSF.RibbonGroupIdMapCommonMLR[this.id]),this.id=OSF.RibbonGroupIdMap[this.id];else if(!OSF.OUtil.checkFlight(OSF.FlightNames.AddinRibbonIdAllowUnknown))throw new n("Unsupported id for OfficeGroup.")},t.prototype.apply=function(e){e.builder.ribbonBuilder.addNativeGroup(this)},t}(A),T=function(){function e(e,t){this.type=e,this.tabs=[],this.namespace=OSF.GetNamespaceOrDefault(t)}return e.prototype.apply=function(e){if(this.type==e.builder.commandSurface)for(var t=this.tabs.length,n=0,i=0,o=0;o<t;o++){var r=this.tabs[o];if(r.isOfficeTab&&n<1)n++;else{if(r.isOfficeTab||!(i<1||e.multipleCustomTabsEnabled))break;i++}r.apply(e)}},e.prototype.parse=function(e,t){var n=e.manifest._xmlProcessor.selectSingleNode(this.namespace+"OfficeTab",t);null!=n&&((a=new C(!0,this.namespace)).parse(e,n),this.tabs.push(a));var i=e.manifest._xmlProcessor.selectNodes(this.namespace+"CustomTab",t);if(i)for(var o=i.length,r=0;r<o;r++){var a;if(null!=(n=i[r]))(a=new C(!1,this.namespace)).parse(e,n),this.tabs.push(a)}"undefined"!=typeof otel&&void 0!==otel.sendTelemetryEvent&&(OSF.OUtil.sendTelemetryEvent("Office.Online.Extensibility.Ribbon.OfficeGroupControlCount",[{name:"OfficeControlCount",int64:e.officeControlCount},{name:"OfficeGroupCount",int64:e.officeGroupCount},{name:"InsertBefore",string:JSON.stringify(e.insertBefore)},{name:"InsertAfter",string:JSON.stringify(e.insertAfter)}])||otel.sendTelemetryEvent({name:"Office.Online.Extensibility.Ribbon.OfficeGroupControlCount",dataFields:[{name:"OfficeControlCount",int64:e.officeControlCount},{name:"OfficeGroupCount",int64:e.officeGroupCount},{name:"InsertBefore",string:JSON.stringify(e.insertBefore)},{name:"InsertAfter",string:JSON.stringify(e.insertAfter)}]}))},e.prototype.parseFromMos=function(e,t){if(!OSF.OUtil.isNullOrUndefined(t))for(var n=0,i=t;n<i.length;n++){var o=i[n],r=void 0;(r=OSF.OUtil.isNullOrUndefined(o.builtInTabId)?new C(!1):new C(!0)).parseFromMos(e,o),this.tabs.push(r)}"undefined"!=typeof otel&&void 0!==otel.sendTelemetryEvent&&(OSF.OUtil.sendTelemetryEvent("Office.Online.Extensibility.Ribbon.OfficeGroupControlCount",[{name:"OfficeControlCount",int64:e.officeControlCount},{name:"OfficeGroupCount",int64:e.officeGroupCount},{name:"InsertBefore",string:JSON.stringify(e.insertBefore)},{name:"InsertAfter",string:JSON.stringify(e.insertAfter)}])||otel.sendTelemetryEvent({name:"Office.Online.Extensibility.Ribbon.OfficeGroupControlCount",dataFields:[{name:"OfficeControlCount",int64:e.officeControlCount},{name:"OfficeGroupCount",int64:e.officeGroupCount},{name:"InsertBefore",string:JSON.stringify(e.insertBefore)},{name:"InsertAfter",string:JSON.stringify(e.insertAfter)}]}))},e}(),I=function(){function e(e){this.namespace=OSF.GetNamespaceOrDefault(e)}return e.prototype.parse=function(e,t){e.shouldParseNode(t)&&(this.id=e.parseIdRequired(t),e.manifest.isForOfficeAppManifest()&&(this.type=e.parseType(t)),this.children=e.parseChildControls(this.namespace+"Control",t,(function(e,t){return e.parseControlInGroup(t)})))},e.prototype.parseFromMos=function(e,t){e.shouldParseNodeFromMos(t)&&(this.id=e.getContextMenuType(t),this.children=e.parseControlsFromMos(t.controls,(function(e,t){return e.parseControlInGroupFromMos(t)})))},e.prototype.apply=function(e){e.controlBuilder.startBuildMenu({id:this.id,label:null,superTip:null}),c.buildControls(e,this.children),e.controlBuilder.endBuildMenu()},e}(),x=function(){function e(e,t){this.type=e,this.namespace=OSF.GetNamespaceOrDefault(t)}return e.prototype.apply=function(e){this.type==e.builder.commandSurface&&c.buildControls({functionFile:e.functionFile,actionBuilder:e.builder.actionBuilder,controlBuilder:e.builder.contextMenuBuilder},this.children)},e.prototype.parse=function(e,t){var n=this;this.children=e.parseChildControls(this.namespace+"OfficeMenu",t,(function(e,t){var i=new I(n.namespace);return i.parse(e,t),i}))},e.prototype.parseFromMos=function(e,t){this.children=e.parseChildControlsFromMos("OfficeMenu",t,(function(e,t){var n=new I;return n.parseFromMos(e,t),n}))},e}(),E=function(){function e(e){this.type=e}return e.prototype.apply=function(e){},e.prototype.parse=function(e,t){var i=e.manifest._xmlProcessor.selectSingleNode("ov:Namespace",t);i&&(this.namespaceResId=i.getAttribute("resid"));var o=e.manifest._xmlProcessor.selectSingleNode("ov:Script",t);if(o&&(this.scriptResId=this._parseSourceLocationResId(e,o)),!this.scriptResId)throw new n("Missing required <Script> element under element <ExtensionPoint xsi:type='CustomFunctions'>.");var r=e.manifest._xmlProcessor.selectSingleNode("ov:Page",t);if(r&&(this.pageResId=this._parseSourceLocationResId(e,r)),!this.pageResId)throw new n("Missing required <Page> element under element <ExtensionPoint xsi:type='CustomFunctions'>.");var a=e.manifest._xmlProcessor.selectSingleNode("ov:Metadata",t);if(a&&(this.metadataResId=this._parseSourceLocationResId(e,a)),!this.metadataResId)throw new n("Missing required <Metadata> element under element <ExtensionPoint xsi:type='CustomFunctions'>.")},e.prototype.parseFromMos=function(e,t){},e.prototype._parseSourceLocationResId=function(e,t){var n=e.manifest._xmlProcessor.selectSingleNode("ov:SourceLocation",t);if(n)return n.getAttribute("resid")},e}();t.CustomFunctionsExtensionPoint=E;var M=function(){function e(){}return e.prototype.parse=function(e,t){this.type=t.getAttribute("Type"),this.functionName=t.getAttribute("FunctionName"),this.sendMode=t.getAttribute("SendMode")},e.prototype.parseFromMos=function(e,t){},e}(),F=function(){function e(e,t){this.type=e,this.events=[],this.namespace=OSF.GetNamespaceOrDefault(t)}return e.prototype.apply=function(e){},e.prototype.parse=function(e,t){var i=e.manifest._xmlProcessor.selectSingleNode(this.namespace+"LaunchEvents",t);if(null==i)throw new n("Missing required <LaunchEvents> element under element <ExtensionPoint xsi:type='LaunchEvent'>.");var o=e.manifest._xmlProcessor.selectNodes(this.namespace+"LaunchEvent",i);if(0==o.length)throw new n("Missing required <LaunchEvent> element under element <LaunchEvents>.");for(var r=0;r<o.length;r++){var a=new M;a.parse(e,o[r]),this.events.push(a)}var s=e.manifest._xmlProcessor.selectSingleNode(this.namespace+"SourceLocation",t);if(null==s)throw new n("Missing required <SourceLocation> element under element <ExtensionPoint xsi:type='LaunchEvent'>.");this.resid=s.getAttribute("resid")},e.prototype.parseFromMos=function(e,t){},e}(),b=function(){function t(e){this.getStartedNode=null,this.functionFile=null,this.functionFileResid=null,this.supportsSharedFolders=!1,this.cacheableUrls=[],this.ExtensionPoints=[],this.namespace=OSF.GetNamespaceOrDefault(e)}return t.prototype.cacheableResources=function(){return this.cacheableUrls},t.prototype.apply=function(t,i,o){void 0===o&&(o=!1);try{t.startApplyAddin({entitlement:this.extensionEntitlement,manifest:this.extensionManifest,startedNode:this.getStartedNode,overrides:{type:this.type,description:this.description}});for(var r=new u(this.functionFile,t,o),a=this.ExtensionPoints.length,s=0;s<a;s++){this.ExtensionPoints[s].apply(r)}t.endApplyAddin()}catch(t){throw t instanceof n&&i.setErrorMessageForAddin(Telemetry.PrivacyRules.GetPrivacyCompliantId(this.extensionEntitlement.solutionId,this.extensionEntitlement.storeType,this.extensionEntitlement.assetId,null,null,this.extensionEntitlement.storeId),Strings.OsfRuntime.L_AddinCommands_AddinNotSupported_Message),OSF.OUtil.checkFlight(OSF.FlightNames.ManifestParserDevConsoleLog)&&e.DevConsole.log(t),t}},t.prototype.parse=function(e,t){this.type=e.manifest.getNodeXsiType(t);var i=e.manifest._xmlProcessor.selectSingleNode(this.namespace+"Description",t);OSF.OUtil.isNullOrUndefined(i)||(this.description=e.getLongString(i));for(var o=OSF.SelectChildNodes(e.manifest._xmlProcessor,this.namespace+"Host",t,[this.namespace+"Hosts"]),r=null,a=o.length,s=0;s<a;s++){var l=o[s];if(e.manifest.getNodeXsiType(l)==e.hostType){null==(r=e.manifest._xmlProcessor.selectSingleNode(this.namespace+e.formFactor,l))&&(r=e.manifest._xmlProcessor.selectSingleNode(this.namespace+"AllFormFactors",l));break}}var c=e.manifest._xmlProcessor.selectSingleNode(this.namespace+"GetStarted",r);OSF.OUtil.isNullOrUndefined(c)||(this.getStartedNode=new d(this.namespace),this.getStartedNode.parse(e,c)),i=e.manifest._xmlProcessor.selectSingleNode(this.namespace+"FunctionFile",r),OSF.OUtil.isNullOrUndefined(i)||(this.functionFileResid=i.getAttribute("resid"),this.functionFile=e.getUrlResource(i),e.manifest.addManifestUrl(this.functionFile)),e.manifest.isForOfficeAppManifest()&&(i=e.manifest._xmlProcessor.selectSingleNode(this.namespace+"SupportsSharedFolders",r),OSF.OUtil.isNullOrUndefined(i)||(this.supportsSharedFolders=e.manifest._parseBooleanNode(i)));var u=e.manifest._xmlProcessor.selectNodes(this.namespace+"ExtensionPoint",r);a=u.length;for(s=0;s<a;s++){var p,f=u[s],m=e.manifest.getNodeXsiType(f);switch(m){case"Events":if(e.manifest.isForOfficeAppManifest()){console.error("[31m%s[0m",'ExtensionPoint type "Events" in the XML manifest "'+e.manifest.getDefaultDisplayName()+'" is not supported. Please change the type to "LaunchEvent" and then convert it to metaOS manifest.');continue}throw"Not Implemented";case"PrimaryCommandSurface":p=new T(m,this.namespace);break;case"ContextMenu":p=new x(m,this.namespace);break;case"CustomFunctions":p=new E(m);break;case"LaunchEvent":p=new F(m,this.namespace);break;default:if(!e.manifest.isForOfficeAppManifest())throw new n("Unsupported extension type.");switch(m){case"MessageReadCommandSurface":case"MessageComposeCommandSurface":case"AppointmentOrganizerCommandSurface":case"AppointmentAttendeeCommandSurface":case"MobileMessageReadCommandSurface":case"MobileMessageComposeCommandSurface":case"MobileAppointmentOrganizerCommandSurface":case"MobileAppointmentAttendeeCommandSurface":case"MobileOnlineMeetingCommandSurface":case"MobileLogEventAppointmentAttendee":p=new T(m,this.namespace);break;default:OSF.OUtil.isNullOrUndefined(OSF.AppTelemetry)||OSF.OUtil.isNullOrUndefined(OSF.AppTelemetry.logAppCommonMessage)||OSF.AppTelemetry.logAppCommonMessage("Ignoring unsupported extension point type: "+m);continue}}p.parse(e,f),this.ExtensionPoints.push(p)}var h=e.resources.Images;for(var g in h)this.cacheableUrls.push(h[g]);this.extensionEntitlement=e.entitlement,this.extensionManifest=e.manifest,this.resources=e.resources},t.prototype.parseFromMos=function(e){var t=e.manifest.getDescription();OSF.OUtil.isNullOrUndefined(t)||(this.description=t);var n=e.manifest.getExtensionGetStartedMessage();OSF.OUtil.isNullOrUndefined(n)||(this.getStartedNode=new d(this.namespace),this.getStartedNode.parseFromMos(e,n));for(var i=0,o=e.manifest.getExtensionRuntimes();i<o.length;i++){var r=o[i];if(!Mos.AppMetadata.isLegacyRuntime(r)){this.functionFile=r.code.page,this.functionFileResid=r.id;break}}var a=e.manifest.getExtensionRibbon();if(!OSF.OUtil.isNullOrUndefined(a)){var s=new T("PrimaryCommandSurface");s.parseFromMos(e,a.tabs),this.ExtensionPoints.push(s)}var l=e.manifest.getExtensionContextMenu();if(!OSF.OUtil.isNullOrUndefined(l)){var c=new x("ContextMenu");c.parseFromMos(e,l),this.ExtensionPoints.push(c)}var u=e.resources.Images;for(var p in u)this.cacheableUrls.push(u[p]);this.extensionEntitlement=e.entitlement,this.extensionManifest=e.manifest},t}();t.VersionOverrides=b;var R=function(){function e(){}return e.prototype.cacheableResources=function(){return[]},e.prototype.apply=function(e,t){},e}(),P=function(){function t(e,t,n){this.hostType=e,this.formFactor=t,this.namespace=OSF.GetNamespaceOrDefault(n)}return t.prototype.parseExtensions=function(t,i,o,r){try{if(i.getPayloadType()===OSF.PayloadType.MosAcquisition){var a=new b;return a.parseFromMos(new l(this.hostType,this.formFactor,t,i)),a}var s=i._xmlProcessor.selectSingleNode("o:OfficeApp"),c=i._xmlProcessor.selectSingleNode(this.namespace+"VersionOverrides",s);if(OSF.OUtil.isNullOrUndefined(c))return new R;if(i.isForOfficeAppManifest()&&"MailHost"===this.hostType&&r){var u=OSF.GetVersionOverridesPath(i._xmlProcessor,this.namespace,r),d=OSF.SelectSingleNode(i._xmlProcessor,s,u,!0);i.getNodeXsiType(d)===OSF.GetVersionOverridesString(r)&&(c=d)}var p=new l(this.hostType,this.formFactor,t,i,this.namespace,r),f=OSF.GetVersionOverridesNamespace(this.namespace,r),m=new b(f);return p.namespace=f,m.parse(p,c),m}catch(i){throw i instanceof n&&o.setErrorMessageForAddin(Telemetry.PrivacyRules.GetPrivacyCompliantId(t.solutionId,t.storeType,t.assetId,null,null,t.storeId),Strings.OsfRuntime.L_AddinCommands_AddinNotSupported_Message),OSF.OUtil.checkFlight(OSF.FlightNames.ManifestParserDevConsoleLog)&&e.DevConsole.log(i),i}},t}();t.AddinCommandsManifestParser=P}(e.Parser||(e.Parser={}))}(OfficeExt||(OfficeExt={})),function(e){var t=function(){function t(){}return t.clearSettingsByExtendedManifest=function(t){return Common.App.AppsForOffice.AddinShortcutsPreferenceSettingHelper.instance().getSetting().then((function(n){if(n){var i=JSON.parse(n),o=t.shortcuts;if(Object.keys(i).length>0&&o){for(var r=0;r<o.length;r++){var a=e.ShortcutsMappingTableManager.getKeysFromShortcutPlatformAvailability(o[r].key),s=e.ShortcutsMappingTableManager.convertStringToKeys(a);null!=s&&(i[s.virtualKey]&&i[s.virtualKey][s.modifierKeys]&&(delete i[s.virtualKey][s.modifierKeys],0==Object.keys(i[s.virtualKey]).length&&delete i[s.virtualKey]))}return Common.App.AppsForOffice.AddinShortcutsPreferenceSettingHelper.instance().saveSettings(JSON.stringify(i))}}}))},t}();e.AddinShortcutsPreferenceSettingHelper=t}(OfficeExt||(OfficeExt={})),function(e){!function(e){e.log=function(e){OSF.OUtil.getBooleanSetting("DevConsoleEnabled")&&console.log({ErrorSource:"[Add-in Dev Message]: ","Error:":e})}}(e.DevConsole||(e.DevConsole={}))}(OfficeExt||(OfficeExt={})),function(e){!function(e){var t;!function(e){e[e.Image=0]="Image",e[e.Url=1]="Url",e[e.ShortString=2]="ShortString",e[e.LongString=3]="LongString"}(t||(t={}));var n=function(e){this.name="AddinManifestError",this.message=this.name+": "+e};function i(e,t){if(void 0!==typeof e&&null===e)throw new n(t)}function o(e,t){if(void 0!==typeof e&&null===e&&""===e)throw new n(t)}var r=function(){function e(e,t,n,o,r,a,s){this.hostType=e,this.formFactor=t,this.entitlement=n,this.manifest=o,this.ribbonData=r,this.runtimeId=a,this.osfControl=s,this.actions=this.parseActions(r.actions),i(this.actions,"actions is required")}return e.prototype.parseActions=function(e){for(var t={},i=0,o=e;i<o.length;i++){var r=o[i];if(r.id&&r.type){var a;switch(r.type){case"ShowTaskpane":(a=new s).parse(this,r);var c=a.sourceLocation;if(c&&this.osfControl&&!this.osfControl.checkAppDomains(c))throw Telemetry.Logger.SendULSTraceTag(Telemetry.ULSCat.msoulscat_Osf_Runtime,Telemetry.ULSTraceLevel.unexpected,"A domain in the provided JSON is not registered with the addins AppDomains.",520656785),new n("A domain in the provided JSON is not registered with the addins AppDomains.");break;case"ExecuteFunction":(a=new l).parse(this,r);break;default:throw new n("Unknown action type")}a.runtimeId||(a.runtimeId=this.runtimeId),t[r.id]=a}}return t},e.prototype.parseIdRequired=function(e){var t=e.id?e.id:null;return o(t,"Id required"),t},e.prototype.parseLabelRequired=function(e){var t=this.parseLabel(e);return i(t,"Label required"),t},e.prototype.parseLabel=function(e){return e.label?e.label:null},e.prototype.parseSuperTipRequired=function(e){if(!e.superTip)throw new n("Supertip required");return this.parseSuperTip(e)},e.prototype.parseSuperTip=function(e){var t={title:"",description:""};return e.superTip&&(t.title=e.superTip.title?e.superTip.title:"",t.description=e.superTip.description?e.superTip.description:""),t},e.prototype.parseIconRequired=function(e){if(e.icon)return this.parseIcon(e);throw new n("Icon required")},e.prototype.parseIcon=function(e){var t={};if(e.icon)for(var n=0,i=e.icon;n<i.length;n++){var o=i[n];o.size&&o.sourceLocation&&(t[o.size]=o.sourceLocation)}return t},e}();e.ParsingContext=r;var a=function(){function e(){}return e.prototype.clone=function(){},e.prototype.buildAction=function(e){},e.prototype.parse=function(e,t){o(t.type,"Action type required."),this.type=t.type},e}(),s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type="ShowTaskpane",t.title=null,t.supportsPinning=!1,t}return __extends(t,e),t.prototype.clone=function(){var e=new t;return e.id=this.id,e.type=this.type,e.controlId=this.controlId,e.runtimeId=this.runtimeId,e.title=this.title,e.sourceLocation=this.sourceLocation,e.taskpaneId=this.taskpaneId,e.supportsPinning=this.supportsPinning,e},t.prototype.buildAction=function(e){return e.buildShowTaskpane(this.sourceLocation,this.title,this.taskpaneId,this.runtimeId)},t.prototype.parse=function(t,n){e.prototype.parse.call(this,t,n),o(n.taskpaneId,"Taskpane ID required"),this.taskpaneId=n.taskpaneId,o(n.sourceLocation,"Source Location required"),this.sourceLocation=n.sourceLocation,i(n.title,"Title required"),this.title=n.title,n.supportPinning||(this.supportsPinning=n.supportPinning)},t}(a),l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.clone=function(){var e=new t;return e.id=this.id,e.type=this.type,e.controlId=this.controlId,e.runtimeId=this.runtimeId,e.functionFile=this.functionFile,e.functionName=this.functionName,e},t.prototype.buildAction=function(e){return e.buildCallFunction(this.functionFile,this.functionName,this.controlId,this.id)},t.prototype.parse=function(t,n){e.prototype.parse.call(this,t,n),this.functionFile=n.functionFile,this.functionName=n.functionName},t}(a),c=function(){function e(){}return e.prototype.parse=function(e,t){this.id=e.parseIdRequired(t),this.label=e.parseLabelRequired(t)},e}(),u=function(e){function t(){var t=e.call(this)||this;return t.enabled=!0,t}return __extends(t,e),t.prototype.apply=function(e,t){},t.prototype.parse=function(t,i){if(e.prototype.parse.call(this,t,i),this.icon=t.parseIconRequired(i),this.superTip=t.parseSuperTipRequired(i),this.enabled=!!i.enabled,i.type&&(this.controlType=i.type,"MenuItem"==i.type||"Button"==i.type)){if(!i.actionId||!(i.actionId in t.actions))throw new n("Action is required");var o=t.actions[i.actionId].clone();o.controlId=this.id,this.actionParsed=o,this.actionType=o.type}},t}(c),d=function(e){function t(){var t=e.call(this)||this;return t.children=[],t.controlType="Menu",t}return __extends(t,e),t.prototype.apply=function(t,n){e.prototype.apply.call(this,t,n),t.ribbonBuilder.startBuildMenu(this);for(var i=0,o=this.children;i<o.length;i++){o[i].apply(t,n)}t.ribbonBuilder.endBuildMenu()},t.prototype.parse=function(t,i){if(e.prototype.parse.call(this,t,i),!(i.items&&i.items instanceof Array))throw new n("Menu items required.");for(var o=0,r=i.items;o<r.length;o++){var a=r[o],s=new p;s.parse(t,a),this.children.push(s)}},t}(u);e.Menu=d;var p=function(e){function t(){var t=e.call(this)||this;return t.controlType="MenuItem",t}return __extends(t,e),t.prototype.apply=function(t,n){e.prototype.apply.call(this,t,n);var i=this.actionParsed.buildAction(t.actionBuilder),o={id:this.id,label:this.label,icon:this.icon,superTip:this.superTip,actionType:this.actionType,action:i,enabled:this.enabled};t.ribbonBuilder.addMenuItem(o)},t}(u),f=function(e){function t(){var t=e.call(this)||this;return t.controlType="Button",t}return __extends(t,e),t.prototype.apply=function(t,n){e.prototype.apply.call(this,t,n);var i=this.actionParsed.buildAction(t.actionBuilder),o={id:this.id,label:this.label,icon:this.icon,superTip:this.superTip,actionType:this.actionType,action:i,enabled:this.enabled};t.ribbonBuilder.addButton(o)},t}(u),m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.children=[],t}return __extends(t,e),t.prototype.parse=function(t,i){e.prototype.parse.call(this,t,i),this.icon=t.parseIconRequired(i);for(var r=0,a=i.controls;r<a.length;r++){var s=a[r];switch(o(s.type,"Control type required."),s.type){case"Button":var l=new f;l.parse(t,s),this.children.push(l);break;case"Menu":var c=new d;c.parse(t,s),this.children.push(c);break;default:throw new n("Unknown control type.")}}},t.prototype.apply=function(e,t){e.ribbonBuilder.startBuildGroup(this);for(var n=0,i=this.children;n<i.length;n++){i[n].apply(e,t)}e.ribbonBuilder.endBuildGroup()},t}(c),h=function(){function e(){this.label=null,this.isOfficeTab=!1,this.visible=!0,this.children=[],this.tabType="contextual",this.insertBefore="",this.insertAfter=""}return e.prototype.apply=function(e,t){e.ribbonBuilder.startBuildTab(this);for(var n=0,i=this.children;n<i.length;n++){i[n].apply(e,t)}e.ribbonBuilder.endBuildTab()},e.prototype.parse=function(e,t){this.id=t.id,this.visible=t.visible||!1,this.label=e.parseLabelRequired(t);for(var n=0,i=t.groups;n<i.length;n++){var o=i[n],r=new m;r.parse(e,o),this.children.push(r)}},e}(),g=function(){function e(e,t,n){this.entitlement=t,this.manifest=n,this.tabs=e}return e.prototype.cacheableResources=function(){return[]},e.prototype.apply=function(e,t){var n={entitlement:this.entitlement,manifest:this.manifest,overrides:null,startedNode:null};e.startApplyAddin(n);for(var i=0,o=this.tabs;i<o.length;i++){o[i].apply(e,t)}e.endApplyAddin()},e}(),y=function(){function e(e,t){this.hostType=e,this.formFactor=t,this.tabs=[],this.maxTabCount=20}return e.prototype.parse=function(e,t,i,o,a,s){var l=[];try{var c=new r(this.hostType,this.formFactor,e,t,i,a,s);c.parseActions(i.actions);for(var u=0,d=i.tabs.slice(0,this.maxTabCount);u<d.length;u++){var p=d[u],f=new h;f.parse(c,p),l.push(f)}}catch(t){throw t instanceof n&&o.setErrorMessageForAddin(Telemetry.PrivacyRules.GetPrivacyCompliantId(e.solutionId,e.storeType,e.assetId,null,null,e.storeId),Strings.OsfRuntime.L_AddinCommands_AddinNotSupported_Message),t}return new g(l,e,t)},e}();e.AddinCommandsJsonParser=y}(e.JsonParser||(e.JsonParser={}))}(OfficeExt||(OfficeExt={})),function(e){var t=function(){function e(){}return e.createManifestForAddinAction=function(e,t,n,i){var o=new OSF.Manifest.ExtensionSettings,r=(OSF.FormFactor.Default,{}),a=e._UILocale.toLocaleLowerCase();r[a]=n,o._defaultHeight=null,o._defaultWidth=null,o._sourceLocations={},o._sourceLocations[a]=t;var s=e;return new OSF.Manifest.Manifest((function(e){e._xmlProcessor=s._xmlProcessor,e._displayNames=null!=n?r:s._displayNames,e._iconUrls=s._iconUrls,e._extensionSettings={formFactor:o},e._highResolutionIconUrls=s._highResolutionIconUrls,e._target=s._target,e._id=null!=i?i:s._id,e._version=s._version,e._providerName=s._providerName,e._idIssuer=s._idIssuer,e._alternateId=s._alternateId,e._defaultLocale=s._defaultLocale,e._signature=s._signature,e._capabilities=s._capabilities,e._hosts=s._hosts,e._descriptions=s._descriptions,e._appDomains=s._appDomains,e._permissions=s._permissions,e._requirements=s._requirements,e._webApplicationResource=s._webApplicationResource,e._webApplicationId=s._webApplicationId,e._webApplicationMsaId=s._webApplicationMsaId,e._webApplicationScopes=s._webApplicationScopes,e._webApplicationAuthorizations=s._webApplicationAuthorizations,e._ribbonExtensionControls=s._ribbonExtensionControls,e._equivalentAddins=s._equivalentAddins,e._versionOverrides=s._versionOverrides}),s._UILocale)},e.cacheManifestForAction=function(e,t,n){OSF.OsfManifestManager.cacheManifest(t,n,e)},e.purgeManifestForAction=function(e,t){OSF.OsfManifestManager.purgeManifest(e,t)},e}();e.AddinCommandsManifestManager=t}(OfficeExt||(OfficeExt={})),function(e){e.AddinActionContextMap={},e.AutoShowTaskPaneControlIdMap={};var t,n,i={},o={};!function(e){e[e.Default=1]="Default",e[e.ExclusiveForCur=2]="ExclusiveForCur",e[e.ExclusiveForNew=3]="ExclusiveForNew"}(t=e.CommandInvokeMode||(e.CommandInvokeMode={})),function(e){e[e.ooeTimeout=-1]="ooeTimeout",e[e.ooeSuccess=0]="ooeSuccess",e[e.ooeOperationNotSupported=5e3]="ooeOperationNotSupported"}(n||(n={}));var r=function(){function t(e,t,n){this.contextProvider=e,this.manifest=n,this.entitlement=t}return t.prototype.buildShowTaskpane=function(e,t,n,i){return this.CreateManifestAndActivationContextForTaskpaneCommand(e,t,n,i)},t.prototype.buildCallFunction=function(e,t,n,i){return!t&&OSF.OUtil.checkFlight(OSF.FlightNames.UseActionIdForUILessCommand)?this.CreateManifestAndActivationContextForUILessCommand(e,i,n):this.CreateManifestAndActivationContextForUILessCommand(e,t,n)},t.prototype.CreateManifestAndActivationContextForTaskpaneCommand=function(e,t,o,r){var a=function(e,t){t==n.ooeSuccess&&null!=o&&(i[o]=e)};return this.CreateManifestAndActivationContext(e,t,o,r,(function(e,t,n,r){null!=o&&function(e,t){var n=i[e];if(null==n)return!1;var o=t.getOsfControl(n);null!=o&&(null==o._sharedRuntimeId&&o._refresh())}(o,t),e.showTaskpane(n,r,a)}))},t.prototype.CreateManifestAndActivationContext=function(t,n,i,r,a){var s=this,l=e.AddinCommandsManifestManager.createManifestForAddinAction(this.manifest,t,n,null);return function(n){var c=s.contextProvider.createActionContext(n,(function(o,c){var u=s.entitlement.solutionId,d={solutionId:u+(i||n),version:s.entitlement.version,storeType:OSF.StoreType.InMemory,storeId:s.entitlement.storeId,assetId:s.entitlement.assetId,assetStoreId:s.entitlement.assetStoreId,targetType:OSF.OsfControlTarget.TaskPane};l._inMemoryEToken=s.entitlement.eToken;var p=d.solutionId,f=null==c?OSF.ManifestHostType.Workbook:OSF.getManifestHostType(c._hostType),m=n;if(null!=c){var h={ownerAddinSolutionId:u,controlId:n,originalControlId:""};c._notifyHost("0",OSF.AgaveHostAction.GetOriginalControlId,h),null!=h.originalControlId&&(m=h.originalControlId)}var g=null;if(OSF.OUtil.checkFlight(OSF.FlightNames.AddinActionDefinitionHybridMode)?null!=t?g=l.getSharedRuntimeForTaskpane(f,i||m):(g=l.getSharedRuntimeById(f,r),i=l.getTaskpaneIdByRuntimeId(f,r),d.solutionId=u+i):g=l.getSharedRuntimeForTaskpane(f,i||m),null!=g&&null!=g.Resid&&g.Resid.length>0&&(p=OSF.OsfManifestManager.getSharedRuntimeManifestCacheKey(u,g.Resid)),OSF.OUtil.isChangeGateEnabled("OfficeVSO:0_LogLaunchTaskpaneAppDomainValidation")){var y;try{y=new URL(t)}catch(e){}var v=l.getAppDomains().some((function(e){try{var t=new URL(e);return y.origin===t.origin}catch(e){return!1}}));Telemetry.Logger.SendULSTraceTag(Telemetry.ULSCat.msoulscat_Osf_Runtime,Telemetry.ULSTraceLevel.info,v.toString(),523847257)}e.AddinCommandsManifestManager.cacheManifestForAction(l,p,d.version),a(o,c,d,l,i)}));e.AddinActionContextMap[n]=c;var u=s.entitlement.solutionId;null==e.AutoShowTaskPaneControlIdMap[u]&&"Office.AutoShowTaskpaneWithDocument"==i&&(e.AutoShowTaskPaneControlIdMap[u]=n),r&&(o[u]||(o[u]={}),o[u][r]||(o[u][r]=n))}},t.prototype.CreateManifestAndActivationContextForUILessCommand=function(t,i,o){var r=this,a=e.AddinCommandsManifestManager.createManifestForAddinAction(this.manifest,t,null,null);return function(t){var s=r.contextProvider.createActionContext(t,(function(t,s){var l=r.entitlement.solutionId,u={solutionId:l+"##UILessContainer##",version:r.entitlement.version,storeType:OSF.StoreType.InMemory,storeId:r.entitlement.storeId,assetId:r.entitlement.assetId,assetStoreId:r.entitlement.assetStoreId,targetType:OSF.OsfControlTarget.TaskPane},d=u.solutionId,p=null==s?OSF.ManifestHostType.Workbook:OSF.getManifestHostType(s._hostType),f=a.getSharedRuntimeForAppCmdsExecuteFunction(p);null!=f&&null!=f.Resid&&f.Resid.length>0&&(d=OSF.OsfManifestManager.getSharedRuntimeManifestCacheKey(l,f.Resid)),e.AddinCommandsManifestManager.cacheManifestForAction(a,d,u.version),t.createUILessSandbox(u,a,(function(e,r){if(r==n.ooeSuccess)c.ensureOsfHostEntry(e,t);!function(e,t){if(t==n.ooeSuccess){var r={source:{id:o}};c.invokeAppCommand(e,i,r,(function(e,t){}))}}(e,r)}))}));e.AddinActionContextMap[t]=s}},t}(),a=function(){function t(e,t){this.contextProvider=e,this.entitlement=t}return t.prototype.buildShowTaskpane=function(t,n){var i=this;return function(t){delete e.AddinActionContextMap[t];var n=i.entitlement.solutionId;e.AddinCommandsManifestManager.purgeManifestForAction(n+t,i.entitlement.version)}},t.prototype.buildCallFunction=function(t,n,i){var o=this;return function(t){delete e.AddinActionContextMap[t];var n=o.entitlement.solutionId;e.AddinCommandsManifestManager.purgeManifestForAction(n+"##UILessContainer##",o.entitlement.version)}},t}(),s=function(){function t(){}return t.createActionBuilder=function(e,t,n){return new r(e,t,n)},t.createDeleterActionBuilder=function(e,t,n){return new a(e,t)},t.bindAction=function(e,t){t(e)},t.retrieveActionContext=function(t){return e.AddinActionContextMap[t]},t.retrieveAutoShowTaskPaneControlIdMap=function(){return e.AutoShowTaskPaneControlIdMap},t.getTaskPaneControlIdFromSolutionIdRuntimeId=function(e,t){return o[e]?o[e][t]:null},t}();e.DefaultControlActionBinder=s;var l=function(){function e(){this.invocationQueue={}}return e.prototype.invokeAppCommand=function(n,i,o,r,a){var s={dispid:OSF.DDA.EventDispId.dispidAppCommandInvokedEvent,controlId:this.osfControlId};if(OSF.OUtil.isChangeGateEnabled("OfficeVSO:0_OwaAutorunResponseChange")){s[0]=n,s[1]=i,a=a||e.defaultTimeout;var l=o&&o.commandMode?o.commandMode:t.Default,c=!(!o||!o.hasExistingCommandInQueue)&&!!o.hasExistingCommandInQueue;o&&o.hasExistingCommandInQueue&&delete o.hasExistingCommandInQueue,s[2]=JSON.stringify(o);var u={args:s,onComplete:r,timeout:a,timeoutTimer:null};null==(d=this.invocationQueue[i])&&(d=[],this.invocationQueue[i]=d),l==t.ExclusiveForCur&&d.length>0||l==t.ExclusiveForNew&&d.length>1||c&&d.length>0||d.push(u),1==d.length&&this.trySendInvocation(u)}else{s[0]=n,s[1]=i,s[2]=JSON.stringify(o),a=a||e.defaultTimeout;var d;l=o&&o.commandMode?o.commandMode:t.Default,u={args:s,onComplete:r,timeout:a,timeoutTimer:null};null==(d=this.invocationQueue[i])&&(d=[],this.invocationQueue[i]=d),l==t.ExclusiveForCur&&d.length>0||l==t.ExclusiveForNew&&d.length>1||d.push(u),1==d.length&&this.trySendInvocation(u)}},e.prototype.invocationCompleted=function(e,t,n){var i=this;for(var o in this.invocationQueue){var r=this.invocationQueue[o],a=r[0];if(e==a.args[0]){if(r.length>1){r.splice(0,1);var s=r[0];window.setTimeout((function(){i.trySendInvocation(s)}),0)}else delete this.invocationQueue[o];return null!=a.timeoutTimer&&(window.clearTimeout(a.timeoutTimer),a.timeoutTimer=null),void a.onComplete(t,n)}}},e.prototype.sendInvocations=function(e){if(this.eventHandler=e,null!=e)for(var t in this.invocationQueue){var n=this.invocationQueue[t][0];this.sendInvocation(e,n)}},e.prototype.trySendInvocation=function(e){var t=this.eventHandler;null!=t&&this.sendInvocation(t,e)},e.prototype.sendInvocation=function(e,t){var n=this,i=t.args;e(i),t.timeoutTimer=window.setTimeout((function(){n.invocationTimeout(i[0])}),t.timeout)},e.prototype.invocationTimeout=function(e){this.invocationCompleted(e,n.ooeTimeout,null)},e.prototype.disposeHost=function(){for(var e in this.invocationQueue)return;this.host.disposeHost(this.osfControlId),null!=this.onDisposed&&this.onDisposed(this)},e.defaultTimeout=3e5,e}(),c=function(){function e(){}return e.registerEvent=function(t,n,i,o){void 0===o&&(o=null),e.registerEventInternal(i.eventDispId,(null==o?void 0:o.controlId)||i.controlId,i.targetId,t,(function(e){n&&n(0==e)}))},e.unregisterEvent=function(t,n,i){e.unregisterEventInternal(i.eventDispId,i.controlId,i.targetId,t,(function(e){n&&n(0==e)}))},e.invokeAppCommand=function(t,n,i,o){var r=e.getOrCreateOsfHostEntry(t),a=e.getNextAppCommandId();r.invokeAppCommand(a,n,i,o)},e.invocationCompleted=function(t,n){var i=e.getOrCreateOsfHostEntry(t),o=n[0],r=n[1],a=n[2]?JSON.parse(n[2]):null;i.invocationCompleted(o,r,a)},e.ensureOsfHostEntry=function(t,n){var i=e.getOrCreateOsfHostEntry(t);return null==i.host&&(i.host=n),i},e.getNextAppCommandId=function(){return"AppCmd"+e._nextAppCommandId++},e.getOrCreateOsfHostEntry=function(t){var n=e._invocationQueues[t];return null==n&&((n=new l).osfControlId=t,n.onDisposed=function(t){delete e._invocationQueues[t.osfControlId]},e._invocationQueues[t]=n),n},e.registerEventInternal=function(t,i,o,r,a){switch(t){case OSF.DDA.EventDispId.dispidAppCommandInvokedEvent:var s=e.getOrCreateOsfHostEntry(i);return a(n.ooeSuccess),void s.sendInvocations(r)}a(n.ooeOperationNotSupported)},e.unregisterEventInternal=function(t,i,o,r,a){switch(t){case OSF.DDA.EventDispId.dispidAppCommandInvokedEvent:var s=e.getOrCreateOsfHostEntry(i);return s.eventHandler==r&&(s.eventHandler=null),void a(n.ooeSuccess)}a(n.ooeOperationNotSupported)},e._nextAppCommandId=0,e._invocationQueues={},e}();e.AddinCommandsRuntimeManager=c}(OfficeExt||(OfficeExt={})),function(e){!function(e){function t(e){if("undefined"!=typeof JSON)try{return JSON.stringify(e)}catch(e){}return""}function n(){try{var e=window.navigator.userAgent;return e.indexOf("MSIE ")>-1||e.indexOf("Trident/")>-1||e.indexOf("Edge/")>-1}catch(e){return i("Error happens in isInternetExplorer.",e),!1}}function i(e,n){OsfMsAjaxFactory.msAjaxDebug.trace(e+" Exception details: "+t(n))}e.parseAppContextFromWindowName=function(e,t){return OSF.OUtil.parseInfoFromWindowName(e,t,OSF.WindowNameItemKeys.AppContext)},e.serializeObjectToString=t,e.isHostTrusted=function(){return new RegExp("^https://[a-z0-9-]+.(officeapps.live|officeapps-df.live|partner.officewebapps).com/").test(OSF.getClientEndPoint()._targetUrl.toLowerCase())},e.addHostInfoAsQueryParam=function(e,t){if(!e)return null;var n,i="#",o=(e=e.trim()||"").split(i),r=o.shift(),a=o.join(i),s=r.split("?");return s.length>1?n=r+"&_host_Info="+t:s.length>0&&(n=r+"?_host_Info="+t),a?[n,i,a].join(""):n},e.getDomainForUrl=function(e){if(!e)return null;var t=OSF.OUtil.parseUrl(e,!0);return t.protocol+"//"+t.host},e.shouldUseLocalStorageToPassMessage=function(){try{for(var e=["Windows NT 6.1","Windows NT 6.2","Windows NT 6.3","Windows NT 10.0"],t=window.navigator.userAgent,o=0,r=e.length;o<r;o++)if(t.indexOf(e[o])>-1)return n();return!1}catch(e){return i("Error happens in shouldUseLocalStorageToPassMessage.",e),!1}},e.isInternetExplorer=n,e.removeMatchesFromLocalStorage=function(e){for(var t=OSF.OUtil.getLocalStorage(),n=t.getKeysWithPrefix(""),i=0,o=n.length;i<o;i++)for(var r=n[i],a=0,s=e.length;a<s;a++)if(e[a].test(r)){t.removeItem(r);break}},e.logExceptionToBrowserConsole=i,e.isTeamsWebView=function(){var e=navigator.userAgent;return/Teams\/((?:(\d+)\.)?(?:(\d+)\.)?(?:(\d+)\.\d+)).* Electron\/((?:(\d+)\.)?(?:(\d+)\.)?(?:(\d+)\.\d+))/.test(e)},e.getHostSecure=function(e){if(void 0!==e&&e){var t=void 0,n="https:";try{var i=new URL(e);if(i&&(t=i.host),!i.protocol)throw"fallback";if(i.protocol!==n)return}catch(i){try{var o=document.createElement("a");if(o.href=e,o.protocol!==n)return;var r=e.match(new RegExp("^https://[^/?#]+","i")),a=r&&1==r.length?r[0].toLowerCase():"",s=(o.protocol+"//"+o.hostname).toLowerCase();(o.protocol+"//"+o.host).toLowerCase()!==a&&s!=a||(t="443"==o.port?o.hostname:o.host)}catch(e){return}}return t?t.toLowerCase():void 0}};var o=function(){function e(){}return e.GatedCacheKeyPrefix="__OSF_GATED_OMEX.",e.AnonymousCacheKeyPrefix="__OSF_ANONYMOUS_OMEX.",e.UngatedCacheKeyPrefix="__OSF_OMEX.",e.ActivatedCacheKeyPrefix="__OSF_RUNTIME_.Activated.",e.AppinstallAuthenticated="appinstall_authenticated.",e.Entitlement="entitle.",e.AppState="appState.",e.AppDetails="appDetails.",e.AppInstallInfo="appInstallInfo.",e.AuthenticatedAppInstallInfoCacheKey=e.GatedCacheKeyPrefix+e.AppinstallAuthenticated+"{0}.{1}.{2}.{3}",e.EntitlementsKey=e.Entitlement+"{0}.{1}",e.AppStateCacheKey="{0}"+e.AppState+"{1}.{2}",e.AppDetailKey="{0}"+e.AppDetails+OSF.OUtil.isChangeGateEnabled("OfficeVSO:7799078_CultureAwareAppDetailKey")?"{1}.{2}":"{1}",e.AppInstallInfoKey="{0}"+e.AppInstallInfo+"{1}.{2}",e.ActivatedCacheKey=e.ActivatedCacheKeyPrefix+"{0}.{1}.{2}",e}();e.CacheConstants=o}(e.WACUtils||(e.WACUtils={}))}(OfficeExt||(OfficeExt={})),function(e){!function(e){e[e.Success=0]="Success",e[e.ClientError=400]="ClientError",e[e.ServerError=500]="ServerError",e[e.UnknownError=600]="UnknownError"}(e.OmexRemoveAddinResultCode||(e.OmexRemoveAddinResultCode={})),function(e){e.RemoveAddinResultCode="resultCode",e.RemoveAddinResultValue="resultValue"}(e.OmexRemoveAddinMessageKeys||(e.OmexRemoveAddinMessageKeys={})),function(e){e.MessageType="messageType",e.MessageValue="messageValue"}(e.OmexMessageKeys||(e.OmexMessageKeys={})),function(e){e[e.Anonymous=0]="Anonymous",e[e.MSA=1]="MSA",e[e.OrgId=2]="OrgId",e[e.ADAL=3]="ADAL"}(e.AuthType||(e.AuthType={})),function(e){e.AppName="client",e.AppVersion="cv",e.AppUILocale="ui",e.AppDomain="appDomain",e.StoreLocator="rs",e.AssetId="assetid",e.NotificationType="notificationType",e.AppCorrelationId="corr",e.AuthType="authType",e.AppId="appid",e.Scopes="scopes"}(e.OmexPageParameterKeys||(e.OmexPageParameterKeys={})),function(e){e.ButtonBorderColor="buttonBorderColor",e.ButtonBackgroundColor="buttonBackgroundColor"}(e.HostThemeButtonStyleKeys||(e.HostThemeButtonStyleKeys={})),function(e){e.Url="url",e.Width="width",e.Height="height",e.DisplayInIframe="displayInIframe",e.HideTitle="hideTitle",e.UseDeviceIndependentPixels="useDeviceIndependentPixels",e.PromptBeforeOpen="promptBeforeOpen",e.EnforceAppDomain="enforceAppDomain",e.UrlNoHostInfo="urlNoHostInfo"}(e.ShowWindowDialogParameterKeys||(e.ShowWindowDialogParameterKeys={}))}(OSF||(OSF={})),function(e){!function(e){e[e.MaxXmlSize=1048576]="MaxXmlSize",e[e.MaxElementDepth=64]="MaxElementDepth"}(e.XmlConstants||(e.XmlConstants={}));var t=function(){function e(e,t){this._xmldoc=(new DOMParser).parseFromString(e,"text/xml"),this._evaluator=new XPathEvaluator,this._namespaceMapping={},this._defaultNamespace=null;for(var n,i=t.split(" "),o=0;o<i.length;++o)(n=/xmlns="([^"]*)"/g.exec(i[o]))?this._defaultNamespace=n[1]:(n=/xmlns:([^=]*)="([^"]*)"/g.exec(i[o]))&&(this._namespaceMapping[n[1]]=n[2]);this._resolver=this}return e.prototype.lookupNamespaceURI=function(e){return this._namespaceMapping[e]||this._defaultNamespace},e.prototype.addNamespaceMapping=function(e,t){return!this._namespaceMapping[e]&&(this._namespaceMapping[e]=t,!0)},e.prototype.getNamespaceMapping=function(){return this._namespaceMapping},e.prototype.selectSingleNode=function(e,t){var n=(t?"./":"/")+e;t=t||this.getDocumentElement();var i=this._evaluator.evaluate(n,t,this._resolver,XPathResult.FIRST_ORDERED_NODE_TYPE,null);return i?i.singleNodeValue:null},e.prototype.selectNodes=function(e,t){var n=(t?"./":"/")+e;t=t||this.getDocumentElement();var i=this._evaluator.evaluate(n,t,this._resolver,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null),o=[];if(i)for(var r=i.iterateNext();r;)o.push(r),r=i.iterateNext();return o},e.prototype.selectNodesByXPath=function(e,t){var n=this._evaluator.evaluate(e,t,this._resolver,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null),i=[];if(n)for(var o=n.iterateNext();o;)i.push(o),o=n.iterateNext();return i},e.prototype.getDocumentElement=function(){return this._xmldoc.documentElement},e}();e.Xpath3Provider=t;var n=function(){function t(t,n){for(var i=null,o=["MSXML2.DOMDocument.6.0"],r=0;r<o.length;r++)try{(i=new ActiveXObject(o[r])).setProperty("ResolveExternals",!1),i.setProperty("ValidateOnParse",!1),i.setProperty("ProhibitDTD",!0),i.setProperty("MaxXMLSize",e.XmlConstants.MaxXmlSize),i.setProperty("MaxElementDepth",e.XmlConstants.MaxElementDepth),i.async=!1,i.loadXML(t),i.setProperty("SelectionLanguage","XPath"),i.setProperty("SelectionNamespaces",n);break}catch(e){OsfMsAjaxFactory.msAjaxDebug.trace("xml doc creating error:"+e)}this._xmldoc=i}return t.prototype.selectSingleNode=function(e,t){var n=(t?"./":"/")+e;return(t=t||this.getDocumentElement()).selectSingleNode(n)},t.prototype.addNamespaceMapping=function(e,t){var n=this._xmldoc.getProperty("SelectionNamespaces"),i="xmlns:"+e+"=",o="xmlns:"+e+'="'+t+'"';return-1==n.indexOf(i)&&(n=n+" "+o,this._xmldoc.setProperty("SelectionNamespaces",n),!0)},t.prototype.getNamespaceMapping=function(){return null},t.prototype.selectNodes=function(e,t){var n=(t?"./":"/")+e;return(t=t||this.getDocumentElement()).selectNodes(n)},t.prototype.selectNodesByXPath=function(e,t){return t.selectNodes(e)},t.prototype.getDocumentElement=function(){return this._xmldoc.documentElement},t.prototype.getActiveXObject=function(){return this._xmldoc},t}();e.IEXpathProvider=n;var i=function(){function e(e,t){try{this._xmldoc=(new DOMParser).parseFromString(e,"text/xml")}catch(e){Sys.Debug.trace("xml doc creating error:"+e)}this._namespaceMapping={},this._defaultNamespace=null;for(var n,i=t.split(" "),o=0;o<i.length;++o)(n=/xmlns="([^"]*)"/g.exec(i[o]))?this._defaultNamespace=n[1]:(n=/xmlns:([^=]*)="([^"]*)"/g.exec(i[o]))&&(this._namespaceMapping[n[1]]=n[2])}return e.prototype.addNamespaceMapping=function(e,t){return!this._namespaceMapping[e]&&(this._namespaceMapping[e]=t,!0)},e.prototype.getNamespaceMapping=function(){return this._namespaceMapping},e.prototype.selectSingleNode=function(e,t){var n=t||this._xmldoc,i=this._selectNodes(e,n);return 0===i.length?null:i[0]},e.prototype.selectNodes=function(e,t){var n=t||this._xmldoc;return this._selectNodes(e,n)},e.prototype.selectNodesByXPath=function(e,t){return null},e.prototype._selectNodes=function(e,t){var n=[];if(!e)return n;var i,o,r=e.split(":");if(1===r.length)i=null,o=r[0];else{if(2!==r.length)throw OsfMsAjaxFactory.msAjaxError.argument("name");i=this._namespaceMapping[r[0]],o=r[1]}if(!t.hasChildNodes)return n;for(var a=t.childNodes,s=0;s<a.length;s++)o===this._removeNodePrefix(a[s].nodeName)&&i===a[s].namespaceURI&&n.push(a[s]);return n},e.prototype._removeNodePrefix=function(e){var t=e.split(":");return 1===t.length?e:t[1]},e.prototype.getDocumentElement=function(){return this._xmldoc.documentElement},e}();e.DomParserProvider=i;var o=function(){function t(t,n){var i=Function._validateParams(arguments,[{name:"xml",type:String,mayBeNull:!1},{name:"xmlNamespaces",type:String,mayBeNull:!1}]);if(i)throw i;document.implementation&&document.implementation.hasFeature("XPath","3.0")?this._provider=new e.Xpath3Provider(t,n):(this._provider=new e.IEXpathProvider(t,n),this._provider.getActiveXObject()||(this._provider=new e.DomParserProvider(t,n)))}return t.prototype.addNamespaceMapping=function(e,t){var n=Function._validateParams(arguments,[{name:"namespacePrefix",type:String,mayBeNull:!1},{name:"namespaceUri",type:String,mayBeNull:!1}]);if(n)throw n;return this._provider.addNamespaceMapping(e,t)},t.prototype.getNamespaceMapping=function(){var e;return null===(e=this._provider)||void 0===e?void 0:e.getNamespaceMapping()},t.prototype.selectSingleNode=function(e,t){var n=Function._validateParams(arguments,[{name:"name",type:String,mayBeNull:!1},{name:"contextNode",mayBeNull:!0,optional:!0}]);if(n)throw n;return this._provider.selectSingleNode(e,t)},t.prototype.selectNodes=function(e,t){var n=Function._validateParams(arguments,[{name:"name",type:String,mayBeNull:!1},{name:"contextNode",mayBeNull:!0,optional:!0}]);if(n)throw n;return this._provider.selectNodes(e,t)},t.prototype.selectNodesByXPath=function(e,t){var n=Function._validateParams(arguments,[{name:"xpath",type:String,mayBeNull:!1},{name:"contextNode",mayBeNull:!0,optional:!0}]);if(n)throw n;return t=t||this._provider.getDocumentElement(),this._provider.selectNodesByXPath(e,t)},t.prototype.getDocumentElement=function(){return this._provider.getDocumentElement()},t.prototype.getNodeValue=function(e){var t=Function._validateParams(arguments,[{name:"node",type:Object,mayBeNull:!1}]);if(t)throw t;return e.text?e.text:e.textContent},t.prototype.getNodeText=function(e){var t=Function._validateParams(arguments,[{name:"node",type:Object,mayBeNull:!1}]);if(t)throw t;return 9==this.getNodeType(e)?this.getNodeText(this.getDocumentElement()):e.text?e.text:e.textContent},t.prototype.setNodeText=function(e,t){var n=Function._validateParams(arguments,[{name:"node",type:Object,mayBeNull:!1},{name:"text",type:String,mayBeNull:!1}]);if(n)throw n;if(9==this.getNodeType(e))return!1;try{e.text?e.text=t:e.textContent=t}catch(e){return!1}return!0},t.prototype.getNodeXml=function(e){var t,n=Function._validateParams(arguments,[{name:"node",type:Object,mayBeNull:!1}]);if(n)throw n;return e.xml?t=e.xml:(t=(new XMLSerializer).serializeToString(e),2==this.getNodeType(e)&&(t=this.getNodeBaseName(e)+'="'+t+'"')),t},t.prototype.setNodeXml=function(t,n){var i=Function._validateParams(arguments,[{name:"node",type:Object,mayBeNull:!1},{name:"xml",type:String,mayBeNull:!1}]);if(i)throw i;var o=new e.XmlProcessor(n,"");if(!o.isValidXml())return null;var r=o.getDocumentElement();try{t.parentNode.replaceChild(r,t)}catch(e){return null}return r},t.prototype.getNodeNamespaceURI=function(e){var t=Function._validateParams(arguments,[{name:"node",type:Object,mayBeNull:!1}]);if(t)throw t;return e.namespaceURI},t.prototype.getNodePrefix=function(e){var t=Function._validateParams(arguments,[{name:"node",type:Object,mayBeNull:!1}]);if(t)throw t;return e.prefix},t.prototype.getNodeBaseName=function(e){var t=Function._validateParams(arguments,[{name:"node",type:Object,mayBeNull:!1}]);if(t)throw t;return!e.nodeType||1!=e.nodeType&&2!=e.nodeType?e.nodeName:e.baseName?e.baseName:e.localName},t.prototype.getNodeType=function(e){var t=Function._validateParams(arguments,[{name:"node",type:Object,mayBeNull:!1}]);if(t)throw t;return e.nodeType},t.prototype.appendChild=function(t,n){var i=Function._validateParams(arguments,[{name:"node",type:Object,mayBeNull:!1},{name:"childXml",type:String,mayBeNull:!1}]);if(i)throw i;var o=new e.XmlProcessor(n,"");if(!o.isValidXml())return null;var r=o.getDocumentElement();return t.appendChild(r),r},t.prototype._getAttributeLocalName=function(e){return e.localName?e.localName:e.baseName},t.prototype.readAttributes=function(e,t,n){var i,o,r=Function._validateParams(arguments,[{name:"node",type:Object,mayBeNull:!1},{name:"attributesToRead",type:Object,mayBeNull:!1},{name:"objectToFill",type:Object,mayBeNull:!1}]);if(r)throw r;for(var a=0;a<e.attributes.length;a++)for(var s in i=e.attributes[a],o=this._getAttributeLocalName(i),t)o===s&&(n[t[s]]=i.value)},t.prototype.isValidXml=function(){if(null==this.getDocumentElement())return!1;if(this._provider._xmldoc.getElementsByTagName("parsererror").length>0){var e=(new DOMParser).parseFromString("<","text/xml").getElementsByTagName("parsererror")[0].namespaceURI;return this._provider._xmldoc.getElementsByTagNameNS(e,"parsererror").length<=0}return!0},t}();e.XmlProcessor=o}(OSF||(OSF={})),function(e){var t=function(){function e(){}return e.prototype.Serialize=function(e){try{return JSON.stringify(e)}catch(e){return null}},e.prototype.Deserialize=function(e){try{return JSON.parse(e)}catch(e){return null}},e}();e.SafeSerializer=t;var n=function(){function e(e,t){this._localStorage=e,this._serializer=t}return e.prototype.GetCacheItem=function(t,n,i,o,r){void 0===n&&(n=!0),void 0===r&&(r=!0),this.ValidateCurrentCache();var a=this._localStorage.getItem(t);if(a){var s=this._serializer.Deserialize(a);if(void 0!==o&&o>0&&o-s.createdOn>0)this._localStorage.removeItem(t),i&&(i.cacheExpired=!0);else{if(!n)return s.data;var l=new Date;if(Math.abs(l.getTime()-s.createdOn)<e.msPerDay*s.refreshRate)return s.data;r&&(this._localStorage.removeItem(t),i&&(i.cacheExpired=!0))}}},e.prototype.SetCacheItem=function(t,n,i){i=i||e.defaultRefreshRateInDays;var o={data:n,createdOn:(new Date).getTime(),refreshRate:i};this._localStorage.setItem(t,this._serializer.Serialize(o))},e.prototype.RemoveCacheItem=function(e){this._localStorage.removeItem(e)},e.prototype.RemoveAll=function(e){for(var t=this._localStorage.getKeysWithPrefix(e),n=0,i=t.length;n<i;n++)this._localStorage.removeItem(t[n])},e.prototype.RemoveMatches=function(e){for(var t=this._localStorage.getKeysWithPrefix(""),n=0,i=t.length;n<i;n++)for(var o=t[n],r=0,a=e.length;r<a;r++)if(e[r].test(o)){this._localStorage.removeItem(o);break}},e.prototype.ValidateCurrentCache=function(){this._localStorage.getItem(e.cacheVersionKey)!=e.currentSchemaVersion&&(this.RemoveMatches([new RegExp("__OSF_(?!.*activated).*$","i")]),this._localStorage.setItem(e.cacheVersionKey,e.currentSchemaVersion))},e.defaultRefreshRateInDays=3,e.msPerDay=864e5,e.currentSchemaVersion="1",e.checkedCache=!1,e.cacheVersionKey="osfCacheVersion",e}();e.AppsDataCacheManager=n;var i=function(e){function t(t,n){return e.call(this,t,n)||this}return __extends(t,e),t.prototype.GetRefreshToken=function(n,i){var o=OSF.OUtil.formatString(t._refreshTokenCacheKey,n,i);return e.prototype.GetCacheItem.call(this,o)},t.prototype.AddRefreshToken=function(n,i,o){var r=OSF.OUtil.formatString(t._refreshTokenCacheKey,i,o);e.prototype.SetCacheItem.call(this,r,n)},t.prototype.RemoveAll=function(){e.prototype.RemoveAll.call(this,t._refreshTokenCachePrefixKey)},t.prototype.RemoveRefreshToken=function(n,i){var o=OSF.OUtil.formatString(t._refreshTokenCacheKey,n,i);e.prototype.RemoveCacheItem.call(this,o)},t._refreshTokenCacheKey="_OSF_PRIVATECATALOG_REFRESHTOKEN_{0}_{1}",t._refreshTokenCachePrefixKey="_OSF_PRIVATECATALOG_REFRESHTOKEN",t}(n);e.TokenCacheManager=i}(OfficeExt||(OfficeExt={})),function(e){var t=function(){function e(e){this._table=e,this._fields={}}return Object.defineProperty(e.prototype,"Fields",{get:function(){return this._fields},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"Table",{get:function(){return this._table},enumerable:!1,configurable:!0}),e.prototype.SerializeFields=function(){},e.prototype.SetSerializedField=function(e,t){null!=t&&(this._serializedFields[e]=t.toString())},e.prototype.SerializeRow=function(){return this._serializedFields={},this.SetSerializedField("Table",this._table),this.SerializeFields(),JSON.stringify(this._serializedFields)},e}();e.BaseUsageData=t;var n=function(e){function t(){return e.call(this,"AppLoadTime")||this}return __extends(t,e),Object.defineProperty(t.prototype,"CorrelationId",{get:function(){return this.Fields.CorrelationId},set:function(e){this.Fields.CorrelationId=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"AppInfo",{get:function(){return this.Fields.AppInfo},set:function(e){this.Fields.AppInfo=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ActivationInfo",{get:function(){return this.Fields.ActivationInfo},set:function(e){this.Fields.ActivationInfo=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"InstanceId",{get:function(){return this.Fields.InstanceId},set:function(e){this.Fields.InstanceId=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"AssetId",{get:function(){return this.Fields.AssetId},set:function(e){this.Fields.AssetId=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Stage1Time",{get:function(){return this.Fields.Stage1Time},set:function(e){this.Fields.Stage1Time=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Stage2Time",{get:function(){return this.Fields.Stage2Time},set:function(e){this.Fields.Stage2Time=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Stage3Time",{get:function(){return this.Fields.Stage3Time},set:function(e){this.Fields.Stage3Time=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Stage4Time",{get:function(){return this.Fields.Stage4Time},set:function(e){this.Fields.Stage4Time=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Stage5Time",{get:function(){return this.Fields.Stage5Time},set:function(e){this.Fields.Stage5Time=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Stage6Time",{get:function(){return this.Fields.Stage6Time},set:function(e){this.Fields.Stage6Time=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Stage7Time",{get:function(){return this.Fields.Stage7Time},set:function(e){this.Fields.Stage7Time=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Stage8Time",{get:function(){return this.Fields.Stage8Time},set:function(e){this.Fields.Stage8Time=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Stage9Time",{get:function(){return this.Fields.Stage9Time},set:function(e){this.Fields.Stage9Time=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Stage10Time",{get:function(){return this.Fields.Stage10Time},set:function(e){this.Fields.Stage10Time=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Stage11Time",{get:function(){return this.Fields.Stage11Time},set:function(e){this.Fields.Stage11Time=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ErrorResult",{get:function(){return this.Fields.ErrorResult},set:function(e){this.Fields.ErrorResult=e},enumerable:!1,configurable:!0}),t.prototype.SerializeFields=function(){this.SetSerializedField("CorrelationId",this.CorrelationId),this.SetSerializedField("AppInfo",this.AppInfo),this.SetSerializedField("ActivationInfo",this.ActivationInfo),this.SetSerializedField("InstanceId",this.InstanceId),this.SetSerializedField("AssetId",this.AssetId),this.SetSerializedField("Stage1Time",this.Stage1Time),this.SetSerializedField("Stage2Time",this.Stage2Time),this.SetSerializedField("Stage3Time",this.Stage3Time),this.SetSerializedField("Stage4Time",this.Stage4Time),this.SetSerializedField("Stage5Time",this.Stage5Time),this.SetSerializedField("Stage6Time",this.Stage6Time),this.SetSerializedField("Stage7Time",this.Stage7Time),this.SetSerializedField("Stage8Time",this.Stage8Time),this.SetSerializedField("Stage9Time",this.Stage9Time),this.SetSerializedField("Stage10Time",this.Stage10Time),this.SetSerializedField("Stage11Time",this.Stage11Time),this.SetSerializedField("ErrorResult",this.ErrorResult)},t}(t);e.AppLoadTimeUsageData=n;var i=function(e){function t(){return e.call(this,"AppNotification")||this}return __extends(t,e),Object.defineProperty(t.prototype,"CorrelationId",{get:function(){return this.Fields.CorrelationId},set:function(e){this.Fields.CorrelationId=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ErrorResult",{get:function(){return this.Fields.ErrorResult},set:function(e){this.Fields.ErrorResult=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"NotificationClickInfo",{get:function(){return this.Fields.NotificationClickInfo},set:function(e){this.Fields.NotificationClickInfo=e},enumerable:!1,configurable:!0}),t.prototype.SerializeFields=function(){this.SetSerializedField("CorrelationId",this.CorrelationId),this.SetSerializedField("ErrorResult",this.ErrorResult),this.SetSerializedField("NotificationClickInfo",this.NotificationClickInfo)},t}(t);e.AppNotificationUsageData=i;var o=function(e){function t(){return e.call(this,"AppManagementMenu")||this}return __extends(t,e),Object.defineProperty(t.prototype,"AssetId",{get:function(){return this.Fields.AssetId},set:function(e){this.Fields.AssetId=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"OperationMetadata",{get:function(){return this.Fields.OperationMetadata},set:function(e){this.Fields.OperationMetadata=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ErrorResult",{get:function(){return this.Fields.ErrorResult},set:function(e){this.Fields.ErrorResult=e},enumerable:!1,configurable:!0}),t.prototype.SerializeFields=function(){this.SetSerializedField("AssetId",this.AssetId),this.SetSerializedField("OperationMetadata",this.OperationMetadata),this.SetSerializedField("ErrorResult",this.ErrorResult)},t}(t);e.AppManagementMenuUsageData=o;var r=function(e){function t(){return e.call(this,"InsertionDialogSession")||this}return __extends(t,e),Object.defineProperty(t.prototype,"AssetId",{get:function(){return this.Fields.AssetId},set:function(e){this.Fields.AssetId=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"TotalSessionTime",{get:function(){return this.Fields.TotalSessionTime},set:function(e){this.Fields.TotalSessionTime=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"TrustPageSessionTime",{get:function(){return this.Fields.TrustPageSessionTime},set:function(e){this.Fields.TrustPageSessionTime=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"DialogState",{get:function(){return this.Fields.DialogState},set:function(e){this.Fields.DialogState=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"LastActiveTab",{get:function(){return this.Fields.LastActiveTab},set:function(e){this.Fields.LastActiveTab=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"LastActiveTabCount",{get:function(){return this.Fields.LastActiveTabCount},set:function(e){this.Fields.LastActiveTabCount=e},enumerable:!1,configurable:!0}),t.prototype.SerializeFields=function(){this.SetSerializedField("AssetId",this.AssetId),this.SetSerializedField("TotalSessionTime",this.TotalSessionTime),this.SetSerializedField("TrustPageSessionTime",this.TrustPageSessionTime),this.SetSerializedField("DialogState",this.DialogState),this.SetSerializedField("LastActiveTab",this.LastActiveTab),this.SetSerializedField("LastActiveTabCount",this.LastActiveTabCount)},t}(t);e.InsertionDialogSessionUsageData=r;var a=function(e){function t(){return e.call(this,"UploadFileDevCatelog")||this}return __extends(t,e),Object.defineProperty(t.prototype,"CorrelationId",{get:function(){return this.Fields.CorrelationId},set:function(e){this.Fields.CorrelationId=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"OperationMetadata",{get:function(){return this.Fields.OperationMetadata},set:function(e){this.Fields.OperationMetadata=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ErrorResult",{get:function(){return this.Fields.ErrorResult},set:function(e){this.Fields.ErrorResult=e},enumerable:!1,configurable:!0}),t.prototype.SerializeFields=function(){this.SetSerializedField("CorrelationId",this.CorrelationId),this.SetSerializedField("OperationMetadata",this.OperationMetadata),this.SetSerializedField("ErrorResult",this.ErrorResult)},t}(t);e.UploadFileDevCatelogUsageData=a;var s=function(e){function t(){return e.call(this,"UploadFileDevCatalogUsage")||this}return __extends(t,e),Object.defineProperty(t.prototype,"CorrelationId",{get:function(){return this.Fields.CorrelationId},set:function(e){this.Fields.CorrelationId=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"StoreType",{get:function(){return this.Fields.StoreType},set:function(e){this.Fields.StoreType=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"AppId",{get:function(){return this.Fields.AppId},set:function(e){this.Fields.AppId=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"AppVersion",{get:function(){return this.Fields.AppVersion},set:function(e){this.Fields.AppVersion=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"AppTargetType",{get:function(){return this.Fields.AppTargetType},set:function(e){this.Fields.AppTargetType=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"IsAppCommand",{get:function(){return this.Fields.IsAppCommand},set:function(e){this.Fields.IsAppCommand=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"AppSizeWidth",{get:function(){return this.Fields.AppSizeWidth},set:function(e){this.Fields.AppSizeWidth=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"AppSizeHeight",{get:function(){return this.Fields.AppSizeHeight},set:function(e){this.Fields.AppSizeHeight=e},enumerable:!1,configurable:!0}),t.prototype.SerializeFields=function(){this.SetSerializedField("CorrelationId",this.CorrelationId),this.SetSerializedField("StoreType",this.StoreType),this.SetSerializedField("AppId",this.AppId),this.SetSerializedField("AppVersion",this.AppVersion),this.SetSerializedField("AppTargetType",this.AppTargetType),this.SetSerializedField("IsAppCommand",this.IsAppCommand),this.SetSerializedField("AppSizeWidth",this.AppSizeWidth),this.SetSerializedField("AppSizeHeight",this.AppSizeHeight)},t}(t);e.UploadFileDevCatalogUsageUsageData=s}(OSFLog||(OSFLog={})),function(e){"use strict";var t,n,i,o;!function(e){e[e.unexpected=10]="unexpected",e[e.warning=15]="warning",e[e.info=50]="info",e[e.verbose=100]="verbose",e[e.verboseEx=200]="verboseEx"}(t=e.ULSTraceLevel||(e.ULSTraceLevel={})),function(e){e[e.msoulscat_Osf_Latency=1401]="msoulscat_Osf_Latency",e[e.msoulscat_Osf_Notification=1402]="msoulscat_Osf_Notification",e[e.msoulscat_Osf_Runtime=1403]="msoulscat_Osf_Runtime",e[e.msoulscat_Osf_AppManagementMenu=1404]="msoulscat_Osf_AppManagementMenu",e[e.msoulscat_Osf_InsertionDialogSession=1405]="msoulscat_Osf_InsertionDialogSession",e[e.msoulscat_Osf_UploadFileDevCatelog=1406]="msoulscat_Osf_UploadFileDevCatelog",e[e.msoulscat_Osf_UploadFileDevCatalogUsage=1411]="msoulscat_Osf_UploadFileDevCatalogUsage"}(n=e.ULSCat||(e.ULSCat={})),function(e){e[e.ConfirmationDialogCancel=256]="ConfirmationDialogCancel",e[e.InsertionDialogClosed=512]="InsertionDialogClosed",e[e.IsAnonymous=1024]="IsAnonymous"}(i||(i={})),function(e){e[e.Undefined=0]="Undefined",e[e.Inserted=1]="Inserted",e[e.Canceled=2]="Canceled",e[e.Closed=3]="Closed",e[e.TrustPageVisited=8]="TrustPageVisited"}(o||(o={}));var r=function(){function e(){this.timeValue=0}return e.prototype.Start=function(){this.timeValue=-(new Date).getTime(),this.finishedMeasurement=!1},e.prototype.Stop=function(){this.timeValue<0&&(this.timeValue+=(new Date).getTime(),this.finishedMeasurement=!0)},Object.defineProperty(e.prototype,"Finished",{get:function(){return this.finishedMeasurement},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ElapsedTime",{get:function(){var e=this.timeValue;return!this.Finished&&e<0&&(e=Math.abs(e)-(new Date).getTime()),e},enumerable:!1,configurable:!0}),e}();e.LatencyStopwatch=r;var a=function(){};e.Context=a;var s=function(){function e(){}return e.SetExternalLogger=function(t){e.s_externalLogger=t},e.SendULSTraceTag=function(t,n,i,o){Microsoft.Office.WebExtension.FULSSupported&&(window.Diag&&Diag.UULS&&Diag.UULS.trace?Diag.UULS.trace(o,t,n,i):e.s_externalLogger&&e.s_externalLogger.sendTraceTag&&e.s_externalLogger.sendTraceTag(o,t,n,i))},e.s_externalLogger=null,e}();e.Logger=s;var l=function(){function e(){}return e.Instance=function(){return e.instance||(e.instance=new e),e.instance},e.prototype.LogData=function(t){s.SendULSTraceTag(e.category,e.level,t.SerializeRow(),6062431)},e.category=n.msoulscat_Osf_Notification,e.level=t.info,e}();e.NotificationLogger=l;var c=function(){function e(){}return e.Instance=function(){return e.instance||(e.instance=new e),e.instance},e.prototype.LogData=function(t){s.SendULSTraceTag(e.category,e.level,t.SerializeRow(),523360225)},e.category=n.msoulscat_Osf_AppManagementMenu,e.level=t.info,e}();e.AppManagementMenuLogger=c;var u=function(){function e(){}return e.Instance=function(){return e.instance||(e.instance=new e),e.instance},e.prototype.LogData=function(t){s.SendULSTraceTag(e.category,e.level,t.SerializeRow(),523360226)},e.category=n.msoulscat_Osf_UploadFileDevCatelog,e.level=t.info,e}();e.UploadFileDevCatelogLogger=u;var d=function(){function e(){}return e.Instance=function(){return e.instance||(e.instance=new e),e.instance},e.prototype.LogData=function(t){s.SendULSTraceTag(e.category,e.level,t.SerializeRow(),523360227)},e.category=n.msoulscat_Osf_UploadFileDevCatalogUsage,e.level=t.info,e}();e.UploadFileDevCatalogUsageLogger=d;var p=function(){function e(){}return e.Instance=function(){return e.instance||(e.instance=new e),e.instance},e.prototype.LogData=function(t){s.SendULSTraceTag(e.category,e.level,t.SerializeRow(),4748055)},e.category=n.msoulscat_Osf_Latency,e.level=t.info,e}();e.LatencyLogger=p;var f=function(){function e(){}return e.Instance=function(){return e.instance||(e.instance=new e),e.instance},e.prototype.LogData=function(t){s.SendULSTraceTag(e.category,e.level,t.SerializeRow(),523360256)},e.category=n.msoulscat_Osf_InsertionDialogSession,e.level=t.info,e}();e.InsertionDialogSessionLogger=f;var m=function(){function e(){}return e.LogNotification=function(e,t,n){var i=new OSFLog.AppNotificationUsageData;i.CorrelationId=e,i.ErrorResult=t,i.NotificationClickInfo=n,l.Instance().LogData(i)},e}();e.AppNotificationHelper=m;var h=function(){function e(){}return e.LogAppManagementMenuAction=function(e,t,n,o,r,a){var s=new OSFLog.AppManagementMenuUsageData,l=0===e.toLowerCase().indexOf("wa")?parseInt(e.substring(2),10):parseInt(e,10);o&&(t|=i.InsertionDialogClosed),r&&(t|=i.IsAnonymous),s.AssetId=l,s.OperationMetadata=t,s.ErrorResult=a,c.Instance().LogData(s)},e}();e.AppManagementMenuHelper=h;var g=function(){function e(){}return e.LogUploadFileDevCatelogAction=function(e,t,n,i,o,r){var a=new OSFLog.UploadFileDevCatelogUsageData;a.CorrelationId=e,a.OperationMetadata=t,a.ErrorResult=r,u.Instance().LogData(a)},e}();e.UploadFileDevCatelogHelper=g;var y=function(){function e(){}return e.LogUploadFileDevCatalogUsageAction=function(e,t,n,i,o,r,a,s){var l=new OSFLog.UploadFileDevCatalogUsageUsageData;l.CorrelationId=e,l.StoreType=t,l.AppId=n,l.AppVersion=i,l.AppTargetType=o,l.IsAppCommand=r,l.AppSizeWidth=a,l.AppSizeHeight=s,d.Instance().LogData(l)},e}();e.UploadFileDevCatalogUsageHelper=y;var v=function(){function e(){}return e.GenerateActivationMessage=function(e,t){var n="";return null!=e&&(n+="ActivationRuntimeType: "+e.toString()+"|"),null!=t&&(n+="CorrelationId: "+t),n},e.ActivationStart=function(i,o,a,l,c,u){e.activatingNumber++,i.LoadTime=new OSFLog.AppLoadTimeUsageData,i.Timers={},i.LoadTime.CorrelationId=l,i.LoadTime.AppInfo=o,i.LoadTime.ActivationInfo=0,i.LoadTime.InstanceId=c,i.LoadTime.AssetId=a,i.LoadTime.Stage1Time=0,i.Timers.Stage1Time=new r,i.LoadTime.Stage2Time=0,i.Timers.Stage2Time=new r,i.LoadTime.Stage3Time=0,i.LoadTime.Stage4Time=0,i.Timers.Stage4Time=new r,i.LoadTime.Stage5Time=0,i.Timers.Stage5Time=new r,i.LoadTime.Stage6Time=e.activatingNumber,i.LoadTime.Stage7Time=0,i.Timers.Stage7Time=new r,i.LoadTime.Stage8Time=0,i.Timers.Stage8Time=new r,i.LoadTime.Stage9Time=0,i.Timers.Stage9Time=new r,i.LoadTime.Stage10Time=0,i.Timers.Stage10Time=new r,i.LoadTime.Stage11Time=0,i.Timers.Stage11Time=new r,i.LoadTime.ErrorResult=0,i.ActivationRuntimeType=u,e.StartStopwatch(i,"Stage1Time"),s.SendULSTraceTag(n.msoulscat_Osf_Runtime,t.info,e.GenerateActivationMessage(u,l),523360257)},e.ActivationEnd=function(t){e.ActivateEndInternal(t)},e.PageStart=function(t){e.StartStopwatch(t,"Stage2Time")},e.PageLoaded=function(t){e.StopStopwatch(t,"Stage2Time")},e.ServerCallStart=function(t){e.StartStopwatch(t,"Stage4Time")},e.ServerCallEnd=function(t){e.StopStopwatch(t,"Stage4Time")},e.AuthenticationStart=function(t){e.StartStopwatch(t,"Stage5Time")},e.AuthenticationEnd=function(t){e.StopStopwatch(t,"Stage5Time")},e.EntitlementCheckStart=function(t){e.StartStopwatch(t,"Stage7Time")},e.EntitlementCheckEnd=function(t){e.StopStopwatch(t,"Stage7Time")},e.KilledAppsCheckStart=function(t){e.StartStopwatch(t,"Stage8Time")},e.KilledAppsCheckEnd=function(t){e.StopStopwatch(t,"Stage8Time")},e.AppStateCheckStart=function(t){e.StartStopwatch(t,"Stage9Time")},e.AppStateCheckEnd=function(t){e.StopStopwatch(t,"Stage9Time")},e.ManifestRequestStart=function(t){e.StartStopwatch(t,"Stage10Time")},e.ManifestRequestEnd=function(t){e.StopStopwatch(t,"Stage10Time")},e.OfficeJSStartToLoad=function(t){e.StartStopwatch(t,"Stage11Time")},e.OfficeJSLoaded=function(t){e.StopStopwatch(t,"Stage11Time")},e.SetAnonymousFlag=function(t,n){e.SetActivationInfoField(t,e.ConvertFlagToBit(n),2,0)},e.SetRetryCount=function(t,n){e.SetActivationInfoField(t,n,3,2)},e.SetManifestTrustCachedFlag=function(t,n){e.SetActivationInfoField(t,e.ConvertFlagToBit(n),2,5)},e.SetManifestDataCachedFlag=function(t,n){e.SetActivationInfoField(t,e.ConvertFlagToBit(n),2,7)},e.SetOmexHasEntitlementFlag=function(t,n){e.SetActivationInfoField(t,e.ConvertFlagToBit(n),2,9)},e.SetManifestDataInvalidFlag=function(t,n){e.SetActivationInfoField(t,e.ConvertFlagToBit(n),2,11)},e.SetAppStateDataCachedFlag=function(t,n){e.SetActivationInfoField(t,e.ConvertFlagToBit(n),2,13)},e.SetAppStateDataInvalidFlag=function(t,n){e.SetActivationInfoField(t,e.ConvertFlagToBit(n),2,15)},e.SetActivationRuntimeType=function(t,n){e.SetActivationInfoField(t,n,2,17)},e.SetErrorResult=function(t,n){t.LoadTime&&(t.LoadTime.ErrorResult=n,e.ActivateEndInternal(t))},e.SetBit=function(t,n,i,o){e.SetActivationInfoField(t,n,o||2,i)},e.StartStopwatch=function(t,n){t.LoadTime&&t.Timers&&t.Timers[n]&&(t.Timers[n].Start(),e.UpdateActivatingNumber(t))},e.StopStopwatch=function(t,n){t.LoadTime&&t.Timers&&t.Timers[n]&&(t.Timers[n].Stop(),e.UpdateActivatingNumber(t))},e.ConvertFlagToBit=function(e){return e?2:1},e.SetActivationInfoField=function(t,n,i,o){t.LoadTime&&(e.UpdateActivatingNumber(t),t.LoadTime.ActivationInfo=e.SetBitField(t.LoadTime.ActivationInfo,n,i,o))},e.SetBitField=function(e,t,n,i){return e&~(Math.pow(2,n)-1<<i)|t<<i},e.UpdateActivatingNumber=function(t){t.LoadTime&&(t.LoadTime.Stage6Time=t.LoadTime.Stage6Time>e.activatingNumber?t.LoadTime.Stage6Time:e.activatingNumber)},e.ActivateEndInternal=function(i){if(i.LoadTime){if(e.StopStopwatch(i,"Stage1Time"),i.Timers)for(var o in i.Timers)null!=i.Timers[o].ElapsedTime&&(i.LoadTime[o]=i.Timers[o].ElapsedTime);s.SendULSTraceTag(n.msoulscat_Osf_Runtime,t.info,e.GenerateActivationMessage(i.ActivationRuntimeType,i.LoadTime.CorrelationId),523360258),p.Instance().LogData(i.LoadTime),i.LoadTime=null,e.activatingNumber--}},e.activatingNumber=0,e}();e.AppLoadTimeHelper=v;var S=function(){function e(){}return e.LogProxyFailure=function(n,i,o){var r;null==n&&(n=""),r=OSF.OUtil.formatString("appCorrelationId:{0}, methodName:{1}",n,i),Object.keys(o).forEach((function(e){var t=o[e];null!=t&&(t=t.toString()),r+=", "+e+":"+t})),s.SendULSTraceTag(e.category,t.warning,r,6062432)},e.LogExceptionTag=function(n,i,o,r){var a=n;i&&(i.name&&(a+=" Exception name:"+i.name+"."),i.paramName&&(a+=" Param name:"+i.paramName+"."),i.message&&(a+=" Message:"+i.message+"."),i.stack&&(a+=" [Stack:"+i.stack+"]")),null!=o&&(a+=" AppCorrelationId:"+o+"."),s.SendULSTraceTag(e.category,t.warning,a,r)},e.LogCommonMessageTag=function(n,i,o){null!=i&&(n+=" AppCorrelationId:"+i+"."),s.SendULSTraceTag(e.category,t.info,n,o)},e.category=n.msoulscat_Osf_Runtime,e}();e.RuntimeTelemetryHelper=S;var _=function(){function e(){}return e.LogInsertionDialogSession=function(e,t,n,i,r,a){var s=new OSFLog.InsertionDialogSessionUsageData,l=0===e.toLowerCase().indexOf("wa")?parseInt(e.substring(2),10):parseInt(e,10),c=o.Undefined;c|=i?o.Inserted:o.Canceled,n>0&&(c|=o.TrustPageVisited),s.AssetId=l,s.TotalSessionTime=t,s.TrustPageSessionTime=n,s.DialogState=c,s.LastActiveTab=r,s.LastActiveTabCount=a,f.Instance().LogData(s)},e}();e.InsertionDialogSessionHelper=_;var C=function(){function i(){}return i.IsPrivateAddin=function(e,i,o,r,a){switch((e||"").toLowerCase()){case OSF.StoreType.OMEX:case OSF.StoreType.HardCodedPreinstall:case OSF.StoreType.FirstParty:case OSF.StoreType.Sdx:case OSF.StoreType.WopiCatalog:return!1;case OSF.StoreType.SPCatalog:case OSF.StoreType.SPApp:case OSF.StoreType.FileSystem:case OSF.StoreType.Registry:case OSF.StoreType.UploadFileDevCatalog:return!0;case OSF.StoreType.PrivateCatalog:return!i||0!==i.toLowerCase().indexOf("wa");case OSF.StoreType.Exchange:var l=null!=r?r.toLowerCase():null;if(l&&"default"===l||"marketplace"===l||"preinstalled"===l||"marketplaceprivatecatalog"===l)return!1;var c=null!=o?o.toLowerCase():null;return!(c&&"microsoft"===c||"microsoft corp"===c||"microsoft corp."===c||"microsoft corporation"===c);case OSF.StoreType.InMemory:default:return s.SendULSTraceTag(n.msoulscat_Osf_Notification,t.warning,"Unknown StoreType: "+e+" in function IsPrivateAddin.",523360259),!0}},i.GetAssetId=function(t,n,o,r,a){return e.RuntimeTelemetryHelper.LogExceptionTag("PrivacyRules GetAssetId is deprecated",null,null,509666709),i.IsPrivateAddin(t,o,r,a,n)?i.privateCompliantId:o},i.GetPrivacyCompliantId=function(e,t,n,o,r,a){return i.IsPrivateAddin(t,n,o,r,a)?i.privateCompliantId:e},i.privateCompliantId="PRIVATE",i}();e.PrivacyRules=C}(Telemetry||(Telemetry={})),function(e){var t,n=function(){function e(){this.m_osfControlId=null,this.m_isControlReady=!1,this.m_queue=[]}return Object.defineProperty(e.prototype,"osfControlId",{get:function(){return this.m_osfControlId},set:function(e){this.m_osfControlId=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isControlReady",{get:function(){return this.m_isControlReady},set:function(e){this.m_isControlReady=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isEmpty",{get:function(){return 0===this.m_queue.length},enumerable:!1,configurable:!0}),e.prototype.queueAction=function(e,t){var n={eventData:e,actionSender:t};this.m_queue.push(n)},e.prototype.sendActions=function(){var e=this;return new Promise((function(t,n){window.setTimeout((function(){for(;e.m_queue.length>0;){var n=e.m_queue[0];e.m_queue.splice(0,1),e.sendAction(n)}t()}),0)}))},e.prototype.sendAction=function(e){var t=e.eventData,n=e.actionSender;t&&n&&this.m_isControlReady&&n(this.m_osfControlId,t)},e}();!function(e){e[e.Unknown=0]="Unknown",e[e.Host=1]="Host",e[e.Addin=2]="Addin"}(t||(t={}));var i=function(){function i(){}return i.init=function(){return i.s_usedShortcutAddins={},e.ActionMetadataManager.init(!0).then((function(){if(i.isAddinShortcutsPreferenceSettingHelperSupported())return Common.App.AppsForOffice.AddinShortcutsPreferenceSettingHelper.instance().loadShortcutsPreferenceMappingTable()}))},i.isConflictFound=function(e,t){return e&&t.length>0||!e&&t.length>1},i.isAddinShortcutsPreferenceSettingHelperSupported=function(){return"undefined"!=typeof Common&&Common.App&&Common.App.AppsForOffice&&Common.App.AppsForOffice.AddinShortcutsPreferenceSettingHelper&&Common.App.AppsForOffice.AddinShortcutsPreferenceSettingHelper.instance()},i.tryDispatchShortcutKey=function(n,o,r,a,s,l,c){try{if(!a)throw new e.OsfRuntimeError(e.OsfRuntimeErrorCode.invalidParameter,"Error: Invalid Parameter");if(!s)throw new e.OsfRuntimeError(e.OsfRuntimeErrorCode.invalidParameter,"Error: Invalid Parameter");var u=i.getShortcutInfoArrayFromShortcutKey(n,o);return!(!u||0===u.length)&&(!r&&1===u.length&&u[0].addinId&&u[0].actionId?(c&&c!=u[0].addinId||i.callActionHandlerAndLogUsage(a,u[0].addinId,u[0].actionId),!0):!!i.isConflictFound(!!r,u)&&("undefined"!=typeof Common&&Common.App&&Common.App.AppsForOffice&&Common.App.AppsForOffice.AddinShortcutsPreferenceSettingHelper?Common.App.AppsForOffice.AddinShortcutsPreferenceSettingHelper.instance().getSetting().then((function(d){if(d){var p=JSON.parse(d);if(p[o.toString()]){var f=p[o.toString()][n.toString()];if(f)if(f.ownerType==t.Addin){for(var m=!1,h=0;h<u.length;h++)if(f.addinId==u[h].addinId){m=!0;break}if(m)return void(c&&c!=f.addinId||i.callActionHandlerAndLogUsage(a,f.addinId,f.action));Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("Action owner do not exist",null,523539520)}else{if(f.ownerType==t.Host&&!c)return void s();Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("Action owner type isn't support",null,523539521)}}}var g=[];r&&g.push({addinId:null,addinName:null,action:null,actionDescription:r,ownerType:t.Host});for(h=0;h<u.length;h++){var y=new OSF.AddinIdInfo(u[h].addinId),v=OSF.OsfManifestManager.getCachedManifest(y.getSolutionId(),y.getSolutionVersion());v&&g.push({addinId:u[h].addinId,addinName:null==v._displayNames[v._UILocale.toLowerCase()]?v._displayNames[v._defaultLocale.toLocaleLowerCase()]:v._displayNames[v._UILocale.toLowerCase()],action:u[h].actionId,actionDescription:u[h].actionName,ownerType:t.Addin})}if(1==g.length){if(g[0].ownerType==t.Host)return s(),!0;if(g[0].ownerType==t.Addin)return i.callActionHandlerAndLogUsage(a,g[0].addinId,g[0].action),!0}var S={modifiers:n,keyCode:o,shortcutText:e.ShortcutsMappingTableManager.getShortcutText(n,o,e.ExtendedManifestUtility.getPlatformName()),shortcutDisplayInfoArray:g};l(S).then((function(e){e>=0&&S.shortcutDisplayInfoArray[e]&&i.enableShortcutKey(S.shortcutDisplayInfoArray[e].ownerType,S.shortcutDisplayInfoArray[e].addinId,S.shortcutDisplayInfoArray[e].action,n,o).then((function(){S.shortcutDisplayInfoArray[e].ownerType==t.Addin?c&&c!=S.shortcutDisplayInfoArray[e].addinId||i.callActionHandlerAndLogUsage(a,S.shortcutDisplayInfoArray[e].addinId,S.shortcutDisplayInfoArray[e].action):S.shortcutDisplayInfoArray[e].ownerType!=t.Host||c||s()})),setTimeout((function(){i.sendShortcutConflictInfoTelemetry(S,e)}),0)}))})):Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("AddinShortcutsPreferenceSettingHelper isn't ready",null,523539522),!0))}catch(e){return Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Failed to disptach the shortcut key",e,null,523539523),!1}},i.getShortcutInfoArrayFromShortcutKey=function(t,n){if(!i.isAddinShortcutsPreferenceSettingHelperSupported())throw OfficeExtension.WacRuntime.Utility.createInvalidOperationException();var o=[],r=Common.App.AppsForOffice.AddinShortcutsPreferenceSettingHelper.instance().getShortcutInfoArray(t,n);Array.isArray(r)&&r.length>0&&r.forEach((function(t){var n=e.ShortcutsMappingTableManager.getActionName(t.addinId,t.action);o.push({addinId:t.addinId,actionId:t.action,actionName:n})}));var a=e.ShortcutsMappingTableManager.getShortcutsMappingTable();if(null!=a&&null!=a[n]){var s=a[n][t];Array.isArray(s)&&s.length>0&&s.forEach((function(t){if(!Common.App.AppsForOffice.AddinShortcutsPreferenceSettingHelper.instance().isActionCustomized(t.addinId,t.actionId)){var n=e.ShortcutsMappingTableManager.getActionName(t.addinId,t.actionId);o.push({addinId:t.addinId,actionId:t.actionId,actionName:n})}}))}return o},i.callActionHandlerAndLogUsage=function(e,t,n){e(t,n),setTimeout((function(){i.sendShortcutUsageTelemetry(t)}),0)},i.enableShortcutKey=function(e,t,n,i,o){return Common.App.AppsForOffice.AddinShortcutsPreferenceSettingHelper.instance().saveSetting(e,t,n,i,o)},i.sendQueuedActions=function(e){var t=i.getOrCreateAddinActionQueue(e);t&&(t.isControlReady=!0,t.sendActions())},i.queueOrSendActionIfControlReady=function(e,t,n){var o=i.getOrCreateAddinActionQueue(e);o.isControlReady?o.isEmpty?n(e,t):(o.queueAction(t,n),o.sendActions()):o.queueAction(t,n)},i.getOrCreateAddinActionQueue=function(e){var t=i.s_actionQueues[e];return t||((t=new n).osfControlId=e,i.s_actionQueues[e]=t),t},i.sendShortcutUsageTelemetry=function(t){if(t){if(!i.s_usedShortcutAddins[t]){i.s_usedShortcutAddins[t]=!0;var n=new OSF.AddinIdInfo(t);if(!n.getStoreTypeId()||!n.getSolutionId())return void Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("Couldn't get solutionId or storetype from the addinid",null,523539525);"undefined"!=typeof otel&&void 0!==otel.sendTelemetryEvent?OSF.OUtil.sendTelemetryEvent("Office.Extensibility.Shortcuts.RuntimeInfo",[{name:"shortcutBeingUsed",bool:!0},{name:"solutionId",string:n.getPrivacyCompliantSolutionId()},{name:"storeType",string:e.ManifestUtil.GetStoreTypeName(n.getStoreTypeId())}])||otel.sendTelemetryEvent({name:"Office.Extensibility.Shortcuts.RuntimeInfo",dataFields:[{name:"shortcutBeingUsed",bool:!0},{name:"solutionId",string:n.getPrivacyCompliantSolutionId()},{name:"storeType",string:e.ManifestUtil.GetStoreTypeName(n.getStoreTypeId())}]}):Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("The Otel isn't available, couldn't call sendOtelEvent for logging the shortcuts telemetry",null,523539526)}}else Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("AddinId is null",null,523539524)},i.sendShortcutConflictInfoTelemetry=function(n,i){var o=null,r=null;if(i>=0&&n.shortcutDisplayInfoArray.length>i&&n.shortcutDisplayInfoArray[i].ownerType==t.Addin){if(!n.shortcutDisplayInfoArray[i].addinId)return void Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("Couldn't get the addinid",null,523539527);var a=new OSF.AddinIdInfo(n.shortcutDisplayInfoArray[i].addinId);if(o=a.getPrivacyCompliantSolutionId(),r=e.ManifestUtil.GetStoreTypeName(a.getStoreTypeId()),!o||!r)return void Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("Couldn't get solutionId or storetype from the addinid",null,523539528)}var s=[{name:"FConflictWithExcel",bool:n.shortcutDisplayInfoArray[0].ownerType==t.Host},{name:"ConflictVectorSize",int64:n.shortcutDisplayInfoArray.length},{name:"KeyCode",int64:n.keyCode},{name:"ModifierKeys",int64:n.modifiers},{name:"SolutionId",string:o},{name:"StoreType",string:r}];"undefined"!=typeof otel&&void 0!==otel.sendTelemetryEvent?(i>=0?s.push({name:"ExcelHostShortcutGotOverride",bool:n.shortcutDisplayInfoArray[0].ownerType==t.Host&&n.shortcutDisplayInfoArray[i].ownerType!=t.Host}):s.push({name:"UserCanceledConflictUI",bool:!0}),OSF.OUtil.sendTelemetryEvent("Office.Extensibility.Shortcuts.ConflictInfo",s)||otel.sendTelemetryEvent({name:"Office.Extensibility.Shortcuts.ConflictInfo",dataFields:s})):Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("The Otel isn't available, couldn't call sendOtelEvent for logging the shortcuts telemetry",null,523539529)},i.checkShortcutsInUse=function(n,o){if(null==n)throw OfficeExtension.WacRuntime.Utility.createInvalidArgumentException("shortcuts");if(null==o)throw OfficeExtension.WacRuntime.Utility.createInvalidArgumentException("isShortcutKeyUsedByHost");if(!i.isAddinShortcutsPreferenceSettingHelperSupported())throw OfficeExtension.WacRuntime.Utility.createInvalidOperationException();return Common.App.AppsForOffice.AddinShortcutsPreferenceSettingHelper.instance().getSetting().then((function(r){var a=null;r&&(a=JSON.parse(r));for(var s=[],l=0;l<n.length;++l){var c=e.ShortcutsMappingTableManager.convertStringToKeys(n[l]);if(null==c)throw OfficeExtension.WacRuntime.Utility.createInvalidArgumentException("shortcuts");if(a&&a[c.virtualKey.toString()]){var u=a[c.virtualKey.toString()][c.modifierKeys.toString()];if(u&&(u.ownerType==t.Addin||u.ownerType==t.Host)){s.push(!0);continue}}if(o(c.modifierKeys,c.virtualKey))s.push(!0);else{var d=i.getShortcutInfoArrayFromShortcutKey(c.modifierKeys,c.virtualKey);Array.isArray(d)&&d.length>0?s.push(!0):s.push(!1)}}return s}))},i.getShortcuts=function(n){if(null==n||0===n.length)throw OfficeExtension.WacRuntime.Utility.createInvalidArgumentException("addinId");if(!i.isAddinShortcutsPreferenceSettingHelperSupported())throw OfficeExtension.WacRuntime.Utility.createInvalidOperationException();return new Promise((function(i,o){var r=Common.App.AppsForOffice.AddinShortcutsPreferenceSettingHelper.instance().getShortcutsPreferenceMappingTable(),a={},s=function(i){var o=function(o){var s=null!=r&&null!=r[i]?r[i][o]:null;if(s&&s.ownerType==t.Addin&&s.addinId==n){var l=e.ShortcutsMappingTableManager.getShortcutText(parseInt(o),parseInt(i),e.ExtendedManifestUtility.getPlatformName());a[s.action]=l}else{var c=Common.App.AppsForOffice.AddinShortcutsPreferenceSettingHelper.instance().getShortcutInfoArray(o,i);Array.isArray(c)&&c.length>0&&c.forEach((function(r){if(r.addinId==n)if(s&&(s.ownerType==t.Host||s.ownerType==t.Addin&&s.addinId!=n))a[r.action]=null;else{var l=e.ShortcutsMappingTableManager.getShortcutText(parseInt(o),parseInt(i),e.ExtendedManifestUtility.getPlatformName());a[r.action]=l}}))}};for(var s in r[i])o(s)};for(var l in r)s(l);var c=e.ShortcutsMappingTableManager.getShortcutsMappingTable(),u=function(i){var o=function(o){var s=c[i][o];Array.isArray(s)&&s.length>0&&s.forEach((function(s){if(s.addinId==n&&!Common.App.AppsForOffice.AddinShortcutsPreferenceSettingHelper.instance().isActionCustomized(s.addinId,s.actionId)){var l=null!=r&&null!=r[i]?r[i][o]:null,c=null;(!l||l.ownerType==t.Addin&&l.addinId==s.addinId&&l.action==s.actionId)&&(c=e.ShortcutsMappingTableManager.getShortcutText(s.modifierKeys,s.virtualKey,e.ExtendedManifestUtility.getPlatformName())),a[s.actionId]=c}}))};for(var s in c[i])o(s)};for(var l in c)u(l);i(a)}))},i.replaceShortcuts=function(n,o){return __awaiter(this,void 0,void 0,(function(){var r,a,s,l,c,u,d,p,f,m,h,g,y;return __generator(this,(function(v){switch(v.label){case 0:if(null==n||0===n.length)throw OfficeExtension.WacRuntime.Utility.createInvalidArgumentException("addinId");if(!i.isAddinShortcutsPreferenceSettingHelperSupported())throw OfficeExtension.WacRuntime.Utility.createInvalidOperationException();for(s in Common.App.AppsForOffice.AddinShortcutsPreferenceSettingHelper.instance().startBatchUpdateScope(),r=e.ShortcutsMappingTableManager.getActionNamesByAddinId(n),a=[],o)a.push(s);l=0,v.label=1;case 1:if(!(l<a.length))return[3,7];if(c=a[l],null==r[c])throw OfficeExtension.WacRuntime.Utility.createInvalidArgumentException("shortcuts");return null!=(u=o[c])?[3,3]:[4,Common.App.AppsForOffice.AddinShortcutsPreferenceSettingHelper.instance().removeActionFromShortcutInfoArray(n,c)];case 2:return v.sent(),[3,6];case 3:if(null==(d=e.ShortcutsMappingTableManager.convertStringToKeys(u)))throw OfficeExtension.WacRuntime.Utility.createInvalidArgumentException("shortcuts");for(p=e.ShortcutsMappingTableManager.getShortcutsInfo(d.modifierKeys,d.virtualKey),f=!1,m=0;m<p.length;++m)if(p[m].addinId==n&&p[m].actionId==c){f=!0;break}return f?[3,6]:Common.App.AppsForOffice.AddinShortcutsPreferenceSettingHelper.instance().isActionCustomized(n,c)?[4,Common.App.AppsForOffice.AddinShortcutsPreferenceSettingHelper.instance().removeActionFromShortcutInfoArray(n,c)]:[3,5];case 4:v.sent(),v.label=5;case 5:h={ownerType:t.Addin,addinId:n,action:c},g=[h],y=Common.App.AppsForOffice.AddinShortcutsPreferenceSettingHelper.instance().getShortcutInfoArray(d.modifierKeys,d.virtualKey),Array.isArray(y)&&y.length>0&&g.concat(y),Common.App.AppsForOffice.AddinShortcutsPreferenceSettingHelper.instance().setShortcutInfoWithinBatchUpdateScope(d.modifierKeys,d.virtualKey,g),v.label=6;case 6:return l++,[3,1];case 7:return[4,Common.App.AppsForOffice.AddinShortcutsPreferenceSettingHelper.instance().commitBatchUpdateScope()];case 8:return v.sent(),[2]}}))}))},i.s_usedShortcutAddins={},i.s_actionQueues={},i}();e.ShortcutKeyDispatchManager=i}(OfficeExt||(OfficeExt={}));var _omexXmlNamespaces='xmlns="urn:schemas-microsoft-com:office:office" xmlns:o="urn:schemas-microsoft-com:office:office"';function _getAppSubType(e){var t;if(0===e)t=OSF.AppSubType.Content;else{if(1!==e)throw OsfMsAjaxFactory.msAjaxError.argument("officeExtentionTarget");t=OSF.AppSubType.Taskpane}return t}function _getAppVersion(e){var t=OSF.AppVersion[e.toLowerCase()];if(void 0===t)throw OsfMsAjaxFactory.msAjaxError.argument("applicationName");return t}function _invokeCallbackTag(e,t,n,i,o,r){var a=i;if(e){try{var s={status:t,result:n,failureInfo:null},l=function(e,t,n){null===e.failureInfo&&(e.failureInfo={}),e.failureInfo[t]=n};if(o){var c=-1;if(o.get_statusCode&&(c=o.get_statusCode()),a||(o.get_timedOut&&o.get_timedOut()?a="Request timed out.":o.get_aborted&&o.get_aborted()&&(a="Request aborted.")),c>=400||t===statusCode.Failed||a){l(s,"statusCode",c),l(s,"tagId",r);var u=o.get_webRequest();if(u)if(u.getResolvedUrl&&l(s,"url",u.getResolvedUrl()),o.getResponseHeader&&u.get_userContext&&u.get_userContext()&&!u.get_userContext().correlationId)l(s,"correlationId",o.getResponseHeader("X-CorrelationId"))}}a&&(l(s,"message",a),OsfMsAjaxFactory.msAjaxDebug.trace(a))}catch(e){OsfMsAjaxFactory.msAjaxDebug.trace("Encountered exception with logging: "+e)}e(s)}}!function(e){!function(e){e[e.Taskpane=1]="Taskpane",e[e.Content=2]="Content",e[e.Contextual=3]="Contextual",e[e.Dictionary=4]="Dictionary"}(e.AppSubType||(e.AppSubType={})),function(e){e.access="ZAC150",e.excel="ZXL150",e.excelwebapp="WAE160",e.outlook="ZOL150",e.outlookwebapp="MOW150",e.powerpoint="ZPP151",e.powerpointwebapp="WAP160",e.project="ZPJ150",e.word="ZWD150",e.wordwebapp="WAW160",e.onenotewebapp="WAO160",e.visio="ZVO161",e.visiowebapp="WAV161"}(e.AppVersion||(e.AppVersion={}))}(OSF||(OSF={}));var RuntimeLifeTime,Mos,OSF_DDA_Marshaling_BindingType,OSF_DDA_Marshaling_FilePropertiesKeys,OSF_DDA_Marshaling_File_FilePropertiesKeys,OSF_DDA_Marshaling_File_SlicePropertiesKeys,OSF_DDA_Marshaling_File_FileType,OSF_DDA_Marshaling_File_ParameterKeys,OSF_DDA_Marshaling_GoToType,OSF_DDA_Marshaling_SelectionMode,OfficeExt,_serviceEndPoint=null,_defaultRefreshRate=3,_msPerDay=864e5,_defaultTimeout=6e4,_officeVersionHeader="X-Office-Version",_hourToDayConversionFactor=24,_buildParameter="&build=",_expectedVersionParameter="&expver=",_queryStringParameters={clientName:"client",clientVersion:"cv"},statusCode={Succeeded:1,Failed:0},_spUpn=null;function _sendWebRequest(e,t,n,i,o,r){o=o||{};var a=new Sys.Net.WebRequest;for(var s in n)a.get_headers()[s]=n[s];o&&(o.officeVersion&&(a.get_headers()[_officeVersionHeader]=o.officeVersion),o.correlationId&&e.indexOf("?")>-1&&(e+="&corr="+o.correlationId)),r&&a.set_body(r),a.set_url(e),a.set_httpVerb(t),a.set_timeout(_defaultTimeout),a.set_userContext(o),a.add_completed(i),a.invoke()}function _onCompleted(e,t){var n=e.get_webRequest().get_userContext(),i=e.get_webRequest().get_url();if(e.get_timedOut())OsfMsAjaxFactory.msAjaxDebug.trace("Request timed out: "+i),_invokeCallbackTag(n.callback,statusCode.Failed,null,null,e,8757955);else if(e.get_aborted())OsfMsAjaxFactory.msAjaxDebug.trace("Request aborted: "+i),_invokeCallbackTag(n.callback,statusCode.Failed,null,null,e,8757956);else if(e.get_responseAvailable())if(200==e.get_statusCode())try{n._onCompleteHandler(e,t)}catch(t){OsfMsAjaxFactory.msAjaxDebug.trace("Request failed with exception "+t+": "+i),_invokeCallbackTag(n.callback,statusCode.Failed,t,null,e,8757957)}else{var o=e.get_statusText();OsfMsAjaxFactory.msAjaxDebug.trace("Request failed with status code "+o+": "+i),_invokeCallbackTag(n.callback,statusCode.Failed,o,null,e,8757958)}else OsfMsAjaxFactory.msAjaxDebug.trace("Request failed: "+i),_invokeCallbackTag(n.callback,statusCode.Failed,o,null,e,8757959)}function _isProxyReady(e,t){t&&t({status:statusCode.Succeeded,result:!0})}function _createQueryStringFragment(e){var t="";for(var n in e){var i=e[n];null!=i&&""!==i&&(t+="&"+encodeURIComponent(n)+"="+encodeURIComponent(i))}return t}!function(e){e.HostSpecificFileVersionMap={access:{web:"16.00"},agavito:{winrt:"16.00"},excel:{android:"16.00",ios:"16.00",mac:"16.00",web:"16.00",win32:"16.01",winrt:"16.00"},onenote:{android:"16.00",ios:"16.00",mac:"16.00",web:"16.00",win32:"16.00",winrt:"16.00"},outlook:{android:"16.00",ios:"16.00",mac:"16.00",web:"16.01",win32:"16.02"},powerpoint:{ios:"16.00",mac:"16.00",web:"16.00",win32:"16.01",winrt:"16.00"},project:{win32:"16.00"},sway:{web:"16.00"},word:{ios:"16.00",mac:"16.00",web:"16.00",win32:"16.01",winrt:"16.00"},visio:{web:"16.00",win32:"16.00"}},e.HostSpecificFileVersionDefault="16.00"}(OSF||(OSF={})),function(e){var t,n,i;!function(e){e.Requirements="RequirementsToken",e.Locale="LocaleToken",e.TokenReplaceRegex="\\$\\{token\\.(\\w+)\\}",e.ResourceTokenRegEx="^\\$\\{resource\\.([A-Za-z0-9_-]+)\\}$",e.ExtendedManifestLoggingPrefix="Extended Manifest",e.ExtendedManifestResourcesLoggingPrefix="Extended Manifest Resources",e[e.ActionIdMaxLength=32]="ActionIdMaxLength",e[e.ActionNameMaxLength=125]="ActionNameMaxLength"}(e.ExtendedManifestSupportTokens||(e.ExtendedManifestSupportTokens={})),function(e){e.Ideas="fa000000029",e.ExperimentationSdx="fa000000059",e.CopilotChatExcel="fa000000124",e.CopilotChatWord="fa000000125",e.CopilotChatOneNote="fa000000128",e.CopilotChatPpt="fa000000129"}(t=e.SdxAssetIds||(e.SdxAssetIds={})),e.DefaultAllowDisplayCaptureSdxIds=[t.CopilotChatExcel,t.CopilotChatWord,t.CopilotChatOneNote,t.CopilotChatPpt].join(";"),function(e){e[e.None=0]="None",e[e.Enable3rdPartySetAppContextInIFrameName=2]="Enable3rdPartySetAppContextInIFrameName"}(e.HostFeatureGateFlags||(e.HostFeatureGateFlags={})),e.MaxAppContextLength=10240,function(e){e[e.None=0]="None",e[e.SharedApp=1]="SharedApp",e[e.CustomFunction=2]="CustomFunction",e[e.ProtectedDocDisable=4]="ProtectedDocDisable",e[e.ExperimentJsEnabled=8]="ExperimentJsEnabled",e[e.PublicAddin=16]="PublicAddin",e[e.IsMos=64]="IsMos",e[e.IsMonarch=128]="IsMonarch"}(e.HostInfoFlags||(e.HostInfoFlags={})),function(e){e[e.Manifest=1]="Manifest",e[e.Etoken=2]="Etoken",e[e.Both=3]="Both"}(e.ManifestRequestTypes||(e.ManifestRequestTypes={})),function(e){e[e.V1Enabled=0]="V1Enabled",e[e.V1S2SEnabled=1]="V1S2SEnabled",e[e.V2Enabled=2]="V2Enabled",e[e.V2S2SEnabled=3]="V2S2SEnabled"}(e.ActivationTypes||(e.ActivationTypes={})),function(e){e[e.S_OK=0]="S_OK",e[e.E_REQUEST_TIME_OUT=-2147471590]="E_REQUEST_TIME_OUT",e[e.E_USER_NOT_SIGNED_IN=-2147208619]="E_USER_NOT_SIGNED_IN",e[e.E_CATALOG_ACCESS_DENIED=-2147471591]="E_CATALOG_ACCESS_DENIED",e[e.E_CATALOG_REQUEST_FAILED=-2147471589]="E_CATALOG_REQUEST_FAILED",e[e.E_OEM_NO_NETWORK_CONNECTION=-2147208640]="E_OEM_NO_NETWORK_CONNECTION",e[e.E_PROVIDER_NOT_REGISTERED=-2147208617]="E_PROVIDER_NOT_REGISTERED",e[e.E_OEM_CACHE_SHUTDOWN=-2147208637]="E_OEM_CACHE_SHUTDOWN",e[e.E_OEM_REMOVED_FAILED=-2147209421]="E_OEM_REMOVED_FAILED",e[e.E_CATALOG_NO_APPS=-1]="E_CATALOG_NO_APPS",e[e.E_USER_NO_MAILBOX=-2]="E_USER_NO_MAILBOX",e[e.E_GENERIC_ERROR=-1e3]="E_GENERIC_ERROR",e[e.S_HIDE_PROVIDER=10]="S_HIDE_PROVIDER"}(e.InvokeResultCode||(e.InvokeResultCode={})),function(e){e[e.E_OEM_EXTENSION_NOT_ENTITLED=2147758662]="E_OEM_EXTENSION_NOT_ENTITLED",e[e.E_MANIFEST_SERVER_UNAVAILABLE=2147758672]="E_MANIFEST_SERVER_UNAVAILABLE",e[e.E_USER_NOT_SIGNED_IN=2147758677]="E_USER_NOT_SIGNED_IN",e[e.E_MANIFEST_DOES_NOT_EXIST=2147758673]="E_MANIFEST_DOES_NOT_EXIST",e[e.E_OEM_EXTENSION_KILLED=2147758660]="E_OEM_EXTENSION_KILLED",e[e.E_OEM_OMEX_EXTENSION_KILLED=2147758686]="E_OEM_OMEX_EXTENSION_KILLED",e[e.E_MANIFEST_UPDATE_AVAILABLE=2147758681]="E_MANIFEST_UPDATE_AVAILABLE",e[e.S_OEM_EXTENSION_TRIAL_MODE=275013]="S_OEM_EXTENSION_TRIAL_MODE",e[e.E_OEM_EXTENSION_WITHDRAWN_FROM_SALE=2147758690]="E_OEM_EXTENSION_WITHDRAWN_FROM_SALE",e[e.E_TOKEN_EXPIRED=2147758675]="E_TOKEN_EXPIRED",e[e.E_TRUSTCENTER_CATALOG_UNTRUSTED_ADMIN_CONTROLLED=2147757992]="E_TRUSTCENTER_CATALOG_UNTRUSTED_ADMIN_CONTROLLED",e[e.E_MANIFEST_REFERENCE_INVALID=2147758678]="E_MANIFEST_REFERENCE_INVALID",e[e.S_USER_CLICKED_BUY=274205]="S_USER_CLICKED_BUY",e[e.E_MANIFEST_INVALID_VALUE_FORMAT=2147758654]="E_MANIFEST_INVALID_VALUE_FORMAT",e[e.E_TRUSTCENTER_MOE_UNACTIVATED=2147757996]="E_TRUSTCENTER_MOE_UNACTIVATED",e[e.S_OEM_EXTENSION_FLAGGED=275040]="S_OEM_EXTENSION_FLAGGED",e[e.S_OEM_EXTENSION_DEVELOPER_WITHDRAWN_FROM_SALE=275041]="S_OEM_EXTENSION_DEVELOPER_WITHDRAWN_FROM_SALE",e[e.E_BROWSER_VERSION=2147758194]="E_BROWSER_VERSION",e[e.E_TRUSTCENTER_APP_BLOCKED_FOR_MINOR=-2147209295]="E_TRUSTCENTER_APP_BLOCKED_FOR_MINOR",e[e.E_PRIVACY_SERVICE_DISABLED_ADMIN=2147758792]="E_PRIVACY_SERVICE_DISABLED_ADMIN",e[e.WAC_AgaveUnsupportedStoreType=1041]="WAC_AgaveUnsupportedStoreType",e[e.WAC_AgaveActivationError=1042]="WAC_AgaveActivationError",e[e.WAC_ActivateAttempLoading=1043]="WAC_ActivateAttempLoading",e[e.WAC_HTML5IframeSandboxNotSupport=1044]="WAC_HTML5IframeSandboxNotSupport",e[e.WAC_AgaveRequirementsErrorOmex=1045]="WAC_AgaveRequirementsErrorOmex",e[e.WAC_AgaveRequirementsError=1046]="WAC_AgaveRequirementsError",e[e.WAC_AgaveOriginCheckError=1047]="WAC_AgaveOriginCheckError",e[e.WAC_AgavePermissionCheckError=1048]="WAC_AgavePermissionCheckError",e[e.WAC_AgaveHostHandleRequestError=1049]="WAC_AgaveHostHandleRequestError",e[e.WAC_AgaveUnknownClientAppStatus=1050]="WAC_AgaveUnknownClientAppStatus",e[e.WAC_AgaveAnonymousProxyCreationError=1051]="WAC_AgaveAnonymousProxyCreationError",e[e.WAC_AgaveOsfControlActivationError=1052]="WAC_AgaveOsfControlActivationError",e[e.WAC_AgaveEntitlementRequestFailure=1053]="WAC_AgaveEntitlementRequestFailure",e[e.WAC_AgaveManifestRequestFailure=1054]="WAC_AgaveManifestRequestFailure",e[e.WAC_AgaveManifestAndEtokenRequestFailure=1055]="WAC_AgaveManifestAndEtokenRequestFailure",e[e.WAC_FirstPartyAddInListRequestFailure=1056]="WAC_FirstPartyAddInListRequestFailure",e[e.WAC_SDX_DMSRequestFailed=1058]="WAC_SDX_DMSRequestFailed",e[e.WAC_SDX_AssetIdNotInDMSResponse=1059]="WAC_SDX_AssetIdNotInDMSResponse",e[e.WAC_CustomFunctionsRegistrationError=1060]="WAC_CustomFunctionsRegistrationError",e[e.WAC_WopiHostCheckStatusNotTrusted=1061]="WAC_WopiHostCheckStatusNotTrusted",e[e.WAC_WopiHostCheckStatusNotReady=1062]="WAC_WopiHostCheckStatusNotReady",e[e.WAC_AgaveIRMBlockError=1063]="WAC_AgaveIRMBlockError"}(e.ErrorStatusCodes||(e.ErrorStatusCodes={})),function(e){e[e.defaultMaxStreamRows=1e3]="defaultMaxStreamRows"}(e.BWsaConfig||(e.BWsaConfig={})),function(e){e[e.Static=1]="Static"}(e.BWsaStreamTypes||(e.BWsaStreamTypes={})),function(e){e[e.DATAID_APPSFOROFFICEUSAGE=10595]="DATAID_APPSFOROFFICEUSAGE",e[e.DATAID_APPSFOROFFICENOTIFICATIONS=10942]="DATAID_APPSFOROFFICENOTIFICATIONS"}(e.SQMDataPoints||(e.SQMDataPoints={})),function(e){e[e.urlOnly=0]="urlOnly",e[e.etokenOnly=1]="etokenOnly",e[e.both=2]="both"}(e.ClientAppInfoReturnType||(e.ClientAppInfoReturnType={})),function(e){e[e.NotInitialized=0]="NotInitialized",e[e.NotImplemented=1]="NotImplemented",e[e.NotReady=2]="NotReady",e[e.Exempted=3]="Exempted",e[e.NotTrusted=4]="NotTrusted",e[e.Trusted=5]="Trusted"}(e.HostFrameTrustState||(e.HostFrameTrustState={})),function(e){e[e.NotSet=0]="NotSet",e[e.Match=1]="Match",e[e.NotMatch=2]="NotMatch"}(e.UpnCheckCode||(e.UpnCheckCode={})),function(e){e[e.Succeeded=1]="Succeeded",e[e.Failed=0]="Failed",e[e.ProxyNotReady=-1]="ProxyNotReady"}(e.ProxyCallStatusCode||(e.ProxyCallStatusCode={})),function(e){e.RenderLoadingAnimationStart="Agave.NotificationUx.RenderLoadingAnimationStart",e.RenderLoadingAnimationEnd="Agave.NotificationUx.RenderLoadingAnimationEnd",e.RemoveLoadingAnimationStart="Agave.NotificationUx.RemoveLoadingAnimationStart",e.RemoveLoadingAnimationEnd="Agave.NotificationUx.RemoveLoadingAnimationEnd",e.RenderStage1Start="Agave.NotificationUx.RenderStage1Start",e.RenderStage1End="Agave.NotificationUx.RenderStage1End",e.RemoveStage1Start="Agave.NotificationUx.RemoveStage1Start",e.RemoveStage1End="Agave.NotificationUx.RemoveStage1End",e.RenderStage2Start="Agave.NotificationUx.RenderStage2Start",e.RenderStage2End="Agave.NotificationUx.RenderStage2End",e.RemoveStage2Start="Agave.NotificationUx.RemoveStage2Start",e.RemoveStage2End="Agave.NotificationUx.RemoveStage2End"}(e.NotificationUxPerfMarker||(e.NotificationUxPerfMarker={})),function(e){e.ActivationStart="Agave.AgaveActivationStart",e.ActivationEnd="Agave.AgaveActivationEnd",e.DeactivationStart="Agave.AgaveDeactivationStart",e.DeactivationEnd="Agave.AgaveDeactivationEnd",e.SelectionTimeout="Agave.AgaveSelectionTimeout"}(e.OsfControlActivationPerfMarker||(e.OsfControlActivationPerfMarker={})),function(e){e.GetEntitlementStart="Agave.OfficeExtensionManager.GetEntitlementStart",e.GetEntitlementEnd="Agave.OfficeExtensionManager.GetEntitlementEnd"}(e.OsfOfficeExtensionManagerPerfMarker||(e.OsfOfficeExtensionManagerPerfMarker={})),function(e){e.Default="DefaultSettings",e.Desktop="DesktopSettings",e.Tablet="TabletSettings",e.Phone="PhoneSettings"}(e.FormFactor||(e.FormFactor={})),function(e){e[e.Undefined=-1]="Undefined",e[e.InContent=0]="InContent",e[e.TaskPane=1]="TaskPane",e[e.Contextual=2]="Contextual",e[e.SDXDialog=3]="SDXDialog"}(e.OsfControlTarget||(e.OsfControlTarget={})),function(e){e[e.ContentApp=0]="ContentApp",e[e.TaskPaneApp=1]="TaskPaneApp",e[e.MailApp=2]="MailApp",e[e.SDXDialogApp=3]="SDXDialogApp"}(e.OfficeAppType||(e.OfficeAppType={})),function(e){e[e.Failed=0]="Failed",e[e.Success=1]="Success"}(e.OmexRemoveAppStatus||(e.OmexRemoveAppStatus={})),function(e){e[e.NotAttempted=-1]="NotAttempted",e[e.CheckFailed=0]="CheckFailed",e[e.Authenticated=1]="Authenticated",e[e.Anonymous=2]="Anonymous",e[e.Unknown=3]="Unknown"}(e.OmexAuthNStatus||(e.OmexAuthNStatus={})),function(e){e.Free="free",e.Trial="trial",e.Paid="paid"}(e.OmexEntitlementType||(e.OmexEntitlementType={})),function(e){e[e.None=0]="None",e[e.Office=1]="Office",e[e.External=2]="External"}(e.OmexTrialType||(e.OmexTrialType={})),function(e){e[e.Killed=0]="Killed",e[e.OK=1]="OK",e[e.Withdrawn=2]="Withdrawn",e[e.Flagged=3]="Flagged",e[e.DeveloperWithdrawn=4]="DeveloperWithdrawn"}(e.OmexState||(e.OmexState={})),function(e){e[e.OK=1]="OK",e[e.UnknownAssetId=2]="UnknownAssetId",e[e.KilledAsset=3]="KilledAsset",e[e.NoEntitlement=4]="NoEntitlement",e[e.DownloadsExceeded=5]="DownloadsExceeded",e[e.Expired=6]="Expired",e[e.Invalid=7]="Invalid",e[e.Revoked=8]="Revoked",e[e.ServerError=9]="ServerError",e[e.BadRequest=10]="BadRequest",e[e.LimitedTrial=11]="LimitedTrial",e[e.TrialNotSupported=12]="TrialNotSupported",e[e.EntitlementDeactivated=13]="EntitlementDeactivated",e[e.VersionMismatch=14]="VersionMismatch",e[e.VersionNotSupported=15]="VersionNotSupported",e[e.UserIsMinor=16]="UserIsMinor"}(e.OmexClientAppStatus||(e.OmexClientAppStatus={})),function(e){e.Microsoft="Microsoft",e.Custom="Custom"}(e.ManifestIdIssuer||(e.ManifestIdIssuer={})),function(e){e[e.MarketPlace=0]="MarketPlace",e[e.Catalog=1]="Catalog",e[e.SPApp=2]="SPApp",e[e.Exchange=3]="Exchange",e[e.FileSystem=4]="FileSystem",e[e.Registry=5]="Registry",e[e.PrivateCatalog=10]="PrivateCatalog",e[e.HardCodedPreinstall=11]="HardCodedPreinstall",e[e.FirstParty=12]="FirstParty",e[e.Sdx=14]="Sdx",e[e.UploadFileDevCatalog=15]="UploadFileDevCatalog",e[e.WopiCatalog=16]="WopiCatalog"}(e.StoreTypeEnum||(e.StoreTypeEnum={})),function(e){e.OMEX="omex",e.SPCatalog="spcatalog",e.SPApp="spapp",e.Exchange="exchange",e.FileSystem="filesystem",e.Registry="registry",e.InMemory="inmemory",e.PrivateCatalog="excatalog",e.HardCodedPreinstall="hardcodedpreinstall",e.FirstParty="firstparty",e.UploadFileDevCatalog="uploadfiledevcatalog",e.Sdx="sdxcatalog",e.WopiCatalog="wopicatalog"}(e.StoreType||(e.StoreType={})),function(e){e[e.NotStarted=1]="NotStarted",e[e.Loading=2]="Loading",e[e.Ready=3]="Ready",e[e.FailedHandleRequest=4]="FailedHandleRequest",e[e.FailedOriginCheck=5]="FailedOriginCheck",e[e.FailedPermissionCheck=6]="FailedPermissionCheck"}(e.OsfControlPageStatus||(e.OsfControlPageStatus={})),function(e){e[e.NotActivated=1]="NotActivated",e[e.Activated=2]="Activated",e[e.AppStoreNotReachable=3]="AppStoreNotReachable",e[e.InvalidOsfControl=4]="InvalidOsfControl",e[e.UnsupportedStore=5]="UnsupportedStore",e[e.UnknownStore=6]="UnknownStore",e[e.ActivationFailed=7]="ActivationFailed",e[e.NotSandBoxSupported=8]="NotSandBoxSupported"}(e.OsfControlStatus||(e.OsfControlStatus={})),function(e){e[e.Restricted=1]="Restricted",e[e.ReadDocument=2]="ReadDocument",e[e.WriteDocument=4]="WriteDocument",e[e.ReadItem=32]="ReadItem",e[e.ReadWriteMailbox=64]="ReadWriteMailbox",e[e.ReadAllDocument=131]="ReadAllDocument",e[e.ReadWriteDocument=135]="ReadWriteDocument",e[e.ReadWriteItem=256]="ReadWriteItem"}(e.OsfControlPermission||(e.OsfControlPermission={})),function(e){e.Mailbox="Mailbox",e.Document="Document",e.Workbook="Workbook",e.Project="Project",e.Presentation="Presentation",e.Database="Database",e.Sway="Sway",e.Notebook="Notebook",e.Drawing="Drawing"}(e.Capability||(e.Capability={})),function(e){e.Excel="Workbook",e.Outlook="Mailbox",e.Access="Database",e.PowerPoint="Presentation",e.Word="Document",e.Sway="Sway",e.OneNote="Notebook",e.Visio="Drawing"}(e.HostCapability||(e.HostCapability={})),e.getManifestHostType=function(t){var n;switch(t){case e.HostType.Excel:n=e.ManifestHostType.Workbook;break;case e.HostType.Word:n=e.ManifestHostType.Document;break;case e.HostType.PowerPoint:n=e.ManifestHostType.Presentation;break;case e.HostType.OneNote:n=e.ManifestHostType.Notebook;break;case e.HostType.Outlook:n=e.ManifestHostType.Mailbox;break;case e.HostType.Visio:n=e.ManifestHostType.Drawing;break;default:throw OsfMsAjaxFactory.msAjaxDebug.trace("Invalid host type."),"Invalid hostType."}return n},e.getManifestHostTypeFromAppName=function(t){var n;switch(t){case e.AppName.ExcelWebApp:n=e.ManifestHostType.Workbook;break;case e.AppName.PowerpointWebApp:n=e.ManifestHostType.Presentation;break;case e.AppName.WordWebApp:n=e.ManifestHostType.Document;break;case e.AppName.OneNoteWebApp:n=e.ManifestHostType.Notebook;break;case e.AppName.OutlookWebApp:n=e.ManifestHostType.Mailbox;break;case e.AppName.VisioWebApp:n=e.ManifestHostType.Drawing;break;default:throw OsfMsAjaxFactory.msAjaxDebug.trace("Invalid appName."),"Invalid appName."}return n},e.getModernAppVerCode=function(t){var n;switch(t){case e.AppName.ExcelWebApp:n="WAC_Excel";break;case e.AppName.PowerpointWebApp:n="WAC_PowerPoint";break;case e.AppName.WordWebApp:n="WAC_Word";break;case e.AppName.OneNoteWebApp:n="WAC_OneNote";break;case e.AppName.OutlookWebApp:n="WAC_Outlook";break;case e.AppName.VisioWebApp:n="WAC_Visio";break;default:throw OsfMsAjaxFactory.msAjaxDebug.trace("Invalid appName."),"Invalid appName."}return n},e.getAppVerCode=function(t){var n;switch(t){case e.AppName.ExcelWebApp:n="excel.exe";break;case e.AppName.AccessWebApp:n="ZAC";break;case e.AppName.PowerpointWebApp:n="WAP";break;case e.AppName.WordWebApp:n="WAW";break;case e.AppName.OneNoteWebApp:n="WAO";break;case e.AppName.VisioWebApp:n="WAV";break;default:throw OsfMsAjaxFactory.msAjaxDebug.trace("Invalid appName."),"Invalid appName."}return n},function(e){e.Web="Web"}(e.HostPlatform||(e.HostPlatform={})),function(e){e.Workbook="Workbook",e.Document="Document",e.Presentation="Presentation",e.Notebook="Notebook",e.Mailbox="Mailbox",e.Drawing="Drawing"}(e.ManifestHostType||(e.ManifestHostType={})),function(e){e.Excel="Excel",e.Outlook="Outlook",e.Access="Access",e.PowerPoint="PowerPoint",e.Word="Word",e.Sway="Sway",e.OneNote="OneNote",e.Visio="Visio"}(e.HostType||(e.HostType={})),e.OmexAppVersions=(n={},i=e.AppName,n[i.ExcelWebApp]=e.AppVersion.excelwebapp,n[i.WordWebApp]=e.AppVersion.wordwebapp,n[i.OutlookWebApp]=e.AppVersion.outlookwebapp,n[i.AccessWebApp]=e.AppVersion.access,n[i.PowerpointWebApp]=e.AppVersion.powerpointwebapp,n[i.OneNoteWebApp]=e.AppVersion.onenotewebapp,n[i.VisioWebApp]=e.AppVersion.visiowebapp,n),e.OmexClientNames=function(){var t={},n=e.AppName;return t[n.ExcelWebApp]="WAC_Excel",t[n.WordWebApp]="WAC_Word",t[n.OutlookWebApp]="WAC_Outlook",t[n.AccessWebApp]="WAC_Access",t[n.PowerpointWebApp]="WAC_Powerpoint",t[n.OneNoteWebApp]="WAC_OneNote",t[n.VisioWebApp]="WAC_Visio",t}(),function(e){e.GET="GET",e.POST="POST",e.DELETE="DELETE",e.PUT="PUT"}(e.HttpVerb||(e.HttpVerb={})),function(e){e[e.OfficeAddin=1]="OfficeAddin",e[e.MosAcquisition=2]="MosAcquisition"}(e.PayloadType||(e.PayloadType={})),function(e){e.Public="Public",e.Tenant="Tenant",e.User="User"}(e.TitleScope||(e.TitleScope={})),function(e){e.Acquired="acquired",e.Unacquired="unacquired",e.NeedsConsentForUpgrade="needsconsentforupgrade"}(e.AcquisitionAcquiredState||(e.AcquisitionAcquiredState={})),function(e){e[e.V1_0=100]="V1_0",e[e.V1_1=101]="V1_1",e[e.Max=102]="Max"}(e.VersionOverridesNumber||(e.VersionOverridesNumber={})),function(e){e.V1_0="http://schemas.microsoft.com/office/mailappversionoverrides",e.V1_1="http://schemas.microsoft.com/office/mailappversionoverrides/1.1"}(e.VersionOverridesNamespace||(e.VersionOverridesNamespace={})),function(e){e.DesktopFormFactor="DesktopFormFactor",e.Form="Form",e.FormSettings="FormSettings",e.MobileFormFactor="MobileFormFactor",e.OOfficeApp="o:OfficeApp",e.RequestedHeight="RequestedHeight",e.Resources="Resources",e.SourceLocation="SourceLocation",e.VersionOverrides="VersionOverrides",e.Mailappor="mailappor:"}(e.ParserStrings||(e.ParserStrings={})),function(e){e[e.Attendee=0]="Attendee",e[e.Presenter=1]="Presenter",e[e.PrivateViewing=2]="PrivateViewing"}(e.PowerPointSlideShowRole||(e.PowerPointSlideShowRole={})),function(e){e[e.UnifiedApp=0]="UnifiedApp",e[e.MSTeams=1]="MSTeams",e[e.TeamsiOS=2]="TeamsiOS",e[e.TeamsAndroid=3]="TeamsAndroid",e[e.Unknown=4]="Unknown"}(e.PowerPointSlideShowUIHostType||(e.PowerPointSlideShowUIHostType={}))}(OSF||(OSF={})),function(e){var t=function(){function t(){}return t.versionLessThan=function(e,t){return OSF.OsfManifestManager.versionLessThan(e,t)},t.ParseManifest=function(e,t,n){try{return new OSF.Manifest.Manifest(e,t)}catch(e){return Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Invalid manifest:",e,n,520164255),null}},t.constructAddInId=function(t,n,i,o){return e.MsAjaxString.format("{0}|{1}|{2}|{3}|{4}|||","2",t,n,this.GetStoreTypeId(i).toString(),o)},t.GetStoreTypeId=function(e){return e==OSF.StoreType.OMEX?OSF.StoreTypeEnum.MarketPlace:e==OSF.StoreType.SPCatalog?OSF.StoreTypeEnum.Catalog:e==OSF.StoreType.SPApp?OSF.StoreTypeEnum.SPApp:e==OSF.StoreType.Exchange?OSF.StoreTypeEnum.Exchange:e==OSF.StoreType.FileSystem?OSF.StoreTypeEnum.FileSystem:e==OSF.StoreType.Registry?OSF.StoreTypeEnum.Registry:e==OSF.StoreType.PrivateCatalog?OSF.StoreTypeEnum.PrivateCatalog:e==OSF.StoreType.HardCodedPreinstall?OSF.StoreTypeEnum.HardCodedPreinstall:e==OSF.StoreType.FirstParty?OSF.StoreTypeEnum.FirstParty:e==OSF.StoreType.UploadFileDevCatalog?OSF.StoreTypeEnum.UploadFileDevCatalog:e==OSF.StoreType.WopiCatalog?OSF.StoreTypeEnum.WopiCatalog:-1},t.GetStoreTypeName=function(e){var t=parseInt(e);return t==OSF.StoreTypeEnum.MarketPlace?OSF.StoreType.OMEX:t==OSF.StoreTypeEnum.Catalog?OSF.StoreType.SPCatalog:t==OSF.StoreTypeEnum.SPApp?OSF.StoreType.SPApp:t==OSF.StoreTypeEnum.Exchange?OSF.StoreType.Exchange:t==OSF.StoreTypeEnum.FileSystem?OSF.StoreType.FileSystem:t==OSF.StoreTypeEnum.Registry?OSF.StoreType.Registry:t==OSF.StoreTypeEnum.PrivateCatalog?OSF.StoreType.PrivateCatalog:t==OSF.StoreTypeEnum.HardCodedPreinstall?OSF.StoreType.HardCodedPreinstall:t==OSF.StoreTypeEnum.FirstParty?OSF.StoreType.FirstParty:t==OSF.StoreTypeEnum.UploadFileDevCatalog?OSF.StoreType.UploadFileDevCatalog:t==OSF.StoreTypeEnum.WopiCatalog?OSF.StoreType.WopiCatalog:null},t}();e.ManifestUtil=t;var n=function(){function t(){}return t.failed=function(t,n,i){if(t.status!=e.DataServiceResultCode.Succeeded){var o={status:t.status,httpStatus:t.httpStatus};return null!=i&&(o.value=i),n(o),!0}return!1},t.retry=function(e,t){void 0===t&&(t={});var n=t.retries,i=void 0===n?3:n,o=t.factor,r=void 0===o?2:o,a=t.minTimeout,s=void 0===a?300:a,l=t.maxTimeout,c=void 0===l?1/0:l;return new Promise((function(t,n){var o=function(a){e().then(t,(function(e){a>=i?n(e):setTimeout((function(){return o(a+1)}),Math.min(s*Math.pow(r,a),c))}))};o(0)}))},t.limitRate=function(e,t){var n=[],i=-1/0,o=function(){var r=n.shift();n.length>0&&setTimeout(o,t),i=performance.now(),e.apply(void 0,r)};return function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];0===n.length&&setTimeout(o,Math.max(0,t-(performance.now()-i))),n.push(e)}},t.withCache=function(e,n,i){var o=n.forceUpdateCache,r=void 0!==o&&o,a=n.maxAgeInSecs,s=void 0===a?259200:a,l=n.useStaleCache,c=void 0!==l&&l;if(!r&&t.Cache.hasOwnProperty(e))return Promise.resolve({cacheType:"memory",value:t.Cache[e]});var u="__OSF_AsyncCache_"+e,d="__OSF_AsyncCache_"+e+"_stale",p="__OSF_AsyncCacheExpiry",f=Date.now();if(OSF.OUtil.getLocalStorage().isLocalStorageAvailable())try{if(f>=t.NextCheckExpiry){var m=JSON.parse(localStorage.getItem(p))||{},h=!1;for(var g in t.NextCheckExpiry=1/0,m)f>m[g]?(localStorage.removeItem("__OSF_AsyncCache_"+g),delete m[g],h=!0):t.NextCheckExpiry=Math.min(t.NextCheckExpiry,m[g]);h&&localStorage.setItem(p,JSON.stringify(m))}if(!r&&localStorage.hasOwnProperty(u))return Promise.resolve({cacheType:"localStorage",value:localStorage.getItem(u)})}catch(e){Telemetry.RuntimeTelemetryHelper.LogExceptionTag("failed to get key "+u,e,null,520164254)}return i().then((function(n){t.Cache[e]=n;try{var i=JSON.parse(localStorage.getItem(p))||{};i[e]=f+1e3*s,t.NextCheckExpiry=Math.min(t.NextCheckExpiry,i[e]),localStorage.setItem(p,JSON.stringify(i)),localStorage.setItem(u,n),localStorage.setItem(d,n)}catch(e){}return{cacheType:"none",value:n}}),(function(e){if(c&&OSF.OUtil.getLocalStorage().isLocalStorageAvailable()&&localStorage.hasOwnProperty(d))return Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("stale cache used for "+d,null,520164253),Promise.resolve({cacheType:"localStorage",value:localStorage.getItem(d)});throw e}))},t.fetch=function(e,t){return void 0===t&&(t={}),new Promise((function(n,i){var o=new XMLHttpRequest,r=t.method,a=void 0===r?"GET":r,s=t.headers,l=void 0===s?{}:s,c=t.body,u=void 0===c?null:c;for(var d in o.onreadystatechange=function(){4==o.readyState&&n({ok:o.status>=200&&o.status<=299,status:o.status,statusText:o.statusText,text:function(){return Promise.resolve(o.responseText)},json:function(){return Promise.resolve(JSON.parse(o.responseText))}})},o.onerror=i,o.open(a,e,!0),l)o.setRequestHeader(d,l[d]);o.send(u)}))},t.Cache={},t.NextCheckExpiry=0,t}();e.AsyncUtil=n;var i=function(){function e(){}return e.register=function(e,t){this._registry[e]=t},e.resolve=function(e,t){var n=this._resolved[e];if(null!=n)return n;if(null!=(t=t||this._hostInfo)){var i=this._registry[e];if(null==i)return null;this._resolved[e]=n=i(t)}return n},e.setHostContext=function(e){this._hostInfo=e},e.getHostContext=function(){return this._hostInfo},e._registry={},e._resolved={},e}();e.CatalogFactory=i}(OfficeExt||(OfficeExt={})),function(e){var t=function(){function t(e){this._initParams=e}return t.prototype.getEntitlementAsync=function(t,n,i){i({status:e.DataServiceResultCode.Failed,httpStatus:403})},t.prototype.getAndCacheManifest=function(t,n,i,o){o({status:e.DataServiceResultCode.Failed,httpStatus:404})},t.prototype.activateAsync=function(t,n,i){this._initParams&&this._initParams.loaderParamsFunction&&(this._initParams.loaderParams=this._initParams.loaderParamsFunction()),this._initParams&&this._initParams.loaderParams?this._initParams.controlStatus===OSF.OsfControlStatus.ActivationFailed?n.fail(this._initParams.loaderParams,this._initParams.controlStatus):n.notifyUser(this._initParams.loaderParams):n.fail(e.LoaderUtil.error({description:Strings.OsfRuntime.L_AgaveActivationError_ERR,errorCode:OSF.ErrorStatusCodes.WAC_AgaveActivationError}),OSF.OsfControlStatus.ActivationFailed)},t.prototype.removeAsync=function(t,n,i){i({status:e.DataServiceResultCode.Failed,httpStatus:403})},t.prototype.getAppDetails=function(t,n,i,o){o({status:e.DataServiceResultCode.Failed,httpStatus:403})},t}();e.ForbiddenCatalog=t}(OfficeExt||(OfficeExt={})),function(e){var t=function(){function e(){}return e.defaultTitle=function(e){switch(e){case OSF.InfoType.Information:return Strings.OsfRuntime.L_AgaveInformationTitle_TXT;case OSF.InfoType.Error:return Strings.OsfRuntime.L_AgaveErrorTile_TXT;case OSF.InfoType.Warning:return Strings.OsfRuntime.L_AgaveWarningTitle_TXT}return Strings.OsfRuntime.L_AgaveInformationTitle_TXT},e.fillMissing=function(t){return t.infoType=e.isNullOrUndefined(t.infoType)?OSF.InfoType.Information:t.infoType,t.title=t.title||e.defaultTitle(t.infoType),t.buttonTxt=t.buttonTxt||Strings.OsfRuntime.L_OkButton_TXT,t.buttonCallback=t.buttonCallback||null,t.url=t.url||null,t.urlButtonTxt=t.urlButtonTxt||null,t.dismissCallback=t.dismissCallback||null,t.reDisplay=!t.dismissCallback,t.displayDeactive=null==t.displayDeactive||t.displayDeactive,t.detailView=t.detailView||!1,t.logAsError=t.logAsError||!1,t.highPriority=t.highPriority||!1,t.retryAll=t.retryAll||!1,t.errorCode=t.errorCode?t.errorCode:0,t},e.error=function(t){return t.infoType=e.isNullOrUndefined(t.infoType)?OSF.InfoType.Error:t.infoType,t.logAsError=null==t.logAsError||t.logAsError,e.fillMissing(t)},e.warning=function(t){return t.infoType=e.isNullOrUndefined(t.infoType)?OSF.InfoType.Warning:t.infoType,t.logAsError=null==t.logAsError||t.logAsError,e.fillMissing(t)},e.showNotification=function(t,n){t.notifyUser(e.fillMissing(n))},e.showError=function(t,n){t.notifyUser(e.error(n))},e.showWarning=function(t,n){t.notifyUser(e.warning(n))},e.failWithWarning=function(t,n,i){i=e.isNullOrUndefined(i)?OSF.OsfControlStatus.ActivationFailed:i,t.fail(e.warning(n),i)},e.failWithError=function(t,n,i){i=e.isNullOrUndefined(i)?OSF.OsfControlStatus.ActivationFailed:i,t.fail(e.error(n),i)},e.isNullOrUndefined=function(e){return null==e},e}();e.LoaderUtil=t}(OfficeExt||(OfficeExt={})),function(e){var t=function(){function t(e,t){this.osfControl=e,this.trusted=t}return t.prototype.getRequirementsChecker=function(){return this.osfControl._contextActivationMgr.getRequirementsChecker()},t.prototype.load=function(t,n){var i,o,r=this;OSF.OUtil.checkFlight(OSF.FlightTreatmentNames.AddinDetailsServiceSupportEnabled)&&t.entitlement&&this.osfControl._contextActivationMgr._notifyHost("0",OSF.AgaveHostAction.OsfControlLoad,{solutionId:t.entitlement.solutionId,version:t.entitlement.version,storeType:t.entitlement.storeType,storeId:t.entitlement.storeId,assetId:t.entitlement.assetId,assetStoreId:t.entitlement.assetStoreId,targetType:t.entitlement.targetType,width:(null===(i=t.manifest)||void 0===i?void 0:i.getDefaultWidth())||0,height:(null===(o=t.manifest)||void 0===o?void 0:o.getDefaultHeight())||0});var a=performance.now();this.osfControl.getReason()==Microsoft.Office.WebExtension.InitializationReason.Inserted&&(this.osfControl._retryActivate=null,this.osfControl._contextActivationMgr.retryAll(t.entitlement.solutionId)),this.osfControl._status!==OSF.OsfControlStatus.NotActivated&&this.osfControl.deActivate();var s=t.manifest,l=this.osfControl;if(l._etoken=t.eToken,l._manifest=s,l._sourceLocationOverrideUrl?l._iframeUrl=l._sourceLocationOverrideUrl:l._sourceLocationOverrideResourceId?l._iframeUrl=s.getSourceLocationOverrideByResourceId(l._sourceLocationOverrideResourceId):l._iframeUrl=s.getDefaultSourceLocation(l._contextActivationMgr.getFormFactor()),l._iframeUrl&&l.updateUrlsForSdx(t.manifestUrl),null!=t.entitlement&&(t.entitlement.storeType!==OSF.StoreType.PrivateCatalog&&t.entitlement.storeType!==OSF.StoreType.OMEX&&t.entitlement.storeType!==OSF.StoreType.WopiCatalog||(l._assetId=t.entitlement.assetId,l._assetStoreId=t.entitlement.assetStoreId)),l._permission=s.getPermission(),l._appDomains=s.getAppDomains(),l.processManifestForCustomFunctions(s),OSF.OUtil.isChangeGateEnabled("OfficeVSO:0_IsMosFlag")&&!OSF.OUtil.isNullOrUndefined(s)&&(l._isMos=s.getPayloadType()===OSF.PayloadType.MosAcquisition),s.getPayloadType()===OSF.PayloadType.MosAcquisition)OSF.OUtil.isNullOrUndefined(s.getExtensionShortcut())||l.processMosShortcuts(s);else if(s.getExtendedOverrides()){var c=this.osfControl.getReason()==Microsoft.Office.WebExtension.InitializationReason.Inserted;l.processManifestForExtendedOverrides(s,c)}if(null!=n&&(l._iframeUrl=n.decorateUrl(l._iframeUrl)),l.hostInfoFlags()&OSF.HostInfoFlags.ProtectedDocDisable&&!l.isFirstParty())e.LoaderUtil.failWithError(this,{description:Strings.OsfRuntime.L_AgaveProtectedDocError_ERR,detailView:!0,errorCode:OSF.ErrorStatusCodes.WAC_AgaveIRMBlockError});else{if(!OSF.OUtil.doesUrlHaveSupportedProtocol(l._iframeUrl))return e.LoaderUtil.failWithError(this,{description:Strings.OsfRuntime.L_AgaveManifestError_ERR,detailView:!0,errorCode:OSF.ErrorStatusCodes.E_MANIFEST_INVALID_VALUE_FORMAT}),void(null!=t.entitlement&&t.entitlement.storeType===OSF.StoreType.Sdx&&(l._sdxTelemetryContext.errorMessage="Invalid URL encountered",e.SDXCatalog.recordActivationActivity(!1,l._sdxTelemetryContext)));null!=n&&n.preLoad(l,l._contextActivationMgr);var u=s.getDefaultDisplayName();l._isAddinCommands((function(e){e?(l._isvirtualOsfControl=!0,l.invokeVirtualOsfControlActivationCallback(s)):(r.osfControl._sdxTelemetryContext.iframeCreateStart=performance.now(),l._createIframeAndActivateOsfControl(u),r.osfControl._sdxTelemetryContext.iframeCreateEnd=performance.now())})),null!=t.entitlement&&t.entitlement.storeType===OSF.StoreType.Sdx&&e.SDXCatalog.recordActivity("IframeCreate",a,!0,[{name:"OsfControlId",string:l._id},{name:"AssetId",string:t.entitlement.solutionId}]),null!=n&&n.postLoad(l,l._contextActivationMgr)}},t.prototype.skipTrust=function(e){return this.osfControl.getTrustNoPrompt()},t.prototype.hasConsent=function(e){return this.trusted||this.isInsertion()},t.prototype.isInsertion=function(){return this.osfControl.getReason()==Microsoft.Office.WebExtension.InitializationReason.Inserted},t.prototype.setRetryCall=function(e){this.osfControl._retryActivate=e},t.prototype.askForTrust=function(e,t){var n=this;this.osfControl._showTrustError(e.clientName,e.displayName,e.providerName,e.iconUrl,(function(){n.restartActivation(),t()}),e.url,e.isSSOAddin)},t.prototype.askForUpgrade=function(e,t){var n=this;e.buttonCallback=function(){n.restartActivation(),t()},this.notifyUser(e)},t.prototype.fail=function(e,t){var n=this.osfControl;n._status=t,this.notifyUser(e),n._contextActivationMgr.raiseOsfControlStatusChange(n)},t.prototype.notifyUser=function(e){var t=this.osfControl;e.id=t._id,t._contextActivationMgr.displayNotification(e)},t.prototype.restartActivation=function(){this.osfControl._restartActivate()},t.prototype.isForCustomFunctionSandbox=function(){return this.osfControl.isCustomFunctionSandbox()},t.prototype.setIsUpgrading=function(e){this.osfControl.setIsUpgrading(e)},t.prototype.getIsUpgrading=function(){return this.osfControl.getIsUpgrading()},t.prototype.setUpgradingFailed=function(e){this.osfControl.setUpgradingFailed(e)},t}();e.OsfControlLoader=t}(OfficeExt||(OfficeExt={})),function(e){var t=function(){function e(e){this._requirementsChecker=e}return e.prototype.getRequirementsChecker=function(){return this._requirementsChecker},e.prototype.load=function(e,t){},e.prototype.skipTrust=function(e){return!1},e.prototype.hasConsent=function(e){return!1},e.prototype.setRetryCall=function(e){},e.prototype.askForTrust=function(e,t){},e.prototype.askForUpgrade=function(e,t){},e.prototype.fail=function(e,t){},e.prototype.notifyUser=function(e){},e.prototype.restartActivation=function(){},e.prototype.isForCustomFunctionSandbox=function(){return!1},e.prototype.setIsUpgrading=function(e){},e.prototype.getIsUpgrading=function(){return!1},e.prototype.setUpgradingFailed=function(e){},e}();e.PreCacher=t}(OfficeExt||(OfficeExt={})),function(e){var t=function(){function t(){this.isReady=!1,this.clientEndPoint=null,this.pendingCallbacks=new Array,this.iframe=null,this._pendingRequests={},this.conversationId=OSF.OUtil.generateConversationId()}return t.prototype.invokeProxyCommandAsync=function(t,n,i){var o=this,r=n||n.correlationId||"";this.prepareProxy((function(a){null!=a.value?o.invokeProxyMethodAsync(t,i,n):(Telemetry.RuntimeTelemetryHelper.LogExceptionTag("clientendpoint is invalid",null,r,509875074),i({status:e.DataServiceResultCode.ProxyNotReady}))}),(function(t){Telemetry.RuntimeTelemetryHelper.LogExceptionTag("proxysetup failure",null,r,509875073),i({status:e.DataServiceResultCode.ProxyNotReady})}))},t.prototype.prepareProxy=function(e,t){},t.prototype.invokeProxyMethodAsync=function(t,n,i){var o,r=i||i.correlationId||"",a=[this.clientEndPoint._targetUrl,t];for(var s in i)"string"!==(o=typeof i[s])&&"number"!==o&&"boolean"!==o||a.push(i[s]);var l=a.join("."),c=this._pendingRequests,u={onCompleted:n,methodName:t,correlationId:r},d=c[l];if(d)d.push(u);else{c[l]=[u];i||(i={}),i.officeVersion=OSF.Constants.ThreePartsFileVersion,this.clientEndPoint.invoke(t,(function(t,n){var i=null,o=0,r=e.DataServiceResultCode.Failed;0===t&&n.status&&(i=n.result,r=e.DataServiceResultCode.Succeeded);var a=c[l];delete c[l];for(var s=a.length,u=0;u<s;u++){var d=a.shift();try{n&&n.failureInfo&&(o=n.failureInfo.statusCode||null,n.failureInfo.result=n.result,Telemetry.RuntimeTelemetryHelper.LogProxyFailure(d.correlationId,d.methodName,n.failureInfo)),d.onCompleted({status:r,httpStatus:o,value:i})}catch(t){var p="invokeProxyMethodAsync failed";e.WACUtils.logExceptionToBrowserConsole(p,t),Telemetry.RuntimeTelemetryHelper.LogExceptionTag(p,t,d.correlationId,509875072)}}}),i)}},t}();e.ProxyBase=t}(OfficeExt||(OfficeExt={})),function(e){var t,n;!function(e){e[e.Activation=0]="Activation",e[e.ServerCall=1]="ServerCall",e[e.Authentication=2]="Authentication",e[e.EntitlementCheck=3]="EntitlementCheck",e[e.AppStateCheck=4]="AppStateCheck",e[e.KilledAppsCheck=5]="KilledAppsCheck",e[e.ManifestRequest=6]="ManifestRequest"}(t=e.Activity||(e.Activity={})),function(e){e[e.AnonymousFlag=0]="AnonymousFlag",e[e.RetryCount=1]="RetryCount",e[e.ManifestTrustCachedFlag=2]="ManifestTrustCachedFlag",e[e.ManifestDataCachedFlag=3]="ManifestDataCachedFlag",e[e.OmexHasEntitlementFlag=4]="OmexHasEntitlementFlag",e[e.ManifestDataInvalidFlag=5]="ManifestDataInvalidFlag",e[e.AppStateDataCachedFlag=6]="AppStateDataCachedFlag",e[e.AppStateDataInvalidFlag=7]="AppStateDataInvalidFlag",e[e.ActivationRuntimeType=8]="ActivationRuntimeType",e[e.ManifestRequestType=9]="ManifestRequestType",e[e.DmsRequestCachedFlag=10]="DmsRequestCachedFlag"}(n=e.FlagName||(e.FlagName={}));var i=function(){function i(e,t,n,i,o){this.correlationId=e,this.perfContext=t,this.appInfo=n,this.assetId=i,this.instanceId=o}return i.prototype.startActivity=function(o){switch(o){case t.Activation:var r=OSF.ActivationTypes.V2Enabled;return 0==(15&this.appInfo)&&e.S2SOmexCatalogService._requestHandler&&(r=OSF.ActivationTypes.V2S2SEnabled),Telemetry.AppLoadTimeHelper.ActivationStart(this.perfContext,this.appInfo,this.assetId,this.correlationId,this.instanceId,r),void this.setBits(n.ActivationRuntimeType,r)}Telemetry.AppLoadTimeHelper.StartStopwatch(this.perfContext,i.StopWatchName[o])},i.prototype.stopActivity=function(e){Telemetry.AppLoadTimeHelper.StopStopwatch(this.perfContext,i.StopWatchName[e])},i.prototype.setFlag=function(e,t){var n=t?2:1;this.setBits(e,n)},i.prototype.setBits=function(e,t){Telemetry.AppLoadTimeHelper.SetBit(this.perfContext,t,i.FlagOffsetMap[e],2)},i.FlagOffsetMap=[0,2,5,7,9,11,13,15,17,19,21],i.StopWatchName=["Stage1Time","Stage4Time","Stage5Time","Stage7Time","Stage9Time","Stage8Time","Stage10Time"],i}();e.ActivationTelemetryContext=i;var o=function(){function e(e){this.correlationId=e}return e.prototype.startActivity=function(e){},e.prototype.stopActivity=function(e){},e.prototype.setFlag=function(e,t){},e.prototype.setBits=function(e,t){},e}();e.AddinCommandsTelemetryContext=o;var r=function(){function e(e){this.correlationId=e}return e.prototype.startActivity=function(e){},e.prototype.stopActivity=function(e){},e.prototype.setFlag=function(e,t){},e.prototype.setBits=function(e,t){},e}();e.InsertDialogTelemetryContext=r;var a=function(){function e(){}return e.prototype.startActivity=function(e){},e.prototype.stopActivity=function(e){},e.prototype.setFlag=function(e,t){},e.prototype.setBits=function(e,t){},e}();e.SimpleTelemetryContext=a}(OfficeExt||(OfficeExt={})),function(e){var t=function(){function t(t,n){void 0===n&&(n=null),this._initParam=t,this._cacheManager=n||new e.AppsDataCacheManager(OSF.OUtil.getLocalStorage(),new e.SafeSerializer)}return t.prototype.getEntitlementAsync=function(t,n,i){var o=this,r=[],a=[],s=t?this.getUploadFileDevCatalogAddinCommandsMyAddinsCacheKey():this.getUploadFileDevCatalogAddinsCacheKey(),l=this._cacheManager.GetCacheItem(s);null!=l&&(l.forEach((function(t,n,i){var s=o._cacheManager.GetCacheItem(o.getUploadFileDevCatalogManifestCacheKey(t));if(null!=s){var l=e.ManifestUtil.ParseManifest(s,o._initParam.appUILocale);if(null==l)return;var c={solutionId:t,version:l.getMarketplaceVersion(),storeType:OSF.StoreType.UploadFileDevCatalog,storeId:"developer",assetId:null,assetStoreId:null,targetType:l.getTarget()};a.push(c),r.push(t)}})),r.length!=l.length&&(r.length>0?this._cacheManager.SetCacheItem(s,r):this._cacheManager.RemoveCacheItem(s))),i({status:e.DataServiceResultCode.Succeeded,value:a})},t.prototype.getAndCacheManifest=function(n,i,o,r){var a=this,s=OSF.OsfManifestManager.getCachedManifest(n.solutionId,n.version);if(null==s){var l=function(e,t,i){var o=a._cacheManager.GetCacheItem(a.getUploadFileDevCatalogManifestCacheKey(n.solutionId));null==o&&e>=1?setTimeout((function(){return l(e-1,2*t,i)}),t):i(o)};l(t.GetManifestRetryLimit,t.GetManifestRetryWaitMs,(function(t){var i;null!=t&&null!=(i=e.ManifestUtil.ParseManifest(t,a._initParam.appUILocale))&&OSF.OsfManifestManager.cacheManifest(n.solutionId,n.version,i),r({status:null!=i?e.DataServiceResultCode.Succeeded:e.DataServiceResultCode.Failed,value:i})}))}else r({status:e.DataServiceResultCode.Succeeded,value:s})},t.prototype.activateAsync=function(t,n,i){var o=this;this.getAndCacheManifest(t,t.storeId,i,(function(r){if(r.status!=e.DataServiceResultCode.Succeeded)e.LoaderUtil.failWithError(n,{description:Strings.OsfRuntime.L_AgaveManifestRetrieve_ERR,buttonTxt:Strings.OsfRuntime.L_RetryButton_TXT,buttonCallback:function(){n.restartActivation(),o.activateAsync(t,n,i)},errorCode:OSF.ErrorStatusCodes.E_MANIFEST_SERVER_UNAVAILABLE});else{var a=e.HostFeatureEnabledInfo.getHostFeatureEnabledInfo();if(a&&a.enableSingleSignOnForAddin&&!n.isForCustomFunctionSandbox())r.value;n.load({entitlement:t,eToken:"",manifest:r.value},null)}}))},t.prototype.removeAsync=function(t,n,i){i({status:e.DataServiceResultCode.Failed})},t.prototype.getAppDetails=function(t,n,i,o){o({status:e.DataServiceResultCode.Failed})},t.prototype.validateAndCacheNewManifest=function(e,t,n,i){return!!this.validateAddinIdAndVersion(e,t)&&(this.cacheManifest(e,t,n,i),!0)},t.prototype.localCacheAddinCommands=function(e,t,n){this.cacheMyAddins(this.getUploadFileDevCatalogAddinCommandsMyAddinsCacheKey(),e)},t.prototype.validateAddinIdAndVersion=function(e,n){return t.idRegExp.test(e)&&t.versionRegExp.test(n)},t.prototype.cacheManifest=function(e,t,n,i){OSF.OsfManifestManager.cacheManifest(e,t,i),this.cacheMyAddins(this.getUploadFileDevCatalogAddinsCacheKey(),e),this._cacheManager.SetCacheItem(this.getUploadFileDevCatalogManifestCacheKey(e),n)},t.prototype.cacheMyAddins=function(e,t){var n=this._cacheManager.GetCacheItem(e);null==n&&(n=new Array),n.lastIndexOf(t)<0&&(n.push(t),this._cacheManager.SetCacheItem(e,n))},t.prototype.getUploadFileDevCatalogAddinsCacheKey=function(){return t.UploadFileCatalogCacheKey.myAddins+"."+this._initParam.appName+"."+this._initParam.userNameHashCode},t.prototype.getUploadFileDevCatalogAddinCommandsMyAddinsCacheKey=function(){return t.UploadFileCatalogCacheKey.addinCommandsMyAddins+"."+this._initParam.appName+"."+this._initParam.userNameHashCode},t.prototype.getUploadFileDevCatalogManifestCacheKey=function(e){return t.UploadFileCatalogCacheKey.manifest+"."+this._initParam.appName+"."+e},t.UploadFileCatalogCacheKeyPrefix="__OSF_UPLOADFILE.",t.UploadFileCatalogCacheKey={myAddins:t.UploadFileCatalogCacheKeyPrefix+"MyAddins",addinCommandsMyAddins:t.UploadFileCatalogCacheKeyPrefix+"AddinCommandsMyAddins",manifest:t.UploadFileCatalogCacheKeyPrefix+"Manifest"},t.idRegExp=new RegExp("[\\w-]+"),t.versionRegExp=new RegExp("(\\d{1,2}.)*\\d{1,2}"),t.GetManifestRetryLimit=4,t.GetManifestRetryWaitMs=500,t}();e.CatalogFactory.register(OSF.StoreType.UploadFileDevCatalog,(function(n){return n.enableUploadFileDevCatalog?new t({appName:n.appName,appUILocale:n.appUILocale,userNameHashCode:n.userNameHashCode}):new e.ForbiddenCatalog(null)}));var n=function(){function t(e,t){this._catalog=e,this._storeType=t}return t.prototype.validateAndCacheNewManifest=function(e,t,n,i,o){throw"Should never here"},t.prototype.getEntitlementsAsync=function(t,n,i,o){this._catalog.getEntitlementAsync(n,new e.AddinCommandsTelemetryContext(OSF.OUtil.Guid.generateNewGuid()),(function(e){o(e.value)}),!1,i)},t.prototype.getManifestAsync=function(e,t){throw"Should never here"},t.prototype.localCacheAddinCommands=function(e,t,n,i){this._storeType==OSF.StoreType.UploadFileDevCatalog&&this._catalog.localCacheAddinCommands(t,n,i)},t}(),i=function(){function t(){}return t.createAddinDataProvider=function(t,i){var o=e.CatalogFactory.resolve(t);return null==o?null:new n(o,t)},t}();e.AddinDataProviderFactory=i}(OfficeExt||(OfficeExt={})),function(e){var t=function(){function t(t,n){void 0===n&&(n=null),this._omex=null,this._addinListReady=!1,this._entitlements=[],this._appDetails={},this._getEntitlementCallback=null,this._approvedAddIns=null,this._hostInfo=t,this._appUILocale=t.appUILocale,this._cacheManager=n||new e.AppsDataCacheManager(OSF.OUtil.getLocalStorage(),new e.SafeSerializer);try{this._approvedAddIns=JSON.parse(t.approvedAddinList)}catch(t){e.WACUtils.logExceptionToBrowserConsole("Fail to parse the JSON string of specified Approved Addins for Host",t),this._approvedAddIns=null}this.updateAddinList(t.wopiHostAddinList)}return t.prototype.getOmexCatalog=function(){if(this._omex)return this._omex;var t,n=this._hostInfo.osfOmexBaseUrl.indexOf(OSF.Constants.ProtocolSeparator);t=n>=0?this._hostInfo.osfOmexBaseUrl.substr(n):OSF.Constants.ProtocolSeparator+this._hostInfo.osfOmexBaseUrl;var i=OSF.Constants.Https+t;return this._omex=new e.OmexCatalog({appName:this._hostInfo.appName,appUILocale:this._hostInfo.appUILocale,AppVersion:this._hostInfo.appVersion,clientMode:this._hostInfo.clientMode,docUrl:this._hostInfo.docUrl,omexBaseUrl:i,omexForceAnonymous:!0}),this._omex},t.prototype.isAddinTrusted=function(e){return!(!this._approvedAddIns||!e)&&-1!=this._approvedAddIns.indexOf(e.toUpperCase())},t.prototype.updateAddinList=function(t){var n=this;this._entitlements=[];var i=null,o=!1,r=!1,a=!1,s=!1,l=!1;try{i=JSON.parse(t)}catch(t){e.WACUtils.logExceptionToBrowserConsole("Fail to parse JSON string of Host Install Addins.",t),o=!0,i=null}if(i)if(Array.isArray(i))for(var c=0,u=i;c<u.length;c++){var d=u[c];if(d.addinId){var p=void 0;if(d.type)try{p=OSF.OUtil.parseEnum(d.type,OSF.OfficeAppType)}catch(t){e.WACUtils.logExceptionToBrowserConsole("Incorrect targetType.",d.type),s=!0;continue}else p=1;var f=OSF.OUtil.formatString(OSF.Constants.ConsentedCacheKey,d.addinId.toLowerCase(),OSF.StoreType.WopiCatalog,this._appUILocale),m=this.isAddinTrusted(d.addinId)||this._cacheManager.GetCacheItem(f,!0)||!1,h={solutionId:d.addinId,version:"0.0.0.0",storeType:OSF.StoreType.WopiCatalog,storeId:this._appUILocale,assetId:d.addinId,assetStoreId:this._appUILocale,targetType:p,requireConsent:!m};this._entitlements.push(h)}else e.WACUtils.logExceptionToBrowserConsole("Required field missing: addinId.",d),a=!0}else e.WACUtils.logExceptionToBrowserConsole("Received add-in list is not an array.",i),r=!0;var g=this._entitlements;this.getOmexCatalog().getAppDetails(g,null,new e.SimpleTelemetryContext,(function(t){if(t.status!==e.DataServiceResultCode.Succeeded){var i=t.value.map((function(e){return e.assetId.toUpperCase()})),c=n._entitlements;n._entitlements=[];for(var u=0,d=c;u<d.length;u++){var p=d[u];-1==i.indexOf(p.assetId.toUpperCase())?(e.WACUtils.logExceptionToBrowserConsole("Can't find Office Add-in from Microsoft AppSource given addin ID: "+p.assetId+" (content market: "+p.assetStoreId+").",{}),l=!0):n._entitlements.push(p)}}n._appDetails={};for(var f=0,m=t.value;f<m.length;f++)for(var h=m[f],g=0,y=n._entitlements;g<y.length;g++){p=y[g];if(h.assetId.toUpperCase()===p.assetId.toUpperCase()){h.storeType=p.storeType,n._appDetails[h.assetId.toUpperCase()]=h;break}}if(e.SDXCatalog.recordActivity("WopiCatalogUpdateAddinList",performance.now(),!0,[{name:"JSONParseError",bool:o},{name:"AddinListNotAnArray",bool:r},{name:"RequiredFieldMissing",bool:a},{name:"IncorrectTargetType:",bool:s},{name:"AddinNoFound",bool:l},{name:"AddinListNonEmpty",bool:n._entitlements.length>0}]),n._addinListReady=!0,null!=n._getEntitlementCallback){var v=n._getEntitlementCallback;n._getEntitlementCallback=null,v({status:e.DataServiceResultCode.Succeeded,value:n._entitlements})}}),!1)},t.prototype.getEntitlementAsync=function(t,n,i,o,r){if(this._addinListReady)i({status:e.DataServiceResultCode.Succeeded,value:this._entitlements});else if(n.startActivity(e.Activity.EntitlementCheck),null!=this._getEntitlementCallback){var a=this._getEntitlementCallback;this._getEntitlementCallback=function(t){n.stopActivity(e.Activity.EntitlementCheck),a(t),i(t)}}else this._getEntitlementCallback=function(t){n.stopActivity(e.Activity.EntitlementCheck),i(t)}},t.prototype.getAndCacheManifest=function(e,t,n,i,o){this.getOmexCatalog().getAndCacheManifest(e,t,n,i,o||!1)},t.prototype.activateAsync=function(n,i,o){var r=this;o.startActivity(e.Activity.Activation);var a=this,s={solutionId:n.solutionId,version:n.version,storeType:n.storeType,storeId:n.storeId,assetId:n.solutionId,assetStoreId:n.storeId,targetType:n.targetType},l=s.solutionId;this.isAddinEntitledAsync(l,(function(n){if(n.value){var c=OSF.OUtil.formatString(OSF.Constants.ConsentedCacheKey,l.toLowerCase(),s.storeType,s.storeId);if(r._cacheManager.SetCacheItem(c,!0,t.ConsentedCacheRefreshRateInDays),OSF.OUtil.checkFlight(OSF.FlightTreatmentNames.WopiUseNewActivate)){var u=function(t){a.getAndCacheManifest(s,r._appUILocale,o,(function(n){if(n.status===e.DataServiceResultCode.Succeeded){var a=n.value;if(i.getIsUpgrading()&&i.setIsUpgrading(!1),!1===a.requirementsSupported||void 0===a.requirementsSupported&&!i.getRequirementsChecker().isManifestSupported(a)){a.requirementsSupported=!1;var l=Strings.OsfRuntime.L_AgaveManifestRequirementsErrorOmex_ERR||Strings.OsfRuntime.L_AgaveManifestError_ERR;return void e.LoaderUtil.failWithError(i,{description:l,detailView:!0,errorCode:OSF.ErrorStatusCodes.WAC_AgaveRequirementsErrorOmex})}a.requirementsSupported=!0,r.getOmexCatalog().getAppState(s,o,(function(t){if(t.status==e.DataServiceResultCode.Succeeded){var n=t.value;if(n.state2==OSF.OmexState.Killed)return void e.LoaderUtil.failWithError(i,{description:Strings.OsfRuntime.L_AgaveDisabledByOmex_ERR,errorCode:OSF.ErrorStatusCodes.E_OEM_OMEX_EXTENSION_KILLED});var l=a.getMarketplaceVersion(),c=n.version;e.ManifestUtil.versionLessThan(l,c)&&e.LoaderUtil.showWarning(i,{description:Strings.OsfRuntime.L_AgaveNewerVersion_ERR,buttonTxt:Strings.OsfRuntime.L_UpdateButton_TXT,buttonCallback:function(){i.restartActivation(),r.restartActivationTelemetry(o),i.setIsUpgrading(!0),i.setUpgradingFailed(!1),u(!0)},highPriority:!0,displayDeactive:!1,errorCode:OSF.ErrorStatusCodes.E_MANIFEST_UPDATE_AVAILABLE})}o.stopActivity(e.Activity.Activation),i.load({entitlement:s,manifest:a,eToken:""},null)}),t)}else i.getIsUpgrading()&&(i.setUpgradingFailed(!0),i.setIsUpgrading(!1)),o.stopActivity(e.Activity.Activation),e.LoaderUtil.failWithError(i,{description:Strings.OsfRuntime.L_AddinCommands_AddinNotSupported_Message,errorCode:OSF.ErrorStatusCodes.E_MANIFEST_DOES_NOT_EXIST,buttonTxt:Strings.OsfRuntime.L_RefreshButton_TXT,buttonCallback:function(){i.restartActivation(),r.restartActivationTelemetry(o),u(!0)}})}),t)};u(!1)}else a.getAndCacheManifest(s,r._appUILocale,o,(function(t){t.status===e.DataServiceResultCode.Succeeded?(o.stopActivity(e.Activity.Activation),i.load({entitlement:s,manifest:t.value,eToken:""},null)):(o.stopActivity(e.Activity.Activation),e.LoaderUtil.failWithError(i,{description:Strings.OsfRuntime.L_AddinCommands_AddinNotSupported_Message,url:"",errorCode:OSF.ErrorStatusCodes.E_MANIFEST_DOES_NOT_EXIST,buttonTxt:Strings.OsfRuntime.L_RefreshButton_TXT,buttonCallback:function(){i.restartActivation(),a.activateAsync(s,i,o)}}))}))}else o.stopActivity(e.Activity.Activation),e.LoaderUtil.showWarning(i,{description:Strings.OsfRuntime.L_AgaveNotExist_ERR,buttonTxt:Strings.OsfRuntime.L_RefreshButton_TXT,buttonCallback:function(){i.restartActivation(),a.activateAsync(s,i,o)},detailView:!0,retryAll:!0,errorCode:OSF.ErrorStatusCodes.E_OEM_EXTENSION_NOT_ENTITLED})}))},t.prototype.removeAsync=function(t,n,i){i({status:e.DataServiceResultCode.Failed})},t.prototype.getAppDetails=function(t,n,i,o,r){var a=this;this.getEntitlementAsync(!1,new e.SimpleTelemetryContext,(function(n){for(var i=[],r=e.DataServiceResultCode.Succeeded,s=0,l=t;s<l.length;s++){var c=l[s].solutionId.toUpperCase();a._appDetails[c]?i.push(a._appDetails[c]):r=e.DataServiceResultCode.Failed}o({status:r,value:i})}))},t.prototype.isAddinEntitledAsync=function(t,n){this.getEntitlementAsync(!1,new e.SimpleTelemetryContext,(function(i){if(i.status===e.DataServiceResultCode.Succeeded)for(var o=t.toUpperCase(),r=0,a=i.value;r<a.length;r++){if(a[r].solutionId.toUpperCase()===o)return void n({status:e.DataServiceResultCode.Succeeded,value:!0})}n({status:e.DataServiceResultCode.Succeeded,value:!1})}))},t.prototype.restartActivationTelemetry=function(t){t.startActivity(e.Activity.Activation),t.startActivity(e.Activity.ServerCall)},t.ConsentedCacheRefreshRateInDays=180,t}();e.WOPICatalog=t,e.CatalogFactory.register(OSF.StoreType.WopiCatalog,(function(n){if(n.allowExternalMarketplace&&n.osfOmexBaseUrl&&n.enableWopiCatalog)return e.WACUtils.logExceptionToBrowserConsole("Registered WOPICatalog",null),new t(n);e.WACUtils.logExceptionToBrowserConsole("Cannot register WOPICatalog allowExternalMarketplace is: ",n.allowExternalMarketplace),e.WACUtils.logExceptionToBrowserConsole("Cannot register WOPICatalog osfOmexBaseUrl is: ",n.osfOmexBaseUrl),e.WACUtils.logExceptionToBrowserConsole("Cannot register WOPICatalog enableWopiCatalog is: ",n.enableWopiCatalog);var i=!("undefined"==typeof Strings||null===Strings);return new e.ForbiddenCatalog({loaderParams:null,loaderParamsFunction:function(){return e.LoaderUtil.error({title:i?Strings.OsfRuntime.L_AgaveErrorTile_TXT:"TRUSTCENTER_CATALOG_UNTRUSTED",buttonTxt:i?Strings.OsfRuntime.L_OkButton_TXT:"OK",description:i?Strings.OsfRuntime.L_AgaveOmexNotConfigured_ERR:"TRUSTCENTER_CATALOG_UNTRUSTED",errorCode:OSF.ErrorStatusCodes.E_TRUSTCENTER_CATALOG_UNTRUSTED_ADMIN_CONTROLLED})},controlStatus:OSF.OsfControlStatus.ActivationFailed})}))}(OfficeExt||(OfficeExt={})),function(e){!function(e){e[e.Succeeded=1]="Succeeded",e[e.Failed=0]="Failed",e[e.ProxyNotReady=-1]="ProxyNotReady",e[e.PrxoyUrlEmpty=-2]="PrxoyUrlEmpty",e[e.ProxyUrlNotTrusted=-3]="ProxyUrlNotTrusted",e[e.UnknownUserType=2]="UnknownUserType",e[e.Unauthenticated=3]="Unauthenticated",e[e.UserResolutionNoMailbox=4]="UserResolutionNoMailbox"}(e.DataServiceResultCode||(e.DataServiceResultCode={}))}(OfficeExt||(OfficeExt={})),function(e){var t=function(){function t(t,n){void 0===n&&(n=null),this._initParam=t,this._cacheManager=n||new e.AppsDataCacheManager(OSF.OUtil.getLocalStorage(),new e.SafeSerializer)}return t.LogFirstPartyCatalogMonitoringError=function(e,t){Telemetry.RuntimeTelemetryHelper.LogExceptionTag("First Party Catalog Error AssetId: "+t+" Message: "+e,null,null,522733344)},t.prototype.getEntitlementAsync=function(e,t,n,i){throw new Error("in firstParty get Entitlementasync")},t.prototype.getAndCacheManifest=function(e,t,n,i,o){throw new Error("in firstParty getAndCacheManifest")},t.prototype.removeAsync=function(e,t,n){throw new Error("in firstParty removeAsync")},t.prototype.getAppDetails=function(e,t,n,i,o){throw new Error("in firstParty getappDetails")},t.prototype.TryFallBackFirstPartyAddInList=function(n,i,o){var r=this._cacheManager.GetCacheItem(e.CacheConsts.firstPartyAddinListCacheKey,!1);r?(t.LogFirstPartyCatalogMonitoringError("Falling back to stale 1st party add-ins list.",i),o({status:e.DataServiceResultCode.Succeeded,value:r})):o({status:e.DataServiceResultCode.Failed,value:null})},t.prototype.GetFirstyPartyAddInsInfo=function(t,n,i,o){var r=this,a=this._cacheManager.GetCacheItem(e.CacheConsts.firstPartyAddinListCacheKey,!0,null,null,!1);if(a){var s={addInList:a,refreshRate:null};o({status:e.DataServiceResultCode.Succeeded,value:s})}else t.getFirstPartyAddInList((function(t){if(t.status==e.DataServiceResultCode.Succeeded){var a=null;try{a=e.OmexXmlProcessor.ProcessFirstPartyAddInList(t.value)}catch(e){return Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Problem parsing first party list.",e,n.correlationId,522733345),void r.TryFallBackFirstPartyAddInList(n,i,o)}r._cacheManager.SetCacheItem(e.CacheConsts.firstPartyAddinListCacheKey,a.addInList,a.refreshRate/e.CacheConsts.hourToDayConversionFactor),o({status:e.DataServiceResultCode.Succeeded,value:a})}else r.TryFallBackFirstPartyAddInList(n,i,o)}))},t.prototype.TryFallBackFirstPartyManifest=function(n,i,o){var r=this.ReadFirstPartyManifestFromLocalStorage(i,n);r?(t.LogFirstPartyCatalogMonitoringError("Falling back to stale manifest.",n),o({status:e.DataServiceResultCode.Succeeded,value:r})):o({status:e.DataServiceResultCode.Failed,value:null})},t.prototype.ReadFirstPartyManifestFromLocalStorage=function(t,n){var i=OSF.OUtil.formatString(e.CacheConsts.firstPartyManifestCacheKey,n),o=this._cacheManager.GetCacheItem(i,!1);return o?e.ManifestUtil.ParseManifest(o,this._initParam.appUILocale,t.correlationId):null},t.prototype.GetCachedManifest=function(e,t){var n=OSF.OsfManifestManager.getCachedManifest(t,"");return n||(n=this.ReadFirstPartyManifestFromLocalStorage(e,t))&&OSF.OsfManifestManager.cacheManifest(t,"",n),n},t.prototype.GetFirstPartyManifest=function(t,n,i,o){var r=this,a=this.GetCachedManifest(n,i.assetId);if(!a||OSF.OsfManifestManager.versionLessThan(a.getMarketplaceVersion(),i.version)){var s=OSF.OUtil.formatString("{0}/{1}",this._initParam.firstPartyManifestCDNUrl,i.path);t.getFirstPartyManifest(s,(function(t){if(t.status==e.DataServiceResultCode.Succeeded){var a=e.ManifestUtil.ParseManifest(t.value,r._initParam.appUILocale,n.correlationId);if(a){OSF.OsfManifestManager.cacheManifest(i.assetId,"",a);var s=OSF.OUtil.formatString(e.CacheConsts.firstPartyManifestCacheKey,i.assetId);r._cacheManager.SetCacheItem(s,t.value),o({status:e.DataServiceResultCode.Succeeded,value:a})}else r.TryFallBackFirstPartyManifest(i.assetId,n,o)}else r.TryFallBackFirstPartyManifest(i.assetId,n,o)}))}else o({status:e.DataServiceResultCode.Succeeded,value:a})},t.prototype.getDataService=function(t,n){var i=this;if(null==this._dataService){var o={status:e.DataServiceResultCode.Failed,value:null},r=e.ProxyBasedCatalogService.getFirstPartyInstance(this._initParam);r.prepareProxy(t.correlationId,(function(t){!function(t,r){t.status==e.DataServiceResultCode.Succeeded?(i._dataService=r,o.value=r,o.status=e.DataServiceResultCode.Succeeded,n(o)):(o.httpStatus=t.httpStatus,n(o))}(t,r)}))}else n({status:e.DataServiceResultCode.Succeeded,value:this._dataService})},t.prototype.createActivityScope=function(t,n){var i=this;this.getDataService(t,(function(o){if(!e.AsyncUtil.failed(o,n)){var r=o.value,a={cacheManager:i._cacheManager,cachePrefix:e.CacheConsts.anonymousCacheKeyPrefix,cid:r.getCID(),anonymous:!0,telemetryContext:t},s=r.createScope(a);n({status:e.DataServiceResultCode.Succeeded,value:s})}}))},t.prototype.activateAsync=function(n,i,o){var r=this;o.startActivity(e.Activity.Activation),o.startActivity(e.Activity.ServerCall);var a=e.HostFeatureEnabledInfo.getHostFeatureEnabledInfo(),s=a&&a.enableFirstPartySDXErrorMessages,l=n.solutionId;if(this._cacheManager.GetCacheItem(e.CacheConsts.firstPartyAddinListCacheKey,!0,null,null,!1)){var c=this.GetCachedManifest(o,l);if(c)return o.stopActivity(e.Activity.ServerCall),void i.load({entitlement:n,manifest:c,eToken:""},null)}this.createActivityScope(o,(function(a){if(a.status!=e.DataServiceResultCode.Succeeded)return t.LogFirstPartyCatalogMonitoringError("Failed to create 1st party activity scope.",l),void e.LoaderUtil.failWithError(i,{title:s?Strings.OsfRuntime.L_AgaveErrorTile_TXT_FirstParty:Strings.OsfRuntime.L_AgaveErrorTile_TXT,description:s?Strings.OsfRuntime.L_AgaveServerConnectionFailed_ERR_FirstParty:Strings.OsfRuntime.L_AgaveServerConnectionFailed_ERR,buttonTxt:Strings.OsfRuntime.L_RetryButton_TXT,buttonCallback:function(){i.restartActivation(),r.activateAsync(n,i,o)},errorCode:OSF.ErrorStatusCodes.WAC_AgaveAnonymousProxyCreationError});var c=a.value;r.GetFirstyPartyAddInsInfo(c,o,l,(function(a){if(a.status!=e.DataServiceResultCode.Succeeded)return t.LogFirstPartyCatalogMonitoringError("Failed get list of 1st party addIns.",l),void e.LoaderUtil.failWithError(i,{title:s?Strings.OsfRuntime.L_AgaveErrorTile_TXT_FirstParty:Strings.OsfRuntime.L_AgaveErrorTile_TXT,description:s?Strings.OsfRuntime.L_AgaveServerConnectionFailed_ERR_FirstParty:Strings.OsfRuntime.L_AgaveServerConnectionFailed_ERR,buttonTxt:Strings.OsfRuntime.L_RetryButton_TXT,buttonCallback:function(){i.restartActivation(),r.activateAsync(n,i,o)},errorCode:OSF.ErrorStatusCodes.WAC_FirstPartyAddInListRequestFailure});var u=a.value.addInList[l];if(!u)return t.LogFirstPartyCatalogMonitoringError("Could not find 1st party addin solutionId in list.",l),void e.LoaderUtil.failWithError(i,{title:s?Strings.OsfRuntime.L_AgaveErrorTile_TXT_FirstParty:Strings.OsfRuntime.L_AgaveErrorTile_TXT,description:s?Strings.OsfRuntime.L_AgaveServerConnectionFailed_ERR_FirstParty:Strings.OsfRuntime.L_AgaveServerConnectionFailed_ERR,buttonTxt:Strings.OsfRuntime.L_RetryButton_TXT,buttonCallback:function(){i.restartActivation(),r.activateAsync(n,i,o)},errorCode:OSF.ErrorStatusCodes.WAC_FirstPartyAddInListRequestFailure});o.startActivity(e.Activity.ManifestRequest),r.GetFirstPartyManifest(c,o,u,(function(a){if(a.status!=e.DataServiceResultCode.Succeeded)return t.LogFirstPartyCatalogMonitoringError("Could not get 1st party manifest.",l),void e.LoaderUtil.failWithError(i,{title:s?Strings.OsfRuntime.L_AgaveErrorTile_TXT_FirstParty:Strings.OsfRuntime.L_AgaveErrorTile_TXT,description:s?Strings.OsfRuntime.L_AgaveServerConnectionFailed_ERR_FirstParty:Strings.OsfRuntime.L_AgaveServerConnectionFailed_ERR,buttonTxt:Strings.OsfRuntime.L_RetryButton_TXT,buttonCallback:function(){i.restartActivation(),r.activateAsync(n,i,o)},errorCode:OSF.ErrorStatusCodes.WAC_AgaveManifestRequestFailure});o.stopActivity(e.Activity.ManifestRequest),o.stopActivity(e.Activity.ServerCall);var c=a.value;i.load({entitlement:n,manifest:c,eToken:""},null)}))}))}))},t}();e.FirstPartyCatalog=t,e.CatalogFactory.register(OSF.StoreType.FirstParty,(function(n){if(n.osfOmexBaseUrl&&n.firstPartyManifestCDNUrl){var i,o=n.osfOmexBaseUrl.indexOf(OSF.Constants.ProtocolSeparator);i=o>=0?n.osfOmexBaseUrl.substr(o):OSF.Constants.ProtocolSeparator+n.osfOmexBaseUrl;var r=OSF.Constants.Https+i;return new t({appName:n.appName,appUILocale:n.appUILocale,AppVersion:n.appVersion,clientMode:n.clientMode,docUrl:n.docUrl,omexBaseUrl:r,omexForceAnonymous:!0,firstPartyManifestCDNUrl:n.firstPartyManifestCDNUrl})}return new e.ForbiddenCatalog({loaderParams:null,loaderParamsFunction:function(){return e.LoaderUtil.error({description:Strings.OsfRuntime.L_AgaveOmexNotConfigured_ERR,errorCode:OSF.ErrorStatusCodes.E_TRUSTCENTER_CATALOG_UNTRUSTED_ADMIN_CONTROLLED})},controlStatus:OSF.OsfControlStatus.ActivationFailed})}))}(OfficeExt||(OfficeExt={})),function(e){var t=function(e,t,n){var i=this;this.getLastStoreUpdate=function(){return __awaiter(i,void 0,void 0,(function(){return __generator(this,(function(e){return[2,0]}))}))},this.getEntitlementAsync=function(e,t,n){return __awaiter(i,void 0,void 0,(function(){var e,t,n,i,o,r;return __generator(this,(function(a){switch(a.label){case 0:return Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("[OmexCatalog] getEntitlementAsync :: fetching Mos Acquisitions.",this._correlationId,523568906),[4,this._handler.getAppMetadataList(["OfficeAddIns","Extensions"],this._telemetryContext)];case 1:for(e=a.sent(),t=[],n=0,i=e;n<i.length;n++)o=i[n],r={solutionId:o.getMarketplaceID(),version:o.getVersion(),assetId:o.getAssetId(),assetStoreId:o.getLocale(),storeId:o.getLocale(),appVersion:o.getVersion(),storeType:OSF.StoreType.OMEX,targetType:o.getTarget(),addInState:"Ok",contentMarket:o.getLocale(),productId:o.getManifestId(),addInStoreInfo:{AssetId:o.getAssetId(),ContentMarket:o.getLocale()},appSubType:o.getOmexTargetCode(),appSubType2:o.getOmexTargetCode().toString()},t.push(r);return[2,{billingMarket:"",pageSize:"250",refreshRate:"300",entitlements:t,refreshRate2:300,cid:""}]}}))}))},this.getEToken=function(e,t){return __awaiter(i,void 0,void 0,(function(){var t,n,i;return __generator(this,(function(o){switch(o.label){case 0:return[4,this._handler.getAppMetadataList(["OfficeAddIns","Extensions"],this._telemetryContext)];case 1:return t=o.sent(),n=t.filter((function(t){return t.getAssetId()===e.assetId}))[0],i=new Date(Date.now()+31536e6),[2,{etoken:"",manifest:null,assetId:n.getAssetId(),contentMarket:"en-US",status:"1",version:n.getVersion(),cid:"",entitlementType:"Free",tokenExpirationDate:i.toISOString(),status2:1,tokenExpirationDate2:i.getTime()}]}}))}))},this.getETokenAndManifest=function(e,t){return __awaiter(i,void 0,void 0,(function(){var n,i,o;return __generator(this,(function(r){switch(r.label){case 0:return[4,Promise.all([this.getEToken(e,t),this.getManifest(e,t)])];case 1:return n=r.sent(),i=n[0],o=n[1],[2,__assign(__assign({},i),{manifest:o.manifest})]}}))}))},this.getManifest=function(e,t){return __awaiter(i,void 0,void 0,(function(){var t,n;return __generator(this,(function(i){switch(i.label){case 0:return Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("[OmexCatalog] getManifest :: fetching Mos Acquisitions.",this._correlationId,523568907),[4,this._handler.getAppMetadataList(["OfficeAddIns","Extensions"],this._telemetryContext)];case 1:t=i.sent();try{n=t.filter((function(t){return t.getAssetId()==e.assetId}))[0]._acquisition.titleDefinition.elementDefinitions.officeAddIns[0].xmlDefinition}catch(e){Telemetry.RuntimeTelemetryHelper.LogExceptionTag("[OmexCatalog] getManifest :: Error while processing appMetadataList",e,this._correlationId,523568908)}return[2,{status2:n?1:0,manifest:n}]}}))}))},this.getAppState=function(e){return __awaiter(i,void 0,void 0,(function(){var t,n;return __generator(this,(function(i){switch(i.label){case 0:return[4,this._handler.getAppMetadataList(["OfficeAddIns","Extensions"],this._telemetryContext)];case 1:return t=i.sent(),[2,{assetId:(n=t.filter((function(t){return t.getAssetId()===e.assetId}))[0]).getAssetId(),expirationDate:"",expirationDate2:null,productId:n._id,refreshRate:"48",refreshRate2:48,state:"1",state2:1,takeDownUrl:"",unsafePreviousVersion:"",version:n.getVersion()}]}}))}))},this.getKilledApps=function(){return __awaiter(i,void 0,void 0,(function(){return __generator(this,(function(e){return[2,{refreshRate2:0,refreshRate:"0",killedApps:[]}]}))}))},this.getAppDetails=function(e,t){return __awaiter(i,void 0,void 0,(function(){var t,n,i,o,r;return __generator(this,(function(a){switch(a.label){case 0:return[4,this._handler.getAppMetadataList(["OfficeAddIns","Extensions"],this._telemetryContext)];case 1:for(t=a.sent(),n={},i=0,o=t;i<o.length;i++)r=o[i],n[r.getAssetId().toLowerCase()]=r;return[2,e.map((function(e){var t=n[e.toLowerCase()];return null==t?null:{solutionId:t.getMarketplaceID(),storeType:"NYIStoreType",storeId:"NYIStoreId",assetId:t.getAssetId(),assetStoreId:"NYIAssetStoreId",webApplicationId:"",appVersions:"ZXL150,ZXL160,WAE160,MXL160",state:"1",name:t.getDefaultDisplayName(),provider:t.getProviderName(),iconUrl:t.getDefaultIconUrl(),description:t.getDefaultDescription(),version:t.getVersion(),defaultWidth:t.getDefaultWidth(),defaultHeight:t.getDefaultHeight(),appSubType:t.getOmexTargetCode().toString(),appSubType2:t.getOmexTargetCode(),highResolutionIconUrl:t.getDefaultHighResolutionIconUrl(),hosts:t.getHostsXml(),requirements:"",defaultHeight2:parseInt(t.getDefaultWidth()),defaultWidth2:parseInt(t.getDefaultWidth()),state2:1}}))]}}))}))},this.removeApps=function(e){return __awaiter(i,void 0,void 0,(function(){var t,n,i,o,r,a,s;return __generator(this,(function(l){switch(l.label){case 0:return t=[],[4,this._handler.getAppMetadataList(["OfficeAddIns","Extensions"],this._telemetryContext)];case 1:n=l.sent(),i=function(e){var i,r;return __generator(this,(function(a){switch(a.label){case 0:i=!1,a.label=1;case 1:return a.trys.push([1,3,,4]),r=n.filter((function(t){return t.getAssetId()===e}))[0].getTitleId(),[4,o._handler.unacquire(r,o._telemetryContext)];case 2:return a.sent(),i=!0,[3,4];case 3:return a.sent(),[3,4];case 4:return t.push({assetId:e,result:i?"1":"0",result2:i?1:0}),[2]}}))},o=this,r=0,a=e,l.label=2;case 2:return r<a.length?(s=a[r],[5,i(s)]):[3,5];case 3:l.sent(),l.label=4;case 4:return r++,[3,2];case 5:return[2,{removedApps:t}]}}))}))},this.isStoreDisabled=function(){return __awaiter(i,void 0,void 0,(function(){return __generator(this,(function(e){return[2,!1]}))}))},this._handler=e,this._initParam=t,this._cachePrefix=n.cachePrefix,this._cid=n.cid,this._correlationId=n.telemetryContext.correlationId,this._telemetryContext=n.telemetryContext},n=function(){function n(e){this._cid="",this._initParam=e}return n.prototype.getCID=function(){return this._cid},n.prototype.initialize=function(t,n){this._initParam.omexForceAnonymous,n({status:e.DataServiceResultCode.Succeeded,value:{anonymous:!1}})},n.prototype.toCallBack=function(t){return function(){for(var n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];var o=n[n.length-1];t.apply(void 0,n.slice(0,-1)).then((function(t){return o({status:e.DataServiceResultCode.Succeeded,value:t})}),(function(e){return o(e)}))}},n.prototype.createScope=function(n){var i=new t(new e.MosRequestHandler,this._initParam,n);return{getLastStoreUpdate:this.toCallBack(i.getLastStoreUpdate),getEntitlementAsync:this.toCallBack(i.getEntitlementAsync),getManifest:this.toCallBack(i.getManifest),getEToken:this.toCallBack(i.getEToken),getETokenAndManifest:this.toCallBack(i.getETokenAndManifest),getAppState:this.toCallBack(i.getAppState),getKilledApps:this.toCallBack(i.getKilledApps),getAppDetails:this.toCallBack(i.getAppDetails),removeApps:this.toCallBack(i.removeApps),isStoreDisabled:this.toCallBack(i.isStoreDisabled)}},n}();e.MosCatalogServiceForOmex=n}(OfficeExt||(OfficeExt={})),function(e){var t=function(){function e(){}return e.CheckProxyIsReady="OMEX_isProxyReady",e.Gated_GetManifestAndEToken="OMEX_getManifestAndETokenAsync",e.Gated_GetKilledApps="OMEX_getKilledAppsAsync",e.Gated_GetEntitlementSummary="OMEX_getEntitlementSummaryAsync",e.Gated_GetAppState="OMEX_getAppStateAsync",e.Gated_RemoveApp="OMEX_removeAppAsync",e.Gated_RemoveCache="OMEX_removeCacheAsync",e.Gated_ClearCache="OMEX_clearCacheAsync",e.UnGated_GetAppDetails="OMEX_getAppDetailsAsync",e.UnGated_GetRecommendations="OMEX_getRecommendationsAsync",e.UnGated_ClearCache="OMEX_clearCacheAsync",e.Anonymous_GetManifestAndEToken="OMEX_getManifestAndETokenAsync",e.Anonymous_GetKilledApps="OMEX_getKilledAppsAsync",e.Anonymous_GetAppState="OMEX_getAppStateAsync",e.Anonymous_RemoveCache="OMEX_removeCacheAsync",e.Anonymous_ClearCache="OMEX_clearCacheAsync",e.Anonymous_GetAuthNStatus="OMEX_getAuthNStatus",e.Anonymous_GetFirstPartyAddInList="OMEX_getFirstPartyAddInListAsync",e.Anonymous_GetFirstPartyManifest="OMEX_getFirstPartyManifestAsync",e}();e.OmexProxyMethods=t;var n=function(n){function i(e){var t=n.call(this)||this;return t.osfOmexBaseUrl=e,t}return __extends(i,n),i.prototype.prepareProxy=function(e,t,n){n&&(this.isReady=!1,i.resetProxy(this)),this.isReady?e({status:null,value:{clientEndpoint:this.clientEndPoint}}):this.clientEndPoint?this.pendingCallbacks.push([e,t]):this.createProxy(e,t)},i.resetProxy=function(e){Microsoft.Office.Common.XdmCommunicationManager.getClientEndPoint(e.conversationId)&&Microsoft.Office.Common.XdmCommunicationManager.deleteClientEndPoint(e.conversationId),e.iframe&&(OSF.OUtil.removeEventListener(e.iframe,"load",e.iframeOnload),e.iframe.parentNode.removeChild(e.iframe),e.iframe=null),e.clientEndPoint=null},i.sendProxyReadyCheck=function(e,n,i){if(e.clientEndPoint=Microsoft.Office.Common.XdmCommunicationManager.connect(e.conversationId,e.iframe.contentWindow,e.proxyUrl),e.clientEndPoint)e.clientEndPoint.invoke(t.CheckProxyIsReady,n,{__timeout__:500});else{var o="Unexpected error, iframe loaded again after failing OMEX_isProxyReady";Telemetry.RuntimeTelemetryHelper.LogExceptionTag(o,null,null,520664832),i({status:null,value:{errorMessage:o}})}OSF.OUtil.set_entropy((new Date).getTime())},i.prototype.createProxy=function(n,o){try{OSF.OUtil.doesUrlHaveSupportedProtocol(this.proxyUrl)||o({status:null,value:{errorMessage:"Protocal of proxyUrl is not supported."}});var r=this.proxyName===OSF.Constants.OmexAnonymousServiceName&&OSF.OUtil.checkFlight(OSF.FlightTreatmentNames.CheckProxyIsReadyRetry),a=document.createElement("iframe");a.setAttribute("id",this.proxyName),a.setAttribute("name",this.proxyName),a.setAttribute("role","none");var s=this.proxyUrl+"?"+this.conversationId,l=window.location.origin;s=OSF.OUtil.addXdmInfoAsHash(s,this.conversationId+"|"+this.proxyName+"|"+l),s=OSF.OUtil.addSerializerVersionAsHash(s,OSF.SerializerVersion.Browser),s=OSF.OUtil.addFlightsAsHash(s,JSON.stringify(OSF.Flights)),s=OSF.OUtil.addDisabledChangeGatesAsHash(s,JSON.stringify(OSF.DisabledChangeGates)),a.setAttribute("src",s),a.setAttribute("scrolling","auto"),a.setAttribute("border","0"),a.setAttribute("width","0"),a.setAttribute("height","0"),a.setAttribute("style","position: absolute; left: -100px; top:0px;"),document.body.appendChild(a);var c=this,u=function(){var e=function(n,a){var s=c.pendingCallbacks.length;if(0!=s){var l=null;if(0===n&&a.status)c.isReady=!0,l={status:null,value:{clientEndpoint:c.clientEndPoint}};else{if(r)return r=!1,Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("retry "+t.CheckProxyIsReady+" for "+c.proxyName,null,520664803),void window.setTimeout((function(){i.sendProxyReadyCheck(c,e,o)}),500);i.resetProxy(c),l={status:null,value:{errorMessage:"OmexProxyBase::onIframeLoad::isProxyReadyCallback failed, error code "+n}}}for(var u=0;u<s;u++){var d=c.pendingCallbacks.shift();c.isReady?d[0](l):d[1](l)}}};i.sendProxyReadyCheck(c,e,o)};OSF.OUtil.addEventListener(a,"load",u),this.iframeOnload=u,this.pendingCallbacks.push([n,o]),this.iframe=a}catch(t){var d="Error creating client endpoint with proxyUrl = ["+this.proxyUrl+"], msg:"+e.WACUtils.serializeObjectToString(t);o({status:null,value:{errorMessage:d}})}},i}(e.ProxyBase);e.OmexProxyBase=n}(OfficeExt||(OfficeExt={})),function(e){var t=function(t){function n(e){var n=t.call(this,e)||this;return n.proxyName=OSF.Constants.OmexAnonymousServiceName,n.proxyUrl=n.osfOmexBaseUrl+OSF.Constants.OmexAnonymousServiceExtension,n}return __extends(n,t),n.prototype.getManifestAsync=function(t,n){this.invokeProxyCommandAsync(e.OmexProxyMethods.Anonymous_GetManifestAndEToken,t,(function(t){null!=t.value&&t.status==e.DataServiceResultCode.Succeeded&&(t.value=e.OmexXmlProcessor.ConvertClientAppInstallInfo(t.value)),n(t)}))},n.prototype.getFirstPartyAddInListAsync=function(t,n){this.invokeProxyCommandAsync(e.OmexProxyMethods.Anonymous_GetFirstPartyAddInList,t,(function(e){n(e)}))},n.prototype.getFirstPartyManifestAsync=function(t,n){this.invokeProxyCommandAsync(e.OmexProxyMethods.Anonymous_GetFirstPartyManifest,t,(function(e){n(e)}))},n.prototype.getAppStateAsync=function(t,n){this.invokeProxyCommandAsync(e.OmexProxyMethods.Anonymous_GetAppState,t,(function(t){null!=t.value&&t.status==e.DataServiceResultCode.Succeeded&&(t.value=e.OmexXmlProcessor.ConvertAppState(t.value)),n(t)}))},n.prototype.getKilledAppAsync=function(t,n){this.invokeProxyCommandAsync(e.OmexProxyMethods.Anonymous_GetKilledApps,t,(function(t){null!=t.value&&t.status==e.DataServiceResultCode.Succeeded&&(t.value=e.OmexXmlProcessor.ConvertKilledAppsInfo(t.value)),n(t)}))},n.prototype.getAuthNStatusAsync=function(t,n){this.invokeProxyCommandAsync(e.OmexProxyMethods.Anonymous_GetAuthNStatus,t,n)},n}(e.OmexProxyBase);e.AnonymousOmexProxy=t}(OfficeExt||(OfficeExt={})),function(e){var t=function(t){function n(e){var n=t.call(this,e)||this;return n.proxyName=OSF.Constants.OmexGatedServiceName,n.proxyUrl=n.osfOmexBaseUrl+OSF.Constants.OmexGatedServiceExtension,n}return __extends(n,t),n.prototype.getOmexEntitlementsAsync=function(t,n){this.invokeProxyCommandAsync(e.OmexProxyMethods.Gated_GetEntitlementSummary,t,(function(t){null!=t.value&&t.status==e.DataServiceResultCode.Succeeded&&(t.value=e.OmexXmlProcessor.ConvertEntitlementInfo(t.value)),n(t)}))},n.prototype.getManifestAndETokenAsync=function(t,n){this.invokeProxyCommandAsync(e.OmexProxyMethods.Gated_GetManifestAndEToken,t,(function(t){null!=t.value&&t.status==e.DataServiceResultCode.Succeeded&&(t.value=e.OmexXmlProcessor.ConvertClientAppInstallInfo(t.value)),n(t)}))},n.prototype.getAppStateAsync=function(t,n){this.invokeProxyCommandAsync(e.OmexProxyMethods.Gated_GetAppState,t,(function(t){null!=t.value&&t.status==e.DataServiceResultCode.Succeeded&&(t.value=e.OmexXmlProcessor.ConvertAppState(t.value)),n(t)}))},n.prototype.getKilledAppAsync=function(t,n){this.invokeProxyCommandAsync(e.OmexProxyMethods.Gated_GetKilledApps,t,(function(t){null!=t.value&&t.status==e.DataServiceResultCode.Succeeded&&(t.value=e.OmexXmlProcessor.ConvertKilledAppsInfo(t.value)),n(t)}))},n.prototype.removeApps=function(t,n){this.invokeProxyCommandAsync(e.OmexProxyMethods.Gated_RemoveApp,t,(function(t){null!=t.value&&t.status==e.DataServiceResultCode.Succeeded&&(t.value=e.OmexXmlProcessor.ConvertRemoveAppResponse(t.value)),n(t)}))},n}(e.OmexProxyBase);e.GatedOmexProxy=t}(OfficeExt||(OfficeExt={})),function(e){var t;!function(e){e[e.NotDetected=0]="NotDetected",e[e.AuthedUser=1]="AuthedUser",e[e.AnonymousUser=2]="AnonymousUser"}(t||(t={}));var n=function(){function n(n){this.currentUserType=t.NotDetected,this.omexAuthNStatus=OSF.OmexAuthNStatus.NotAttempted,this.omexAuthConnectTries=1,this.initParams=n,this.gatedProxy=new e.GatedOmexProxy(n.omexBaseUrl),this.ungatedProxy=new e.UnGatedOmexProxy(n.omexBaseUrl),this.anonymousProxy=new e.AnonymousOmexProxy(n.omexBaseUrl)}return n.initRequestHandler=function(e){null==n._requestHandler&&(n._requestHandler=e)},n.getInstance=function(e){return null==n._instance&&(n._instance=new n(e)),n._instance},n.getFirstPartyInstance=function(e){if(null==n._firstPartyInstance){var t=new n(e);t._isFirstParty=!0,t.omexAuthNStatus=OSF.OmexAuthNStatus.Anonymous,this._firstPartyInstance=t}return n._firstPartyInstance},n.prototype.initialize=function(e,t){throw new Error("ProxyBasedCatalogService does not need initialize.")},n.prototype.prepareProxy=function(n,i){var o=this;n=n||"";this.ensureOmexProxySetUp(n,(function(n){var r;n&&null!=n.status?n.status:e.DataServiceResultCode.ProxyNotReady;n&&n.value&&(o._isFirstParty?r=!0:n.value.currentUserType&&(n.value.currentUserType==t.AuthedUser?r=!1:n.value.currentUserType==t.AnonymousUser&&(r=!0))),i({status:n.status,value:{anonymous:r}})}))},n.prototype.createScope=function(e){return new o(e,this)},n.prototype.getCID=function(){switch(this.currentUserType){case t.AuthedUser:return this._cid;case t.AnonymousUser:return""}throw"not initialized"},n.prototype.ensureOmexProxySetUp=function(n,i){if(this.currentUserType==t.NotDetected||!this.anonymousProxy.isReady&&!this.gatedProxy.isReady){var o=this,r=function(n){o.currentUserType=t.AuthedUser,i({status:e.DataServiceResultCode.Succeeded,value:o})},a=function(e){o.omexAuthConnectTries<OSF.Constants.AuthenticatedConnectMaxTries?(o.omexAuthConnectTries++,o.omexAuthNStatus!==OSF.OmexAuthNStatus.CheckFailed?o.anonymousProxy.prepareProxy(s,c):o.gatedProxy.prepareProxy(r,a)):(Telemetry.RuntimeTelemetryHelper.LogExceptionTag("exceed maximum tries and fail",null,n,521958851),o.anonymousProxy.prepareProxy(l,c))},s=function(e){if(e&&e.value){o.anonymousProxy.getAuthNStatusAsync({correlationId:n},(function(e){if(e.status===OSF.ProxyCallStatusCode.Succeeded){var t=e.value;t==OSF.OmexAuthNStatus.Authenticated?(o.omexAuthNStatus=OSF.OmexAuthNStatus.Authenticated,o.gatedProxy.prepareProxy(r,a)):t!=OSF.OmexAuthNStatus.Anonymous&&t!=OSF.OmexAuthNStatus.Unknown||(o.omexAuthNStatus=OSF.OmexAuthNStatus.Anonymous,o.anonymousProxy.prepareProxy(l,c))}else Telemetry.RuntimeTelemetryHelper.LogExceptionTag("auth check failure.",null,n,521958852),o.omexAuthNStatus=OSF.OmexAuthNStatus.CheckFailed,o.initParams.omexForceAnonymous?o.anonymousProxy.prepareProxy(l,c):o.gatedProxy.prepareProxy(r,a)}))}else Telemetry.RuntimeTelemetryHelper.LogExceptionTag("GetAuthNStatus callback param invalid",null,n,521958853)},l=function(n){o.omexAuthNStatus==OSF.OmexAuthNStatus.NotAttempted?s(n):(o.currentUserType=t.AnonymousUser,i({status:e.DataServiceResultCode.Succeeded,value:o}))},c=function(t){var o="";void 0!==t&&t.value&&t.value.errorMessage&&(o=t.value.errorMessage),Telemetry.RuntimeTelemetryHelper.LogExceptionTag("create anonymous proxy failure: "+o,null,n,521958854),i({status:e.DataServiceResultCode.ProxyNotReady})};o.initParams.omexForceAnonymous?o.anonymousProxy.prepareProxy(l,c):o.gatedProxy.prepareProxy(r,a)}else i({status:e.DataServiceResultCode.Succeeded,value:this})},n}();e.ProxyBasedCatalogService=n;var i=function(){function e(){}return e.dummyApplicationName="unused",e}(),o=function(){function o(e,t){this._build=OSF.Constants.FileVersion,this._catalogService=t,this._appVersion=OSF.OmexAppVersions[this._catalogService.initParams.appName],this._clientName=OSF.OmexClientNames[this._catalogService.initParams.appName],this._clientVersion=r.getClientVersionFromWACAppVersion(this._catalogService.initParams.AppVersion),this._correlationId=e.telemetryContext.correlationId||""}return o.prototype.getFirstPartyAddInList=function(e){var t=this.buildOmexRequestParameters();t.errors={},this._catalogService.anonymousProxy.getFirstPartyAddInListAsync(t,e)},o.prototype.getFirstPartyManifest=function(e,t){var n=this.buildOmexRequestParameters();n.errors={},n.manifestUrl=e,this._catalogService.anonymousProxy.getFirstPartyManifestAsync(n,t)},o.prototype.tryFail=function(t,n,i){return t!=e.DataServiceResultCode.Succeeded&&(i({status:t}),!0)},o.prototype.isUserTypeValid=function(e){return e!==t.NotDetected||(Telemetry.RuntimeTelemetryHelper.LogExceptionTag("userType is invalid.",null,this._correlationId,521958855),!1)},o.prototype.getEntitlementAsync=function(n,o,r,a){var s=this,l=this.buildOmexRequestParameters();l.applicationName=i.dummyApplicationName,l.appVersion=this._appVersion,l.clearEntitlement=o||!1;var c=this._catalogService.currentUserType;this.isUserTypeValid(c)?c===t.AuthedUser?this._catalogService.gatedProxy.getOmexEntitlementsAsync(l,(function(e){s.tryFail(e.status,e.httpStatus,a)||(s._catalogService._cid=e.value.cid,a(e))})):c===t.AnonymousUser&&a({status:e.DataServiceResultCode.Succeeded,value:{refreshRate2:0,entitlements:[]}}):a({status:e.DataServiceResultCode.UnknownUserType,value:{refreshRate2:0,entitlements:[]}})},o.prototype.getLastStoreUpdate=function(e){},o.prototype.isStoreDisabled=function(t){var i=this;n._requestHandler?n._requestHandler.isStoreDisabled(this._correlationId,(function(n,o){if(200!=n&&403!=n&&401!=n)return i.logServiceCallResponseError("isStoreDisabled",n),void t({status:e.DataServiceResultCode.Failed,value:!1});t({status:e.DataServiceResultCode.Succeeded,value:401==n||403==n})})):t({status:e.DataServiceResultCode.Succeeded,value:!1})},o.prototype.getManifest=function(t,n,i){this.getETokenAndManifestInternal(t,n,OSF.ClientAppInfoReturnType.urlOnly,(function(t){var n=t&&t.value&&t.value.manifest?t.value.manifest:"",o=t&&t.value&&t.value.status2?t.value.status2:OSF.OmexClientAppStatus.ServerError,r=t?t.status:e.DataServiceResultCode.Failed;i({status:r,value:{status2:o,manifest:n}})}))},o.prototype.getEToken=function(e,t,n){this.getETokenAndManifestInternal(e,t,OSF.ClientAppInfoReturnType.etokenOnly,n)},o.prototype.getETokenAndManifest=function(e,t,n){this.getETokenAndManifestInternal(e,t,OSF.ClientAppInfoReturnType.both,n)},o.prototype.getAppState=function(n,i){var o=this,r=this.buildOmexRequestParameters();r.assetID=n.solutionId,r.contentMarket=n.storeId,r.errors={};var a=this._catalogService.currentUserType;this.isUserTypeValid(a)?a===t.AuthedUser?this._catalogService.gatedProxy.getAppStateAsync(r,(function(e){o.tryFail(e.status,e.httpStatus,i)?o.logServiceCallResponseError("appstate",e.httpStatus):i(e)})):a===t.AnonymousUser&&this._catalogService.anonymousProxy.getAppStateAsync(r,i):i({status:e.DataServiceResultCode.UnknownUserType,value:{refreshRate2:0,assetId:"",productId:"",version:"",state2:-1}})},o.prototype.getKilledApps=function(n){var i=this,o=this.buildOmexRequestParameters(),r=this._catalogService.currentUserType;this.isUserTypeValid(r)?r===t.AuthedUser?this._catalogService.gatedProxy.getKilledAppAsync(o,(function(e){i.tryFail(e.status,e.httpStatus,n)?i.logServiceCallResponseError("killedapps",e.httpStatus):n(e)})):r===t.AnonymousUser&&this._catalogService.anonymousProxy.getKilledAppAsync(o,n):n({status:e.DataServiceResultCode.UnknownUserType,value:{refreshRate2:0,killedApps:null}})},o.prototype.getAppDetails=function(e,t,n){var i=this,o=this.buildOmexRequestParameters();o.assetid="",o.assetID=e.join(","),o.contentMarket=t,this._catalogService.ungatedProxy.getAppDetailsAsync(o,(function(e){i.tryFail(e.status,e.httpStatus,n)?i.logServiceCallResponseError("appdetails",e.httpStatus):n(e)}))},o.prototype.removeApps=function(n,i){var o=this,r=this.buildOmexRequestParameters();r.assetid="",r.assetID=n.join(",");var a=this._catalogService.currentUserType;this.isUserTypeValid(a)?a===t.AuthedUser?this._catalogService.gatedProxy.removeApps(r,(function(e){o.tryFail(e.status,e.httpStatus,i)?o.logServiceCallResponseError("removeapps",e.httpStatus):i(e)})):a===t.AnonymousUser&&i({status:e.DataServiceResultCode.Succeeded,value:{removedApps:[]}}):i({status:e.DataServiceResultCode.UnknownUserType,value:{removedApps:[]}})},o.prototype.getETokenAndManifestInternal=function(n,o,r,a){var s=this,l=this.buildOmexRequestParameters();l.applicationName=i.dummyApplicationName,l.assetID=n.solutionId,l.clientAppInfoReturnType=r;var c=this._catalogService.currentUserType;this.isUserTypeValid(c)?c===t.AuthedUser&&r!=OSF.ClientAppInfoReturnType.urlOnly?(l.assetContentMarket=o,l.userContentMarket=n.storeId,l.expectedVersion=n.version,this._catalogService.gatedProxy.getManifestAndETokenAsync(l,(function(e){s.tryFail(e.status,e.httpStatus,a)?s.logServiceCallResponseError("manifestandetoken",e.httpStatus):a(e)}))):(l.contentMarket=n.storeId,l.clientAppInfoReturnType==OSF.ClientAppInfoReturnType.etokenOnly?a({status:e.DataServiceResultCode.Succeeded,value:{status2:OSF.OmexClientAppStatus.OK,etoken:"",manifest:null}}):this._catalogService.anonymousProxy.getManifestAsync(l,(function(e){s.tryFail(e.status,e.httpStatus,a)?s.logServiceCallResponseError("manifest",e.httpStatus):a(e)}))):a({status:e.DataServiceResultCode.UnknownUserType,value:{etoken:"",manifest:null}})},o.prototype.buildOmexRequestParameters=function(){return{clientName:this._clientName,clientVersion:this._clientVersion,correlationId:this._correlationId,build:this._build}},o.prototype.logServiceCallResponseError=function(e,t){var n="proxybased request "+e+" failed";t&&(n+=":"+t),Telemetry.RuntimeTelemetryHelper.LogExceptionTag(n,null,this._correlationId,521958856)},o}();e.ProxyBasedCatalogServiceScope=o;var r=function(){function e(){}return e.getClientVersionFromWACAppVersion=function(e){if(e){var t=e.split("."),n=parseInt(t[0],10),i=parseInt(t[1],10)||0;if(!(n<=15&&i<=0)){var o=OSF.Constants.FileVersion.split(".");return n+"."+i+"."+o[2]+"."+o[3]}}},e.getOmexEndPointPageUrl=function(e,t,n){return OSF.OUtil.formatString("{0}/{1}/downloads/{2}.aspx",e,n,t)},e}();e.OmexUtils=r}(OfficeExt||(OfficeExt={})),function(e){var t=function(t){function n(e){var n=t.call(this,e)||this;return n.proxyName=OSF.Constants.OmexUnGatedServiceName,n.proxyUrl=n.osfOmexBaseUrl+OSF.Constants.OmexUnGatedServiceExtension,n}return __extends(n,t),n.prototype.getAppDetailsAsync=function(t,n){this.invokeProxyCommandAsync(e.OmexProxyMethods.UnGated_GetAppDetails,t,(function(i){null!=i.value&&i.status==e.DataServiceResultCode.Succeeded&&(i.value=e.OmexXmlProcessor.ConvertAppDetails(i.value,t.contentMarket)),n(i)}))},n}(e.OmexProxyBase);e.UnGatedOmexProxy=t}(OfficeExt||(OfficeExt={})),function(e){var t=function(){function t(e,t){this._initParam=t,this._cacheManager=e.cacheManager,this._cachePrefix=e.cachePrefix,this._cid=e.cid,this._anonymous=e.anonymous,this._telemetryContext=e.telemetryContext}return t.prototype.GetCacheKeyPrefix=function(){return this._cachePrefix},t.prototype.getOmexEndPointPageUrl=function(t,n){return e.OmexUtils.getOmexEndPointPageUrl(this._initParam.omexBaseUrl,t,n)},t.prototype.getKilledApps=function(t,n,i){var o=this;this._telemetryContext.startActivity(e.Activity.KilledAppsCheck);var r=OSF.OUtil.formatString(e.CacheConsts.killedAppsCacheKey,this.GetCacheKeyPrefix());if(i)this._cacheManager.RemoveCacheItem(r);else{var a=this._cacheManager.GetCacheItem(r,!0);if(a&&null!=a.refreshRate2)return this._telemetryContext.stopActivity(e.Activity.KilledAppsCheck),void n({status:e.DataServiceResultCode.Succeeded,value:a})}t.getKilledApps((function(t){t.status==e.DataServiceResultCode.Succeeded?(o._telemetryContext.stopActivity(e.Activity.KilledAppsCheck),a=t.value,o._cacheManager.SetCacheItem(r,a,a.refreshRate/e.CacheConsts.hourToDayConversionFactor),n(t)):n(t)}))},t.prototype.getAppState=function(t,n,i,o){var r=this;this._telemetryContext.startActivity(e.Activity.AppStateCheck);var a,s=OSF.OUtil.formatString(e.CacheConsts.appStateCacheKey,this.GetCacheKeyPrefix(),n.storeId,n.solutionId);if(o)this._cacheManager.RemoveCacheItem(s);else{var l={};if(a=this._cacheManager.GetCacheItem(s,!0,l),this._telemetryContext.setFlag(e.FlagName.AppStateDataInvalidFlag,l.cacheExpired||!1),a&&null!=a.state2)return this._telemetryContext.stopActivity(e.Activity.AppStateCheck),this._telemetryContext.setFlag(e.FlagName.AppStateDataCachedFlag,!0),void i({status:e.DataServiceResultCode.Succeeded,value:a})}t.getAppState(n,(function(t){t.status==e.DataServiceResultCode.Succeeded?(r._telemetryContext.stopActivity(e.Activity.AppStateCheck),r._telemetryContext.setFlag(e.FlagName.AppStateDataCachedFlag,!1),a=t.value,r._cacheManager.SetCacheItem(s,a,a.refreshRate2/e.CacheConsts.hourToDayConversionFactor),i(t)):i(t)}))},t.prototype.getManifest=function(t,n,i,o,r){var a,s=this;this._telemetryContext.startActivity(e.Activity.ManifestRequest);var l=OSF.OUtil.formatString(e.CacheConsts.anonymousAppInstallInfoCacheKey,n.solutionId,n.storeId);if(r)this._cacheManager.RemoveCacheItem(l);else{var c={};if(a=this._cacheManager.GetCacheItem(l,!0,c),this._telemetryContext.setFlag(e.FlagName.ManifestDataInvalidFlag,c.cacheExpired||!1),a&&null!=a.status2)return this._telemetryContext.stopActivity(e.Activity.ManifestRequest),this._telemetryContext.stopActivity(e.Activity.ServerCall),this._telemetryContext.setFlag(e.FlagName.ManifestDataCachedFlag,!0),void o({status:e.DataServiceResultCode.Succeeded,value:{status2:a.status2,manifest:a.manifest}})}t.getManifest(n,i,(function(t){t.status==e.DataServiceResultCode.Succeeded&&t.value.status2==OSF.OmexClientAppStatus.OK?(s._telemetryContext.stopActivity(e.Activity.ManifestRequest),s._telemetryContext.stopActivity(e.Activity.ServerCall),s._telemetryContext.setFlag(e.FlagName.ManifestDataCachedFlag,!1),s._telemetryContext.setBits(e.FlagName.ManifestRequestType,OSF.ManifestRequestTypes.Manifest),a={etoken:"",status2:t.value.status2,manifest:t.value.manifest},s._cacheManager.SetCacheItem(l,a,e.CacheConsts.manifestRefreshRate),o(t)):o(t)}))},t.prototype.removeApps=function(t,n,i){var o=this;t.removeApps(n,(function(t){if(t.status==e.DataServiceResultCode.Succeeded){for(var n=".*",r=!1,a=[],s=t.value.removedApps,l=0;l<s.length;++l)s[l].result2==OSF.OmexRemoveAppStatus.Success&&(a.push(new RegExp(OSF.OUtil.formatString(e.WACUtils.CacheConstants.AuthenticatedAppInstallInfoCacheKey,n,s[l].assetId,n,n),"i")),r=!0);r&&o._cacheManager.RemoveMatches(a),i(t)}else i(t)}))},t.prototype.getCachedETokenAndManifest=function(t){var n={},i=this._cacheManager.GetCacheItem(t,!0,n);if(this._telemetryContext.setFlag(e.FlagName.ManifestDataInvalidFlag,n.cacheExpired||!1),i){if(i.status2&&i.tokenExpirationDate2&&i.tokenExpirationDate2>(new Date).getTime())return i;i.etoken=null,i.tokenExpirationDate2=null,i.entitlementType=null}return i},t.prototype.getETokenAndManifest=function(t,n,i,o,r){var a=this;if(this._anonymous)this.getManifest(t,n,i,(function(t){e.AsyncUtil.failed(t,o)||o({status:t.status,value:{etoken:"",status2:t.value.status2,manifest:t.value.manifest}})}),r);else{this._telemetryContext.startActivity(e.Activity.ManifestRequest);var s,l=function(t,n){a._telemetryContext.stopActivity(e.Activity.ManifestRequest),a._telemetryContext.stopActivity(e.Activity.ServerCall),a._telemetryContext.setFlag(e.FlagName.ManifestDataCachedFlag,t),n&&a._telemetryContext.setBits(e.FlagName.ManifestRequestType,n)},c=n.solutionId,u=OSF.OUtil.formatString(e.WACUtils.CacheConstants.AuthenticatedAppInstallInfoCacheKey,this._cid,c,n.storeId,i);if(r)this._cacheManager.RemoveCacheItem(u);else{if((s=this.getCachedETokenAndManifest(u))&&s.etoken&&s.manifest)return l(!0),void o({status:e.DataServiceResultCode.Succeeded,value:s});var d=s?s.manifest:null;if(null==d||""==d){var p=OSF.OUtil.formatString(e.CacheConsts.anonymousAppInstallInfoCacheKey,c,n.storeId),f=this._cacheManager.GetCacheItem(p,!0);f&&(d=f.manifest)}if(d)return void(s&&s.etoken?(l(!0),s.manifest=d,o({status:e.DataServiceResultCode.Succeeded,value:s})):t.getEToken(n,i,(function(n){n.status===e.DataServiceResultCode.Succeeded&&n.value?t.getEntitlementAsync(!1,!0,void 0,(function(t){if(t.status!==e.DataServiceResultCode.Succeeded)return Telemetry.RuntimeTelemetryHelper.LogExceptionTag("getEntitlementAsync() failed after getEToken() succeeded",null,a._telemetryContext.correlationId,523583493),void o({status:e.DataServiceResultCode.Failed});l(!1,OSF.ManifestRequestTypes.Etoken),(s=n.value).status2===OSF.OmexClientAppStatus.OK&&(a._cacheManager.SetCacheItem(u,s,e.CacheConsts.manifestRefreshRate),s.manifest=d),o(n)})):o(n)})))}t.getETokenAndManifest(n,i,(function(n){n.status===e.DataServiceResultCode.Succeeded?t.getEntitlementAsync(!1,!0,void 0,(function(t){if(t.status!==e.DataServiceResultCode.Succeeded)return Telemetry.RuntimeTelemetryHelper.LogExceptionTag("getEntitlementAsync() failed after getETokenAndManifest() succeeded",null,a._telemetryContext.correlationId,523583494),void o({status:e.DataServiceResultCode.Failed});l(!1,OSF.ManifestRequestTypes.Both),n.value.status2===OSF.OmexClientAppStatus.OK&&a._cacheManager.SetCacheItem(u,n.value,e.CacheConsts.manifestRefreshRate),o(n)})):o(n)}))}},t.prototype.getEntitlements=function(t,n,i,o){var r,a,s=this;this._telemetryContext.startActivity(e.Activity.EntitlementCheck);var l=function(){null!=a&&null!=r&&(r=r.filter((function(e){return a.every((function(t){return t.assetId!=e.assetId}))})),i({status:e.DataServiceResultCode.Succeeded,value:{entitlements:r,killed:a}}))};this._anonymous?(r=[],this._telemetryContext.stopActivity(e.Activity.EntitlementCheck),l()):t.getEntitlementAsync(n,o,void 0,(function(t){s._telemetryContext.stopActivity(e.Activity.EntitlementCheck),null!=i&&(e.AsyncUtil.failed(t,i)?i=null:(s._cid||(s._cid=t.value.cid),r=t.value.entitlements,l()))})),this.getKilledApps(t,(function(t){null!=i&&(a=t.status==e.DataServiceResultCode.Succeeded?t.value.killedApps:[],l())}))},t.prototype.activate=function(t,n,i){var o,r,a=this,s=n,l=s.solutionId,c=s.version,u=!1,d=this.getOmexEndPointPageUrl(l,s.storeId),p=e.HostFeatureEnabledInfo.getHostFeatureEnabledInfo(),f=function(r,u){switch(r.status2){case OSF.OmexClientAppStatus.OK:if(r.tokenExpirationDate2&&r.tokenExpirationDate2<=(new Date).getTime())return void e.LoaderUtil.failWithWarning(i,e.LoaderUtil.warning({description:Strings.OsfRuntime.L_AgaveLicenseExpired_ERR,buttonTxt:Strings.OsfRuntime.L_RetryButton_TXT,buttonCallback:function(){return m()},errorCode:OSF.ErrorStatusCodes.E_TOKEN_EXPIRED}));var f=e.ManifestUtil.ParseManifest(r.manifest,a._initParam.appUILocale,a._telemetryContext.correlationId);if(null==f)return void e.LoaderUtil.failWithError(i,{infoType:OSF.InfoType.Error,buttonTxt:Strings.OsfRuntime.L_RetryButton_TXT,buttonCallback:function(){i.restartActivation(),a.restartActivationTelemetry(),m()},description:Strings.OsfRuntime.L_AgaveManifestRetrieve_ERR,errorCode:OSF.ErrorStatusCodes.E_MANIFEST_INVALID_VALUE_FORMAT});var g=f.getMarketplaceVersion();if(OSF.OsfManifestManager.cacheManifest(l,c,f),!1===f.requirementsSupported||void 0===f.requirementsSupported&&!i.getRequirementsChecker().isManifestSupported(f)){f.requirementsSupported=!1;var v;return v=Strings.OsfRuntime.L_AgaveManifestRequirementsErrorOmex_ERR||Strings.OsfRuntime.L_AgaveManifestError_ERR,void e.LoaderUtil.failWithError(i,{description:v,url:d,detailView:!0,errorCode:OSF.ErrorStatusCodes.WAC_AgaveRequirementsErrorOmex})}f.requirementsSupported=!0,a._telemetryContext.setFlag(e.FlagName.ManifestTrustCachedFlag,!u);var S=OSF.OUtil.formatString(OSF.Constants.ActivatedCacheKey,l.toLowerCase(),n.storeType,n.storeId);if(u&&!i.skipTrust(n)){var _=OSF.OmexClientNames[a._initParam.appName];if(!(a._anonymous&&a._cacheManager.GetCacheItem(S,!1))&&!i.hasConsent(n)&&!i.isForCustomFunctionSandbox())return void i.askForTrust({anonymous:!1,clientName:_,entitlement:s,displayName:f.getDefaultDisplayName(),providerName:f.getProviderName(),iconUrl:f.getDefaultIconUrl(),url:d,isSSOAddin:f.isSSOAddin()},(function(){a.restartActivationTelemetry(),a._cacheManager.SetCacheItem(S,!0),a._anonymous?i.load({entitlement:s,manifest:f,eToken:r.etoken},null):a.getETokenAndManifest(t,s,s.storeId,(function(t){t.status==e.DataServiceResultCode.Succeeded&&t.value.status2==OSF.OmexClientAppStatus.OK?(null!=t.value.version&&e.ManifestUtil.versionLessThan(s.version,t.value.version)&&(s.version=t.value.version),y(!1)):e.LoaderUtil.failWithError(i,{infoType:OSF.InfoType.Error,buttonTxt:Strings.OsfRuntime.L_RetryButton_TXT,buttonCallback:function(){i.restartActivation(),a.restartActivationTelemetry(),m()},description:OSF.OUtil.formatString(Strings.OsfRuntime.L_AgaveServerConnectionToCatalogFailed_ERR,Strings.OsfRuntime.L_AgaveOmexCatalogName),errorCode:OSF.ErrorStatusCodes.WAC_AgaveManifestAndEtokenRequestFailure})}))}))}i.hasConsent(n)&&a._cacheManager.SetCacheItem(S,!0);var C=o.version;e.ManifestUtil.versionLessThan(C,n.version)&&(C=n.version),e.ManifestUtil.versionLessThan(g,C)?(s.version=C,e.LoaderUtil.showWarning(i,{description:Strings.OsfRuntime.L_AgaveNewerVersion_ERR,buttonTxt:Strings.OsfRuntime.L_UpdateButton_TXT,buttonCallback:function(){i.restartActivation(),a.restartActivationTelemetry(),i.setIsUpgrading(!0),i.setUpgradingFailed(!1),m(!0),h()},url:d,highPriority:!0,displayDeactive:!1,errorCode:OSF.ErrorStatusCodes.E_MANIFEST_UPDATE_AVAILABLE})):o.state2===OSF.OmexState.DeveloperWithdrawn?e.LoaderUtil.showWarning(i,{description:Strings.OsfRuntime.L_AgaveRetiring_ERR,buttonTxt:Strings.OsfRuntime.L_OkButton_TXT,url:d,displayDeactive:!1,errorCode:OSF.ErrorStatusCodes.S_OEM_EXTENSION_DEVELOPER_WITHDRAWN_FROM_SALE}):o.state2===OSF.OmexState.Flagged?e.LoaderUtil.showWarning(i,{description:Strings.OsfRuntime.L_AgaveSoftKilled_ERR,buttonTxt:Strings.OsfRuntime.L_OkButton_TXT,url:d,displayDeactive:!1,errorCode:OSF.ErrorStatusCodes.S_OEM_EXTENSION_FLAGGED}):!a._anonymous&&r.entitlementType&&r.entitlementType.toLowerCase()===OSF.OmexEntitlementType.Trial&&(e.LoaderUtil.showNotification(i,{description:Strings.OsfRuntime.L_AgaveTrial_ERR,buttonTxt:Strings.OsfRuntime.L_BuyButton_TXT,buttonCallback:function(){return window.open(d)},reDisplay:!0,highPriority:!0,displayDeactive:!1,errorCode:OSF.ErrorStatusCodes.S_OEM_EXTENSION_TRIAL_MODE}),e.LoaderUtil.showNotification(i,{description:Strings.OsfRuntime.L_AgaveTrialRefresh_ERR,buttonTxt:Strings.OsfRuntime.L_RefreshButton_TXT,buttonCallback:function(){i.restartActivation(),a.restartActivationTelemetry(),m(!0)},detailView:!0,reDisplay:!0,highPriority:!0,displayDeactive:!1,errorCode:OSF.ErrorStatusCodes.S_USER_CLICKED_BUY})),i.load({entitlement:s,manifest:f,eToken:r.etoken},null);break;case OSF.OmexClientAppStatus.KilledAsset:e.LoaderUtil.failWithError(i,{description:Strings.OsfRuntime.L_AgaveDisabledByOmex_ERR,url:d,errorCode:OSF.ErrorStatusCodes.E_OEM_OMEX_EXTENSION_KILLED});break;case OSF.OmexClientAppStatus.NoEntitlement:case OSF.OmexClientAppStatus.TrialNotSupported:case OSF.OmexClientAppStatus.LimitedTrial:case OSF.OmexClientAppStatus.EntitlementDeactivated:if(a._anonymous){e.LoaderUtil.failWithError(i,{title:Strings.OsfRuntime.L_AgaveSigninRequiredTitle_TXT,description:Strings.OsfRuntime.L_AgaveNotViewableAnonymous_ERR,buttonTxt:Strings.OsfRuntime.L_SignInButton_TXT,buttonCallback:function(){var e=window.location.href,t=a._initParam.omexBaseUrl+OSF.Constants.SignInRedirectUrl+encodeURIComponent(e);window.open(t)},errorCode:OSF.ErrorStatusCodes.E_USER_NOT_SIGNED_IN})}else{i.setRetryCall((function(){a.restartActivationTelemetry(),m(!0)})),e.LoaderUtil.failWithWarning(i,{description:Strings.OsfRuntime.L_AgaveLicenseNotAquired_ERR,buttonTxt:Strings.OsfRuntime.L_BuyButton_TXT,buttonCallback:function(){window.open(d),e.LoaderUtil.showWarning(i,{description:Strings.OsfRuntime.L_AgaveLicenseNotAquiredRefresh_ERR,buttonTxt:Strings.OsfRuntime.L_RefreshButton_TXT,buttonCallback:function(){i.restartActivation(),a.restartActivationTelemetry(),m(!0)},detailView:!0,retryAll:!0,errorCode:OSF.ErrorStatusCodes.E_OEM_EXTENSION_NOT_ENTITLED})},errorCode:OSF.ErrorStatusCodes.E_OEM_EXTENSION_NOT_ENTITLED})}break;case OSF.OmexClientAppStatus.UnknownAssetId:e.LoaderUtil.failWithError(i,{description:Strings.OsfRuntime.L_AgaveNotExist_ERR,errorCode:OSF.ErrorStatusCodes.E_MANIFEST_DOES_NOT_EXIST});break;case OSF.OmexClientAppStatus.Expired:case OSF.OmexClientAppStatus.Invalid:e.LoaderUtil.failWithWarning(i,{description:Strings.OsfRuntime.L_AgaveLicenseExpired_ERR,buttonTxt:Strings.OsfRuntime.L_RetryButton_TXT,buttonCallback:function(){i.restartActivation(),a.restartActivationTelemetry(),m()},errorCode:OSF.ErrorStatusCodes.E_TOKEN_EXPIRED});break;case OSF.OmexClientAppStatus.Revoked:e.LoaderUtil.failWithError(i,{description:Strings.OsfRuntime.L_AgaveRetired_ERR,url:d,errorCode:OSF.ErrorStatusCodes.E_OEM_EXTENSION_WITHDRAWN_FROM_SALE});break;case OSF.OmexClientAppStatus.VersionMismatch:s.version=r.version,i.askForUpgrade(e.LoaderUtil.warning({description:Strings.OsfRuntime.L_AgaveNewerVersion_ERR,buttonTxt:Strings.OsfRuntime.L_UpdateButton_TXT,url:d,highPriority:!0,logAsError:!0,errorCode:OSF.ErrorStatusCodes.E_MANIFEST_UPDATE_AVAILABLE}),(function(){a.restartActivationTelemetry(),i.setIsUpgrading(!0),i.setUpgradingFailed(!1),m(!0)}));break;case OSF.OmexClientAppStatus.VersionNotSupported:e.LoaderUtil.failWithWarning(i,{description:Strings.OsfRuntime.L_AgaveUnsupportedStoreType_ERR,errorCode:OSF.ErrorStatusCodes.WAC_AgaveUnsupportedStoreType},OSF.OsfControlStatus.UnsupportedStore);break;case OSF.OmexClientAppStatus.UserIsMinor:p&&p.enableDisplayBlockedMinorError&&e.LoaderUtil.failWithError(i,{description:Strings.OsfRuntime.L_AgaveDisabledForMinor_ERR,errorCode:OSF.ErrorStatusCodes.E_TRUSTCENTER_APP_BLOCKED_FOR_MINOR});break;default:Telemetry.RuntimeTelemetryHelper.LogExceptionTag("unknown clientAppStatus in manifestAndEtoken: "+r.status2,null,a._telemetryContext.correlationId,523583495),e.LoaderUtil.failWithError(i,{description:OSF.OUtil.formatString(Strings.OsfRuntime.L_AgaveServerConnectionToCatalogFailed_ERR,Strings.OsfRuntime.L_AgaveOmexCatalogName),buttonTxt:Strings.OsfRuntime.L_RetryButton_TXT,buttonCallback:function(){i.restartActivation(),a.restartActivationTelemetry(),m(!0)},errorCode:OSF.ErrorStatusCodes.WAC_AgaveUnknownClientAppStatus})}},m=function(n){var l=r?r.contentMarket:s.storeId,c=function(t,o){return t.status!=e.DataServiceResultCode.Succeeded&&(p&&p.enableDisplayBlockedMinorError&&451===t.httpStatus?(e.LoaderUtil.failWithError(i,{description:Strings.OsfRuntime.L_AgaveDisabledForMinor_ERR,errorCode:OSF.ErrorStatusCodes.E_TRUSTCENTER_APP_BLOCKED_FOR_MINOR}),!0):(e.LoaderUtil.failWithError(i,{description:OSF.OUtil.formatString(Strings.OsfRuntime.L_AgaveServerConnectionToCatalogFailed_ERR,Strings.OsfRuntime.L_AgaveOmexCatalogName),buttonTxt:Strings.OsfRuntime.L_RetryButton_TXT,buttonCallback:function(){i.restartActivation(),a.restartActivationTelemetry(),m(n)},errorCode:o}),!0))};i.skipTrust(s)?a.getManifest(t,s,l,(function(e){if(c(e,OSF.ErrorStatusCodes.WAC_AgaveManifestRequestFailure))i.getIsUpgrading()&&(i.setUpgradingFailed(!0),i.setIsUpgrading(!1));else{if(n)return o=null,void v(!0);i.getIsUpgrading()&&i.setIsUpgrading(!1),f({etoken:"",status2:e.value.status2,manifest:e.value.manifest})}}),n):a.getETokenAndManifest(t,s,l,(function(e){if(c(e,OSF.ErrorStatusCodes.WAC_AgaveManifestAndEtokenRequestFailure))i.getIsUpgrading()&&(i.setUpgradingFailed(!0),i.setIsUpgrading(!1));else{if(n)return o=null,u=!1,y(!1),void v(!0);i.getIsUpgrading()&&i.setIsUpgrading(!1),f(e.value)}}),n)},h=function(){var t,n=s.solutionId;t=OSF.OUtil.formatString(e.CacheConsts.anonymousAppInstallInfoCacheKey,n,s.storeId),a._cacheManager.RemoveCacheItem(t)},g=function(){if(null!=o&&u){if(null!=r)return s.version=r.version,void m();var l,c,p;if(o.state2===OSF.OmexState.Flagged?l=!0:o.state2===OSF.OmexState.DeveloperWithdrawn?c=!0:o.state2===OSF.OmexState.Withdrawn&&(p=!0),!(l||c||p)||(e.LoaderUtil.failWithError(i,{description:Strings.OsfRuntime.L_AgaveRetired_ERR,url:d,errorCode:OSF.ErrorStatusCodes.E_OEM_EXTENSION_WITHDRAWN_FROM_SALE}),!l))if(i.hasConsent(n))m();else{var h=r?r.contentMarket:s.storeId;a.getManifest(t,s,h,(function(t){t.status==e.DataServiceResultCode.Succeeded?f({etoken:"",status2:t.value.status2,manifest:t.value.manifest},!0):e.LoaderUtil.failWithError(i,{description:OSF.OUtil.formatString(Strings.OsfRuntime.L_AgaveServerConnectionToCatalogFailed_ERR,Strings.OsfRuntime.L_AgaveOmexCatalogName),buttonTxt:Strings.OsfRuntime.L_RetryButton_TXT,buttonCallback:function(){i.restartActivation(),a.restartActivationTelemetry(),g()},errorCode:OSF.ErrorStatusCodes.WAC_AgaveManifestRequestFailure})}))}}},y=function(n){r=null,u=!1,a.getEntitlements(t,!1,(function(t){if(t.status!=e.DataServiceResultCode.Succeeded)return p&&p.enableDisplayBlockedMinorError&&451===t.httpStatus?void e.LoaderUtil.failWithError(i,{description:Strings.OsfRuntime.L_AgaveDisabledForMinor_ERR,errorCode:OSF.ErrorStatusCodes.E_TRUSTCENTER_APP_BLOCKED_FOR_MINOR}):void e.LoaderUtil.failWithError(i,{description:OSF.OUtil.formatString(Strings.OsfRuntime.L_AgaveServerConnectionToCatalogFailed_ERR,Strings.OsfRuntime.L_AgaveOmexCatalogName),buttonTxt:Strings.OsfRuntime.L_RetryButton_TXT,buttonCallback:function(){i.restartActivation(),y(!1)},errorCode:OSF.ErrorStatusCodes.WAC_AgaveEntitlementRequestFailure});var n=s.solutionId;t.value.killed.some((function(e){return e.assetId==n}))?e.LoaderUtil.failWithError(i,{description:Strings.OsfRuntime.L_AgaveDisabledByOmex_ERR,url:d,errorCode:OSF.ErrorStatusCodes.E_OEM_OMEX_EXTENSION_KILLED}):(t.value.entitlements.some((function(e){var t=s.solutionId;return e.assetId.toLowerCase()==t.toLowerCase()&&(r=e,d=a.getOmexEndPointPageUrl(e.assetId,e.contentMarket),!0)})),a._telemetryContext.setFlag(e.FlagName.OmexHasEntitlementFlag,null!=r),u=!0,g())}),n)},v=function(n){o=null,a.getAppState(t,s,(function(t){if(t.status!=e.DataServiceResultCode.Succeeded)return o={state2:OSF.OmexState.OK,productId:null,assetId:s.solutionId,version:s.version,refreshRate2:0},void g();t.value.state2!==OSF.OmexState.Killed?(o=t.value,g()):e.LoaderUtil.failWithError(i,{description:Strings.OsfRuntime.L_AgaveDisabledByOmex_ERR,url:d,errorCode:OSF.ErrorStatusCodes.E_OEM_OMEX_EXTENSION_KILLED})}),n)};v(),y(!1)},t.prototype.restartActivationTelemetry=function(){this._telemetryContext.startActivity(e.Activity.Activation),this._telemetryContext.startActivity(e.Activity.ServerCall),this._telemetryContext.setFlag(e.FlagName.AnonymousFlag,this._anonymous)},t}(),n=function(){function n(t,n){void 0===n&&(n=null),this._anonymous=!0,this._isDisabled=null,this._initParam=t,this._cacheManager=n||new e.AppsDataCacheManager(OSF.OUtil.getLocalStorage(),new e.SafeSerializer)}return n.prototype.GetCacheKeyPrefix=function(){return this._anonymous?e.CacheConsts.anonymousCacheKeyPrefix:e.WACUtils.CacheConstants.GatedCacheKeyPrefix},n.prototype.getOmexEndPointPageUrl=function(e,t){return OSF.OUtil.formatString("{0}/{1}/downloads/{2}.aspx",this._initParam.omexBaseUrl,t,e)},n.prototype.getDataService=function(t,n){var i=this;if(null==this._dataService)if(null==this._dataServiceReady){this._dataServiceReady=n;var o={status:e.DataServiceResultCode.Failed,value:null},r=function(t,n){var r=i._dataServiceReady;i._dataServiceReady=null,t.status==e.DataServiceResultCode.Succeeded?(i._anonymous=t.value.anonymous,i._dataService=n,o.value=n,o.status=e.DataServiceResultCode.Succeeded,r(o)):(o.httpStatus=t.httpStatus,r(o))};t.startActivity(e.Activity.Authentication);var a=OSF.OUtil.checkFlight(OSF.FlightTreatmentNames.MosForOmexEnabled)?new e.MosCatalogServiceForOmex(this._initParam):new e.S2SOmexCatalogService(this._initParam);a.initialize(t.correlationId,(function(n){if(n.status==e.DataServiceResultCode.Succeeded){var o=e.HostFeatureEnabledInfo.getHostFeatureEnabledInfo();if(!o||!o.enableAnonymousUseLegacyCatalogService||!n.value.anonymous)return t.stopActivity(e.Activity.Authentication),void r(n,a)}t.setBits(e.FlagName.ActivationRuntimeType,OSF.ActivationTypes.V2Enabled);var s=e.ProxyBasedCatalogService.getInstance(i._initParam);s.prepareProxy(t.correlationId,(function(n){t.stopActivity(e.Activity.Authentication),t.setBits(e.FlagName.RetryCount,s.omexAuthConnectTries),r(n,s)}))}))}else{t.startActivity(e.Activity.Authentication);var s=this._dataServiceReady;this._dataServiceReady=function(i){t.stopActivity(e.Activity.Authentication),s(i),n(i)}}else n({status:e.DataServiceResultCode.Succeeded,value:this._dataService})},n.prototype.createActivityScope=function(n,i){var o=this;this.getDataService(n,(function(r){if(e.AsyncUtil.failed(r,i))Telemetry.RuntimeTelemetryHelper.LogExceptionTag("failed to get data service.",null,n.correlationId,523583496);else{n.setFlag(e.FlagName.AnonymousFlag,o._anonymous);var a=r.value,s={cacheManager:o._cacheManager,cachePrefix:o.GetCacheKeyPrefix(),cid:a.getCID(),anonymous:o._anonymous,telemetryContext:n},l=a.createScope(s),c=new t(s,o._initParam);i({status:e.DataServiceResultCode.Succeeded,value:{serviceScope:l,activityScope:c}})}}))},n.prototype.getEntitlementAsync=function(t,n,i,o,r){var a=this;this.createActivityScope(n,(function(n){e.AsyncUtil.failed(n,i,[])||(a._anonymous?i({status:e.DataServiceResultCode.Failed,httpStatus:403}):n.value.serviceScope.getEntitlementAsync(t,o,r,(function(t){if(!e.AsyncUtil.failed(t,i,[])){for(var n=t.value.entitlements,o=0;o<n.length;o++){var r=n[o],a=r;a.solutionId=r.assetId,a.assetStoreId=r.contentMarket,a.storeId=r.contentMarket,a.storeType=OSF.StoreType.OMEX,a.targetType=OSF.OUtilWac.getTargetType(r.appSubType)}i({status:t.status,value:n})}})))}))},n.prototype.getAndCacheManifest=function(t,n,i,o,r){var a=this;r=r||!1;var s=OSF.OsfManifestManager.getCachedManifest(t.solutionId,t.version);r||null==s?this.createActivityScope(i,(function(s){if(!e.AsyncUtil.failed(s,o)){var l=s.value.serviceScope;s.value.activityScope.getManifest(l,t,n,(function(n){if(!e.AsyncUtil.failed(n,o))if(n.value.status2==OSF.OmexClientAppStatus.OK){var r=e.ManifestUtil.ParseManifest(n.value.manifest,a._initParam.appUILocale,i.correlationId);null!=r?(OSF.OsfManifestManager.cacheManifest(t.solutionId,t.version,r),o({status:e.DataServiceResultCode.Succeeded,value:r})):o({status:e.DataServiceResultCode.Failed,value:r})}else o({status:e.DataServiceResultCode.Failed})}),r)}})):o({status:e.DataServiceResultCode.Succeeded,value:s})},n.prototype.activateAsync=function(t,n,i){var o=this,r={solutionId:t.solutionId,version:t.version,storeType:t.storeType,storeId:t.storeId,assetId:t.solutionId,assetStoreId:t.storeId,targetType:t.targetType};i.startActivity(e.Activity.Activation),i.startActivity(e.Activity.ServerCall),this.createActivityScope(i,(function(a){o.isStoreDisabled(i,(function(s){if(!0===s.value)e.LoaderUtil.failWithError(n,{description:Strings.OsfRuntime.L_OmexStoreDisabledByAdmin,errorCode:OSF.ErrorStatusCodes.E_TRUSTCENTER_CATALOG_UNTRUSTED_ADMIN_CONTROLLED});else if(a.status!=e.DataServiceResultCode.Succeeded)e.LoaderUtil.failWithError(n,{description:OSF.OUtil.formatString(Strings.OsfRuntime.L_AgaveServerConnectionToCatalogFailed_ERR,Strings.OsfRuntime.L_AgaveOmexCatalogName),buttonTxt:Strings.OsfRuntime.L_RetryButton_TXT,buttonCallback:function(){n.restartActivation(),o.activateAsync(t,n,i)},errorCode:OSF.ErrorStatusCodes.WAC_AgaveAnonymousProxyCreationError});else{var l=a.value.serviceScope;a.value.activityScope.activate(l,r,n)}}))}))},n.prototype.removeAsync=function(t,n,i){this.createActivityScope(n,(function(n){if(!e.AsyncUtil.failed(n,i)){var o=n.value.serviceScope;n.value.activityScope.removeApps(o,t,i)}}))},n.prototype.getAppDetails=function(t,n,i,o,r){var a=this,s=[],l=[];if(r)this._cacheManager.RemoveAll(e.CacheConsts.ungatedCacheKeyPrefix),l=t;else for(var c=0;c<t.length;++c){var u=OSF.OUtil.isChangeGateEnabled("OfficeVSO:7799078_CultureAwareAppDetailKey")?OSF.OUtil.formatString(e.CacheConsts.appDetailKey,t[c].solutionId,t[c].storeId.toUpperCase()):OSF.OUtil.formatString(e.CacheConsts.appDetailKey,t[c].solutionId),d=this._cacheManager.GetCacheItem(u,!0);d&&null!=d.storeType?s.push(d):l.push(t[c])}var p={},f=0;for(c=0;c<l.length;c++){var m=l[c];p[m.storeId]?p[m.storeId].push(m.solutionId):(++f,p[m.storeId]=[m.solutionId])}0!==f?this.createActivityScope(i,(function(t){if(!e.AsyncUtil.failed(t,o,s)){var n=t.value.serviceScope,i=f,r=function(t){if(--i,t.status==e.DataServiceResultCode.Succeeded&&t.value&&t.value.length&&t.value.length>0)for(var n=t.value,r=0;r<n.length;++r){var l=n[r],c=OSF.OUtil.isChangeGateEnabled("OfficeVSO:7799078_CultureAwareAppDetailKey")?OSF.OUtil.formatString(e.CacheConsts.appDetailKey,l.solutionId,l.storeId.toUpperCase()):OSF.OUtil.formatString(e.CacheConsts.appDetailKey,l.solutionId);a._cacheManager.SetCacheItem(c,l),s.push(l)}if(0>=i){var u={value:s,status:e.DataServiceResultCode.Succeeded};o(u)}else;};for(var l in p)n.getAppDetails(p[l],l,r)}})):o({status:e.DataServiceResultCode.Succeeded,value:s})},n.prototype.isStoreDisabled=function(t,n,i){var o=this;if(null!=this._isDisabled)n({status:e.DataServiceResultCode.Succeeded,value:this._isDisabled});else{var r=this.GetCacheKeyPrefix()+"_isStoreDisabledOmex";this.createActivityScope(t,(function(t){if(t.status!=e.DataServiceResultCode.Succeeded){var i=o._cacheManager.GetCacheItem(r),a=null!=i&&i;if(e.AsyncUtil.failed(t,n,a))return}t.value.serviceScope.isStoreDisabled((function(t){t.status===e.DataServiceResultCode.Succeeded&&(o._isDisabled=t.value,o._cacheManager.SetCacheItem(r,o._isDisabled)),n(t)}))}))}},n.prototype.getAppState=function(t,n,i,o){this.createActivityScope(n,(function(n){if(!e.AsyncUtil.failed(n,i,{state2:OSF.OmexState.OK,productId:null,assetId:t.solutionId,version:t.version,refreshRate2:0})){var r=n.value.serviceScope;n.value.activityScope.getAppState(r,t,i,o)}}))},n}();e.OmexCatalog=n,e.CatalogFactory.register(OSF.StoreType.OMEX,(function(t){if(t.allowExternalMarketplace&&t.osfOmexBaseUrl){var i,o=t.osfOmexBaseUrl.indexOf(OSF.Constants.ProtocolSeparator);i=o>=0?t.osfOmexBaseUrl.substr(o):OSF.Constants.ProtocolSeparator+t.osfOmexBaseUrl;var r=OSF.Constants.Https+i;return OSF.OUtil.getQueryStringParamValue(window.location.search,OSF.Constants.OmexForceAnonymousParamName).toLowerCase()==OSF.Constants.OmexForceAnonymousParamValue.toLowerCase()&&(t.omexForceAnonymous=!0),new n({appName:t.appName,appUILocale:t.appUILocale,AppVersion:t.appVersion,clientMode:t.clientMode,docUrl:t.docUrl,omexBaseUrl:r,omexForceAnonymous:t.omexForceAnonymous})}return new e.ForbiddenCatalog({loaderParams:null,loaderParamsFunction:function(){return e.LoaderUtil.error({description:Strings.OsfRuntime.L_AgaveOmexNotConfigured_ERR,errorCode:OSF.ErrorStatusCodes.E_TRUSTCENTER_CATALOG_UNTRUSTED_ADMIN_CONTROLLED})},controlStatus:OSF.OsfControlStatus.ActivationFailed})}))}(OfficeExt||(OfficeExt={})),function(e){var t=function(){function e(){}return e.anonymousCacheKeyPrefix="__OSF_ANONYMOUS_OMEX.",e.ungatedCacheKeyPrefix="__OSF_OMEX.",e.manifestRefreshRate=1825,e.hourToDayConversionFactor=24,e.anonymousAppInstallInfoCacheKey=e.anonymousCacheKeyPrefix+"appInstallInfo.{0}.{1}",e.firstPartyAddinListCacheKey=e.anonymousCacheKeyPrefix+"firstPartyAddInList",e.firstPartyManifestCacheKey=e.anonymousCacheKeyPrefix+"firstPartyManifest.{0}",e.killedAppsCacheKey="{0}killedApps",e.appStateCacheKey="{0}appState.{1}.{2}",e.appDetailKey=OSF.OUtil.isChangeGateEnabled("OfficeVSO:7799078_CultureAwareAppDetailKey")?"__OSF_OMEX.appDetails.{0}.{1}":"__OSF_OMEX.appDetails.{0}",e}();e.CacheConsts=t}(OfficeExt||(OfficeExt={})),function(e){var t=function(){function t(e,t,n){this._handler=e,this._initParam=t,this._cacheManager=n.cacheManager,this._cachePrefix=n.cachePrefix,this._cid=n.cid,this._correlationId=n.telemetryContext.correlationId}return t.prototype.tryFail=function(t,n){return 200!=t&&(n({httpStatus:t,status:e.DataServiceResultCode.Failed}),!0)},t.prototype.getLastStoreUpdate=function(t){var n=this,i=this._initParam.appUILocale;this._handler.getLastStoreUpdate(i,this._correlationId,(function(i,o){if(n.tryFail(i,t))n.logServiceCallResponseError("laststoreupdate",i);else{var r,a=e.DataServiceResultCode.Succeeded;try{r=e.OmexXmlProcessor.ProcessLastStoreUpdate(o)}catch(t){Telemetry.RuntimeTelemetryHelper.LogExceptionTag("GetLastStoreUpdate parsing error",t,n._correlationId,537802126),a=e.DataServiceResultCode.Failed}t({status:a,value:r})}}))},t.prototype.getEntitlementAsync=function(t,n,i,o){var r=this,a=OSF.OmexAppVersions[this._initParam.appName],s=OSF.OUtil.formatString(this._cachePrefix+e.WACUtils.CacheConstants.EntitlementsKey,a,this._cid);if(n)this._cacheManager.RemoveCacheItem(s);else{var l=this._cacheManager.GetCacheItem(s,!0,null,i);if(null!=l)return void o({status:e.DataServiceResultCode.Succeeded,value:l})}this._handler.getEntitlement(t,a,this._correlationId,(function(t,n){if(r.tryFail(t,o))r.logServiceCallResponseError("entitlement",t);else{var i,a=e.DataServiceResultCode.Succeeded;try{(i=e.OmexXmlProcessor.ProcessEntitlement(n)).cid=r._cid,r._cacheManager.SetCacheItem(s,i,i.refreshRate2/e.CacheConsts.hourToDayConversionFactor)}catch(t){Telemetry.RuntimeTelemetryHelper.LogExceptionTag("GetEntitlement parsing error",t,r._correlationId,537802127),a=e.DataServiceResultCode.Failed}o({status:a,value:i})}}))},t.prototype.getEToken=function(t,n,i){var o=this,r=n,a=t.storeId,s=t.solutionId,l=t.version;this._handler.getEToken(a,r,s,l,this._correlationId,(function(t,n){if(o.tryFail(t,i))o.logServiceCallResponseError("etoken",t);else{var r,a=e.DataServiceResultCode.Succeeded;try{r=e.OmexXmlProcessor.ProcessClientAppInstallInfo(n,OSF.ClientAppInfoReturnType.etokenOnly)}catch(t){Telemetry.RuntimeTelemetryHelper.LogExceptionTag("GetEToken parsing error",t,o._correlationId,537802128),a=e.DataServiceResultCode.Failed}i({status:a,value:r})}}))},t.prototype.getETokenAndManifest=function(t,n,i){var o=this;this.getEToken(t,n,(function(r){r.status==e.DataServiceResultCode.Succeeded?o.getManifest(t,n,(function(t){if(t.status!=e.DataServiceResultCode.Succeeded)return r.status=t.status,r.httpStatus=t.httpStatus,void i(r);r.value.manifest=t.value.manifest,i(r)})):i(r)}))},t.prototype.getManifest=function(t,n,i){var o=this,r=n;this._handler.getManifest(r,t.solutionId,this._correlationId,(function(t,n){var r,a=e.DataServiceResultCode.Succeeded;try{r=e.OmexXmlProcessor.ConvertAnonymousManifest(t,n)}catch(t){Telemetry.RuntimeTelemetryHelper.LogExceptionTag("GetManifest parsing error",t,o._correlationId,537802129),a=e.DataServiceResultCode.Failed}i({status:a,value:r})}))},t.prototype.getAppState=function(t,n){var i=this,o=t.storeId+":"+t.solutionId;this._handler.getAppState(o,this._correlationId,(function(t,o){if(i.tryFail(t,n))i.logServiceCallResponseError("appstate",t);else{var r,a=e.DataServiceResultCode.Succeeded;try{r=e.OmexXmlProcessor.ProcessAppState(o)}catch(t){Telemetry.RuntimeTelemetryHelper.LogExceptionTag("GetAppState parsing error",t,i._correlationId,537802130),a=e.DataServiceResultCode.Failed}n({status:a,value:r})}}))},t.prototype.getKilledApps=function(t){var n=this;this._handler.getKilledApps(this._correlationId,(function(i,o){if(n.tryFail(i,t))n.logServiceCallResponseError("killedapps",i);else{var r,a=e.DataServiceResultCode.Succeeded;try{r=e.OmexXmlProcessor.ProcessKilledApps(o)}catch(t){Telemetry.RuntimeTelemetryHelper.LogExceptionTag("GetKilledApps parsing error",t,n._correlationId,537802131),a=e.DataServiceResultCode.Failed}t({status:a,value:r})}}))},t.prototype.getAppDetails=function(t,n,i){var o=this;this._handler.getAppDetails(n,t.join(","),this._correlationId,(function(t,r){if(o.tryFail(t,i))o.logServiceCallResponseError("appdetails",t);else{var a,s=e.DataServiceResultCode.Succeeded;try{a=e.OmexXmlProcessor.ProcessAppDetails(r,n)}catch(t){Telemetry.RuntimeTelemetryHelper.LogExceptionTag("GetAppDetails parsing error",t,o._correlationId,537802132),s=e.DataServiceResultCode.Failed}i({status:s,value:a})}}))},t.prototype.removeApps=function(t,n){var i=this;this._handler.removeApps(t.join(","),this._correlationId,(function(t,o){if(i.tryFail(t,n))i.logServiceCallResponseError("removeapps",t);else{var r,a=e.DataServiceResultCode.Succeeded;try{(r=e.OmexXmlProcessor.ProcessRemoveAppResponse(o)).removedApps.some((function(e){return e.result2==OSF.OmexRemoveAppStatus.Success}))&&i.clearEntitlementCache()}catch(t){Telemetry.RuntimeTelemetryHelper.LogExceptionTag("RemoveApps parsing error",t,i._correlationId,537802133),a=e.DataServiceResultCode.Failed}n({status:a,value:r})}}))},t.prototype.clearEntitlementCache=function(){var t=new RegExp(OSF.OUtil.formatString(e.WACUtils.CacheConstants.EntitlementsKey,".*",".*"),"i");this._cacheManager.RemoveMatches([t])},t.prototype.isStoreDisabled=function(t){var n=this;this._handler.isStoreDisabled(this._correlationId,(function(i,o){if(200!=i&&403!=i&&401!=i)return n.logServiceCallResponseError("isStoreDisabled",i),void t({status:e.DataServiceResultCode.Failed,value:!1});t({status:e.DataServiceResultCode.Succeeded,value:401==i||403==i})}))},t.prototype.logServiceCallResponseError=function(e,t){var n="s2s request "+e+" failed";t&&(n+=":"+t),Telemetry.RuntimeTelemetryHelper.LogExceptionTag(n,null,this._correlationId,521958849)},t}();e.OmexCatalogServiceS2SScope=t;var n=function(){function n(e){this._cid="",this._initParam=e}return n.initRequestHandler=function(e){null==n._requestHandler&&(n._requestHandler=e)},n.prototype.getCID=function(){return this._cid},n.prototype.initialize=function(t,i){var o=this;null!=n._requestHandler?this._initParam.omexForceAnonymous?i({status:e.DataServiceResultCode.Succeeded,value:{anonymous:!0}}):n._requestHandler.getUserId(t,(function(n,r){200==n?(o._cid=r.trim(),i({status:e.DataServiceResultCode.Succeeded,value:{anonymous:!1}})):403==n?i({status:e.DataServiceResultCode.Succeeded,value:{anonymous:!0}}):(Telemetry.RuntimeTelemetryHelper.LogExceptionTag("s2s getuserId request failed "+n,null,t,521958850),i({status:e.DataServiceResultCode.Failed,httpStatus:n}))})):i({status:e.DataServiceResultCode.Failed,httpStatus:404})},n.prototype.createScope=function(e){return new t(n._requestHandler,this._initParam,e)},n}();e.S2SOmexCatalogService=n}(OfficeExt||(OfficeExt={})),function(e){var t=function(){function e(){}return e.ProcessLastStoreUpdate=function(e){var t=new OSF.XmlProcessor(e,_omexXmlNamespaces).getDocumentElement().selectSingleNode("o:update");return null!=t.firstChild?Date.parse(t.firstChild.nodeValue):null},e.ProcessAppState=function(t){var n={},i=new OSF.XmlProcessor(t,_omexXmlNamespaces),o=i.getDocumentElement();i.readAttributes(o,{rr:"refreshRate"},n);var r=i.selectSingleNode("o:results"),a=i.selectSingleNode("o:lang",r),s=i.selectSingleNode("o:asset",a);return i.readAttributes(s,{assetid:"assetId",prodid:"productId",ver:"version",state:"state",tdurl:"takeDownUrl",upv:"unsafePreviousVersion",expiry:"expirationDate"},n),e.ConvertAppState(n)},e.ProcessFirstPartyAddInList=function(e){var t={addInList:{},refreshRate:null},n=new OSF.XmlProcessor(e,_omexXmlNamespaces),i=n.getDocumentElement(),o=n.selectSingleNode("o:Apps",i),r=o.getAttribute("d1p1:rr");t.refreshRate=r?parseInt(r):0;for(var a=n.selectNodes("o:App",o),s=0;s<a.length;s++){var l=a[s],c={assetId:null,path:null,version:null};n.readAttributes(l,{assetid:"assetId"},c);var u=n.selectSingleNode("o:Path",l);c.path=null!=u.text?u.text:null!=u.textContent?u.textContent:u.nodeTypedValue;var d=n.selectSingleNode("o:Version",l);c.version=null!=d.text?d.text:null!=d.textContent?d.textContent:d.nodeTypedValue,t.addInList[c.assetId]=c}return t},e.ConvertAppState=function(t){return t.refreshRate2=t.refreshRate?parseInt(t.refreshRate):0,t.state2=t.state?parseInt(t.state):0,t.expirationDate2=e.GetTickByDate(t.expirationDate),t},e.ProcessEntitlement=function(t){var n={},i=new OSF.XmlProcessor(t,_omexXmlNamespaces),o=i.selectSingleNode("o:entitlementlist"),r=i.selectSingleNode("o:hdr",o);i.readAttributes(r,{pm:"billingMarket",pagesize:"pageSize",rr:"refreshRate"},n);for(var a,s,l=i.selectNodes("o:entitlement",i.selectSingleNode("o:entitlements",o)),c=[],u=0;u<l.length;++u)s={},a=l[u],i.readAttributes(a,{assetid:"assetId",pid:"productId",ver:"version",appst:"appSubType",cm:"contentMarket",trlt:"licenseType",acqdate:"acquireDate",expiry2:"expirationDate",attreq:"attentionRequired"},s),c.push(s);return n.entitlements=c,e.ConvertEntitlementInfo(n)},e.ConvertEntitlementInfo=function(t){for(var n=t.entitlements,i=0;i<n.length;++i){var o=n[i];o.appSubType2=o.appSubType?parseInt(o.appSubType):0,o.acquireDate2=e.GetTickByDate(o.acquireDate),o.expirationDate2=e.GetTickByDate(o.expirationDate),o.attentionRequired2="true"===o.attentionRequired}return t.refreshRate2=t.refreshRate?parseInt(t.refreshRate):0,t},e.ProcessKilledApps=function(t){var n={},i=new OSF.XmlProcessor(t,_omexXmlNamespaces),o=i.getDocumentElement();i.readAttributes(o,{rr:"refreshRate"},n);for(var r=[],a=i.selectSingleNode("o:assets"),s=i.selectNodes("o:asset",a),l=0;l<s.length;++l){var c=s[l],u={};i.readAttributes(c,{assetid:"assetId",pid:"productId"},u),r.push({assetId:u.assetId,productId:u.productId})}return n.killedApps=r,e.ConvertKilledAppsInfo(n)},e.ConvertKilledAppsInfo=function(e){return e.refreshRate2=e.refreshRate?parseInt(e.refreshRate):0,e},e.ProcessClientAppInstallInfo=function(t,n){var i=new OSF.XmlProcessor(t,_omexXmlNamespaces),o=i.selectSingleNode("o:assets"),r=i.selectSingleNode("o:asset",o),a={etoken:null,manifest:null};if(n===OSF.ClientAppInfoReturnType.urlOnly?i.readAttributes(r,{url:"url"},a):n===OSF.ClientAppInfoReturnType.etokenOnly?i.readAttributes(r,{etok:"etoken"},a):i.readAttributes(r,{url:"url",etok:"etoken"},a),i.readAttributes(r,{status:"status",cm:"contentMarket",assetid:"assetId",ver:"version"},a),n!=OSF.ClientAppInfoReturnType.urlOnly&&a.etoken){var s=new OSF.XmlProcessor(a.etoken,""),l=s.selectSingleNode("t",s.selectSingleNode("r"));s.readAttributes(l,{te:"tokenExpirationDate",et:"entitlementType",cid:"cid"},a)}return e.ConvertClientAppInstallInfo(a)},e.ConvertClientAppInstallInfo=function(t){return t.status2=t.status?parseInt(t.status):0,t.tokenExpirationDate2=e.GetTickByDate(t.tokenExpirationDate),t},e.ProcessManifest=function(e){return{manifest:e}},e.ProcessRemoveAppResponse=function(t){for(var n,i,o={removedApps:[]},r=new OSF.XmlProcessor(t,_omexXmlNamespaces),a=(r.getDocumentElement(),r.selectSingleNode("o:apps",r.selectSingleNode("o:removedApps"))),s=r.selectNodes("o:app",a),l=0;l<s.length;++l)n=s[l],i={},r.readAttributes(n,{assetid:"assetId",result:"result"},i),o.removedApps.push(i);return e.ConvertRemoveAppResponse(o)},e.ConvertRemoveAppResponse=function(e){for(var t=e.removedApps,n=0;n<t.length;++n){var i=t[n];i.result2=i.result?parseInt(i.result):0}return e},e.ProcessAppDetails=function(t,n){for(var i,o,r=new OSF.XmlProcessor(t,_omexXmlNamespaces),a=r.selectSingleNode("o:results"),s=r.selectNodes("o:wainfo",a),l=[],c=0;c<s.length;++c)i=s[c],o={},r.readAttributes(i,{assetid:"assetId",appid:"webApplicationId",defhei:"defaultHeight",defwid:"defaultWidth",title:"name",prov:"provider",desc:"description",icon:"iconUrl",privurl:"privacyUrl",eulaurl:"licenseUrl",ver:"version",state:"state",appst:"appSubType",appvers:"appVersions",req:"requirements",hosts:"hosts",highresicon:"highResolutionIconUrl"},o),l.push(o);return e.ConvertAppDetails(l,n)},e.ConvertAppDetails=function(e,t){for(var n=0;n<e.length;++n){var i=e[n];i.solutionId=i.assetId,i.storeType=OSF.StoreType.OMEX,i.storeId=t,i.assetStoreId=OSF.StoreType.OMEX,i.defaultHeight2=i.defaultHeight?parseInt(i.defaultHeight):0,i.defaultWidth2=i.defaultWidth?parseInt(i.defaultWidth):0,i.state2=i.state?parseInt(i.state):0,i.appSubType2=i.appSubType?parseInt(i.appSubType):0}return e},e.ProcessRecommendations=function(e){for(var t,n,i,o=new OSF.XmlProcessor(e,_omexXmlNamespaces),r=o.selectSingleNode("o:results"),a=o.selectNodes("o:wa",r),s=[],l=0;l<a.length;++l)t=a[l],i={},o.readAttributes(t,{assetid:"assetId",title:"name",desc:"description",icon:"iconUrl",ver:"version",state:"state",rat:"rating",dls:"downloads",prov:"provider"},i),n=o.selectSingleNode("o:price",t),o.readAttributes(n,{fop:"originalPrice",opt:"originalPriceTier",fpp:"promotionalPrice",ppt:"promotionalPriceTier",cmod:"priceModel"},i),s.push(i);return s},e.ConvertAnonymousManifest=function(e,t){var n,i="";switch(e){case 200:n=OSF.OmexClientAppStatus.OK,i=t;break;case 204:case 1223:n=OSF.OmexClientAppStatus.NoEntitlement;break;case 400:n=OSF.OmexClientAppStatus.BadRequest;break;case 410:n=OSF.OmexClientAppStatus.KilledAsset;break;case 404:n=OSF.OmexClientAppStatus.UnknownAssetId;break;case 412:n=OSF.OmexClientAppStatus.VersionNotSupported;break;case 451:n=OSF.OmexClientAppStatus.UserIsMinor;break;default:n=OSF.OmexClientAppStatus.ServerError}return{status2:n,manifest:i}},e.GetTickByDate=function(e){return e?new Date(e).getTime():null},e}();e.OmexXmlProcessor=t}(OfficeExt||(OfficeExt={})),function(e){var t=function(){function e(e){if(e)for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e||(this.acquisitions=[])}return e.prototype.init=function(e){if(e){if(Array.isArray(e.acquisitions)){this.acquisitions=[];for(var t=0,i=e.acquisitions;t<i.length;t++){var o=i[t];this.acquisitions.push(n.fromJS(o))}}this.syncKey=e.syncKey,this.nextInterval=e.nextInterval}},e.fromJS=function(t){t="object"==typeof t?t:{};var n=new e;return n.init(t),n},e.prototype.push=function(e){var t;(t=this.acquisitions).push.apply(t,e.acquisitions),this.syncKey=e.syncKey,this.nextInterval=e.nextInterval},e.prototype.toJSON=function(e){if(e="object"==typeof e?e:{},Array.isArray(this.acquisitions)){e.acquisitions=[];for(var t=0,n=this.acquisitions;t<n.length;t++){var i=n[t];e.acquisitions.push(i.toJSON())}}return e.syncKey=this.syncKey,e.nextInterval=this.nextInterval,e},e}();e.AcquisitionList=t;var n=function(){function e(e){if(e)for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e||(this.titleDefinition=new i)}return e.prototype.init=function(e){e&&(this.titleId=e.titleId,this.assetId=e.assetId,this.manifestId=e.manifestId,this.titleDefinition=e.titleDefinition?i.fromJS(e.titleDefinition):new i,this.acquisitionState=e.acquisitionState,this.acquisitionContext=e.acquisitionContext,this.canBeUnacquired=e.canBeUnacquired)},e.fromJS=function(t){t="object"==typeof t?t:{};var n=new e;return n.init(t),n},e.prototype.toJSON=function(e){return(e="object"==typeof e?e:{}).titleId=this.titleId,e.assetId=this.assetId,e.manifestId=this.manifestId,e.titleDefinition=this.titleDefinition?this.titleDefinition.toJSON():void 0,e.acquisitionState=this.acquisitionState,e.acquisitionContext=this.acquisitionContext,e.canBeUnacquired=this.canBeUnacquired,e},e}();e.Acquisition=n;var i=function(){function e(e){if(e)for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e||(this.iconSmall=new o,this.elementDefinitions=new r)}return e.prototype.init=function(e){if(e){if(this.name=e.name,this.iconSmall=e.iconSmall?o.fromJS(e.iconSmall):new o,this.version=e.version,this.elementDefinitions=e.elementDefinitions?r.fromJS(e.elementDefinitions):new r,this.ingestionSource=e.ingestionSource,this.scope=e.scope,this.developerName=e.developerName,this.shortDescription=e.shortDescription,Array.isArray(e.validDomains)){this.validDomains=[];for(var t=0,n=e.validDomains;t<n.length;t++){var i=n[t];this.validDomains.push(i)}}this.webApplicationInfo=e.webApplicationInfo?a.fromJS(e.webApplicationInfo):void 0,this.authorization=e.authorization?s.fromJS(e.authorization):void 0}},e.fromJS=function(t){t="object"==typeof t?t:{};var n=new e;return n.init(t),n},e.prototype.toJSON=function(e){if((e="object"==typeof e?e:{}).name=this.name,e.iconSmall=this.iconSmall?this.iconSmall.toJSON():void 0,e.version=this.version,e.elementDefinitions=this.elementDefinitions?this.elementDefinitions.toJSON():void 0,e.ingestionSource=this.ingestionSource,e.scope=this.scope,e.developerName=this.developerName,e.shortDescription=this.shortDescription,Array.isArray(this.validDomains)){e.validDomains=[];for(var t=0,n=this.validDomains;t<n.length;t++){var i=n[t];e.validDomains.push(i)}}return e.webApplicationInfo=this.webApplicationInfo?this.webApplicationInfo.toJSON():void 0,e.authorization=this.authorization?this.authorization.toJSON():void 0,e},e}();e.TitleDefinition=i;var o=function(){function e(e){if(e)for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t])}return e.prototype.init=function(e){e&&(this.uri=e.uri)},e.fromJS=function(t){t="object"==typeof t?t:{};var n=new e;return n.init(t),n},e.prototype.toJSON=function(e){return(e="object"==typeof e?e:{}).uri=this.uri,e},e}();e.IconSmall=o;var r=function(){function e(e){if(e)for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t])}return e.prototype.init=function(e){if(e){if(Array.isArray(e.officeAddIns)){this.officeAddIns=[];for(var t=0,n=e.officeAddIns;t<n.length;t++){var i=n[t];this.officeAddIns.push(l.fromJS(i))}}if(Array.isArray(e.extensions)){this.extensions=[];for(var o=0,r=e.extensions;o<r.length;o++){i=r[o];this.extensions.push(c.fromJS(i))}}if(Array.isArray(e.firstPartyPages)){this.firstPartyPages=[];for(var a=0,s=e.firstPartyPages;a<s.length;a++){i=s[a];this.firstPartyPages.push(u.fromJS(i))}}}},e.fromJS=function(t){t="object"==typeof t?t:{};var n=new e;return n.init(t),n},e.prototype.toJSON=function(e){if(e="object"==typeof e?e:{},Array.isArray(this.officeAddIns)){e.officeAddIns=[];for(var t=0,n=this.officeAddIns;t<n.length;t++){var i=n[t];e.officeAddIns.push(i.toJSON())}}if(Array.isArray(this.extensions)){e.extensions=[];for(var o=0,r=this.extensions;o<r.length;o++){i=r[o];e.extensions.push(i.toJSON())}}if(Array.isArray(this.firstPartyPages)){e.firstPartyPages=[];for(var a=0,s=this.firstPartyPages;a<s.length;a++){i=s[a];e.firstPartyPages.push(i.toJSON())}}return e},e}();e.ElementDefinitions=r;var a=function(){function e(e){if(e)for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t])}return e.prototype.init=function(e){e&&(this.id=e.id,this.resource=e.resource)},e.fromJS=function(t){t="object"==typeof t?t:{};var n=new e;return n.init(t),n},e.prototype.toJSON=function(e){return(e="object"==typeof e?e:{}).id=this.id,e.resource=this.resource,e},e}();e.WebApplicationInfo=a;var s=function(){function e(e){if(e)for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t])}return e.prototype.init=function(e){e&&(this.permissions=e.permissions?d.fromJS(e.permissions):void 0)},e.fromJS=function(t){t="object"==typeof t?t:{};var n=new e;return n.init(t),n},e.prototype.toJSON=function(e){return(e="object"==typeof e?e:{}).permissions=this.permissions?this.permissions.toJSON():void 0,e},e}();e.Authorization=s;var l=function(){function e(e){if(e)for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t])}return e.prototype.init=function(e){e&&(this.xmlDefinition=e.xmlDefinition,this.name=e.name)},e.fromJS=function(t){t="object"==typeof t?t:{};var n=new e;return n.init(t),n},e.prototype.toJSON=function(e){return(e="object"==typeof e?e:{}).xmlDefinition=this.xmlDefinition,e.name=this.name,e},e}();e.OfficeAddIn=l;var c=function(){function e(e){if(e)for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e||(this.getStartedMessages=[],this.runtimes=[],this.shortcuts=[],this.autoRunEvents=[])}return e.prototype.init=function(e){if(e){if(this.requirements=e.requirements?p.fromJS(e.requirements):void 0,Array.isArray(e.getStartedMessages)){this.getStartedMessages=[];for(var t=0,n=e.getStartedMessages;t<n.length;t++){var i=n[t];this.getStartedMessages.push(f.fromJS(i))}}if(Array.isArray(e.runtimes)){this.runtimes=[];for(var o=0,r=e.runtimes;o<r.length;o++){i=r[o];this.runtimes.push(m.fromJS(i))}}if(Array.isArray(e.ribbons)){this.ribbons=[];for(var a=0,s=e.ribbons;a<s.length;a++){i=s[a];this.ribbons.push(h.fromJS(i))}}if(Array.isArray(e.shortcuts)){this.shortcuts=[];for(var l=0,c=e.shortcuts;l<c.length;l++){i=c[l];this.shortcuts.push(g.fromJS(i))}}if(Array.isArray(e.autoRunEvents)){this.autoRunEvents=[];for(var u=0,d=e.autoRunEvents;u<d.length;u++){i=d[u];this.autoRunEvents.push(y.fromJS(i))}}if(Array.isArray(e.contextMenus)){this.contextMenus=[];for(var _=0,C=e.contextMenus;_<C.length;_++){i=C[_];this.contextMenus.push(v.fromJS(i))}}if(Array.isArray(e.alternatives)){this.alternatives=[];for(var A=0,O=e.alternatives;A<O.length;A++){i=O[A];this.alternatives.push(S.fromJS(i))}}}},e.fromJS=function(t){t="object"==typeof t?t:{};var n=new e;return n.init(t),n},e.prototype.toJSON=function(e){if((e="object"==typeof e?e:{}).requirements=this.requirements?this.requirements.toJSON():void 0,Array.isArray(this.getStartedMessages)){e.getStartedMessages=[];for(var t=0,n=this.getStartedMessages;t<n.length;t++){var i=n[t];e.getStartedMessages.push(i.toJSON())}}if(Array.isArray(this.runtimes)){e.runtimes=[];for(var o=0,r=this.runtimes;o<r.length;o++){i=r[o];e.runtimes.push(i.toJSON())}}if(Array.isArray(this.ribbons)){e.ribbons=[];for(var a=0,s=this.ribbons;a<s.length;a++){i=s[a];e.ribbons.push(i.toJSON())}}if(Array.isArray(this.shortcuts)){e.shortcuts=[];for(var l=0,c=this.shortcuts;l<c.length;l++){i=c[l];e.shortcuts.push(i.toJSON())}}if(Array.isArray(this.autoRunEvents)){e.autoRunEvents=[];for(var u=0,d=this.autoRunEvents;u<d.length;u++){i=d[u];e.autoRunEvents.push(i.toJSON())}}if(Array.isArray(this.contextMenus)){e.contextMenus=[];for(var p=0,f=this.contextMenus;p<f.length;p++){i=f[p];e.contextMenus.push(i.toJSON())}}if(Array.isArray(this.alternatives)){e.alternatives=[];for(var m=0,h=this.alternatives;m<h.length;m++){i=h[m];e.alternatives.push(i.toJSON())}}return e},e}();e.Extension=c;var u=function(){function e(e){if(e)for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t])}return e.prototype.init=function(e){e&&(this.id=e.Id,this.title=e.Title,this.subtitle=e.Subtitle,this.alternateNames=e.AlternateNames,this.brandBarText=e.BrandBarText,this.ariaLabel=e.AriaLabel,this.publisher=e.Publisher,this.iconAnonymousUrl=e.IconAnonymousUrl,this.targetWindow=e.TargetWindow,this.backgroundColor=e.BackgroundColor,this.launchFullUrl=e.LaunchFullUrl,this.name=e.name)},e.fromJS=function(t){t="object"==typeof t?t:{};var n=new e;return n.init(t),n},e.prototype.toJSON=function(e){return(e="object"==typeof e?e:{}).Id=this.id,e.Title=this.title,e.Subtitle=this.subtitle,e.AlternateNames=this.alternateNames,e.BrandBarText=this.brandBarText,e.AriaLabel=this.ariaLabel,e.Publisher=this.publisher,e.IconAnonymousUrl=this.iconAnonymousUrl,e.TargetWindow=this.targetWindow,e.BackgroundColor=this.backgroundColor,e.LaunchFullUrl=this.launchFullUrl,e.name=this.name,e},e}();e.FirstPartyPages=u;var d=function(){function e(e){if(e)for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t])}return e.prototype.init=function(e){if(e){if(Array.isArray(e.orgWide)){this.orgWide=[];for(var t=0,n=e.orgWide;t<n.length;t++){var i=n[t];this.orgWide.push(T.fromJS(i))}}if(Array.isArray(e.resourceSpecific)){this.resourceSpecific=[];for(var o=0,r=e.resourceSpecific;o<r.length;o++){i=r[o];this.resourceSpecific.push(I.fromJS(i))}}}},e.fromJS=function(t){t="object"==typeof t?t:{};var n=new e;return n.init(t),n},e.prototype.toJSON=function(e){if(e="object"==typeof e?e:{},Array.isArray(this.orgWide)){e.orgWide=[];for(var t=0,n=this.orgWide;t<n.length;t++){var i=n[t];e.orgWide.push(i.toJSON())}}if(Array.isArray(this.resourceSpecific)){e.resourceSpecific=[];for(var o=0,r=this.resourceSpecific;o<r.length;o++){i=r[o];e.resourceSpecific.push(i.toJSON())}}return e},e}();e.Permissions=d;var p=function(){function e(e){if(e)for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t])}return e.prototype.init=function(e){if(e){if(Array.isArray(e.scopes)){this.scopes=[];for(var t=0,n=e.scopes;t<n.length;t++){var i=n[t];this.scopes.push(i)}}if(Array.isArray(e.capabilities)){this.capabilities=[];for(var o=0,r=e.capabilities;o<r.length;o++){i=r[o];this.capabilities.push(x.fromJS(i))}}if(Array.isArray(e.platforms)){this.platforms=[];for(var a=0,s=e.platforms;a<s.length;a++){i=s[a];this.platforms.push(i)}}if(Array.isArray(e.formFactors)){this.formFactors=[];for(var l=0,c=e.formFactors;l<c.length;l++){i=c[l];this.formFactors.push(i)}}}},e.fromJS=function(t){t="object"==typeof t?t:{};var n=new e;return n.init(t),n},e.prototype.toJSON=function(e){if(e="object"==typeof e?e:{},Array.isArray(this.scopes)){e.scopes=[];for(var t=0,n=this.scopes;t<n.length;t++){var i=n[t];e.scopes.push(i)}}if(Array.isArray(this.capabilities)){e.capabilities=[];for(var o=0,r=this.capabilities;o<r.length;o++){i=r[o];e.capabilities.push(i.toJSON())}}if(Array.isArray(this.platforms)){e.platforms=[];for(var a=0,s=this.platforms;a<s.length;a++){i=s[a];e.platforms.push(i)}}if(Array.isArray(this.formFactors)){e.formFactors=[];for(var l=0,c=this.formFactors;l<c.length;l++){i=c[l];e.formFactors.push(i)}}return e},e}();e.Requirements=p;var f=function(){function e(e){if(e)for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t])}return e.prototype.init=function(e){e&&(this.requirements=e.requirements?p.fromJS(e.requirements):void 0,this.title=e.title,this.description=e.description,this.learnMoreUrl=e.learnMoreUrl)},e.fromJS=function(t){t="object"==typeof t?t:{};var n=new e;return n.init(t),n},e.prototype.toJSON=function(e){return(e="object"==typeof e?e:{}).requirements=this.requirements?this.requirements.toJSON():void 0,e.title=this.title,e.description=this.description,e.learnMoreUrl=this.learnMoreUrl,e},e}();e.GetStartedMessages=f;var m=function(){function e(e){if(e)for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e||(this.code=new E,this.actions=[],this.functions=[],this.functionSettings=new b)}return e.prototype.init=function(e){if(e){if(this.requirements=e.requirements?p.fromJS(e.requirements):void 0,this.id=e.id,this.type=e.type,this.code=e.code?E.fromJS(e.code):new E,this.lifetime=e.lifetime,Array.isArray(e.actions)){this.actions=[];for(var t=0,n=e.actions;t<n.length;t++){var i=n[t];this.actions.push(M.fromJS(i))}}if(Array.isArray(e.functions)){this.functions=[];for(var o=0,r=e.functions;o<r.length;o++){var a=r[o];this.functions.push(a)}}this.functionSettings=e.functionSettings?b.fromJS(e.functionSettings):new b}},e.fromJS=function(t){t="object"==typeof t?t:{};var n=new e;return n.init(t),n},e.prototype.toJSON=function(e){if((e="object"==typeof e?e:{}).requirements=this.requirements?this.requirements.toJSON():void 0,e.id=this.id,e.type=this.type,e.code=this.code?this.code.toJSON():void 0,e.lifetime=this.lifetime,Array.isArray(this.actions)){e.actions=[];for(var t=0,n=this.actions;t<n.length;t++){var i=n[t];e.actions.push(i.toJSON())}}if(Array.isArray(this.functions)){e.functions=[];for(var o=0,r=this.functions;o<r.length;o++){var a=r[o];e.functions.push(a.toJSON())}}return e.functionSettings=this.functionSettings?this.functionSettings.toJSON():void 0,e},e}();e.Runtimes=m;var h=function(){function e(e){if(e)for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e||(this.tabs=[])}return e.prototype.init=function(e){if(e){if(this.requirements=e.requirements?p.fromJS(e.requirements):void 0,Array.isArray(e.contexts)){this.contexts=[];for(var t=0,n=e.contexts;t<n.length;t++){var i=n[t];this.contexts.push(i)}}if(Array.isArray(e.tabs)){this.tabs=[];for(var o=0,r=e.tabs;o<r.length;o++){i=r[o];this.tabs.push(R.fromJS(i))}}}},e.fromJS=function(t){t="object"==typeof t?t:{};var n=new e;return n.init(t),n},e.prototype.toJSON=function(e){if((e="object"==typeof e?e:{}).requirements=this.requirements?this.requirements.toJSON():void 0,Array.isArray(this.contexts)){e.contexts=[];for(var t=0,n=this.contexts;t<n.length;t++){var i=n[t];e.contexts.push(i)}}if(Array.isArray(this.tabs)){e.tabs=[];for(var o=0,r=this.tabs;o<r.length;o++){i=r[o];e.tabs.push(i.toJSON())}}return e},e}();e.Ribbons=h;var g=function(){function e(e){if(e)for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e||(this.keys=[])}return e.prototype.init=function(e){if(e&&(this.requirements=e.requirements?p.fromJS(e.requirements):void 0,Array.isArray(e.keys))){this.keys=[];for(var t=0,n=e.keys;t<n.length;t++){var i=n[t];this.keys.push(P.fromJS(i))}}},e.fromJS=function(t){t="object"==typeof t?t:{};var n=new e;return n.init(t),n},e.prototype.toJSON=function(e){if((e="object"==typeof e?e:{}).requirements=this.requirements?this.requirements.toJSON():void 0,Array.isArray(this.keys)){e.shortcuts=[];for(var t=0,n=this.keys;t<n.length;t++){var i=n[t];e.shortcuts.push(i.toJSON())}}return e},e}();e.Shortcuts=g;var y=function(){function e(e){if(e)for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e||(this.events=[])}return e.prototype.init=function(e){if(e&&(this.requirements=e.requirements?p.fromJS(e.requirements):void 0,Array.isArray(e.events))){this.events=[];for(var t=0,n=e.events;t<n.length;t++){var i=n[t];this.events.push(D.fromJS(i))}}},e.fromJS=function(t){t="object"==typeof t?t:{};var n=new e;return n.init(t),n},e.prototype.toJSON=function(e){if((e="object"==typeof e?e:{}).requirements=this.requirements?this.requirements.toJSON():void 0,Array.isArray(this.events)){e.events=[];for(var t=0,n=this.events;t<n.length;t++){var i=n[t];e.events.push(i.toJSON())}}return e},e}();e.AutoRunEvents=y;var v=function(){function e(e){if(e)for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e||(this.menus=[])}return e.prototype.init=function(e){if(e&&(this.requirements=e.requirements?p.fromJS(e.requirements):void 0,Array.isArray(e.menus))){this.menus=[];for(var t=0,n=e.menus;t<n.length;t++){var i=n[t];this.menus.push(U.fromJS(i))}}},e.fromJS=function(t){t="object"==typeof t?t:{};var n=new e;return n.init(t),n},e.prototype.toJSON=function(e){if((e="object"==typeof e?e:{}).requirements=this.requirements?this.requirements.toJSON():void 0,Array.isArray(this.menus)){e.menus=[];for(var t=0,n=this.menus;t<n.length;t++){var i=n[t];e.menus.push(i.toJSON())}}return e},e}();e.ContextMenus=v;var S=function(){function e(e){if(e)for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t])}return e.prototype.init=function(e){e&&(this.requirements=e.requirements?p.fromJS(e.requirements):void 0,this.prefer=e.prefer,this.hide=e.hide)},e.fromJS=function(t){t="object"==typeof t?t:{};var n=new e;return n.init(t),n},e.prototype.toJSON=function(e){return(e="object"==typeof e?e:{}).requirements=this.requirements?this.requirements.toJSON():void 0,e.prefer=this.prefer,e.hide=this.hide,e},e}();e.Alternatives=S;var _=function(){function e(e){if(e)for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t])}return e.prototype.init=function(e){},e.fromJS=function(t){t="object"==typeof t?t:{};var n=new e;return n.init(t),n},e.prototype.toJSON=function(e){return e="object"==typeof e?e:{}},e}();e.Subtitle=_;var C=function(){function e(e){if(e)for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t])}return e.prototype.init=function(e){},e.fromJS=function(t){t="object"==typeof t?t:{};var n=new e;return n.init(t),n},e.prototype.toJSON=function(e){return e="object"==typeof e?e:{}},e}();e.AlternateNames=C;var A=function(){function e(e){if(e)for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t])}return e.prototype.init=function(e){},e.fromJS=function(t){t="object"==typeof t?t:{};var n=new e;return n.init(t),n},e.prototype.toJSON=function(e){return e="object"==typeof e?e:{}},e}();e.BrandBarText=A;var O=function(){function e(e){if(e)for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t])}return e.prototype.init=function(e){},e.fromJS=function(t){t="object"==typeof t?t:{};var n=new e;return n.init(t),n},e.prototype.toJSON=function(e){return e="object"==typeof e?e:{}},e}();e.TargetWindow=O;var T=function(){function e(e){if(e)for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t])}return e.prototype.init=function(e){e&&(this.name=e.name,this.type=e.type)},e.fromJS=function(t){t="object"==typeof t?t:{};var n=new e;return n.init(t),n},e.prototype.toJSON=function(e){return(e="object"==typeof e?e:{}).name=this.name,e.type=this.type,e},e}();e.OrgWide=T;var I=function(){function e(e){if(e)for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t])}return e.prototype.init=function(e){e&&(this.name=e.name,this.type=e.type)},e.fromJS=function(t){t="object"==typeof t?t:{};var n=new e;return n.init(t),n},e.prototype.toJSON=function(e){return(e="object"==typeof e?e:{}).name=this.name,e.type=this.type,e},e}();e.ResourceSpecific=I,function(e){e.Mail="mail",e.Workbook="workbook",e.Document="document",e.Presentation="presentation"}(e.Scopes||(e.Scopes={}));var x=function(){function e(e){if(e)for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t])}return e.prototype.init=function(e){e&&(this.name=e.name,this.minVersion=e.minVersion,this.maxVersion=e.maxVersion)},e.fromJS=function(t){t="object"==typeof t?t:{};var n=new e;return n.init(t),n},e.prototype.toJSON=function(e){return(e="object"==typeof e?e:{}).name=this.name,e.minVersion=this.minVersion,e.maxVersion=this.maxVersion,e},e}();e.Capabilities=x,function(e){e.Windows="windows",e.Mac="mac",e.Web="web",e.Ios="ios",e.Android="android"}(e.Platforms||(e.Platforms={})),function(e){e.Desktop="desktop",e.Tablet="tablet",e.Phone="phone"}(e.FormFactors||(e.FormFactors={}));var E=function(){function e(e){if(e)for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t])}return e.prototype.init=function(e){e&&(this.page=e.page,this.script=e.script)},e.fromJS=function(t){t="object"==typeof t?t:{};var n=new e;return n.init(t),n},e.prototype.toJSON=function(e){return(e="object"==typeof e?e:{}).page=this.page,e.script=this.script,e},e}();e.Code=E;var M=function(){function e(e){if(e)for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t])}return e.prototype.init=function(e){e&&(this.id=e.id,this.type=e.type,this.displayName=e.displayName,this.view=e.view)},e.fromJS=function(t){t="object"==typeof t?t:{};var n=new e;return n.init(t),n},e.prototype.toJSON=function(e){return(e="object"==typeof e?e:{}).id=this.id,e.type=this.type,e.displayName=this.displayName,e.view=this.view,e},e}();e.Actions=M;var F=function(){function e(e){if(e)for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e||(this.result=new W,this.parameters=[])}return e.prototype.init=function(e){if(e){if(this.id=e.id,this.name=e.name,this.description=e.description,Array.isArray(e.parameters)){this.parameters=[];for(var t=0,n=e.parameters;t<n.length;t++){var i=n[t];this.parameters.push(H.fromJS(i))}}this.result=e.result?W.fromJS(e.result):new W,this.stream=e.stream,this.volatile=e.volatile,this.cancelable=e.cancelable,this.requiresAddress=e.requiresAddress,this.requiresParameterAddress=e.requiresParameterAddress}},e.fromJS=function(t){t="object"==typeof t?t:{};var n=new e;return n.init(t),n},e.prototype.toJSON=function(e){if((e="object"==typeof e?e:{}).id=this.id,e.name=this.name,e.description=this.description,Array.isArray(this.parameters)){e.parameters=[];for(var t=0,n=this.parameters;t<n.length;t++){var i=n[t];e.parameters.push(i.toJSON())}}return e.result=this.result?this.result.toJSON():void 0,e.stream=this.stream,e.volatile=this.volatile,e.cancelable=this.cancelable,e.requiresAddress=this.requiresAddress,e.requiresParameterAddress=this.requiresParameterAddress,e},e}();e.Functions=F;var b=function(){function e(e){if(e)for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e||(this.namespace=new w)}return e.prototype.init=function(e){e&&(this.namespace=e.namespace?w.fromJS(e.namespace):new w,this.allowErrorForDataTypeAny=e.allowErrorForDataTypeAny,this.allowRichDataForDataTypeAny=e.allowRichDataForDataTypeAny)},e.fromJS=function(t){t="object"==typeof t?t:{};var n=new e;return n.init(t),n},e.prototype.toJSON=function(e){return(e="object"==typeof e?e:{}).namespace=this.namespace?this.namespace.toJSON():void 0,e.allowErrorForDataTypeAny=this.allowErrorForDataTypeAny,e.allowRichDataForDataTypeAny=this.allowRichDataForDataTypeAny,e},e}();e.FunctionSettings=b,function(e){e.Default="default",e.ReadMail="readMail",e.ComposeMail="composeMail",e.AppointmentOrganizer="appointmentOrganizer",e.AppointmentAttendee="appointmentAttendee"}(e.Contexts||(e.Contexts={}));var R=function(){function e(e){if(e)for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e||(this.groups=[])}return e.prototype.init=function(e){if(e&&(this.builtInTabId=e.builtInTabId,this.id=e.id,this.label=e.label,this.position=e.position?L.fromJS(e.position):void 0,Array.isArray(e.groups))){this.groups=[];for(var t=0,n=e.groups;t<n.length;t++){var i=n[t];this.groups.push(k.fromJS(i))}}},e.fromJS=function(t){t="object"==typeof t?t:{};var n=new e;return n.init(t),n},e.prototype.toJSON=function(e){if((e="object"==typeof e?e:{}).builtInTabId=this.builtInTabId,e.id=this.id,e.label=this.label,e.position=this.position?this.position.toJSON():void 0,Array.isArray(this.groups)){e.groups=[];for(var t=0,n=this.groups;t<n.length;t++){var i=n[t];e.groups.push(i.toJSON())}}return e},e}();e.Tabs=R;var P=function(){function e(e){if(e)for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t])}return e.prototype.init=function(e){e&&(this.requirements=e.requirements?p.fromJS(e.requirements):void 0,this.key=e.key?N.fromJS(e.key):void 0,this.actionId=e.actionId)},e.fromJS=function(t){t="object"==typeof t?t:{};var n=new e;return n.init(t),n},e.prototype.toJSON=function(e){return(e="object"==typeof e?e:{}).requirements=this.requirements?this.requirements.toJSON():void 0,e.key=this.key?this.key.toJSON():void 0,e.actionId=this.actionId,e},e}();e.Keys=P;var N=function(){function e(e){if(e)for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t])}return e.prototype.init=function(e){e&&(this.defaultKey=e.default,this.windows=e.windows,this.mac=e.mac,this.web=e.web)},e.fromJS=function(t){t="object"==typeof t?t:{};var n=new e;return n.init(t),n},e.prototype.toJSON=function(e){return(e="object"==typeof e?e:{}).default=this.defaultKey,e.windows=this.windows,e.mac=this.mac,e.web=this.web,e},e}();e.Key=N;var D=function(){function e(e){if(e)for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e||(this.options=new B)}return e.prototype.init=function(e){e&&(this.requirements=e.requirements?p.fromJS(e.requirements):void 0,this.id=e.id,this.actionId=e.actionId,this.options=e.options?B.fromJS(e.options):new B)},e.fromJS=function(t){t="object"==typeof t?t:{};var n=new e;return n.init(t),n},e.prototype.toJSON=function(e){return(e="object"==typeof e?e:{}).requirements=this.requirements?this.requirements.toJSON():void 0,e.id=this.id,e.actionId=this.actionId,e.options=this.options?this.options.toJSON():void 0,e},e}();e.Events=D;var U=function(){function e(e){if(e)for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e||(this.controls=[])}return e.prototype.init=function(e){if(e&&(this.type=e.type,Array.isArray(e.controls))){this.controls=[];for(var t=0,n=e.controls;t<n.length;t++){var i=n[t];this.controls.push(i)}}},e.fromJS=function(t){t="object"==typeof t?t:{};var n=new e;return n.init(t),n},e.prototype.toJSON=function(e){if((e="object"==typeof e?e:{}).type=this.type,Array.isArray(this.controls)){e.controls=[];for(var t=0,n=this.controls;t<n.length;t++){var i=n[t];e.controls.push(i)}}return e},e}();e.Menus=U,function(e){e.Application="Application",e.Delegated="Delegated"}(e.OrgWideType||(e.OrgWideType={})),function(e){e.Application="Application",e.Delegated="Delegated"}(e.ResourceSpecificType||(e.ResourceSpecificType={}));var w=function(){function e(e){if(e)for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t])}return e.prototype.init=function(e){e&&(this.id=e.id,this.name=e.name)},e.fromJS=function(t){t="object"==typeof t?t:{};var n=new e;return n.init(t),n},e.prototype.toJSON=function(e){return(e="object"==typeof e?e:{}).id=this.id,e.name=this.name,e},e}();e.Namespace=w;var L=function(){function e(e){if(e)for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t])}return e.prototype.init=function(e){e&&(this.builtInTabId=e.builtInTabId,this.align=e.align)},e.fromJS=function(t){t="object"==typeof t?t:{};var n=new e;return n.init(t),n},e.prototype.toJSON=function(e){return(e="object"==typeof e?e:{}).builtInTabId=this.builtInTabId,e.align=this.align,e},e}();e.Position=L;var k=function(){function e(e){if(e)for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e||(this.overriddenByRibbonApi=!1,this.controls=[])}return e.prototype.init=function(e){if(e){if(this.overriddenByRibbonApi=void 0!==e.overriddenByRibbonApi&&e.overriddenByRibbonApi,this.builtInGroupId=e.builtInGroupId,this.id=e.id,this.label=e.label,Array.isArray(e.icons)){this.icons=[];for(var t=0,n=e.icons;t<n.length;t++){var i=n[t];this.icons.push(q.fromJS(i))}}if(Array.isArray(e.controls)){this.controls=[];for(var o=0,r=e.controls;o<r.length;o++){i=r[o];this.controls.push(V.fromJS(i))}}}},e.fromJS=function(t){t="object"==typeof t?t:{};var n=new e;return n.init(t),n},e.prototype.toJSON=function(e){if((e="object"==typeof e?e:{}).overriddenByRibbonApi=this.overriddenByRibbonApi,e.builtInGroupId=this.builtInGroupId,e.id=this.id,e.label=this.label,Array.isArray(this.icons)){e.icons=[];for(var t=0,n=this.icons;t<n.length;t++){var i=n[t];e.icons.push(i.toJSON())}}if(Array.isArray(this.controls)){e.controls=[];for(var o=0,r=this.controls;o<r.length;o++){i=r[o];e.controls.push(i.toJSON())}}return e},e}();e.Groups=k;var B=function(){function e(e){if(e)for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t])}return e.prototype.init=function(e){e&&(this.sendMode=e.sendMode)},e.fromJS=function(t){t="object"==typeof t?t:{};var n=new e;return n.init(t),n},e.prototype.toJSON=function(e){return(e="object"==typeof e?e:{}).sendMode=this.sendMode,e},e}();e.Options=B,function(e){e.Cell="cell",e.Text="text"}(e.MenusType||(e.MenusType={}));var H=function(){function e(e){if(e)for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t])}return e.prototype.init=function(e){e&&(this.name=e.name,this.description=e.description,this.type=e.type,this.dimensionality=e.dimensionality)},e.fromJS=function(t){t="object"==typeof t?t:{};var n=new e;return n.init(t),n},e.prototype.toJSON=function(e){return(e="object"==typeof e?e:{}).name=this.name,e.description=this.description,e.type=this.type,e.dimensionality=this.dimensionality,e},e}();e.Parameters=H;var W=function(){function e(e){if(e)for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t])}return e.prototype.init=function(e){e&&(this.dimensionality=e.dimensionality)},e.fromJS=function(t){t="object"==typeof t?t:{};var n=new e;return n.init(t),n},e.prototype.toJSON=function(e){return(e="object"==typeof e?e:{}).dimensionality=this.dimensionality,e},e}();e.Result=W,function(e){e.After="after",e.Before="before"}(e.PositionAlign||(e.PositionAlign={}));var q=function(){function e(e){if(e)for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t])}return e.prototype.init=function(e){e&&(this.size=e.size,this.file=e.file)},e.fromJS=function(t){t="object"==typeof t?t:{};var n=new e;return n.init(t),n},e.prototype.toJSON=function(e){return(e="object"==typeof e?e:{}).size=this.size,e.file=this.file,e},e}();e.Icons=q;var V=function(){function e(e){if(e)for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e||(this.overriddenByRibbonApi=!1,this.enabled=!0,this.icons=[],this.supertip=new G)}return e.prototype.init=function(t){if(t){if(this.overriddenByRibbonApi=void 0!==t.overriddenByRibbonApi&&t.overriddenByRibbonApi,this.builtInControlId=t.builtInControlId,this.id=t.id,this.type=t.type,this.label=t.label,this.enabled=void 0===t.enabled||t.enabled,Array.isArray(t.icons)){this.icons=[];for(var n=0,i=t.icons;n<i.length;n++){var o=i[n];this.icons.push(q.fromJS(o))}}if(this.supertip=t.supertip?G.fromJS(t.supertip):new G,this.actionId=t.actionId,Array.isArray(t.items)){this.items=[];for(var r=0,a=t.items;r<a.length;r++){o=a[r];this.items.push(e.fromJS(o))}}}},e.fromJS=function(t){t="object"==typeof t?t:{};var n=new e;return n.init(t),n},e.prototype.toJSON=function(e){if((e="object"==typeof e?e:{}).overriddenByRibbonApi=this.overriddenByRibbonApi,e.builtInControlId=this.builtInControlId,e.id=this.id,e.type=this.type,e.label=this.label,e.enabled=this.enabled,Array.isArray(this.icons)){e.icons=[];for(var t=0,n=this.icons;t<n.length;t++){var i=n[t];e.icons.push(i.toJSON())}}if(e.supertip=this.supertip?this.supertip.toJSON():void 0,e.actionId=this.actionId,Array.isArray(this.items)){e.items=[];for(var o=0,r=this.items;o<r.length;o++){i=r[o];e.items.push(i.toJSON())}}return e},e}();e.Controls=V,function(e){e.Button="button",e.Menu="menu"}(e.ControlsType||(e.ControlsType={}));var G=function(){function e(e){if(e)for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t])}return e.prototype.init=function(e){e&&(this.title=e.title,this.description=e.description)},e.fromJS=function(t){t="object"==typeof t?t:{};var n=new e;return n.init(t),n},e.prototype.toJSON=function(e){return(e="object"==typeof e?e:{}).title=this.title,e.description=this.description,e},e}();e.Supertip=G}(Mos||(Mos={})),function(e){var t=function(){function t(e){this._acquisitionList=t.parseAndGetAcquisitions(e)}return t._setAppUILocale=function(e){t._locale=e.toLocaleLowerCase()},t.prototype.getAcquisitionList=function(){return this._acquisitionList},t.prototype.getEntitlementInfo=function(){var e={};return e.cid=this._acquisitionList.syncKey,e.entitlements=[],this._acquisitionList.acquisitions.forEach((function(n){if(t.IsValidAcquisition(n)){var i={};i.assetId=n.assetId,i.productId=n.manifestId,i.version=n.titleDefinition.version,e.entitlements.push(i)}})),e},t.prototype.getKilledAppsInfo=function(){throw new Error("Method not implemented.")},t.getPrivateCatalogAddinList=function(e){for(var t=[],n=0,i=e;n<i.length;n++){var o=i[n],r={solutionId:o.getMarketplaceID(),version:o.getVersion(),assetId:o.getAssetId(),assetStoreId:o.getLocale(),storeId:o.getLocale(),storeType:OSF.StoreType.PrivateCatalog,targetType:o.getTarget(),addInState:"Ok",addInStoreInfo:{AssetId:o.getAssetId(),ContentMarket:o.getLocale()}};t.push(r)}return t},t.prototype.getPrivateCatalogManifests=function(){throw new Error("Method not implemented.")},t.parseAndGetAppMetadata=function(e){var n=t.parseAndGetAcquisitions(e);return t.acquisitionsToAppMetadatas(n.acquisitions)},t.appMetadataListToJSON=function(e){return{acquisitions:e.map((function(e){return e.toJSON()}))}},t.parseAndGetAcquisitions=function(n){var i=new e.AcquisitionList;return i.init(JSON.parse(n)),i.acquisitions=t.loadableAcquisitions(i.acquisitions),i},t.acquisitionsToAppMetadatas=function(n,i){return OSF.OUtil.isArrayNullOrUndefinedOrEmpty(n)?[]:(n=t.loadableAcquisitions(n)).map((function(n){try{return e.AppMetadata.fromAcquisition(n,t._locale)}catch(e){return void Telemetry.RuntimeTelemetryHelper.LogExceptionTag("[TaosPayloadAdapter] Acquisition "+n.titleId+" failed to convert into AppMetadata",e,null==i?void 0:i.correlationId,521175447)}})).filter((function(e){return!OSF.OUtil.isNullOrUndefined(e)}))},t.loadableAcquisitions=function(e){return e=null==e?void 0:e.filter((function(e){return e.acquisitionState.toLowerCase()===OSF.AcquisitionAcquiredState.Acquired||e.acquisitionState.toLowerCase()===OSF.AcquisitionAcquiredState.NeedsConsentForUpgrade||t.IsValidAcquisition(e)}))},t.IsValidAcquisition=function(e){var t,n,i,o,r,a;return(null===(i=null===(n=null===(t=e.titleDefinition)||void 0===t?void 0:t.elementDefinitions)||void 0===n?void 0:n.extensions)||void 0===i?void 0:i.length)>0||(null===(a=null===(r=null===(o=e.titleDefinition)||void 0===o?void 0:o.elementDefinitions)||void 0===r?void 0:r.officeAddIns)||void 0===a?void 0:a.length)>0},t.getETokenAndManifest=function(e){var n={};return t.IsValidAcquisition(e)&&(n.assetId=e.assetId,n.version=e.titleDefinition.version,n.manifest=JSON.stringify(e.toJSON())),n},t.getManifestAndStatus=function(e){var n={};return t.IsValidAcquisition(e)&&(n.status2=OSF.OmexClientAppStatus.OK,n.manifest=JSON.stringify(e.toJSON())),n},t.getAppStateInfo=function(e){var n={};return t.IsValidAcquisition(e)&&(n.assetId=e.assetId,n.productId=e.manifestId,n.version=e.titleDefinition.version,n.state=e.acquisitionState),n},t.getAppDetail=function(e){var n={};return t.IsValidAcquisition(e)&&(n.assetId=e.assetId,n.solutionId=e.manifestId,n.version=e.titleDefinition.version),n},t._locale="en-us",t}();e.TaosPayloadAdapter=t}(Mos||(Mos={})),function(e){var t=function(){function t(){this._appMetadataPromiseCache=new Map,this._nextInterval=0,this._requestUpdates=!1}return t.init=function(e){t.webRequestManager=e},t._setUserKey=function(e){t._userKey=e},t.prototype.saveAppMetadata=function(n){return __awaiter(this,void 0,void 0,(function(){var i;return __generator(this,(function(o){switch(o.label){case 0:return Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("[MosRequestHandler] Saving AppMetadata to indexedDB",n.correlationId,523544159),(i=Mos.TaosPayloadAdapter.appMetadataListToJSON(this._cachedAppMetadatas)).syncKey=this._syncKey,i.nextInterval=this._nextInterval,[4,e.OsfCache.set(t._cacheTable,this._cacheKey,JSON.stringify(i),!1)];case 1:return o.sent(),Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("[MosRequestHandler] Saved AppMetadata to indexedDB with Key="+this._cacheKey,n.correlationId,523544160),[2]}}))}))},t.prototype.updateAcquiredAcquisitions=function(e){var t=this._cachedAppMetadatas,n=Mos.TaosPayloadAdapter.acquisitionsToAppMetadatas(e),i=t.filter((function(e){return!0===n.some((function(t){return e.getTitleId()===t.getTitleId()}))})),o=t.filter((function(e){return-1===i.indexOf(e)}));this._cachedAppMetadatas=o.concat(n)},t.prototype.removeUnacquiredAcquisitions=function(e){var t=this._cachedAppMetadatas,n=e.map((function(e){return e.titleId}));this._cachedAppMetadatas=t.filter((function(e){return-1===n.indexOf(e.getTitleId())}))},t.prototype.cacheMetadataHandler=function(e){for(var t=[],n=[],i=[],o=0,r=e.acquisitions;o<r.length;o++){var a=r[o];a.acquisitionState.toLowerCase()===OSF.AcquisitionAcquiredState.Acquired?t.push(a):a.acquisitionState.toLowerCase()===OSF.AcquisitionAcquiredState.NeedsConsentForUpgrade?i.push(a):n.push(a)}this.removeUnacquiredAcquisitions(n),this.updateAcquiredAcquisitions(t)},t.prototype.cacheMetadata=function(e,t){Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("[MosRequestHandler] caching Mos AppMetadata list (in-memory)",t.correlationId,523646275),OSF.OUtil.isNullOrUndefined(this._cacheResponse)?this._cachedAppMetadatas=Mos.TaosPayloadAdapter.acquisitionsToAppMetadatas(e.acquisitions):this.cacheMetadataHandler(e)},t.prototype.getAcquisitionList=function(e,t){return __awaiter(this,void 0,void 0,(function(){var n,i,o,r,a,s,l;return __generator(this,(function(c){switch(c.label){case 0:n=new Mos.AcquisitionList,i=this.requestBodyForAcquisitions(e),o=0,c.label=1;case 1:return 0!=o?[3,4]:[4,this.invokeMosProxy("/catalog/v1/users/acquisitions/get",{method:OSF.HttpVerb.POST,body:i},t)];case 2:return r=c.sent(),l=(s=Mos.TaosPayloadAdapter).parseAndGetAcquisitions,[4,r.text()];case 3:return a=l.apply(s,[c.sent()]),n.push(a),i=JSON.stringify({syncKey:n.syncKey}),o=n.nextInterval,[3,1];case 4:return this._nextInterval=(new Date).getTime()+1e3*o,this._syncKey=n.syncKey,this._requestUpdates=!1,[2,n]}}))}))},t.prototype.getAppMetadataList=function(e,n){if(this._supportedElementsKey=e.sort().toString(),this._cacheKey=t._userKey+":"+this._supportedElementsKey,!this._appMetadataPromiseCache.has(this._supportedElementsKey)){var i=this.getAppMetadataListHelper(e,n);this._appMetadataPromiseCache.set(this._supportedElementsKey,i)}return this._appMetadataPromiseCache.get(this._supportedElementsKey)},t.prototype.getAppMetadataListHelper=function(e,t){return __awaiter(this,void 0,void 0,(function(){var n;return __generator(this,(function(i){switch(i.label){case 0:return Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("[MosRequestHandler] fetching Mos AppMetadata list for "+this._supportedElementsKey,null==t?void 0:t.correlationId,523646276),[4,this.getCacheAndSetLocalVars(t)];case 1:return i.sent(),this._requestUpdates||this.isCacheExpired()?[4,this.getAcquisitionList(e,t)]:[3,4];case 2:return n=i.sent(),this.cacheMetadata(n,t),[4,this.saveAppMetadata(t)];case 3:i.sent(),i.label=4;case 4:return[2,this._cachedAppMetadatas]}}))}))},t.prototype.acquire=function(e,t,n){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(i){switch(i.label){case 0:return[4,this.invokeMosProxy("/catalog/v1/users/acquisitions",{method:OSF.HttpVerb.POST,body:JSON.stringify({titleId:e,titleVersion:t})},n)];case 1:return i.sent(),this.invalidateCache(),Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("[MosRequestHandler] acquired "+e+". Invalidated cache to get updated acquisitions",null==n?void 0:n.correlationId,523646277),[2]}}))}))},t.prototype.unacquire=function(e,t){return __awaiter(this,void 0,void 0,(function(){var n;return __generator(this,(function(i){switch(i.label){case 0:return n=this.findTitleAppMetadata(e),OSF.OUtil.isNullOrUndefined(n)?(Telemetry.RuntimeTelemetryHelper.LogExceptionTag("[MosRequestHandler] title "+e+" not found.",null,null==t?void 0:t.correlationId,520898458),[2]):n.getAcquisition().canBeUnacquired?[4,this.invokeMosProxy("/catalog/v1/users/acquisitions/"+e,{method:OSF.HttpVerb.DELETE},t)]:(Telemetry.RuntimeTelemetryHelper.LogExceptionTag("[MosRequestHandler] title "+e+" cannot be unacquire.",null,null==t?void 0:t.correlationId,520898457),[2]);case 1:return i.sent(),this.invalidateCache(),Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("[MosRequestHandler] unacquired "+e+". Invalidated cache to get updated acquisitions",null==t?void 0:t.correlationId,523646278),[2]}}))}))},t.prototype.invokeMosProxy=function(e,n,i){return __awaiter(this,void 0,void 0,(function(){var o,r=this;return __generator(this,(function(a){return o=[{key:"catalog",value:"mos"},{key:"taosApiMethod",value:n.method},{key:"taosApiPath",value:e}],[2,new Promise((function(e,a){t.webRequestManager.sendWithBody("",o,n.body,2,(function(t,n){t>=500?(Telemetry.RuntimeTelemetryHelper.LogExceptionTag("[MosRequestHandler] Mos proxy request failed. Server Error. Status Code='"+t+"'.",null,i.correlationId,512570761),r.clearCache(),a(new Error("[MosRequestHandler] Mos Proxy request failed (status code = "+t+")"))):t>=400?(Telemetry.RuntimeTelemetryHelper.LogExceptionTag("[MosRequestHandler] Mos proxy request failed. Client Error. Status Code='"+t+"'.",null,i.correlationId,512570760),r.clearCache(),a(new Error("[MosRequestHandler] Mos Proxy request failed (status code = "+t+")"))):(Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("[MosRequestHandler] Mos proxy request succeeded with Status Code='"+t+"'.",i.correlationId,523646280),e({status:t,text:function(){return __awaiter(r,void 0,void 0,(function(){return __generator(this,(function(e){return[2,n]}))}))},json:function(){return __awaiter(r,void 0,void 0,(function(){return __generator(this,(function(e){return[2,JSON.parse(n)]}))}))}}))}),!0)}))]}))}))},t.prototype.getCacheAndSetLocalVars=function(n){return __awaiter(this,void 0,void 0,(function(){var i,o;return __generator(this,(function(r){switch(r.label){case 0:return OSF.OUtil.isNullOrUndefined(this._cacheResponse)?(Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("[MosRequestHandler] try to retrive IndexedDB cache with key="+this._cacheKey,null==n?void 0:n.correlationId,521443200),i=this,[4,e.OsfCache.get(t._cacheTable,this._cacheKey,!1)]):[2];case 1:return i._cacheResponse=r.sent(),OSF.OUtil.isNullOrUndefined(this._cacheResponse)?(Telemetry.RuntimeTelemetryHelper.LogExceptionTag("[MosRequestHandler] key="+this._cacheKey+" is not found in IndexedDB cache",null,null==n?void 0:n.correlationId,521443171),this.resetLocalVars(!1)):(o=Mos.TaosPayloadAdapter.parseAndGetAcquisitions(this._cacheResponse),this._cachedAppMetadatas=Mos.TaosPayloadAdapter.acquisitionsToAppMetadatas(o.acquisitions),this._nextInterval=o.nextInterval,this._syncKey=o.syncKey),[2]}}))}))},t.prototype.getClientDetails=function(){var t=e.CatalogFactory.getHostContext();return{scopes:[OSF.getManifestHostType(t.hostType).toLowerCase()],formFactors:[t.formFactor||"desktop"],capabilities:OSF.AppSpecificSetup.BuildRequirementsChecker()._getSupportedSetAsCapabilities()}},t.prototype.requestBodyForAcquisitions=function(e){return OSF.OUtil.isNullOrUndefined(this._syncKey)?JSON.stringify({Filter:{supportedElementTypes:e,clientDetails:this.getClientDetails()}}):JSON.stringify({syncKey:this._syncKey})},t.prototype.findTitleAppMetadata=function(e){for(var t,n=0,i=this._cachedAppMetadatas;n<i.length;n++){var o=i[n];if(o.getTitleId()===e){t=o;break}}return t},t.prototype.resetLocalVars=function(e){void 0===e&&(e=!0),this._cachedAppMetadatas=[],this._cacheResponse=void 0,this._syncKey=void 0,this._nextInterval=0,e&&this._appMetadataPromiseCache.delete(this._supportedElementsKey)},t.prototype.invalidateCache=function(){return __awaiter(this,void 0,void 0,(function(){var n;return __generator(this,(function(i){switch(i.label){case 0:return OSF.OUtil.isNullOrUndefined(this._cacheResponse)?[2]:((n=JSON.parse(this._cacheResponse)).nextInterval=0,[4,e.OsfCache.set(t._cacheTable,this._cacheKey,JSON.stringify(n),!1)]);case 1:return i.sent(),this.resetLocalVars(),[2]}}))}))},t.prototype.isCacheExpired=function(){return!!OSF.OUtil.isNullOrUndefined(this._cacheResponse)||(new Date).getTime()>this._nextInterval},t.prototype.clearCache=function(){this._requestUpdates=!0,this.resetLocalVars()},t._cacheTable="OSF.MOS.Acquisitions",t}();e.MosRequestHandler=t}(OfficeExt||(OfficeExt={})),function(e){var t=function(){function t(n,i){this._clientCode=n,this._clientVersion=i,t.supportedElementTypes=["OfficeAddIns","Extensions"],t._requestHandler=new e.MosRequestHandler}return t.initRequestHandler=function(t,n,i,o){void 0===o&&(o=!1),null==e.MosRequestHandler.webRequestManager&&(e.MosRequestHandler.webRequestManager=t)},t.ParseAddInList=function(e,t){return OSF.OUtil.isArrayNullOrUndefinedOrEmpty(e)?(Telemetry.RuntimeTelemetryHelper.LogExceptionTag("[MosCatalogService] ParseAddInList :: Mos.AppMetadata list is empty.","",t.correlationId,523646241),null):Mos.TaosPayloadAdapter.getPrivateCatalogAddinList(e)},t.FilterAddIns=function(e,t,n){var i=[];if(OSF.OUtil.isArrayNullOrUndefinedOrEmpty(t))return Telemetry.RuntimeTelemetryHelper.LogExceptionTag("[MosCatalogService] FilterAddIns :: Mos.AppMetadata list is empty","",n.correlationId,523646242),null;for(var o=0,r=e;o<r.length;o++)for(var a=r[o],s=0,l=t;s<l.length;s++){var c=l[s];if(a.ProductId===c._id||a.ProductId===c.getManifestId()){i.push(c);break}}return i},t.prototype.GetLastPrivateCatalogUpdate=function(e,t,n,i,o){},t.prototype.GetAddInList=function(n,i,o,r,a){return __awaiter(this,void 0,void 0,(function(){var n,i,s;return __generator(this,(function(l){switch(l.label){case 0:Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("[MosCatalogService] GetAddInList :: fetching Mos Acquisitions",o.correlationId,523646243),l.label=1;case 1:return l.trys.push([1,3,,4]),[4,t._requestHandler.getAppMetadataList(t.supportedElementTypes,o)];case 2:if(n=l.sent(),i=t.ParseAddInList(n,o),OSF.OUtil.isArrayNullOrUndefinedOrEmpty(i))throw new Error("Empty Mos Private Catalog Addin list");return r(i),[3,4];case 3:return s=l.sent(),Telemetry.RuntimeTelemetryHelper.LogExceptionTag("[MosCatalogService] GetAddInList :: MOS-Private Catalog",s,o.correlationId,523646272),a(e.DataServiceResultCode.Failed),[3,4];case 4:return[2]}}))}))},t.prototype.GetManifests=function(n,i,o,r,a,s){return __awaiter(this,void 0,void 0,(function(){var i,o,l;return __generator(this,(function(c){switch(c.label){case 0:Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("[MosCatalogService] GetManifests :: fetching Mos Acquisitions",r.correlationId,523646273),c.label=1;case 1:return c.trys.push([1,3,,4]),[4,t._requestHandler.getAppMetadataList(t.supportedElementTypes,r)];case 2:if(i=c.sent(),o=t.FilterAddIns(n,i,r),OSF.OUtil.isArrayNullOrUndefinedOrEmpty(o))throw new Error("Empty MOS-Private Catalog manifest list");return a(o),[3,4];case 3:return l=c.sent(),Telemetry.RuntimeTelemetryHelper.LogExceptionTag("[MosCatalogService] GetManifests :: MOS-Private Catalog.",l,r.correlationId,523646274),s(e.DataServiceResultCode.Failed),[3,4];case 4:return[2]}}))}))},t.prototype.ClearServiceSpecificCache=function(){t._requestHandler.clearCache()},t.SignOutUser=function(){t._requestHandler.clearCache()},t}();e.MosCatalogService=t}(OfficeExt||(OfficeExt={})),function(e){!function(e){e[e.OpenUploadFileDialog=0]="OpenUploadFileDialog",e[e.Install=1]="Install",e[e.Cancel=2]="Cancel"}(e.UploadFileDevCatelogAction||(e.UploadFileDevCatelogAction={})),function(e){e.Recommend="rlidMktplcOSFRecs",e.Landing="rlidMktplcOSFRedirect",e.ManageApps="rlidMktplcBillingMgmt"}(e.RLID||(e.RLID={})),function(e){e[e.Cancel=0]="Cancel",e[e.AppDetails=1]="AppDetails",e[e.RateReview=2]="RateReview",e[e.Remove=3]="Remove"}(e.AppManagementAction||(e.AppManagementAction={})),function(e){e.AppManagementMenu="appmanagementmenu",e.InsertionDialogSession="insertiondialogsession",e.UploadFileDevCatelog="uploadfiledevcatelog",e.UploadFileDevCatalogUsage="uploadfiledevcatalogusage"}(e.DataPointNames||(e.DataPointNames={}));var t=function(){function e(){}return e.normalizeAppVersion=function(e){for(var t=e.split("."),n=e,i=0;i<4-t.length;i++)n+=".0";return n},e.getTargetType=function(e){var t=0;switch(e){case"1":t=1;break;case"2":t=0;break;case"4":t=1;break;default:OsfMsAjaxFactory.msAjaxDebug.trace("targetType value is invalid.")}return t},e}();e.OUtilWac=t}(OSF||(OSF={})),function(e){var t=function(){function t(t,n,i,o){void 0===o&&(o=null),this._cacheManager=o||new e.AppsDataCacheManager(OSF.OUtil.getLocalStorage(),new e.SafeSerializer),this._privateCatalogService=OSF.OUtil.checkFlight(OSF.FlightTreatmentNames.MosForPrivateCatalogEnabled)?new e.MosCatalogService(OSF.OmexClientNames[t],OSF.OUtilWac.normalizeAppVersion(n)):new e.PrivateCatalogService(OSF.OmexClientNames[t],OSF.OUtilWac.normalizeAppVersion(n)),this._uiLocale=i}return t.prototype.getEntitlementAsync=function(n,i,o,r){i.startActivity(e.Activity.EntitlementCheck),r&&(this._cacheManager.RemoveAll(t._addInsCacheKey),this._cacheManager.RemoveCacheItem(t._lastCatalogUpdateKey),this._privateCatalogService.ClearServiceSpecificCache()),this.GetAddInList(n,i,(function(n){for(var r=[],a=0,s=n;a<s.length;a++){var l=s[a];l.addInState===t._addInOkState&&r.push(l)}i.stopActivity(e.Activity.EntitlementCheck),o({status:e.DataServiceResultCode.Succeeded,value:r})}),(function(e){o({status:e})}))},t.prototype.getAppDetails=function(n,i,o,r,a){var s=this,l=[],c=[];if(a)this._cacheManager.RemoveAll(t._addInDetailsCacheKeyPrefix),c=n;else for(var u=0;u<n.length;u++){var d=n[u],p=t.GetAppDetailsCacheKey(d.solutionId),f=this._cacheManager.GetCacheItem(p);f&&null!=f.storeType?l.push(f):c.push(d)}if(0!==c.length){for(var m={},h=[],g=0,y=c;g<y.length;g++){d=y[g];m[d.solutionId.toLowerCase()]=d;var v={ProductId:d.solutionId,Version:d.version,AddInState:t._addInOkState};h.push(v)}this._privateCatalogService.GetManifests(h,null,null,o,(function(n){for(var i=0;i<n.length;i++){var a,c=n[i];if(a="string"==typeof c?s.ParseAndCacheManifest(c,o):c){var u=a.getMarketplaceID(),d=m[u.toLowerCase()];if(d){var p=t.CreateAddInDetails(a,d);l.push(p);var f=t.GetAppDetailsCacheKey(d.solutionId);s._cacheManager.SetCacheItem(f,p,t._addInDetailsRefreshRateDays)}else Telemetry.RuntimeTelemetryHelper.LogExceptionTag("No entitlement found",null,o.correlationId,521216516)}}r({status:e.DataServiceResultCode.Succeeded,value:l})}),(function(e){r({status:e})}))}else r({status:e.DataServiceResultCode.Succeeded,value:l})},t.prototype.getAndCacheManifest=function(n,i,o,r){var a={ProductId:n.solutionId,Version:n.version,AddInState:t._addInOkState,StoreInfo:{AssetId:n.storeId,ContentMarket:i}};this.GetManifest(a,o,(function(t){r({status:e.DataServiceResultCode.Succeeded,value:t})}),(function(e){r({status:e})}))},t.prototype.activateAsync=function(n,i,o){var r=this;o.startActivity(e.Activity.Activation);var a=this;this.GetAddInList(!1,o,(function(s){for(var l,c=/[{}]/g,u=0,d=s;u<d.length;u++){var p=d[u];if(n.solutionId.replace(c,"").toLowerCase()===p.solutionId.replace(c,"").toLowerCase()){l=p;break}}if(l)if(l.addInState===t._addInOkState){(n=l).addInStoreInfo=l.addInStoreInfo;var f={ProductId:l.solutionId,Version:l.version,AddInState:t._addInOkState,StoreInfo:{AssetId:l.storeId,ContentMarket:""}};r.GetManifest(f,o,(function(e){i.load({entitlement:n,manifest:e,eToken:""},null)}),(function(t){e.LoaderUtil.failWithError(i,{description:Strings.OsfRuntime.L_AddinCommands_AddinNotSupported_Message,url:"",errorCode:OSF.ErrorStatusCodes.E_MANIFEST_DOES_NOT_EXIST,buttonTxt:Strings.OsfRuntime.L_RefreshButton_TXT,buttonCallback:function(){i.restartActivation(),a.activateAsync(n,i,o)}})}))}else e.LoaderUtil.failWithError(i,{description:Strings.OsfRuntime.L_AgaveDisabledByAdmin_ERR,url:"",errorCode:OSF.ErrorStatusCodes.E_OEM_OMEX_EXTENSION_KILLED});else e.LoaderUtil.showWarning(i,{description:Strings.OsfRuntime.L_AgaveNotExist_ERR,buttonTxt:Strings.OsfRuntime.L_RefreshButton_TXT,buttonCallback:function(){i.restartActivation(),a._cacheManager.RemoveAll(t._addInsCacheKey),a._cacheManager.RemoveCacheItem(t._lastCatalogUpdateKey),a.activateAsync(n,i,o)},detailView:!0,retryAll:!0,errorCode:OSF.ErrorStatusCodes.E_OEM_EXTENSION_NOT_ENTITLED})}),(function(r){e.LoaderUtil.showWarning(i,{description:OSF.OUtil.formatString(Strings.OsfRuntime.L_AgaveServerConnectionToCatalogFailed_ERR,Strings.OsfRuntime.L_AgaveAdminManagedCatalogName),buttonTxt:Strings.OsfRuntime.L_RefreshButton_TXT,buttonCallback:function(){i.restartActivation(),a._cacheManager.RemoveAll(t._addInsCacheKey),a._cacheManager.RemoveCacheItem(t._lastCatalogUpdateKey),a.activateAsync(n,i,o)},detailView:!0,retryAll:!0,errorCode:OSF.ErrorStatusCodes.WAC_AgaveActivationError}),o.stopActivity(e.Activity.Activation)}))},t.prototype.removeAsync=function(t,n,i){i({status:e.DataServiceResultCode.Failed})},t.GetAppDetailsCacheKey=function(e){return t._addInDetailsCacheKeyPrefix+OSF.OUtil.formatString(t._addInDetailsCacheKeySufix,e)},t.GetManifestCacheKey=function(e,n){return t._manifestCacheKeyPrefix+OSF.OUtil.formatString(t._manifestCacheKeySufix,e,n)},t.CreateAddInDetails=function(e,t){return{solutionId:t.solutionId,version:t.version,storeType:OSF.StoreType.PrivateCatalog,storeId:OSF.StoreType.PrivateCatalog,assetId:t.assetId,assetStoreId:t.assetStoreId,name:e.getDefaultDisplayName(),provider:e.getProviderName(),description:e.getDefaultDescription(),appSubType:String(e.getOmexTargetCode()),defaultHeight:String(e.getDefaultHeight()||0),defaultWidth:String(e.getDefaultWidth()||0),iconUrl:e.getDefaultIconUrl(),webApplicationId:e.getWebApplicationId(),requirements:e.getRequirementsXml(),hosts:e.getHostsXml(),highResolutionIconUrl:e.getDefaultHighResolutionIconUrl()}},t.prototype.GetAddInList=function(e,n,i,o){var r,a=this;e||!(r=this._cacheManager.GetCacheItem(t._addInsCacheKey))?this._privateCatalogService.GetAddInList(null,null,n,(function(e){for(var n=0,o=e;n<o.length;n++){var r=o[n],s=t.GetAppDetailsCacheKey(r.solutionId),l=a._cacheManager.GetCacheItem(s);l&&l.version!==r.version&&a._cacheManager.RemoveCacheItem(s)}a._cacheManager.SetCacheItem(t._addInsCacheKey,e,t._addInListRefreshRateDays),i(e)}),o):i(r)},t.prototype.GetManifest=function(n,i,o,r){var a=this;i.startActivity(e.Activity.ManifestRequest);var s=OSF.OsfManifestManager.getCachedManifest(n.ProductId,n.Version);if(s)return i.stopActivity(e.Activity.ManifestRequest),void o(s);var l=t.GetManifestCacheKey(n.ProductId,n.Version),c=this._cacheManager.GetCacheItem(l);if(c)return(s=new OSF.Manifest.Manifest(c,this._uiLocale))?(OSF.OsfManifestManager.cacheManifest(n.ProductId,n.Version,s),i.stopActivity(e.Activity.ManifestRequest),void o(s)):void r(e.DataServiceResultCode.Failed);this._privateCatalogService.GetManifests([n],null,null,i,(function(t){var s;(s="string"==typeof t[0]?a.ParseAndCacheManifest(t[0],i):t[0])?(OSF.OsfManifestManager.cacheManifest(n.ProductId,n.Version,s),i.stopActivity(e.Activity.ManifestRequest),o(s)):r(e.DataServiceResultCode.Failed)}),(function(e){r(e)}))},t.prototype.ParseAndCacheManifest=function(e,n){try{var i=new OSF.Manifest.Manifest(e,this._uiLocale),o=t.GetManifestCacheKey(i.getMarketplaceID(),i.getMarketplaceVersion());return this._cacheManager.SetCacheItem(o,e,t._addInManifestRefreshRateDays),i}catch(e){Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Invalid manifest retrieved from Private Catalog.",e,n.correlationId,523248984)}return null},t._addInsCacheKey="__OSF_PRIVATECATALOG_ADDINS",t._addInDetailsCacheKeyPrefix="__OSF_PRIVATECATALOG_ADDINDETAILS",t._addInDetailsCacheKeySufix="_{0}",t._manifestCacheKeyPrefix="__OSF_PRIVATECATALOG_MANIFEST",t._manifestCacheKeySufix="_{0}_{1}",t._lastCatalogUpdateKey="_OSF_PRIVATECATALOG_LASTUPDATE",t._addInListRefreshRateDays=1/24,t._addInDetailsRefreshRateDays=365,t._addInManifestRefreshRateDays=365,t._addInOkState="Ok",t}();e.PrivateCatalog=t,e.CatalogFactory.register(OSF.StoreType.PrivateCatalog,(function(n){if(n.enablePrivateCatalog)return new t(n.appName,n.appVersion,n.appUILocale);return new e.ForbiddenCatalog({loaderParams:null,loaderParamsFunction:function(){return e.LoaderUtil.error({description:OSF.OUtil.formatString(Strings.OsfRuntime.L_AgaveCatalogNotEnabled_ERR,Strings.OsfRuntime.L_AgaveAdminManagedCatalogName),errorCode:OSF.ErrorStatusCodes.E_EXCHANGE_PRIVATE_CATALOG_DISABLED})},controlStatus:OSF.OsfControlStatus.ActivationFailed})}))}(OfficeExt||(OfficeExt={})),function(e){var t=function(){function t(e,t){this._clientCode=e,this._clientVersion=t}return t.initRequestHandler=function(n,i,o,r){void 0===r&&(r=!1),null==t._requestHandler&&(t._requestHandler=n),null==t.authenticationProxy&&(t.authenticationProxy=i),t._isThirdPartyHostEnabled=o,t._resultCodeIsEnabled=r&&!0===r,t._tokenCacheManager=new e.TokenCacheManager(OSF.OUtil.getLocalStorage(),new e.SafeSerializer),t._cacheManager=new e.AppsDataCacheManager(OSF.OUtil.getLocalStorage(),new e.SafeSerializer)},t.ParseAddInList=function(e,t){var n,i=[];try{n=JSON.parse(e)}catch(e){return Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Could not parse GetAddIns response.",e,t.correlationId,523613456),null}if(!n||!n.AddIns)return Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("GetPrivateCatalogAddIns response could not be parsed.",t.correlationId,523613457),i;for(var o=0,r=n.AddIns;o<r.length;o++){var a=r[o];if(a.AddInState&&a.ProductId&&a.Version){var s={solutionId:a.ProductId,version:a.Version,storeType:OSF.StoreType.PrivateCatalog,storeId:OSF.StoreType.PrivateCatalog,assetId:a.StoreInfo?a.StoreInfo.AssetId:null,assetStoreId:a.StoreInfo?a.StoreInfo.ContentMarket:null,targetType:OSF.OsfControlTarget.Undefined,addInState:a.AddInState,addInStoreInfo:a.StoreInfo,installTimeInMS:a.InstallTimeInMS?a.InstallTimeInMS:0};i.push(s)}else Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("Add-In metadata was missing some data.",t.correlationId,523613458)}return i},t.ParseAndCacheManifestList=function(e,n){var i,o=[];try{i=JSON.parse(e)}catch(e){return Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Could not parse GetManifests response.",e,n.correlationId,523613459),null}if(!i||!i.Manifests)return Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("GetAddInManifests response could not be parsed.",n.correlationId,523613460),o;for(var r=0,a=i.Manifests;r<a.length;r++){var s=a[r];o.push(s)}return t.StoreAuthenticationData(i),o},t.StoreAuthenticationData=function(e){t._tokenCacheManager.AddRefreshToken(e.RefreshToken,e.UserId,e.TenantId),t._userId=e.UserId,t._tenantId=e.TenantId},t.prototype.GetLastPrivateCatalogUpdate=function(n,i,o,r,a){t._requestHandler.getLastPrivateCatalogUpdate(this._clientCode,this._clientVersion,n,i,o.correlationId,(function(n,i){if(t._resultCodeIsEnabled){if(200===n){var s=t.ParsePrivateCatalogServiceResponse(i,o);if(!s)return void a(e.DataServiceResultCode.Failed);if(1===s.ResponseCode){try{l=JSON.parse(i)}catch(t){return Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Could not parse GetLastPrivateCatalogUpdate reponse.",t,o.correlationId,523613461),void a(e.DataServiceResultCode.Failed)}return l&&l.LastUpdate?(t.StoreAuthenticationData(l),void r(l.LastUpdate)):(Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("GetLastPrivateCatalogUpdate response could not be parsed.",o.correlationId,523613462),void a(e.DataServiceResultCode.Failed))}return void t.HandleLogging(s,o,a)}}else{if(200===n){var l;try{l=JSON.parse(i)}catch(t){return Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Could not parse GetLastPrivateCatalogUpdate reponse.",t,o.correlationId,523613463),void a(e.DataServiceResultCode.Failed)}return l&&l.LastUpdate?(t.StoreAuthenticationData(l),void r(l.LastUpdate)):(Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("GetLastPrivateCatalogUpdate response could not be parsed.",o.correlationId,523613464),void a(e.DataServiceResultCode.Failed))}if(403===n)return Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Private Catalog: GetLastPrivateCatalogUpdate authentication failed with HPA auth flow.",null,o.correlationId,523613465),void a(e.DataServiceResultCode.Unauthenticated)}Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Private Catalog: GetLastPrivateCatalogUpdate request failed with status code "+n,null,o.correlationId,523613467),a(e.DataServiceResultCode.Failed)}))},t.prototype.GetAddInList=function(n,i,o,r,a){t._requestHandler||Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Private Catalog: GetAddInList PrivateCatalogService._requestHandler is not defined",null,o.correlationId,523613468),t._requestHandler.getPrivateCatalogAddIns(this._clientCode,this._clientVersion,n,i,o.correlationId,(function(n,i){if(t._resultCodeIsEnabled){if(200===n)return(l=t.ParsePrivateCatalogServiceResponse(i,o))?1===l.ResponseCode?(s=t.ParseAddInList(i,o))?void r(s):void a(e.DataServiceResultCode.Failed):void t.HandleLogging(l,o,a):void a(e.DataServiceResultCode.Failed)}else{var s;if(200===n)return(s=t.ParseAddInList(i,o))?void r(s):void a(e.DataServiceResultCode.Failed);if(403===n)return Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Private Catalog: GetAddInList authentication failed with HPA auth flow.",null,o.correlationId,523613469),void a(e.DataServiceResultCode.Unauthenticated)}var l=t.ParsePrivateCatalogServiceResponse(i,o);if(403===n)return Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Private Catalog: GetAddInList authentication failed with HPA auth flow.",null,o.correlationId,512234501),l?void t.HandleLogging(l,o,a):void a(e.DataServiceResultCode.Unauthenticated);var c=l?l.ResponseCode:0;Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Private Catalog: GetAddInList request failed with status code "+n+" and responseCode "+c,null,o.correlationId,523613471),a(e.DataServiceResultCode.Failed)}))},t.prototype.GetManifests=function(n,i,o,r,a,s){var l={AddIns:n,RefreshToken:o,ResponseCode:1,UserId:"",TenantId:""};t._requestHandler.getPrivateCatalogManifests(e.WACUtils.serializeObjectToString(l),i,o,r.correlationId,(function(n,i){if(t._resultCodeIsEnabled){if(200===n){var o=t.ParsePrivateCatalogServiceResponse(i,r);return o?1===o.ResponseCode?(l=t.ParseAndCacheManifestList(i,r))?void a(l):void s(e.DataServiceResultCode.Failed):void t.HandleLogging(o,r,s):void s(e.DataServiceResultCode.Failed)}}else{var l;if(200===n)return(l=t.ParseAndCacheManifestList(i,r))?void a(l):void s(e.DataServiceResultCode.Failed);if(403===n)return Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Private Catalog: GetManifests authentication failed with HPA auth flow.",null,r.correlationId,523613473),void s(e.DataServiceResultCode.Unauthenticated)}Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Private Catalog: GetManifests request failed with status code "+n,null,r.correlationId,523613475),s(e.DataServiceResultCode.Failed)}))},t.prototype.ClearServiceSpecificCache=function(){},t.TryGetRefreshToken=function(e,n){var i;try{i=JSON.parse(e)}catch(e){Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("Failed to parse response into PrivateCatalogServiceResponse object.",n.correlationId,523613504)}return i?t._tokenCacheManager.GetRefreshToken(i.UserId,i.TenantId):null},t.HandleLogging=function(n,i,o){if(!n)return Telemetry.RuntimeTelemetryHelper.LogExceptionTag("PrivateCatalogService.HandleLogging: parsedResponse object is null.",null,i.correlationId,523613505),void o(e.DataServiceResultCode.Failed);if(4===n.ResponseCode||5===n.ResponseCode)return 5===n.ResponseCode?Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("PrivateCatalogService: User not authenticated.",null,523613506):Telemetry.RuntimeTelemetryHelper.LogExceptionTag("PrivateCatalogService: All authentication attempts failed. ResponseCode: "+n.ResponseCode,null,i.correlationId,523613507),void o(t._isThirdPartyHostEnabled?e.DataServiceResultCode.Unauthenticated:e.DataServiceResultCode.Failed);var r=e.DataServiceResultCode.Failed;0!==n.ResponseCode&&7!==n.ResponseCode||Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Call to AddinServiceHandler failed. ResponseCode: "+n.ResponseCode,null,i.correlationId,523613508),6===n.ResponseCode&&(Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("PrivateCatalogService: User not supported.",null,523613509),r=e.DataServiceResultCode.UserResolutionNoMailbox),Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("PCS RCode: "+n.ResponseCode,null,523613510),o(r)},t.ParsePrivateCatalogServiceResponse=function(e,t){var n;try{n=JSON.parse(e)}catch(e){Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("Failed to parse response into PrivateCatalogServiceResponse object.",t.correlationId,523613511)}return n},t.SignOutUser=function(){Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag(OSF.OUtil.formatString("PrivateCatalogService.SignOutUser: userId = {0}, tenantId = {1}",t._userId,t._tenantId),null,523613512),t._tokenCacheManager.RemoveRefreshToken(t._userId,t._tenantId),t.authenticationProxy.signOut((function(){t._cacheManager.RemoveAll(e.PrivateCatalog._addInsCacheKey),t._cacheManager.RemoveAll(e.PrivateCatalog._addInDetailsCacheKeyPrefix)}),(function(){Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("Private Catalog: Failed to sign out ",null,523613513)}))},t._maxAuthenticationAttempts=3,t._authenticationTimeout=3e3,t}();e.PrivateCatalogService=t}(OfficeExt||(OfficeExt={})),function(e){var t=function(){function t(){}return t.recordActivity=function(e,t,n,i){otel&&otel.sendActivityEvent&&(OSF.OUtil.sendActivityEvent("Office.Online.Sdx."+e,performance.now()-t,n,i)||otel.sendActivityEvent({name:"Office.Online.Sdx."+e,durationMs:performance.now()-t,succeeded:n,dataFields:i}))},t.recordActivationActivity=function(e,n){t.recordActivity("Activation",n.activationStart,e,[{name:"PerformanceTimestampOrigin",double:n.performanceTimestampOrigin},{name:"OsfControlId",string:n.osfControlId},{name:"AssetId",string:n.assetId},{name:"FFN",string:n.ffn},{name:"Version",string:n.version},{name:"SourceLocationOverrideResourceId",string:n.sourceLocationOverrideResourceId},{name:"IframeUrl",string:n.iframeUrl},{name:"CachedUrls",string:n.cachedUrls},{name:"ActivationStart",double:n.activationStart},{name:"ActivateAsyncStart",double:n.activateAsyncStart},{name:"PackageListRetrievalStart",double:n.packageListRetrievalStart},{name:"PackageListRetrievalEnd",double:n.packageListRetrievalEnd},{name:"PackageListParseStart",double:n.packageListParseStart},{name:"PackageListParseEnd",double:n.packageListParseEnd},{name:"ManifestRetrievalStart",double:n.manifestRetrievalStart},{name:"ManifestRetrievalEnd",double:n.manifestRetrievalEnd},{name:"ManifestParseStart",double:n.manifestParseStart},{name:"ManifestParseEnd",double:n.manifestParseEnd},{name:"IframeCreateStart",double:n.iframeCreateStart},{name:"IframeCreateEnd",double:n.iframeCreateEnd},{name:"GetAppContextStart",double:n.getAppContextStart},{name:"GetAppContextEnd",double:n.getAppContextEnd},{name:"IframeOnLoadReceived",double:n.iframeOnLoadReceived},{name:"ErrorMessage",string:n.errorMessage},{name:"OfficeJsReadyDate",double:n.officeJsReadyDate},{name:"IsPreload",boolean:!0===n.isPreload},{name:"SdxPreloadStart",string:n.sdxPreloadStart}])},t.InitializeSdx=function(n){OSF.OUtil.getValue(n.flightingTreatmentVariables,{});var i=OSF.OUtil.getValue(n.generalParameters,{});if(t.appName=OSF.OUtil.getValue(i.Application,"Unknown"),t.wacCdnRssUrl=OSF.OUtil.getValue(i.wacCdnRssUrl,""),t.ValidCdnUrlForSdxPrefetcherRegExp.test(i.StaticContentUrl)){var o=i.StaticContentUrl+"sdxprefetcher.htm";t.PrefetcherIframeOrigin=e.WACUtils.getDomainForUrl(o),t.PrefetcherIframeContentWindow=new Promise((function(e){var t=document.createElement("iframe");t.src=o,t.style.display="none",t.onload=function(){return e(t.contentWindow)},t.setAttribute("sandbox","allow-same-origin allow-scripts"),document.getElementsByTagName("body")[0].appendChild(t)}))}t.setDmsSdxPackageFromList(OSF.OUtil.getValue(i.DmsSdxList,null)),t.InitializeSdxList(i.SdxDmsUrl,i.SdxCdnUrl,i.UICulture,i.Application,i.LoggableUserId,i.SessionStartInfoJson)},t.MarkSdxPreloadStart=function(e){var n=e.toLowerCase();t.SdxPreloadStart[n]=performance.now()},t.IsSdxPreloaded=function(e){var n=e.toLowerCase();return t.SdxPreloadStart.hasOwnProperty(n)},t.GetPackageList=function(t,n,i,o,r,a){void 0===a&&(a=!1);var s,l=window.fetch||e.AsyncUtil.fetch;try{var c=JSON.parse(r).AudienceGroup.toLowerCase();s={automation:"Dogfood",microsoft:"Microsoft",dogfood:"Dogfood"}[c]||"Production"}catch(e){Telemetry.RuntimeTelemetryHelper.LogExceptionTag('Error in determining ring for DMS request, default to "Production".',e,null,523645518),s="Production"}var u="SDXPackageList_"+i+"_"+n.toLowerCase(),d=0;return e.AsyncUtil.Cache.hasOwnProperty(u)||void 0===window.prefetchedDmsResponse||(e.AsyncUtil.Cache[u]=window.prefetchedDmsResponse,delete window.prefetchedDmsResponse),e.AsyncUtil.withCache(u,{forceUpdateCache:a,maxAgeInSecs:3600,useStaleCache:!0},(function(){return e.AsyncUtil.retry((function(){++d;var e=OSF.OUtil.Guid.generateNewGuid();return Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("Making network call to DMS. DMSActivityId="+e,null,523645519),l(t,{method:"POST",body:JSON.stringify({Context:{Hosts:[i],ReactNativeVersion:"0.0.0.0",Channel:"DevMain",Capabilities:OSF.AppSpecificSetup.BuildRequirementsChecker()._getSupportedSetAsCapabilities(),Ring:s,Platform:"Web",Locales:[n],ClientId:o},SyncId:0}),headers:{"Content-Type":"application/json",DMSActivityId:e}}).then((function(e){if(!e.ok)throw new Error(e.status+" - "+e.statusText);return e.text()}),(function(t){throw new Error(JSON.stringify({Method:"GetPackageList",dmsActivityId:""+e,"fetch attempts":""+d,Exception:""+t.message}))}))}))}))},t.GetManifest=function(n,i,o,r){void 0===r&&(r=!1);var a=window.fetch||e.AsyncUtil.fetch,s=t.GetManifestCdnUrl(n,i),l=OSF.OUtil.hashCode(s);return e.AsyncUtil.withCache("SDXManifest_"+i.AssetId+"_"+i.FFN+"_"+i.Version+"_"+l,{forceUpdateCache:r,maxAgeInSecs:259200,useStaleCache:!0},(function(){return e.AsyncUtil.retry((function(){return Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("Making network call to CDN. Url="+s,null,523645520),a(s).then((function(e){if(!e.ok)throw new Error(e.status+" - "+e.statusText);return e.text()}),(function(e){throw new Error(JSON.stringify({Method:"GetManifest",Exception:""+e.message}))}))}))}))},t.GetManifestCdnUrl=function(e,t){return OSF.OUtil.formatString(e,t.AssetId,t.FFN,t.Version,"en-us")},t.IsAbsoluteUrl=function(e){return/^(?:[a-z]+:)?\/\//i.test(e)},t.ResolveUrl=function(e,n){if(t.IsAbsoluteUrl(n))return n;var i=e.lastIndexOf("/");return e.substr(0,i)+("/"===n.charAt(0)?"":"/")+n},t.UpdateManifestIconUrl=function(e,n,i){for(var o="en-US",r=0,a=["_iconUrls","_highResolutionIconUrls"];r<a.length;r++){var s=a[r];if(e[s])if(e[s][i])e[s][i]=t.ResolveUrl(n,e[s][i]);else if(e[s]["en-US"])e[s][i]=t.ResolveUrl(n,e[s]["en-US"]);else for(var l in e[s])if(e[s].hasOwnProperty(l)&&o.toLowerCase()==l.toLowerCase()){e[s][l]=t.ResolveUrl(n,e[s][l]);break}}},t.InitializeSdxList=function(e,n,i,o,r,a){var s=t.defaultDMSData?Promise.resolve(t.defaultDMSData):t.GetPackageList(e,i,OSF.getManifestHostType(o),r,a,!0).then((function(e){var t=e.value;return JSON.parse(t).Packages}));s.then((function(e){return e.forEach((function(e){return t.requestIdleCallback((o=e,function(){return t.GetManifest(n,o,i,!0).catch((function(){}))}));var o})),e}),(function(e){var t=OSF.OUtil.getLocalStorage().isLocalStorageAvailable();Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Error in getting SDX package list:InitializeSdxList localStorage:"+t,e,null,523645521)})),t.SdxCdnManifestUrlByAssetId=s.then((function(e){var i={};return e.forEach((function(e){i[e.AssetId.toLowerCase()]=t.GetManifestCdnUrl(n,e)})),i}))},t.PrefetchUrl=function(n,i){if(void 0===i&&(i=!1),!t.PrefetchedAssetSet.hasOwnProperty(n)){var o={start:performance.now()};if(t.PrefetchedAssetSet[n]=o,t.PrefetcherIframeContentWindow)t.PrefetcherIframeContentWindow.then((function(e){e.postMessage({action:"prefetch",type:"link",urls:[n]},t.PrefetcherIframeOrigin)}));else if(i){var r=document.createElement("link");r.rel="prefetch",r.href=n,r.onload=function(){o.end=performance.now()},document.head.appendChild(r)}else{var a=window.fetch||e.AsyncUtil.fetch;t.requestIdleCallback((function(){a(n,{mode:"no-cors"}).then((function(){o.end=performance.now()}))}))}}},t.ResolveRelativeUrl=function(e,n){return t.SdxCdnManifestUrlByAssetId.then((function(i){var o=i[n.toLowerCase()];if(null==o)throw new Error("Unable to find manifestUrl");return t.ResolveUrl(o,e)}))},t.PrefetchAsset=function(e,n,i,o){var r=e.match(t.OfficeJsEntryRegex);if(null===r){var a=!1;"iframeUrl:"===e.slice(0,10)&&(e=e.slice(10),a=!0),t.IsAbsoluteUrl(e)?t.PrefetchUrl(e,a):a?t.ResolveRelativeUrl(e,o).then((function(e){return t.PrefetchUrl(e,!0)}),(function(e){})):t.ResolveRelativeUrl(e,o).then((function(e){return t.PrefetchUrl(e,!1)}),(function(e){}))}else{var s=r[1],l=r[2],c="https://appsforoffice.microsoft.com/lib/"+r[3]+"/hosted/",u=i.toLowerCase(),d=OSF.HostSpecificFileVersionMap[u].web||OSF.HostSpecificFileVersionDefault;t.PrefetchUrl(""+c+s),t.PrefetchUrl(""+c+u+"-web-"+d+(l||"")+".js"),t.PrefetchUrl(c+"en-us/office_strings.js"),t.PrefetchUrl(c+"telemetry/oteljs_agave.js"),t.PrefetchUrl(c+"webauth/webauth.browserauth.js")}},t.PrefetchSdxAssets=function(e,n,i,o){var r=e.SdxAssetsToPrefetchMapping;if(null!=r&&!t.IsSdxPreloaded(o)){var a=[],s=[];try{a=JSON.parse(n["Microsoft.Office.OEP."+o.toUpperCase()+".SdxPrefetchAssetsToAdd"]||"[]"),s=JSON.parse(n["Microsoft.Office.OEP."+o.toUpperCase()+".SdxPrefetchAssetsToRemove"]||"[]")}catch(e){Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Error in parsing the sdx prefetch override flighting treatment variables.",e,null,523645522)}if("Word"===i){var l;try{l=JSON.parse(r)[o.toLowerCase()]}catch(e){return void t.LogSDXCatalogMonitoringError("Parsing SdxAssetsToPrefetchMapping failed.",o)}if(Array.isArray(l))for(var c=0,u=l;c<u.length;c++){var d=u[c];-1===s.indexOf(d)&&t.PrefetchAsset(d,e,i,o)}else for(var p=0,f=Object.keys(l);p<f.length;p++){var m=f[p],h=!1;if(""===m)h=!0;else{var g=m.split("=="),y=g[0],v=g[1];(e[y]==v||n["Microsoft.Office."+y]==v)&&(h=!0)}if(h)for(var S=0,_=l[m];S<_.length;S++){d=_[S];-1===s.indexOf(d)&&t.PrefetchAsset(d,e,i,o)}}for(var C=0,A=a;C<A.length;C++){d=A[C];t.PrefetchAsset(d,e,i,o)}}}},t.AddWacSettingParametersToIframeUrl=function(e,t){var n=document.createElement("a");n.href=e;var i=Object.keys(t).map((function(e){return"wacSetting"+e+"="+encodeURIComponent(t[e].toString())})).join("&"),o=n.search.length>1?n.search.substr(1)+"&":"";return n.search=o+i,n.href},t.activateAsync=function(n,i,o,r,a,s){o.startActivity(e.Activity.Activation);var l=n.solutionId;s.activateAsyncStart=performance.now(),s.assetId=l.toUpperCase();var c=e.CatalogFactory.getHostContext();Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("Start activating SDX with assetId: "+l+".",o.correlationId,523645523),o.startActivity(e.Activity.ServerCall);var u=null,d=performance.now();s.packageListRetrievalStart=performance.now(),(t.defaultDMSData?Promise.resolve({cacheType:"memory",packages:t.defaultDMSData}):t.GetPackageList(c.sdxDmsUrl,c.appUILocale,OSF.getManifestHostType(c.hostType),a.clientId,a.sessionStartInfoJson).then((function(e){var t=e.cacheType,n=e.value;s.packageListRetrievalEnd=performance.now(),s.packageListParseStart=performance.now();var i={cacheType:t,packages:JSON.parse(n).Packages};return s.packageListParseEnd=performance.now(),i}))).then((function(e){var n=e.cacheType,i=e.packages;return t.recordActivity("PackageListRetrieval",d,!0,[{name:"OsfControlId",string:o.instanceId},{name:"WasCachedInMemory",bool:"memory"==n}]),i}),(function(e){throw Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Error in getting Manifest:activateAsync",e,null,523645524),s.packageListRetrievalEnd=performance.now(),t.recordActivity("PackageListRetrieval",d,!1,[{name:"OsfControlId",string:o.instanceId},{name:"WasCachedInMemory",bool:!1}]),e.sdxErrorCode=OSF.ErrorStatusCodes.WAC_SDX_DMSRequestFailed,e})).then((function(e){if(null==(u=e.filter((function(e){return e.AssetId.toLowerCase()==l.toLowerCase()}))[0])){var t=new Error('Unable to find SDX "'+l+'" in the package list.');throw t.sdxErrorCode=OSF.ErrorStatusCodes.WAC_SDX_AssetIdNotInDMSResponse,t}return u})).then((function(n){o.startActivity(e.Activity.ManifestRequest);var i=performance.now();return s.manifestRetrievalStart=performance.now(),s.ffn=n.FFN,s.version=n.Version,t.GetManifest(c.sdxCdnUrl,n,c.appUILocale).then((function(e){var r=e.cacheType,a=e.value;return s.manifestRetrievalEnd=performance.now(),t.recordActivity("ManifestRetrieval",i,!0,[{name:"OsfControlId",string:o.instanceId},{name:"AssetId",string:n.AssetId},{name:"FFN",string:n.FFN},{name:"Version",string:n.Version},{name:"WasCachedInMemory",bool:"memory"==r}]),a}),(function(e){throw s.manifestRetrievalEnd=performance.now(),t.recordActivity("ManifestRetrieval",i,!1,[{name:"OsfControlId",string:o.instanceId},{name:"AssetId",string:n.AssetId},{name:"FFN",string:n.FFN},{name:"Version",string:n.Version},{name:"WasCachedInMemory",bool:!1}]),e.sdxErrorCode=OSF.ErrorStatusCodes.WAC_AgaveManifestRequestFailure,e}))})).then((function(n){s.manifestParseStart=performance.now();var i=e.ManifestUtil.ParseManifest(n,c.appUILocale,o.correlationId);if(s.manifestParseEnd=performance.now(),t.recordActivity("ManifestParse",s.manifestParseStart,null!=i,[{name:"OsfControlId",string:o.instanceId},{name:"AssetId",string:u.AssetId},{name:"FFN",string:u.FFN},{name:"Version",string:u.Version}]),null==i){var r=new Error("Unable to parse manifest.");throw r.sdxErrorCode=OSF.ErrorStatusCodes.WAC_AgaveManifestRequestFailure,r}return OSF.OsfManifestManager.cacheManifest(u.AssetId,"",i),i})).then((function(r){o.stopActivity(e.Activity.ServerCall),o.stopActivity(e.Activity.ManifestRequest);var a=t.GetManifestCdnUrl(c.sdxCdnUrl,u);t.UpdateManifestIconUrl(r,a,c.appUILocale),s.cachedUrls=JSON.stringify(t.PrefetchedAssetSet),s.sdxPreloadStart=JSON.stringify(t.SdxPreloadStart),s.performanceTimestampOrigin=Date.now()-performance.now(),i.load({entitlement:n,manifest:r,eToken:"",manifestUrl:a},null)}),(function(c){if(s.errorMessage=c.toString(),s.cachedUrls=JSON.stringify(t.PrefetchedAssetSet),s.sdxPreloadStart=JSON.stringify(t.SdxPreloadStart),s.performanceTimestampOrigin=Date.now()-performance.now(),e.SDXCatalog.recordActivationActivity(!1,s),Telemetry.RuntimeTelemetryHelper.LogExceptionTag("SDX Catalog Error AssetId: "+l,c,null,523645525),null!=c.sdxErrorCode){var u=e.HostFeatureEnabledInfo.getHostFeatureEnabledInfo(),d=u&&u.enableFirstPartySDXErrorMessages;e.LoaderUtil.failWithError(i,{title:d?Strings.OsfRuntime.L_AgaveErrorTile_TXT_FirstParty:Strings.OsfRuntime.L_AgaveErrorTile_TXT,description:d?Strings.OsfRuntime.L_AgaveServerConnectionFailed_ERR_FirstParty:Strings.OsfRuntime.L_AgaveServerConnectionFailed_ERR,buttonTxt:Strings.OsfRuntime.L_RetryButton_TXT,buttonCallback:function(){i.restartActivation(),t.activateAsync(n,i,o,r,a,s)},errorCode:c.sdxErrorCode})}}))},t.LogSDXCatalogMonitoringError=function(e,t){Telemetry.RuntimeTelemetryHelper.LogExceptionTag("SDX Catalog Error AssetId: "+t+" Message: "+e,null,null,523645526)},t.setDmsSdxPackageFromList=function(e){if(t.defaultDMSData=null,e){var n=e.split(";").filter(Boolean).map((function(e){var t=e.split(",").map((function(e){return e.trim()}));return{AssetId:t[0],Version:t[1],FFN:t[2]}}));t.defaultDMSData=n}},t.appName="Unknown",t.defaultDMSData=null,t.wacCdnRssUrl="",t.PrefetchedAssetSet={},t.OfficeJsEntryRegex=/^(office(\.debug)?\.js)@(1|1\.0|1\.1|beta)$/i,t.SdxPreloadStart={},t.PrefetcherIframeContentWindow=null,t.PrefetcherIframeOrigin=null,t.ValidHostUrlForSdxPrefetcherRegExp=new RegExp("^https://.*\\.officeapps\\.live\\.com/"),t.ValidCdnUrlForSdxPrefetcherRegExp=new RegExp("^https://.*\\.office\\.net(:443)?/"),t.requestIdleCallback=window.requestIdleCallback?window.requestIdleCallback.bind(window):e.AsyncUtil.limitRate((function(e){return e()}),50),t}();e.SDXCatalog=t}(OfficeExt||(OfficeExt={})),function(e){var t=function(){function e(){}return e.CheckProxyIsReady="OEM_isProxyReady",e.GetEntitlementSummary="OEM_getEntitlementSummaryAsync",e.GetManifest="OEM_getManifestAsync",e.GetSPCatalogUrl="OEM_getSPCatalogUrlAsync",e.IsUpnMatch="OEM_isUpnMatchAsync",e}();e.SPCatalogProxyMethods=t;var n=function(){function e(){this.iframeProxies={},this.iframeProxyCount=0}return e.iframeNamePrefix="__officeExtensionProxy",e}();e.IframeProxyGroup=n;var i=function(i){function o(e,t){var n=i.call(this)||this;return n.proxyUrl=e,n.iframeProxyGroup=t,n}return __extends(o,i),o.prototype.getEntitlementsAsync=function(e,n){this.invokeProxyCommandAsync(t.GetEntitlementSummary,e,n)},o.prototype.getManifestAsync=function(e,n){this.invokeProxyCommandAsync(t.GetManifest,e,n)},o.prototype.getSPCatalogUrlAsync=function(e,n){this.invokeProxyCommandAsync(t.GetSPCatalogUrl,e,n)},o.prototype.isUpnMatchAsync=function(e,n){this.invokeProxyCommandAsync(t.IsUpnMatch,e,n)},o.prototype.prepareProxy=function(e,t){this.isReady?e({status:null,value:{clientEndpoint:this.clientEndPoint}}):this.clientEndPoint?this.pendingCallbacks.push([e,t]):this.createProxy(e,t)},o.resetProxy=function(e){delete e.iframeProxyGroup.iframeProxies[e.proxyUrl],e.iframeProxyGroup.iframeProxyCount=e.iframeProxyGroup.iframeProxyCount-1,Microsoft.Office.Common.XdmCommunicationManager.getClientEndPoint(e.conversationId)&&Microsoft.Office.Common.XdmCommunicationManager.deleteClientEndPoint(e.conversationId),e.iframe&&(OSF.OUtil.removeEventListener(e.iframe,"load",e.iframeOnload),e.iframe.parentNode.removeChild(e.iframe),e.iframe=null),e.clientEndPoint=null},o.AddTrustedLocation=function(e,t){if(o.GetTrustedLocations()[e]=!0,t){var n=o.GetTrustedLocationsPersistedCache(),i=n.getTrustedLocations();i[e]=!0,n.setTrustedLocations(i)}},o.prototype.createProxy=function(i,r){try{if(!OSF.OUtil.doesUrlHaveSupportedProtocol(this.proxyUrl))return void r({status:null,value:{errorMessage:"Protocal of proxyUrl is not supported."}});var a=!1,s=this.proxyUrl.toLowerCase(),l=o.GetTrustedLocations();for(var c in l)if(c.toLowerCase()==s){a=l[c];break}if(!0!==a)return void r({status:e.DataServiceResultCode.ProxyUrlNotTrusted,value:{errorMessage:"ProxyUrl is not trusted."}});this.iframeProxyGroup.iframeProxies[this.proxyUrl]=this,this.iframeProxyGroup.iframeProxyCount=this.iframeProxyGroup.iframeProxyCount+1;var u=this.proxyUrl,d=u.length;"/"===u.charAt(d-1)&&(u=u.substr(0,d-1));var p=document.createElement("iframe"),f=n.iframeNamePrefix+this.iframeProxyGroup.iframeProxyCount;p.setAttribute("id",f),p.setAttribute("name",f),p.setAttribute("role","none");var m=u+"/_layouts/15/OfficeExtensionManager.aspx?"+this.conversationId,h=window.location.origin;m=OSF.OUtil.addXdmInfoAsHash(m,this.conversationId+"|"+f+"|"+h),m=OSF.OUtil.addSerializerVersionAsHash(m,OSF.SerializerVersion.Browser),m=OSF.OUtil.addFlightsAsHash(m,JSON.stringify(OSF.Flights)),m=OSF.OUtil.addDisabledChangeGatesAsHash(m,JSON.stringify(OSF.DisabledChangeGates)),p.setAttribute("scrolling","auto"),p.setAttribute("border","0"),p.setAttribute("width","0"),p.setAttribute("height","0"),p.setAttribute("style","position: absolute; left: -100px; top:0px;");var g=this;document.body.appendChild(p);var y=function(){if(g.clientEndPoint=Microsoft.Office.Common.XdmCommunicationManager.connect(g.conversationId,p.contentWindow,g.proxyUrl),g.clientEndPoint)g.clientEndPoint.invoke(t.CheckProxyIsReady,(function(e,t){var n=null;0===e&&t.status?(g.isReady=!0,n={status:null,value:{clientEndpoint:g.clientEndPoint}}):(o.resetProxy(g),n={status:null,value:{errorMessage:"isProxyReadyCallback failed, error code "+e}});for(var i=g.pendingCallbacks.length,r=0;r<i;r++){var a=g.pendingCallbacks.shift();g.isReady?a[0](n):a[1](n)}}),{__timeout__:2e3});else{var e="Unexpected error, iframe loaded again after failing OEM_isProxyReady";Telemetry.RuntimeTelemetryHelper.LogExceptionTag(e,null,null,523584719),r({status:null,value:{errorMessage:e}})}};OSF.OUtil.addEventListener(p,"load",y),p.setAttribute("src",m),this.iframeOnload=y,this.pendingCallbacks.push([i,r]),this.iframe=p}catch(t){var v="Error creating client endpoint with proxyUrl = ["+this.proxyUrl+"], msg:"+e.WACUtils.serializeObjectToString(t);r({status:null,value:{errorMessage:v}})}},o.GetTrustedLocations=function(){if(!o._trustedSPCatalogProxyUrls){var e=o.GetTrustedLocationsPersistedCache();o._trustedSPCatalogProxyUrls=e.getTrustedLocations()}return o._trustedSPCatalogProxyUrls},o.GetTrustedLocationsPersistedCache=function(){var t=new e.AppsDataCacheManager(OSF.OUtil.getLocalStorage(),new e.SafeSerializer);return{getTrustedLocations:function(){return t.GetCacheItem(OSF.Constants.SPCatalogTrustedLocationsCacheKey,!1)||{}},setTrustedLocations:function(e){t.SetCacheItem(OSF.Constants.SPCatalogTrustedLocationsCacheKey,e)}}},o}(e.ProxyBase);e.SPCatalogProxy=i}(OfficeExt||(OfficeExt={})),function(e){var t=function(){function t(t){this.proxyRetries={},this.initParams=t,this.iframeProxyGroup=new e.IframeProxyGroup}return t.getInstance=function(e){return null==t._instance&&(t._instance=new t(e)),t._instance},t.prototype.prepareProxy=function(t,n,i){n=n||"";this.proxyRetries[t]=1,this.ensureSPCatalogProxySetUp(t,n,(function(t){t&&null!=t.status?t.status:e.DataServiceResultCode.ProxyNotReady;i({status:t.status})}))},t.prototype.createScope=function(e){return new n(e,this)},t.prototype.getSPCatalogUrl=function(t,n,i){var o=this;this.prepareProxy(t,n,(function(){var r;if(t)if(r=o.iframeProxyGroup.iframeProxies[t]){var a={};a.webUrl=t,r.getSPCatalogUrlAsync(a,(function(t){t.status!==e.DataServiceResultCode.Succeeded&&(Telemetry.RuntimeTelemetryHelper.LogExceptionTag("getspcatalogurl failed",null,n,523588550),OsfMsAjaxFactory.msAjaxDebug.trace("getspcatalogurl failed")),i(t)}))}else Telemetry.RuntimeTelemetryHelper.LogExceptionTag(OSF.OUtil.formatString("getspcatalogurl proxy not found, webUrl: {0}",t),null,n,523588551),i({status:e.DataServiceResultCode.ProxyNotReady});else Telemetry.RuntimeTelemetryHelper.LogExceptionTag("getspcatalogurl proxy URL empty",null,n,523588549),i({status:e.DataServiceResultCode.PrxoyUrlEmpty})}))},t.prototype.isUpnMatchAsync=function(t,n,i,o){var r=this;this.prepareProxy(n,i,(function(){var a;n?(a=r.iframeProxyGroup.iframeProxies[n])?a.isUpnMatchAsync({upn:t,webUrl:n,useEmailForUpnCheck:!0},(function(t){t.status!==e.DataServiceResultCode.Succeeded&&(Telemetry.RuntimeTelemetryHelper.LogExceptionTag("isUpnMatchAsync failed",null,i,523588553),OsfMsAjaxFactory.msAjaxDebug.trace("isUpnMatchAsync failed")),o(t)})):(Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag(OSF.OUtil.formatString("isUpnMatchAsync proxy not found, webUrl: {0}",n),i,520741142),o({status:e.DataServiceResultCode.ProxyNotReady})):(Telemetry.RuntimeTelemetryHelper.LogExceptionTag("isUpnMatchAsync proxy URL empty",null,i,523588552),o({status:e.DataServiceResultCode.PrxoyUrlEmpty}))}))},t.prototype.ensureSPCatalogProxySetUp=function(t,n,i){if(!t)return Telemetry.RuntimeTelemetryHelper.LogExceptionTag("proxyUrl is null",null,n,523588555),void i({status:e.DataServiceResultCode.Failed});var o=this.iframeProxyGroup.iframeProxies[t];if(o||(o=new e.SPCatalogProxy(t,this.iframeProxyGroup)),o.isReady)i({status:e.DataServiceResultCode.Succeeded});else{var r=this,a=function(t){i({status:e.DataServiceResultCode.Succeeded})},s=function(l){r.proxyRetries[t]<OSF.Constants.AuthenticatedConnectMaxTries?(r.proxyRetries[t]++,o.prepareProxy(a,s)):(Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("sp exceed maximum tries and fail",n,521412868),i({status:l.status||e.DataServiceResultCode.ProxyNotReady}))};o.prepareProxy(a,s)}},t}();e.SPCatalogProxyBasedCatalogService=t;var n=function(){function t(e,t){this._catalogService=t,this.proxyUrl=e.storeId,this._correlationId=e.telemetryContext.correlationId||""}return t.prototype.tryFail=function(t,n,i){return t!=e.DataServiceResultCode.Succeeded&&(i({status:t}),!0)},t.prototype.getEntitlementAsync=function(e,t,n,i){var o=this,r=this._catalogService.iframeProxyGroup.iframeProxies[this.proxyUrl],a={};a.webUrl=this.proxyUrl,a.applicationName=this._catalogService.initParams.applicationName,a.officeExtentionTarget=t,a.clearCache=i||!1,a.supportedManifestVersions={"1.0":!0,1.1:!0},r.getEntitlementsAsync(a,(function(e){o.tryFail(e.status,e.httpStatus,n)?o.logServiceCallResponseError("entitlement",e.httpStatus):n(e)}))},t.prototype.getLastStoreUpdate=function(e){},t.prototype.getManifest=function(e,t,n,i,o){var r=this,a=this._catalogService.iframeProxyGroup.iframeProxies[this.proxyUrl],s={};s.manifestUrl=e,s.id=t,s.version=n,s.clearCache=o,a.getManifestAsync(s,(function(e){r.tryFail(e.status,e.httpStatus,i)?r.logServiceCallResponseError("manifest",e.httpStatus):i(e)}))},t.prototype.isUpnMatchAsync=function(e,t){var n=this,i=this._catalogService.iframeProxyGroup.iframeProxies[this.proxyUrl],o={};o.upn=e,o.webUrl=this.proxyUrl,i.isUpnMatchAsync(o,(function(e){n.tryFail(e.status,e.httpStatus,t)?n.logServiceCallResponseError("isUpnMatch",e.httpStatus):t(e)}))},t.prototype.logServiceCallResponseError=function(e,t){var n="spproxy request "+e+" failed";t&&(n+=":"+t),Telemetry.RuntimeTelemetryHelper.LogExceptionTag(n,null,this._correlationId,523588557)},t}();e.SPCatalogProxyBasedCatalogServiceScope=n}(OfficeExt||(OfficeExt={})),function(e){var t=function(){function t(e,t){this._initParam=t,this._cacheManager=e.cacheManager,this._telemetryContext=e.telemetryContext}return t.prototype.getManifest=function(t,n,i,o){var r=this;this._telemetryContext.startActivity(e.Activity.ManifestRequest);var a=OSF.OsfManifestManager.getCachedManifest(n.OfficeExtensionID,n.OfficeExtensionVersion);if(a)return this._telemetryContext.stopActivity(e.Activity.ManifestRequest),this._telemetryContext.stopActivity(e.Activity.ServerCall),void i({status:e.DataServiceResultCode.Succeeded,value:{manifest:a,cached:!0}});n.EncodedAbsUrl?t.getManifest(n.EncodedAbsUrl,n.OfficeExtensionID,n.OfficeExtensionVersion,(function(t){if(r._telemetryContext.stopActivity(e.Activity.ManifestRequest),r._telemetryContext.stopActivity(e.Activity.ServerCall),t.status==e.DataServiceResultCode.Succeeded){var n=e.ManifestUtil.ParseManifest(t.value.manifest,r._initParam.appUILocale,r._telemetryContext.correlationId);null==n&&(t.status=e.DataServiceResultCode.Failed),i({status:t.status,value:{manifest:n,cached:!1}})}else i({status:t.status,value:{manifest:null,cached:!1}})}),o):i({status:e.DataServiceResultCode.Failed,value:{manifest:null,cached:!1}})},t.prototype.activate=function(t,n,i){var o,r=this,a={solutionId:n.solutionId,version:n.version,storeType:n.storeType,storeId:n.storeId,assetId:n.assetId,assetStoreId:n.assetStoreId,targetType:n.targetType},s=a.solutionId,l=a.version,c=function(d){r.getManifest(t,o,(function(t){t.status===e.DataServiceResultCode.Succeeded&&t.value.manifest?function(t,o){var c=t.manifest,d=c.getMarketplaceVersion();if(OSF.OsfManifestManager.cacheManifest(s,l,c),t.cached&&e.ManifestUtil.versionLessThan(d,l))u(!0);else{var p;if(!1===c.requirementsSupported||void 0===c.requirementsSupported&&!i.getRequirementsChecker().isManifestSupported(c))return c.requirementsSupported=!1,p=Strings.OsfRuntime.L_AgaveManifestRequirementsError_ERR||Strings.OsfRuntime.L_AgaveManifestError_ERR,void e.LoaderUtil.failWithError(i,{description:p,detailView:!0,errorCode:OSF.ErrorStatusCodes.WAC_AgaveRequirementsError});if(c.requirementsSupported=!0,o&&!i.skipTrust(n)){var f=OSF.OUtil.formatString(OSF.Constants.ActivatedCacheKey,s.toLowerCase(),n.storeType,n.storeId),m=OSF.OmexClientNames[r._initParam.applicationName];if(!r._cacheManager.GetCacheItem(f,!1)&&!i.hasConsent(n)&&!i.isForCustomFunctionSandbox())return void i.askForTrust({anonymous:null,clientName:m,entitlement:a,displayName:c.getDefaultDisplayName(),providerName:c.getProviderName(),iconUrl:c.getDefaultIconUrl(),isSSOAddin:c.isSSOAddin()},(function(){r._cacheManager.SetCacheItem(f,!0),i.load({entitlement:a,manifest:c,eToken:null},null)}))}i.hasConsent(n)&&r._cacheManager.SetCacheItem(f,!0),i.load({entitlement:a,manifest:c,eToken:null},null)}}(t.value,!0):e.LoaderUtil.failWithError(i,{description:Strings.OsfRuntime.L_AgaveManifestRetrieve_ERR,buttonTxt:Strings.OsfRuntime.L_RetryButton_TXT,buttonCallback:function(){i.restartActivation(),c(d)},errorCode:OSF.ErrorStatusCodes.E_MANIFEST_SERVER_UNAVAILABLE})}),d)},u=function(s){o=null,r._telemetryContext.startActivity(e.Activity.EntitlementCheck),t.getEntitlementAsync(!1,n.targetType,(function(t){if(t.status==e.DataServiceResultCode.Succeeded){r._telemetryContext.stopActivity(e.Activity.EntitlementCheck);for(var n,l=null,d=t.value.entitlements,p=0;p<d.length;p++){n=d[p];var f=a.solutionId;n.OfficeExtensionID&&f&&n.OfficeExtensionID.toLowerCase()==f.toLowerCase()&&(l&&!e.ManifestUtil.versionLessThan(l.OfficeExtensionVersion,n.OfficeExtensionVersion)||(l=n))}o=l,function(t){o?o.OfficeExtensionKillbit?e.LoaderUtil.failWithError(i,{description:Strings.OsfRuntime.L_AgaveDisabledByAdmin_ERR,errorCode:OSF.ErrorStatusCodes.E_OEM_EXTENSION_KILLED}):c(t):e.LoaderUtil.failWithError(i,{description:Strings.OsfRuntime.L_AgaveNotExist_ERR,buttonTxt:Strings.OsfRuntime.L_RetryButton_TXT,buttonCallback:function(){i.restartActivation(),r._telemetryContext.startActivity(e.Activity.Activation),r._telemetryContext.startActivity(e.Activity.ServerCall),u(!0)},errorCode:OSF.ErrorStatusCodes.E_MANIFEST_DOES_NOT_EXIST})}(s)}else e.LoaderUtil.failWithError(i,{description:OSF.OUtil.formatString(Strings.OsfRuntime.L_AgaveServerConnectionToCatalogFailed_ERR,Strings.OsfRuntime.L_AgaveMyOrganizationCatalogName),buttonTxt:Strings.OsfRuntime.L_RetryButton_TXT,buttonCallback:function(){i.restartActivation(),r._telemetryContext.startActivity(e.Activity.Activation),r._telemetryContext.startActivity(e.Activity.ServerCall),u()},errorCode:OSF.ErrorStatusCodes.E_MANIFEST_SERVER_UNAVAILABLE})}),s)};u()},t}(),n=function(){function n(t,n){void 0===n&&(n=null),this._appDataService={},this._catalogUrlDataService={},this._initParam=t,this._cacheManager=n||new e.AppsDataCacheManager(OSF.OUtil.getLocalStorage(),new e.SafeSerializer)}return n.prototype.getDataService=function(e,t,n){this.getDataServiceInternal(this._appDataService,e,t,n)},n.prototype.getCatalogUrlDataService=function(e,t,n){this.getDataServiceInternal(this._catalogUrlDataService,e,t,n)},n.prototype.getDataServiceInternal=function(t,n,i,o){if(null==t[n]&&(t[n]={spCatalogService:null,spCatalogServiceReady:null}),null==t[n].spCatalogService)if(null==t[n].spCatalogServiceReady){t[n].spCatalogServiceReady=o;var r={status:e.DataServiceResultCode.Failed,value:null};i.startActivity(e.Activity.Authentication);var a=e.SPCatalogProxyBasedCatalogService.getInstance(this._initParam);a.prepareProxy(n,i.correlationId,(function(o){i.stopActivity(e.Activity.Authentication),function(i,o){var a=t[n].spCatalogServiceReady;t[n].spCatalogServiceReady=null,i.status==e.DataServiceResultCode.Succeeded?(t[n].spCatalogService=o,r.value=o,r.status=e.DataServiceResultCode.Succeeded,a(r)):(r.status=i.status||e.DataServiceResultCode.Failed,r.httpStatus=i.httpStatus,a(r))}(o,a)}))}else{var s=t[n].spCatalogServiceReady;t[n].spCatalogServiceReady=function(e){s(e),o(e)}}else o({status:e.DataServiceResultCode.Succeeded,value:t[n].spCatalogService})},n.prototype.createActivityScope=function(n,i,o){var r=this;this.getDataService(n,i,(function(a){if(!e.AsyncUtil.failed(a,o)){var s=a.value,l={cacheManager:r._cacheManager,storeId:n,telemetryContext:i},c=s.createScope(l),u=new t(l,r._initParam);o({status:e.DataServiceResultCode.Succeeded,value:{serviceScope:c,activityScope:u}})}}))},n.prototype.getEntitlementAsync=function(e,t,n,i,o){this.getEntitlementAsyncInternal(e,t,n,i,o,null)},n.prototype.getAndCacheManifest=function(t,n,i,o){var r=this;this.getEntitlementAsyncInternal(!0,i,(function(n){if(OSF.OUtil.writeProfilerMark(OSF.OsfOfficeExtensionManagerPerfMarker.GetEntitlementEnd),n.status===e.DataServiceResultCode.Succeeded&&n.value){for(var a=n.value,s=a.length,l=null,c=0;c<s;c++){var u=a[c],d=t.solutionId;u.OfficeExtensionID&&d&&u.OfficeExtensionID.toLowerCase()===d.toLowerCase()&&(l&&!OSF.OsfManifestManager.versionLessThan(l.OfficeExtensionVersion,u.OfficeExtensionVersion)||(l=u))}null!=l?r.createActivityScope(l.storeId,i,(function(t){e.AsyncUtil.failed(t,o)||t.value.activityScope.getManifest(t.value.serviceScope,l,(function(e){o({status:e.status,value:e.value.manifest})}))})):o({status:e.DataServiceResultCode.Failed,value:null})}else o({status:e.DataServiceResultCode.Failed,value:null})}),!1,0,t.storeId)},n.prototype.isUpnMatchAsync=function(t,n,i){var o=this;this.getCatalogUrlDataService(this._initParam.spBaseUrl,n,(function(r){e.SPCatalogProxyBasedCatalogService.getInstance(o._initParam).isUpnMatchAsync(t,o._initParam.spBaseUrl,n.correlationId,i)}))},n.prototype.activateAsync=function(t,n,i){var o=this;i.startActivity(e.Activity.Activation),i.startActivity(e.Activity.ServerCall);this.getSPCatalogUrl(i,(function(r){o.createActivityScope(t.storeId,i,(function(r){if(r.status==e.DataServiceResultCode.Succeeded){var a=r.value.serviceScope;r.value.activityScope.activate(a,t,n)}else r.status==e.DataServiceResultCode.ProxyUrlNotTrusted?(Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("StoreId is not a trusted proxy.",null,522803347),e.LoaderUtil.failWithError(n,{description:OSF.OUtil.formatString(Strings.OsfRuntime.L_AgaveSourceLocationNotTrustedExternal_ERR,t.storeId),buttonTxt:Strings.OsfRuntime.L_TrustLocationButton_TXT,buttonCallback:function(){Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("Trust proxy was selected.",null,522803348),e.SPCatalogProxy.AddTrustedLocation(t.storeId,!0),n.restartActivation(),o.activateAsync(t,n,i)},errorCode:OSF.ErrorStatusCodes.WAC_AgaveAnonymousProxyCreationError})):e.LoaderUtil.failWithError(n,{description:OSF.OUtil.formatString(Strings.OsfRuntime.L_AgaveServerConnectionToCatalogFailed_ERR,Strings.OsfRuntime.L_AgaveMyOrganizationCatalogName),buttonTxt:Strings.OsfRuntime.L_RetryButton_TXT,buttonCallback:function(){n.restartActivation(),o.activateAsync(t,n,i)},errorCode:OSF.ErrorStatusCodes.WAC_AgaveAnonymousProxyCreationError})}))}))},n.prototype.removeAsync=function(t,n,i){i({status:e.DataServiceResultCode.Failed})},n.prototype.getAppDetails=function(t,n,i,o,r){for(var a=[],s=0;s<t.length;s++){var l=t[s],c={solutionId:l.OfficeExtensionID,version:l.OfficeExtensionVersion,storeType:OSF.StoreType.SPCatalog,storeId:l.storeId,assetId:l.assetId,assetStoreId:l.assetStoreId,name:l.Title,provider:l.OEProviderName,description:l.OfficeExtensionDescription,appSubType:String(OSF.OfficeAppType[l.OEType]),defaultWidth:l.OfficeExtensionDefaultWidth.toString(),defaultHeight:l.OfficeExtensionDefaultHeight.toString(),iconUrl:l.OfficeExtensionIcon,webApplicationId:null};a.push(c)}o({status:e.DataServiceResultCode.Succeeded,value:a})},n.prototype.getEntitlementAsyncInternal=function(t,n,i,o,r,a){var s=this;this.getSPCatalogUrl(n,(function(r){var l;r.status!==e.DataServiceResultCode.Succeeded?a||i({status:r.status,value:null}):l=r.value;var c=a||l;s.createActivityScope(c,n,(function(n){e.AsyncUtil.failed(n,i,[])||n.value.serviceScope.getEntitlementAsync(t,null,(function(t){if(!e.AsyncUtil.failed(t,i,[])){for(var n=t.value.entitlements,o=0;o<n.length;o++){var r=n[o];r.solutionId=r.OfficeExtensionID,r.version=r.OfficeExtensionVersion,r.storeType=OSF.StoreType.SPCatalog,r.storeId=c,r.assetId=null,r.assetStoreId=null,r.targetType=OSF.OfficeAppType[r.OEType]}i({status:t.status,value:n})}}),o)}))}))},n.prototype.getSPCatalogUrl=function(t,n){var i=this;this.myOrgCatalogUrlAsyncResultStatus?n({status:this.myOrgCatalogUrlAsyncResultStatus,value:this.myOrgCatalogUrl}):this.getCatalogUrlDataService(this._initParam.spBaseUrl,t,(function(o){e.SPCatalogProxyBasedCatalogService.getInstance(i._initParam).getSPCatalogUrl(i._initParam.spBaseUrl,t.correlationId,(function(t){i.myOrgCatalogUrlAsyncResultStatus=t.status,i.myOrgCatalogUrlAsyncResultStatus==e.DataServiceResultCode.Succeeded&&(i.myOrgCatalogUrl=t.value,e.SPCatalogProxy.AddTrustedLocation(i.myOrgCatalogUrl,!1)),n({status:i.myOrgCatalogUrlAsyncResultStatus,value:i.myOrgCatalogUrl})}))}))},n}();e.CatalogFactory.register(OSF.StoreType.SPCatalog,(function(t){var i=new n({applicationName:OSF.HostCapability[t.hostType],AppVersion:t.appVersion,clientMode:t.clientMode,appUILocale:t.appUILocale,spBaseUrl:t.spBaseUrl,docUrl:t.docUrl});return e.SPCatalogProxy.AddTrustedLocation(t.spBaseUrl,!1),i}))}(OfficeExt||(OfficeExt={})),function(e){e._ErrorUXHelper=function(t){var n=t,i=n.getOsfOmexBaseUrl(),o="omexNotificationIframeClassName";e.OUtil.loadCSS(n.getLocalizedCSSFilePath("moeerrorux.css")),document.createElement("img").src=n.getLocalizedImageFilePath("progress.gif"),document.createElement("img").src=n.getLocalizedImageFilePath("moe_status_icons.png"),document.createElement("img").src=n.getLocalizedImageFilePath("agavedefaulticon96x96.png");var r={},a=0,s=function(e){for(var t,n=e.childNodes.length,i=0;i<n;)"iframe"===(t=e.childNodes.item(i)).tagName.toLowerCase()?i++:(e.removeChild(t),n--)},l=function(e){var t=document.getElementById(e);t&&t.parentNode.removeChild(t)},c=function(t,n){var i;e.OUtil.writeProfilerMark(e.NotificationUxPerfMarker.RemoveStage2Start),i=n?"moe-infobar-body_"+t:"notificationbackground_"+t;var o=I(t);o&&r[t][0].highPriority&&a--,l(i),o&&r[t].shift(),e.OUtil.writeProfilerMark(e.NotificationUxPerfMarker.RemoveStage2End)},u=function(t){e.OUtil.writeProfilerMark(e.NotificationUxPerfMarker.RemoveStage2Start);var n="moe-trust-prompt-table_"+t.id,i=I(t.id);i&&r[t.id][0].highPriority&&a--,l(n),i&&r[t.id].shift(),e.OUtil.writeProfilerMark(e.NotificationUxPerfMarker.RemoveStage2End)},d=function(t){e.OUtil.writeProfilerMark(e.NotificationUxPerfMarker.RenderStage1Start),s(t.div);var i=document.createElement("div");i.setAttribute("class","moe-background"),i.setAttribute("id","icon_"+t.id);var o=document.createElement("input");o.setAttribute("id","iconImg_"+t.id),o.setAttribute("type","image"),o.setAttribute("tabindex","0"),o.src=n.getLocalizedImageFilePath("moe_status_icons.png");var r,a,l;o.setAttribute("onclick","getIntoStage2(params)"),e.OUtil.attachClickHandler(o,(function(){!function(e){e.sqmDWords[1]|=2,C(e.id);var t=OfficeExt.HostFeatureEnabledInfo.getHostFeatureEnabledInfo();t&&t.enableSingleSignOnForAddin?f(e):p(e)}(t)})),i.appendChild(o),t.displayDeactive&&(i.style.backgroundImage="url("+n.getLocalizedImageFilePath("agavedefaulticon96x96.png")+")",i.style.backgroundColor="white",i.style.opacity="1",i.style.filter="alpha(opacity=100)",i.style.backgroundRepeat="no-repeat",i.style.backgroundPosition="center",i.style.height="100%"),t.infoType===e.InfoType.Error?(r="moe-status-error-icon",a="iconImg_error_"+t.id,l=Strings.OsfRuntime.L_InfobarIconErrorAccessibleName_TXT):t.infoType===e.InfoType.Warning?(r="moe-status-warning-icon",a="iconImg_warning_"+t.id,l=Strings.OsfRuntime.L_InfobarIconWarningAccessibleName_TXT):t.infoType===e.InfoType.Information?(r="moe-status-info-icon",a="iconImg_info_"+t.id,l=Strings.OsfRuntime.L_InfobarIconInfoAccessibleName_TXT):(r="moe-status-secinfo-icon",a="iconImg_secinfo_"+t.id,l=Strings.OsfRuntime.L_InfobarIconSecInfoAccessibleName_TXT),null!=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})").exec(navigator.userAgent)&&9==parseFloat(RegExp.$1)&&(r+="_ie"),o.setAttribute("class",r),o.setAttribute("id",a),o.setAttribute("alt",l),0!=t.div.childNodes.length?t.div.insertBefore(i,t.div.childNodes[0]):t.div.appendChild(i),A(t.id,e.AgaveHostAction.TabIn),e.OUtil.writeProfilerMark(e.NotificationUxPerfMarker.RenderStage1End)},p=function(t){e.OUtil.writeProfilerMark(e.NotificationUxPerfMarker.RenderStage2Start),s(t.div);var i=t.description;t.title.length>100&&(t.title=t.title.substring(0,99)),t.description.length>255&&(t.description=t.description.substring(0,254));var o="moe-infobar-body_"+t.id,r=document.getElementById(o);null==r&&((r=document.createElement("div")).setAttribute("class","moe-infobar-body"),r.setAttribute("id",o));var a=document.createElement("div");a.textContent=i,r.setAttribute("title",a.textContent),a=null;var l,u=document.createElement("table");for(u.setAttribute("class","moe-infobar-infotable"),u.setAttribute("role","presentation"),l=0;l<3;l++)u.insertRow(l).setAttribute("role","presentation");var d=u.rows;d[0].insertCell(0),d[0].insertCell(1),d[0].insertCell(2),d[0].cells[1].setAttribute("rowSpan","2"),d[1].insertCell(0),d[1].insertCell(1),d[2].insertCell(0),d[2].insertCell(1),d[2].insertCell(2),d[0].cells[0].setAttribute("class","moe-infobar-top-left-cell"),d[0].cells[1].setAttribute("class","moe-infobar-message-cell"),d[0].cells[2].setAttribute("class","moe-infobar-top-right-cell"),d[2].cells[1].setAttribute("class","moe-infobar-button-cell");var p,f,m=document.createElement("img");m.src=n.getLocalizedImageFilePath("moe_status_icons.png"),t.infoType===e.InfoType.Error?(p="moe-infobar-error",f=Strings.OsfRuntime.L_InfobarIconErrorAccessibleName_TXT):t.infoType===e.InfoType.Warning?(p="moe-infobar-warning",f=Strings.OsfRuntime.L_InfobarIconWarningAccessibleName_TXT):t.infoType===e.InfoType.Information?(p="moe-infobar-info",f=Strings.OsfRuntime.L_InfobarIconInfoAccessibleName_TXT):(p="moe-infobar-secinfo",f=Strings.OsfRuntime.L_InfobarIconSecInfoAccessibleName_TXT),m.setAttribute("class",p),m.setAttribute("alt",f),d[0].cells[0].appendChild(m);var h=document.createElement("a");h.setAttribute("class","moe-infobar-message-div"),h.setAttribute("tabindex","1");var g=document.createElement("span");g.setAttribute("class","moe-infobar-title"),g.textContent=t.title;var y="moe-infobar-message_"+t.id,v=document.getElementById(y);null==v&&((v=document.createElement("span")).setAttribute("class","moe-infobar-message"),v.setAttribute("id",y)),v.textContent=t.description,h.appendChild(g),h.appendChild(v),d[0].cells[1].appendChild(h);var S=function(e){var t=n.getOsfControl(e.id);Telemetry.AppNotificationHelper.LogNotification(t._appCorrelationId,e.sqmDWords[0],e.sqmDWords[1])},_=function(){t.sqmDWords[1]|=8,S(t),t.reDisplay||c(t.id,t.displayDeactive),C(t.id),t.reDisplay?O(t):T(t.id),t.dismissCallback&&t.dismissCallback()},I=document.createElement("input");I.setAttribute("type","image"),I.setAttribute("src",n.getLocalizedImageFilePath("moe_status_icons.png")),I.setAttribute("class","moe-infobar-dismiss"),I.setAttribute("id","moe-infobar-dismiss_"+t.id),I.setAttribute("tabindex","0"),I.setAttribute("alt",Strings.OsfRuntime.L_InfobarIconCloseButtonAccessibleName_TXT),I.setAttribute("role","button"),I.setAttribute("onclick","handleDismiss();"),e.OUtil.attachClickHandler(I,_),d[0].cells[2].appendChild(I),t.detailView=!1;var x=document.createElement("button");if(x.setAttribute("class","moe-infobar-button"),x.textContent=t.buttonTxt,x.setAttribute("id","moe-infobar-button_"+t.id),x.setAttribute("tabindex","1"),x.setAttribute("type","button"),t.buttonCallback){x.setAttribute("onclick","handleButtonClick()"),e.OUtil.attachClickHandler(x,(function(){if(t.sqmDWords[1]|=4,S(t),c(t.id,!1),C(t.id),T(t.id),!0===t.retryAll){var e=n.getOsfControl(t.id);e._retryActivate=null,n.retryAll(e.getSolutionId())}t.buttonCallback()}))}else x.setAttribute("onclick","handleDismiss()"),e.OUtil.attachClickHandler(x,_);if(d[2].cells[1].appendChild(x),t.url){var E=document.createElement("button");E.setAttribute("class","moe-infobar-button"),E.textContent=t.urlButtonTxt?t.urlButtonTxt:Strings.OsfRuntime.L_MoreInfoButton_TXT,E.setAttribute("id","moe-infobar-button2_"+t.id),E.setAttribute("onclick","moreInfoButtonClick()"),e.OUtil.attachClickHandler(E,(function(){t.sqmDWords[1]|=4,S(t),t.sqmDWords[1]=1,window.open(t.url)})),E.setAttribute("tabindex","1"),E.setAttribute("type","button"),d[2].cells[1].appendChild(E)}r.appendChild(u);var M=document.createElement("div");M.setAttribute("class","moe-background"),M.setAttribute("id","notificationbackground_"+t.id),t.displayDeactive&&(M.style.backgroundImage="url("+n.getLocalizedImageFilePath("agavedefaulticon96x96.png")+")",M.style.backgroundColor="white",M.style.opacity="1",M.style.filter="alpha(opacity=100)",M.style.backgroundRepeat="no-repeat",M.style.backgroundPosition="center",M.style.height="100%"),M.appendChild(r),0!=t.div.childNodes.length?t.div.insertBefore(M,t.div.childNodes[0]):t.div.appendChild(M),A(t.id,e.AgaveHostAction.TabIn),e.OUtil.writeProfilerMark(e.NotificationUxPerfMarker.RenderStage2End)},f=function(t){e.OUtil.writeProfilerMark(e.NotificationUxPerfMarker.RenderStage2Start);try{s(t.div);var i=t.description;t.title.length>100&&(t.title=t.title.substring(0,99)),t.description.length>255&&(t.description=t.description.substring(0,254));var o="moe-infobar-body_"+t.id,r=document.getElementById(o);null==r&&((r=document.createElement("div")).className="moe-infobar-body",r.id=o),r.title=i,t.iframeNotificationUrl?r.appendChild(h(t,r)):r.appendChild(m(t));var a=document.createElement("div");a.className="moe-background",a.id="notificationbackground_"+t.id,t.displayDeactive&&(a.style.backgroundImage="url("+n.getLocalizedImageFilePath("agavedefaulticon96x96.png")+")",a.style.backgroundColor="white",a.style.opacity="1",a.style.filter="alpha(opacity=100)",a.style.backgroundRepeat="no-repeat",a.style.backgroundPosition="center",a.style.height="100%"),a.appendChild(r),0!=t.div.childNodes.length?t.div.insertBefore(a,t.div.childNodes[0]):t.div.appendChild(a),A(t.id,e.AgaveHostAction.TabIn)}catch(e){Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Failed to show infobar, error message: ",e,null,523331666)}e.OUtil.writeProfilerMark(e.NotificationUxPerfMarker.RenderStage2End)},m=function(t){var i=g(t),o=i.rows;o[0].cells[0].appendChild(y(t));var r=document.createElement("a");r.className="moe-infobar-message-div",r.tabIndex=1;var a=document.createElement("span");a.className="moe-infobar-title",a.textContent=t.title;var s="moe-infobar-message_"+t.id,l=document.getElementById(s);null==l&&((l=document.createElement("span")).className="moe-infobar-message",l.id=s),l.textContent=t.description,r.appendChild(a),r.appendChild(l),o[0].cells[1].appendChild(r);var u=function(){S(t)},d=_(t);e.OUtil.attachClickHandler(d,u),o[0].cells[2].appendChild(d),t.detailView=!1;var p=document.createElement("button");if(p.className="moe-infobar-button",p.textContent=t.buttonTxt,p.id="moe-infobar-button_"+t.id,p.tabIndex=1,p.type="button",t.buttonCallback){e.OUtil.attachClickHandler(p,(function(){if(t.sqmDWords[1]|=4,v(t),c(t.id,!1),C(t.id),T(t.id),!0===t.retryAll){var e=n.getOsfControl(t.id);e._retryActivate=null,n.retryAll(e.getSolutionId())}t.buttonCallback()}))}else e.OUtil.attachClickHandler(p,u);if(o[2].cells[1].appendChild(p),t.url){var f=document.createElement("button");f.className="moe-infobar-button",f.textContent=t.urlButtonTxt?t.urlButtonTxt:Strings.OsfRuntime.L_MoreInfoButton_TXT,f.id="moe-infobar-button2_"+t.id,e.OUtil.attachClickHandler(f,(function(){t.sqmDWords[1]|=4,v(t),t.sqmDWords[1]=1,window.open(t.url)})),f.tabIndex=1,f.type="button",o[2].cells[1].appendChild(f)}return i},h=function(t,r){var a=g(t),s=a.rows,l=document.createElement("iframe");window.getComputedStyle(t.div,null);l.width="100%",l.frameBorder="0",l.className=o,l.src=t.iframeNotificationUrl,s[0].cells[1].appendChild(l);var u="moe-hovered";r.addEventListener("mouseenter",(function(t){e.OUtil.addClass(r,u),l.contentWindow.postMessage(e.AgaveHostAction.MouseEnter,i)})),r.addEventListener("mouseleave",(function(t){e.OUtil.removeClass(r,u),l.contentWindow.postMessage(e.AgaveHostAction.MouseLeave,i)})),t.detailView=!1;var d=null,p=_(t);return e.OUtil.attachClickHandler(p,(function(){S(t),window.removeEventListener("message",d)})),s[0].cells[2].appendChild(p),p.addEventListener("keydown",(function(t){9==t.keyCode&&t.shiftKey&&(t.preventDefault(),t.stopPropagation(),l.contentWindow.postMessage(e.AgaveHostAction.TabInShift,i))})),t.buttonCallback&&(d=function(i){try{if(i.source==l.contentWindow){var o=JSON.parse(i.data),r=parseInt(o[e.OmexMessageKeys.MessageType]),a=parseInt(o[e.OmexMessageKeys.MessageValue]);if(r==e.OmexMessageType.ConsentResult){if(c(t.id,!1),C(t.id),T(t.id),!0===t.retryAll&&(t.notificationType==e.NotificationType.TrustYellowBar||t.notificationType==e.NotificationType.ConsentYellowBar&&a==e.ConsentResultCode.Success)){var s=n.getOsfControl(t.id);s._retryActivate=null,n.retryAll(s.getSolutionId())}window.removeEventListener("message",d),t.buttonCallback(a)}else r==e.OmexMessageType.TabExit&&(a==e.AgaveHostAction.TabExitShift&&n._notifyHost?n._notifyHost(t.id,e.AgaveHostAction.TabExitShift):a==e.AgaveHostAction.TabExit&&(window.focus(),p.focus()))}}catch(e){Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Exception in receivedMessageHandler: ",e,null,523331668)}},window.addEventListener("message",d)),a},g=function(e){var t=document.createElement("table");t.className="moe-infobar-infotable",t.setAttribute("role","presentation");for(var n=e.iframeNotificationUrl?1:3,i=0;i<n;i++){t.insertRow(i).setAttribute("role","presentation")}var o=t.rows;return o[0].insertCell(0),o[0].insertCell(1),o[0].insertCell(2),o[0].cells[1].setAttribute("rowSpan","2"),o[0].cells[0].setAttribute("class","moe-infobar-top-left-cell"),o[0].cells[1].setAttribute("class","moe-infobar-message-cell"),o[0].cells[2].setAttribute("class","moe-infobar-top-right-cell"),null==e.iframeNotificationUrl&&(o[1].insertCell(0),o[1].insertCell(1),o[2].insertCell(0),o[2].insertCell(1),o[2].insertCell(2),o[2].cells[1].setAttribute("class","moe-infobar-button-cell")),o[0].cells[0].appendChild(y(e)),t},y=function(t){var i,o,r=document.createElement("img");return r.src=n.getLocalizedImageFilePath("moe_status_icons.png"),t.infoType===e.InfoType.Error?(i="moe-infobar-error",o=Strings.OsfRuntime.L_InfobarIconErrorAccessibleName_TXT):t.infoType===e.InfoType.Warning?(i="moe-infobar-warning",o=Strings.OsfRuntime.L_InfobarIconWarningAccessibleName_TXT):t.infoType===e.InfoType.Information?(i="moe-infobar-info",o=Strings.OsfRuntime.L_InfobarIconInfoAccessibleName_TXT):(i="moe-infobar-secinfo",o=Strings.OsfRuntime.L_InfobarIconSecInfoAccessibleName_TXT),r.className=i,r.alt=o,r},v=function(e){var t=n.getOsfControl(e.id);Telemetry.AppNotificationHelper.LogNotification(t._appCorrelationId,e.sqmDWords[0],e.sqmDWords[1])},S=function(e){e.sqmDWords[1]|=8,v(e),e.reDisplay||c(e.id,e.displayDeactive),C(e.id),e.reDisplay?O(e):T(e.id),e.dismissCallback&&e.dismissCallback()},_=function(e){var t=document.createElement("input");return t.type="image",t.src=n.getLocalizedImageFilePath("moe_status_icons.png"),t.className="moe-infobar-dismiss",t.id="moe-infobar-dismiss_"+e.id,t.tabIndex=0,t.alt=Strings.OsfRuntime.L_InfobarIconCloseButtonAccessibleName_TXT,t.setAttribute("role","button"),t},C=function(e){var t=n.getOsfControl(e);t&&(t._controlFocus=!0)},A=function(t,a){var s=n.getOsfControl(t);if(s&&s._controlFocus)if(I(t)){var l=r[t][0];if(l&&l.div)if(null!=l.iframeNotificationUrl){var c=l.div.getElementsByClassName(o)[0];c&&(c.contentWindow.postMessage(e.AgaveHostAction.TabIn,i),n._notifyHost&&n._notifyHost(t,e.AgaveHostAction.SelectWithError))}else{var u=l.div.querySelectorAll("input,a,button");if(u&&u.length>0){if(4==u.length)var d=u[2];else d=u[0];d instanceof HTMLElement&&(window.focus(),d.focus(),n._notifyHost&&n._notifyHost(t,e.AgaveHostAction.SelectWithError))}}}else s.notifyAgave(a)},O=function(t){if(t.notificationType!==e.NotificationType.TrustPromptContent&&t.notificationType!==e.NotificationType.TrustPromptTaskpane)if(null==t.detailView||!1===t.detailView)t.sqmDWords[1]=0,d(t);else{t.sqmDWords[1]=1;var i=OfficeExt.HostFeatureEnabledInfo.getHostFeatureEnabledInfo();i&&i.enableSingleSignOnForAddin?f(t):p(t)}else!function(t){function i(t,n,i){e.OUtil.isNullOrUndefined(t.telemetryId)||"undefined"==typeof otel||void 0===otel.sendTelemetryEvent||e.OUtil.sendTelemetryEvent("Office.Extensibility.Host.TrustUX",[{name:"SDX.Id",string:t.telemetryId},{name:"TrustUXAction",string:n}])||otel.sendTelemetryEvent({name:"Office.Extensibility.Host.TrustUX",dataFields:[{name:"SDX.Id",string:t.telemetryId},{name:"TrustUXAction",string:n}]}),window.open(i,"_blank")}e.OUtil.writeProfilerMark(e.NotificationUxPerfMarker.RenderStage2Start);try{s(t.div);var o=function(e){function t(e,t){var n=e.insertRow(-1);n.className="moe-trust-prompt-row "+t,n.setAttribute("role","presentation"),n.insertCell(-1).className="moe-trust-prompt-cell"}e.id;var n="moe-trust-prompt-table_"+e.id,i=document.getElementById(n);null===i&&((i=document.createElement("table")).id=n,i.className="moe-trust-prompt-table",i.setAttribute("role","presentation")),t(i.createTHead(),"moe-trust-prompt-header");var o=i.createTBody();return t(o,"moe-trust-prompt-preview"),t(o,"moe-trust-prompt-description"),t(i.createTFoot(),"moe-trust-prompt-footer"),i}(t),r=o.rows,a=function(t){var n=document.createElement("p");return n.textContent=t.notificationType===e.NotificationType.TrustPromptContent?t.name:t.title,n.className="moe-trust-prompt-header-title",n}(t);r[0].cells[0].appendChild(a);var l=function(e){var t=document.createElement("img");return t.src=e.icon,t.className="moe-trust-prompt-preview-img",t.setAttribute("alt",e.iconTitle),t}(t),c=function(e){var t=document.createElement("p");return t.textContent=e.name,t.className="moe-trust-prompt-preview-title",t}(t),d=function(e){var t=document.createElement("p");return t.textContent=e.provider,t.className="moe-trust-prompt-preview-sub",t}(t);r[1].cells[0].appendChild(l),r[1].cells[0].appendChild(c),r[1].cells[0].appendChild(d);var p=function(e){var t=document.createElement("p"),n=e.description.split("<br>");if(9!=n.length)t.textContent=e.description;else{t.textContent="";var o=document.createElement("b");o.textContent=n[0],t.appendChild(o),t.appendChild(document.createElement("br")),t.appendChild(document.createElement("br")),t.appendChild(document.createTextNode(n[1])),t.appendChild(document.createElement("br")),t.appendChild(document.createElement("br")),t.appendChild(document.createTextNode(n[2]));var r=document.createElement("a");r.setAttribute("href",n[7]),r.onclick=function(){return i(e,"ClickLicenseLink",n[7]),!1},r.textContent=n[3],t.appendChild(r),t.appendChild(document.createTextNode(n[4]));var a=document.createElement("a");a.setAttribute("href",n[8]),a.onclick=function(){return i(e,"ClickPrivacyLink",n[8]),!1},a.textContent=n[5],t.appendChild(a),t.appendChild(document.createTextNode(n[6])),t.appendChild(document.createElement("br"))}return t.className="moe-trust-prompt-description-text",t.id="moe-trust-prompt-description-id",t}(t);r[2].cells[0].appendChild(p);var f=((y=document.createElement("button")).textContent=t.buttonTxt,y.className="moe-trust-prompt-button moe-trust-prompt-button-primary moe-trust-prompt-buttons-action",y.id="moe-trust-prompt-buttons-action_"+t.id,y.tabIndex=0,y.type="button",y.setAttribute("aria-describedby","moe-trust-prompt-description-id"),g=t.buttonCallback?function(){if(t.sqmDWords[1]|=4,v(t),u(t),C(t.id),T(t.id),!0===t.retryAll){var e=n.getOsfControl(t.id);e._retryActivate=null,n.retryAll(e.getSolutionId())}t.buttonCallback()}:function(){t.sqmDWords[1]|=8,v(t),t.reDisplay||u(t),C(t.id),t.reDisplay?O(t):T(t.id),t.dismissCallback&&t.dismissCallback()},e.OUtil.attachClickHandler(y,g),y);if(r[3].cells[0].appendChild(f),null!==t.url){var m=function(t){var n=document.createElement("button");return n.textContent=t.urlButtonTxt||Strings.OsfRuntime.L_AgaveTrustAddIn_Improved_MoreInfoButton_TXT,n.className="moe-trust-prompt-button moe-trust-prompt-buttons-url",n.id="moe-trust-prompt-buttons-url_"+t.id,n.tabIndex=0,n.type="button",e.OUtil.attachClickHandler(n,(function(){"undefined"!=typeof otel&&void 0!==otel.sendTelemetryEvent&&(e.OUtil.sendTelemetryEvent("Office.Extensibility.Host.TrustUX",[{name:"SDX.Id",string:t.telemetryId},{name:"TrustUXAction",string:"ClickGetDetails"}])||otel.sendTelemetryEvent({name:"Office.Extensibility.Host.TrustUX",dataFields:[{name:"SDX.Id",string:t.telemetryId},{name:"TrustUXAction",string:"ClickGetDetails"}]})),t.sqmDWords[1]|=4,v(t),window.open(t.url)})),n}(t);r[3].cells[0].appendChild(m)}var h=function(t){var i=document.createElement("div");i.className="moe-trust-prompt-collapse cui-ctl-iconContainer cui-img-cont-float cui-img-16by16";var o=document.createElement("img");switch(t.clientName){case"WAC_Powerpoint":o.src=n.getLocalizedImageFilePath("per.png"),o.className="per_UpChevron_16x16x32";break;case"WAC_Word":o.src=n.getLocalizedImageFilePath("we.png"),o.className="we_UpChevron_16x16x32";break;case"WAC_Excel":o.src=n.getLocalizedImageFilePath("EwaEdit_m2.png"),o.className="ewaboot_UpChevron16"}return o.alt=Strings.OsfRuntime.L_InfobarIconCloseButtonAccessibleName_TXT,i.appendChild(o),e.OUtil.attachClickHandler(i,(function(){!0===t.collapsed?t.div.classList.remove("collapsed"):t.div.classList.add("collapsed"),t.collapsed=!t.collapsed})),i}(t);0!=t.div.childNodes.length?t.div.insertBefore(o,t.div.childNodes[0]):t.div.appendChild(o),t.div.appendChild(h),t.div.style.overflowY="auto",t.div.classList.add("moe-trust-prompt"),t.div.classList.add(t.clientName),t.div.classList.add(t.notificationType===e.NotificationType.TrustPromptContent?"content-add-in":"taskpane-add-in"),A(t.id,e.AgaveHostAction.TabIn)}catch(e){Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Failed to show trust prompt, error message: ",e,null,523331667)}var g,y;e.OUtil.writeProfilerMark(e.NotificationUxPerfMarker.RenderStage2End)}(t)},T=function(t){if(I(t)){var i=r[t][0];O(i)}else!function(t){var i,o=n.getOsfControl(t);if(o&&!I(t))if(o.getStatus()===e.OsfControlStatus.Activated&&o.getPageStatus()===e.OsfControlPageStatus.Ready)o.notifyAgave(e.AgaveHostAction.TabIn);else{var r="_trySetFocusInAppContent$newCallback";if(o._notifyHostIFrameOnLoaded&&o._notifyHostIFrameOnLoaded.newCallbackIdentity&&o._notifyHostIFrameOnLoaded.newCallbackIdentity===r)return;var a=(i=o._notifyHostIFrameOnLoaded,function(){if(i)try{i()}catch(e){}o.getStatus()===e.OsfControlStatus.Activated&&o.getPageStatus()===e.OsfControlPageStatus.Ready&&o.notifyAgave(e.AgaveHostAction.TabIn),o._notifyHostIFrameOnLoaded=i});a.newCallbackIdentity=r,o._notifyHostIFrameOnLoaded=a}}(t)},I=function(e){return r[e]&&r[e].length>0};return{showProgress:function(t,i){try{if(e.OUtil.writeProfilerMark(e.NotificationUxPerfMarker.RenderLoadingAnimationStart),!document.getElementById("progress_"+i)){r[i]=[];var o=document.createElement("div");o.setAttribute("class","moe-background"),o.setAttribute("id","progress_"+i),o.style.backgroundColor="rgba(255, 255, 255, 0.5)",o.style.opacity="1",o.style.filter="alpha(opacity=100)",o.style.height="100%";var a=document.createElement("div");a.style.width="100%",a.style.height="100%",a.style.backgroundImage="url("+n.getLocalizedImageFilePath("progress.gif")+")",a.style.backgroundRepeat="no-repeat",a.style.backgroundPosition="center",o.appendChild(a),t.appendChild(o)}e.OUtil.writeProfilerMark(e.NotificationUxPerfMarker.RenderLoadingAnimationEnd)}catch(e){}},showNotification:function(t){t.sqmDWords=[t.errorCode,0],delete t.errorCode,null==t.highPriority&&(t.highPriority=t.infoType===e.InfoType.Error),null==t.reDisplay&&(t.reDisplay=t.infoType===e.InfoType.Error);var n=r[t.id];void 0===n&&(n=[],r[t.id]=n),!1===t.highPriority?n.push(t):(n.splice(a,0,t),a++),(1===r[t.id].length||t.highPriority)&&O(n[0])},showICon:function(e){d(e)},removeDOMElement:function(e){l(e)},removeProgressDiv:function(t,n){e.OUtil.writeProfilerMark(e.NotificationUxPerfMarker.RemoveLoadingAnimationStart),t.ownerDocument.getElementById("progress_"+n)&&s(t),e.OUtil.writeProfilerMark(e.NotificationUxPerfMarker.RemoveLoadingAnimationEnd)},removeIConDiv:function(t){!function(t){e.OUtil.writeProfilerMark(e.NotificationUxPerfMarker.RemoveStage1Start),l("icon_"+t),e.OUtil.writeProfilerMark(e.NotificationUxPerfMarker.RemoveStage1End)}(t)},removeInfoBarDiv:function(e,t){c(e,t)},dismissMessages:function(e){!function(e){if(r[e]){if(r[e].length>0){var t=r[e][0].div;s(t)}delete r[e]}}(e)},getHTMLEncodedString:function(e){return function(e){var t=document.createElement("div"),n=document.createTextNode(e);return t.appendChild(n),t.textContent}(e)},purgeOsfControlNotification:function(e){var t=r[e],i=n.getOsfControl(e);t&&t.length>0&&i&&Telemetry.AppNotificationHelper.LogNotification(e,t[0].sqmDWords[0],t[0].sqmDWords[1])},focusOnNotificationUx:function(e,t){C(e),A(e,t)},focusOnNotificationUxShiftIn:function(t,i){C(t),function(t,i){var o=n.getOsfControl(t);if(o&&o._controlFocus)if(I(t)){var a=r[t][0];if(a&&a.div){var s=a.div.querySelectorAll("input,a,button");if(s&&s.length>0){var l=s.length>1?s[1]:s[0];l instanceof HTMLElement&&(window.focus(),l.focus(),n._notifyHost&&n._notifyHost(t,e.AgaveHostAction.SelectWithError))}}}else o._controlFocus=!1,n._notifyHost(t,i)}(t,i)},appHasNotifications:function(e){return I(e)}}},function(e){e[e.TabExit=1]="TabExit",e[e.ButtonClick=2]="ButtonClick",e[e.PageLoad=3]="PageLoad"}(e.OmexMessageType||(e.OmexMessageType={})),function(e){e[e.TrustYellowBar=0]="TrustYellowBar",e[e.TrustPromptTaskpane=3]="TrustPromptTaskpane",e[e.TrustPromptContent=4]="TrustPromptContent"}(e.NotificationType||(e.NotificationType={})),function(e){e[e.Error=0]="Error",e[e.Warning=1]="Warning",e[e.Information=2]="Information",e[e.SecurityInfo=3]="SecurityInfo"}(e.InfoType||(e.InfoType={}))}(OSF||(OSF={})),function(e){var t;!function(e){e[e.default=0]="default",e[e.web=1]="web",e[e.windows=2]="windows",e[e.mac=3]="mac"}(t||(t={}));var n=function(){function n(){}return n.ensureFinalExtendedOverridesUrls=function(t,n){var i=t.getExtendedOverrides();i.hasFinalUrls||(i.url=e.ExtendedManifestUtility.ensureFinalExtendedOverridesUrl(t.getExtendedOverrides().url,t,n),t.getExtendedOverrides().resourcesUrl&&(i.resourcesUrl=e.ExtendedManifestUtility.ensureFinalExtendedOverridesUrl(t.getExtendedOverrides().resourcesUrl,t,n)),i.hasFinalUrls=i.url&&(i.resourcesUrl||!t.getExtendedOverrides().resourcesUrl))},n.ensureFinalExtendedOverridesUrl=function(e,t,i){var o=n.computeUrlTokens(t,i),r=n.substituteUrlTokens(e,o),a=OSF.OUtil.parseUrl(r);return a.protocol&&a.hostname&&a.host&&a.pathname?r:(Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("Invalid ExtendedOverrides Url",null,523249548),null)},n.computeUrlTokens=function(e,t){for(var i=e.getExtendedOverridesTokens(),o={},r=0;r<i.length;++r)i[r].type==OSF.ExtendedManifestSupportTokens.Requirements?o[i[r].name]=n.computeRequirementsToken(i[r],t):i[r].type==OSF.ExtendedManifestSupportTokens.Locale?o[i[r].name]=n.computeLocaleToken(i[r],t):o[i[r].name]=i[r].defaultValue;return o},n.computeRequirementsToken=function(e,t){for(var n=e.defaultValue,i=e.overrides,o=0;o<i.length;++o)t._requirementsChecker._checkSets(i[o].data.sets)&&t._requirementsChecker._checkMethods(i[o].data.methods)&&(n=i[o].value);return n},n.computeLocaleToken=function(e,t){for(var n=e.defaultValue.toLowerCase(),i=t.getAppUILocale().toLowerCase(),o=i.replace(/-.+/,"-*"),r=e.overrides,a=0;a<r.length;++a){var s=r[a];if(i==s.data){n=s.value;break}o==s.data&&(n=s.value)}return n},n.substituteUrlTokens=function(e,t){return e.replace(new RegExp(OSF.ExtendedManifestSupportTokens.TokenReplaceRegex,"g"),(function(e,i,o,r){return n.substituteMatchWithTokenValue(e,i,o,r,t)}))},n.downloadContent=function(t){return new Promise((function(n,i){OSF.OUtil.xhrGet(t,(function(o){o?n(o):i(new e.OsfRuntimeError(e.OsfRuntimeErrorCode.downloadError,"No content downloaded from "+t))}),(function(e){i(e)}))}))},n.substituteMatchWithResourceValue=function(t,n,i,o){if(i&&"object"==typeof i[n])return i[n].value;if(o&&"object"==typeof o[n])return o[n].value;throw Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Missing Extended Manifest Resource Token value",null,null,523249549),new e.OsfRuntimeError(e.OsfRuntimeErrorCode.tokenError,"Missing Extended Manifest Resource token value")},n.replaceResourceTokens=function(e,t,i){var o=new RegExp(OSF.ExtendedManifestSupportTokens.ResourceTokenRegEx);return e.replace(o,(function(e,o){return n.substituteMatchWithResourceValue(e,o,t,i)}))},n.constructExtendedManifestFromAppMetadata=function(e){for(var t,n=[],i=[],o=null===(t=e.getExtensionShortcut())||void 0===t?void 0:t.keys,r=0;r<o.length;r++){var a={key:{}};a.key.default=o[r].key.defaultKey,o[r].key.web&&(a.key.web=o[r].key.web),a.action=o[r].actionId,n.push(a);var s=e.getExtensionActionById(o[r].actionId),l={};l.id=s.id,l.name=s.displayName,l.type="ExecuteFunction",i.push(l)}return{shortcuts:n,actions:i}},n.constructExtendedManifest=function(e,t){var i=void 0;e.resources&&(i=e.resources.default);var o=e.shortcuts,r=e.actions;if(o)for(var a=0;a<o.length;a++)o[a].key.web&&(o[a].key.web=n.replaceResourceTokens(o[a].key.web,t,i)),o[a].key.default&&(o[a].key.default=n.replaceResourceTokens(o[a].key.default,t,i)),o[a].key.default||o[a].key.web||Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Error: No valid platform for shortcut",null,null,null);if(r)for(a=0;a<r.length;a++)r[a].name=n.replaceResourceTokens(r[a].name,t,i);return{shortcuts:o,actions:r}},n.substituteMatchWithTokenValue=function(t,n,i,o,r){if("string"==typeof r[n])return r[n];throw Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Missing ExtendedOverrides Token value",null,null,523249550),new e.OsfRuntimeError(e.OsfRuntimeErrorCode.tokenError,"Missing ExtendedOverrides Token value")},n.validateExtendedOverrides=function(t){var n,i=[],o=t.resources,r=t.shortcuts,a=t.actions,s=new RegExp(OSF.ExtendedManifestSupportTokens.ResourceTokenRegEx),l=new RegExp(".*\\$\\{resource\\.([A-Za-z0-9_-]+)\\}.*"),c=e.ExtendedManifestUtility.validateShortcuts(r,s,l),u=e.ExtendedManifestUtility.validateActions(a,s,l,c.neededActionIds);if(i=c.errors.concat(u.errors),n=c.tokens.concat(c.tokens),c.needsResources&&u.needsResources)if(o)if(Object.keys(o).length>1&&i.push(e.ExtendedManifestValidationErrorMessages.invalidProperty(OSF.ExtendedManifestSupportTokens.ExtendedManifestLoggingPrefix,"resources","1 locale",Object.keys(o).length+" locales")),o.default){var d=e.ExtendedManifestUtility.validateExtendedOverridesResources(o.default,n,!1);i=i.concat(d)}else i.push(e.ExtendedManifestValidationErrorMessages.missingRequiredProperty(OSF.ExtendedManifestSupportTokens.ExtendedManifestLoggingPrefix,"resources.default"));else i.push(e.ExtendedManifestValidationErrorMessages.missingRequiredProperty(OSF.ExtendedManifestSupportTokens.ExtendedManifestLoggingPrefix,"resources"));return i.length>0&&Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Invalid extended manifest",null,null,523249551),{errors:i,tokens:n,needsResources:!1}},n.validateShortcuts=function(n,i,o){var r=[],a=!1,s=[],l={};if(n)for(var c=0;c<n.length;++c)if(n[c].action?l[n[c].action]=!0:r.push(e.ExtendedManifestValidationErrorMessages.missingRequiredProperty(OSF.ExtendedManifestSupportTokens.ExtendedManifestLoggingPrefix,"shortcuts["+c+"].action")),n[c].key)for(var u in n[c].key)u in t?i.test(n[c].key[u])?(s.push(n[c].key[u]),a=!0):o.test(n[c].key[u])?r.push(e.ExtendedManifestValidationErrorMessages.invalidValue(OSF.ExtendedManifestSupportTokens.ExtendedManifestLoggingPrefix,"shortcuts["+c+"].key."+u,n[c].key[u])):"string"!=typeof n[c].key[u]&&r.push(e.ExtendedManifestValidationErrorMessages.invalidType(OSF.ExtendedManifestSupportTokens.ExtendedManifestLoggingPrefix,"shortcuts["+c+"].key.","string",typeof n[c].key[u])):r.push(e.ExtendedManifestValidationErrorMessages.invalidValue(OSF.ExtendedManifestSupportTokens.ExtendedManifestLoggingPrefix,"shortcuts["+c+"].key",u));else r.push(e.ExtendedManifestValidationErrorMessages.missingRequiredProperty(OSF.ExtendedManifestSupportTokens.ExtendedManifestLoggingPrefix,"shortcuts["+c+"].key"));return{errors:r,tokens:s,needsResources:a,neededActionIds:l}},n.validateActions=function(t,n,i,o){var r=[],a=[],s=!1,l={};if(t)for(var c=0;c<t.length;++c)t[c].id?((t[c].id.length>OSF.ExtendedManifestSupportTokens.ActionIdMaxLength||t[c].id.length<1)&&r.push(e.ExtendedManifestValidationErrorMessages.invalidLength("Extended Manifest","actions["+c+"].id",OSF.ExtendedManifestSupportTokens.ActionIdMaxLength)),o[t[c].id]&&delete o[t[c].id],l[t[c].id]?r.push(e.ExtendedManifestValidationErrorMessages.duplicateValue(OSF.ExtendedManifestSupportTokens.ExtendedManifestLoggingPrefix,"actions["+c+"].id",t[c].id)):l[t[c].id]=!0):r.push(e.ExtendedManifestValidationErrorMessages.missingRequiredProperty(OSF.ExtendedManifestSupportTokens.ExtendedManifestLoggingPrefix,"actions["+c+"].id")),t[c].type||(t[c].type="ExecuteFunction"),t[c].name?t[c].name.length>OSF.ExtendedManifestSupportTokens.ActionNameMaxLength||t[c].name.length<1?r.push(e.ExtendedManifestValidationErrorMessages.invalidLength("Extended Manifest","actions["+c+"].name",OSF.ExtendedManifestSupportTokens.ActionNameMaxLength)):n.test(t[c].name)?(a.push(t[c].name),s=!0):i.test(t[c].name)?r.push(e.ExtendedManifestValidationErrorMessages.invalidValue(OSF.ExtendedManifestSupportTokens.ExtendedManifestLoggingPrefix,"actions["+c+"].name",t[c].name)):"string"!=typeof t[c].name&&r.push(e.ExtendedManifestValidationErrorMessages.invalidType(OSF.ExtendedManifestSupportTokens.ExtendedManifestLoggingPrefix,"actions["+c+"].name","string",typeof t[c].name)):r.push(e.ExtendedManifestValidationErrorMessages.missingRequiredProperty(OSF.ExtendedManifestSupportTokens.ExtendedManifestLoggingPrefix,"actions["+c+"].name"));for(var u=Object.keys(o),d=0;d<u.length;d++)r.push(e.ExtendedManifestValidationErrorMessages.actionNotFound(u[d]));return{errors:r,tokens:a,needsResources:s}},n.validateExtendedOverridesResources=function(t,n,i){var o=[];if(!t)return o;for(var r=Object.keys(t),a=new RegExp(OSF.ExtendedManifestSupportTokens.ResourceTokenRegEx),s=0,l=n;s<l.length;s++){var c=l[s],u=a.exec(c)[1],d=t[u];d?d.value||(i?o.push(e.ExtendedManifestValidationErrorMessages.missingRequiredProperty(OSF.ExtendedManifestSupportTokens.ExtendedManifestResourcesLoggingPrefix,"resources["+r.indexOf(u)+"].value")):o.push(e.ExtendedManifestValidationErrorMessages.missingRequiredProperty(OSF.ExtendedManifestSupportTokens.ExtendedManifestLoggingPrefix,"resources.default["+r.indexOf(u)+"].value"))):i?o.push(e.ExtendedManifestValidationErrorMessages.missingRequiredValue(OSF.ExtendedManifestSupportTokens.ExtendedManifestResourcesLoggingPrefix,"resources",c)):o.push(e.ExtendedManifestValidationErrorMessages.missingRequiredValue(OSF.ExtendedManifestSupportTokens.ExtendedManifestLoggingPrefix,"resources.default",c))}return o.length>0&&Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Invalid extended manifest resources",null,null,523249552),o},n.validateAndSubstituteExtendedManifestTokens=function(t,n){var i=e.ExtendedManifestUtility.validateExtendedOverrides(t),o=e.ExtendedManifestUtility.validateExtendedOverridesResources(n,i.tokens,!0),r=i.errors.concat(o);if(0==r.length)return e.ExtendedManifestUtility.constructExtendedManifest(t,n);throw new e.OsfMultiError(e.OsfRuntimeErrorCode.invalidExtendedOverride,r)},n.getPlatformName=function(){var t=navigator.userAgent;return t.indexOf("Windows")>=0||t.indexOf("CrOS")>=0||t.indexOf("SunOS")>=0||t.indexOf("Linux")>=0?e.ShortcutsMappingTableManager.s_shortcutPlatformWin32:t.indexOf("Macintosh")>=0||t.indexOf("Mac OS X")>=0?e.ShortcutsMappingTableManager.s_shortcutPlatformMac:(Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("Unknown platform or operating system, the userAgent info is: "+t,null,523249553),null)},n}();e.ExtendedManifestUtility=n}(OfficeExt||(OfficeExt={})),function(e){var t=function(){function e(){}return e.missingRequiredProperty=function(e,t){return"["+e+"] [Parsing] [Missing Required Property] property = "+t},e.invalidValue=function(e,t,n){return"["+e+"] [Parsing] [Invalid Value] property = "+t+", value = "+n},e.invalidType=function(e,t,n,i){return"["+e+"] [Parsing] [Invalid Type] property = "+t+", expected = "+n+", value = "+i},e.invalidProperty=function(e,t,n,i){return"["+e+"] [Parsing] [Invalid Property] property = "+t+", expected = "+n+", value = "+i},e.missingRequiredValue=function(e,t,n){return"["+e+"] [Parsing] [Missing Required Value] property = "+t+", expected = "+n},e.actionNotFound=function(e){return"[Extended Manifest] [Parsing] [Action Not Found] Unable to find the action with id: "+e},e.duplicateValue=function(e,t,n){return"["+e+"] [Parsing] [Duplicate Value] property = "+t+", value = "+n},e.invalidLength=function(e,t,n){return"["+e+"] [Parsing] [Invalid Length] "+t+" must be between 1 and "+n+" characters long"},e}();e.ExtendedManifestValidationErrorMessages=t}(OfficeExt||(OfficeExt={})),function(e){var t=function(){function e(){}return e.setHostFeatureEnabledInfo=function(e){this._hostFeatureEnabledInfo=e},e.getHostFeatureEnabledInfo=function(){return this._hostFeatureEnabledInfo},e}();e.HostFeatureEnabledInfo=t}(OfficeExt||(OfficeExt={})),function(e){var t="_",n=function(){function e(){}return e.prototype.get=function(e,t){return this.openTransaction(e).then((function(n){return new Promise((function(i,o){var r=n.objectStore(e).get(t);r.onsuccess=function(e){var t=e.target.result;i(t)},r.onerror=function(e){o(e)}}))})).catch((function(e){throw Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("failed to get data from indexedDB",null,521416792),e}))},e.prototype.set=function(e,t,n){return this.openTransaction(e).then((function(i){return new Promise((function(o,r){var a=i.objectStore(e).put(n,t);a.onsuccess=function(e){o(void 0)},a.onerror=function(e){r(e)}}))})).catch((function(e){throw Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("failed to set data into indexedDB",null,521416791),e}))},e.prototype.remove=function(e,t){return this.openTransaction(e).then((function(n){return new Promise((function(i,o){var r=n.objectStore(e).delete(t);r.onsuccess=function(e){i(void 0)},r.onerror=function(e){o(e)}}))})).catch((function(e){throw Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("failed to remove data from indexedDB",null,521416790),e}))},e.prototype.openDB=function(e){var t=window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB||window.indexedDB;return new Promise((function(n,i){var o=t.open(e);o.onupgradeneeded=function(t){var n=o.result;n.objectStoreNames.contains(e)||n.createObjectStore(e)},o.onsuccess=function(e){var t=o.result;n(t)},o.onerror=function(e){console.log(e.error),i(e)}})).catch((function(e){throw Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("failed to open indexedDB",null,521416789),e}))},e.prototype.openTransaction=function(e){return this.openDB(e).then((function(t){return t.transaction(e,"readwrite")})).catch((function(e){throw Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("failed to open transaction",null,521416788),e}))},e}(),i=function(){function e(){}return e.prototype.get=function(e,n){var i=localStorage.getItem(e.concat(t,n));return Promise.resolve(i)},e.prototype.set=function(e,n,i){return localStorage.setItem(e.concat(t,n),i),Promise.resolve()},e.prototype.remove=function(e,n){return localStorage.removeItem(e.concat(t,n)),Promise.resolve()},e}(),o=function(){function e(){this.cache={}}return e.prototype.get=function(e,n){var i=this.cache[e.concat(t,n)];return Promise.resolve(i)},e.prototype.set=function(e,n,i){return this.cache[e.concat(t,n)]=i,Promise.resolve()},e.prototype.remove=function(e,n){var i=e.concat(t,n);return this.cache[i]&&delete this.cache[i],Promise.resolve()},e}(),r=function(){function e(){this.indexedDB=window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB||window.indexedDB}return e.get=function(t,n,i){return void 0===i&&(i=!0),e.getOrCreateOsfCache(i).then((function(e){return e.get(t,n).catch((function(e){return Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("failed to get data from osfCache",null,521416787),Promise.resolve(null)}))}))},e.set=function(t,n,i,o){return void 0===o&&(o=!0),e.getOrCreateOsfCache(o).then((function(e){return e.set(t,n,i).catch((function(e){return Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("failed to set data into osfCache",null,521416786),Promise.resolve(null)}))}))},e.remove=function(t,n,i){return void 0===i&&(i=!0),e.getOrCreateOsfCache(i).then((function(e){return e.remove(t,n).catch((function(e){return Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("failed to remove data frome osfCache",null,521416785),Promise.resolve(null)}))}))},e.isIndexedDBSupported=function(){return!OSF.OUtil.getBooleanSetting("IsSafariWithIndexedDBDisabled")&&("undefined"!=typeof indexedDB&&"function"==typeof indexedDB.open)},e.getOrCreateOsfCache=function(t){return void 0===t&&(t=!0),__awaiter(this,void 0,void 0,(function(){var n,i,o;return __generator(this,(function(r){switch(r.label){case 0:return t?null!=e.instance?[3,2]:(i=e,[4,e.getOrCreateOsfCacheInstance(t)]):[3,3];case 1:i.instance=r.sent(),r.label=2;case 2:return n=e.instance,[3,6];case 3:return null!=e.instance2?[3,5]:(o=e,[4,e.getOrCreateOsfCacheInstance(t)]);case 4:o.instance2=r.sent(),r.label=5;case 5:n=e.instance2,r.label=6;case 6:return[2,n]}}))}))},e.getOrCreateOsfCacheInstance=function(t){return __awaiter(this,void 0,void 0,(function(){var r,a,s,l,c;return __generator(this,(function(u){switch(u.label){case 0:if(e.isIndexedDBSupported()?r=new n:t&&"undefined"!=typeof localStorage&&(r=new i),!r)return[3,6];u.label=1;case 1:return u.trys.push([1,5,,6]),a="2e6fcdbf4fc14868bb28bfce0ba90308",s="6a70357198be40ca993ee899547f7cca",l="a580479c26f042b5a91c3fadb93ac3ef",[4,r.set(a,s,l)];case 2:return u.sent(),[4,r.get(a,s)];case 3:return c=u.sent(),[4,r.remove(a,s)];case 4:if(u.sent(),c!=l)throw new Error("database isn't avalible");return[3,6];case 5:return u.sent(),r=new o,[3,6];case 6:return r||(r=new o),[2,r]}}))}))},e.c_osfCacheTableName="OSF.Cache",e.c_extendedManifestTableName="OSF.ExtendedManifest",e.c_extendedManifestResourcesTableName="OSF.ExtendedManifestResources",e}();e.OsfCache=r}(OfficeExt||(OfficeExt={})),function(e){var t=function(){function t(t){var n=this;if(e.OUtil.validateParamObject(t,{appName:{type:Number,mayBeNull:!1},appVersion:{type:String,mayBeNull:!1},clientMode:{type:Number,mayBeNull:!1},appUILocale:{type:String,mayBeNull:!1},dataLocale:{type:String,mayBeNull:!1},osfOmexBaseUrl:{type:String,mayBeNull:!0},devCatalogUrl:{type:String,mayBeNull:!0},sdxCdnUrl:{type:String,mayBeNull:!0},sdxDmsUrl:{type:String,mayBeNull:!0},spBaseUrl:{type:String,mayBeNull:!0},docUrl:{type:String,mayBeNull:!0},hostControl:{type:Object,mayBeNull:!0},pageBaseUrl:{type:String,mayBeNull:!0},lcid:{type:String,mayBeNull:!0},formFactor:{type:String,mayBeNull:!0},controlStatusChanged:{type:Object,mayBeNull:!0},notifyHost:{type:Object,mayBeNull:!0},allowExternalMarketplace:{type:Boolean,mayBeNull:!0},localizedScriptsUrl:{type:String,mayBeNull:!0},localizedImagesUrl:{type:String,mayBeNull:!0},localizedStylesUrl:{type:String,mayBeNull:!0},localizedResourcesUrl:{type:String,mayBeNull:!0},enableAddinCommands:{type:Boolean,mayBeNull:!0},enableBlackForestRedirect:{type:Boolean,mayBeNull:!0},enableMyOrg:{type:Boolean,mayBeNull:!0},enableMyApps:{type:Boolean,mayBeNull:!0},enableDevCatalog:{type:Boolean,mayBeNull:!0},enablePrivateCatalog:{type:Boolean,mayBeNull:!0},enableTaskpaneUpgradeToAppCommand:{type:Boolean,mayBeNull:!0},enableUploadFileDevCatalog:{type:Boolean,mayBeNull:!0},enableV1RedirectApis:{type:Boolean,mayBeNull:!0},omexForceAnonymous:{type:Boolean,mayBeNull:!0},userNameHashCode:{type:Number,mayBeNull:!0},hostFullVersion:{type:String,mayBeNull:!0},envCode:{type:String,mayBeNull:!0},showSignOutFromPrivateCatalogMessage:{type:Boolean,mayBeNull:!0},enableSingleSignOnForAddin:{type:Boolean,mayBeNull:!0},firstPartySingleSignOnWhitelist:{type:String,mayBeNull:!0},hideAppsExtensionUrl:{type:String,mayBeNull:!0},enableInsertDialogAccessibilityFix:{type:Boolean,mayBeNull:!0},disableLogging:{type:Boolean,mayBeNull:!0},enableDisplayBlockedMinorError:{type:Boolean,mayBeNull:!0},enableFirstPartySSO:{type:Boolean,mayBeNull:!0},disableAppsForOfficeThirdParty:{type:Boolean,mayBeNull:!0},wacSessionId:{type:String,mayBeNull:!0},enableFirstPartySDXErrorMessages:{type:Boolean,mayBeNull:!0},isHostDocumentDomain:{type:Boolean,mayBeNull:!0},enableRichApiCellEditDelay:{type:Boolean,mayBeNull:!0},wopiHostOriginFromPostMessage:{type:String,mayBeNull:!0},wopiHostOriginFromWacPropBag:{type:String,mayBeNull:!0},"wacIsEmbedded ":{type:Boolean,mayBeNull:!0},"accessibilityAllowFocusAddinTaskpane ":{type:Boolean,mayBeNull:!0},disableMicrophonePermission:{type:Boolean,mayBeNull:!0},agaveAddinUploadEnabled:{type:Boolean,mayBeNull:!0},featureGateFlag:{type:Number,mayBeNull:!0},isReactRibbonEnabled:{type:Boolean,mayBeNull:!0}},null),this.getBooleanAppSetting=function(e,t){var n=e&&t&&void 0!==e[t]&&e[t]&&("string"==typeof e[t]&&"TRUE"===e[t].toUpperCase()||"boolean"==typeof e[t]&&e[t]);return void 0!==n&&n},this.addAppSettingAsFlights=function(t,n,i){this.getBooleanAppSetting(t,n)&&e.OUtil.pushFlight(i)},this._osfOmexBaseUrl=t.osfOmexBaseUrl,this._devCatalogUrl=t.devCatalogUrl,this._sdxCdnUrl=t.sdxCdnUrl,this._sdxDmsUrl=t.sdxDmsUrl,this._firstPartyManifestCDNUrl=t.firstPartyManifestCDNUrl,this._spBaseUrl=t.spBaseUrl,this._enableAddinCommands=t.enableAddinCommands||!1,this._enableBlackForestRedirect=t.enableBlackForestRedirect||!1,this._enableInsertDialogAccessibilityFix=t.enableInsertDialogAccessibilityFix||!1,this._enableFirstPartySDXErrorMessages=t.enableFirstPartySDXErrorMessages||!1,this._enableMyOrg=t.enableMyOrg||!1,this._enableMyApps=t.enableMyApps||!1,this._enableDevCatalog=t.enableDevCatalog||!1,this._enablePrivateCatalog=t.enablePrivateCatalog||!1,this._showSignOutFromPrivateCatalogMessage=t.showSignOutFromPrivateCatalogMessage||!1,this._enableTaskpaneUpgradeToAppCommand=t.enableTaskpaneUpgradeToAppCommand||!1,this._enableUploadFileDevCatalog=t.enableUploadFileDevCatalog||!1,this._enableV1RedirectApis=t.enableV1RedirectApis||!1,this._appName=t.appName,this._appVersion=t.appVersion,this._clientMode=t.clientMode,this._appUILocale=t.appUILocale,this._dataLocale=t.dataLocale,this._docUrl=t.docUrl,this._hostControl=t.hostControl,this._formFactor=t.formFactor||e.FormFactor.Default,this._pageBaseUrl=t.pageBaseUrl,this._lcid=t.lcid,this._controlStatusChanged=t.controlStatusChanged,this._notifyHost=t.notifyHost||function(e,t,n){},this._allowExternalMarketplace=t.allowExternalMarketplace,this._localizedScriptsUrl=t.localizedScriptsUrl,this._localizedImagesUrl=t.localizedImagesUrl,this._localizedStylesUrl=t.localizedStylesUrl,this._localizedResourcesUrl=t.localizedResourcesUrl,this._omexForceAnonymous=t.omexForceAnonymous||!1,this._userNameHashCode=t.userNameHashCode||0,this._hostFullVersion=t.hostFullVersion,this._wacHostEnvironment=t.envCode,this._enableSingleSignOnForAddin=t.enableSingleSignOnForAddin||!1,this._enableFirstPartySSO=t.enableFirstPartySSO||!1,this._hideAppsExtensionUrl=this._osfOmexBaseUrl+t.hideAppsExtensionUrl,this._disableLogging=t.disableLogging||!1,this._enableDisplayBlockedMinorError=t.enableDisplayBlockedMinorError||!1,this._disableAppsForOfficeThirdParty=t.disableAppsForOfficeThirdParty||!1,this._isHostDocumentDomain=t.isHostDocumentDomain||!1,this._enableRichApiCellEditDelay=t.enableRichApiCellEditDelay||!1,this._loggableUserId=t.loggableUserId,this._sessionStartInfoJson=t.sessionStartInfoJson,this._firstPartySingleSignOnWhitelist=t.firstPartySingleSignOnWhitelist,this._wopiHostOriginFromPostMessage=t.wopiHostOriginFromPostMessage,this._wopiHostOriginFromWacPropBag=t.wopiHostOriginFromWacPropBag,this._wacIsEmbedded=t.wacIsEmbedded,this._enableWopiHostCheck=t.isHostFrameTrustCheckEnabledForAddIns||!1,this._enableUpnCheck=t.isUpnCheckEnabled||!1,this._wacUpn=t.wacUpn,this._externalLogger=t.externalLogger||null,this._hostInstallAddInsIsEnabled=t.hostInstallAddInsIsEnabled||!1,this._hostInstallAddIns=t.hostInstallAddIns,this._approvedAddIns=t.approvedAddIns,this._accessibilityAllowFocusAddinTaskpane=t.accessibilityAllowFocusAddinTaskpane,this._disableMicrophonePermission=t.disableMicrophonePermission||!1,this._oAuthManager=null,this._agaveAddinUploadEnabled=t.agaveAddinUploadEnabled||!1,this._isHostFrameTrusted=t.isHostFrameTrusted||e.HostFrameTrustState.NotInitialized,this._hostFeatureGateFlag=t.hostFeatureGateFlag||e.HostFeatureGateFlags.None,this._isReactRibbonEnabled=t.isReactRibbonEnabled||!1,this._enableSetFocusOnTaskpaneOnUserAction=t.enableSetFocusOnTaskpaneOnUserAction||!1,this._isSafariWithIndexedDBDisabled=t.isSafariWithIndexedDBDisabled||!1,this._enableCustomShortcuts=t.enableCustomShortcuts,this._changeGetModifierKeyStringOutputOrder=t.changeGetModifierKeyStringOutputOrder,this._enable3rdPartySetAppContextInIframeName=this._hostFeatureGateFlag&e.HostFeatureGateFlags.Enable3rdPartySetAppContextInIFrameName,this._appSettings=t.appSettings||{},this._singleSignOnSettings=t.singleSignOnSettings||{},this._flightingTreatmentVariables=t.flightingTreatmentVariables||{},this._enableWopiHostCheck=this._enableWopiHostCheck||this.getBooleanAppSetting(this._appSettings,"WopiHostCheckForAddinsIsEnabled"),this._officeJsUrl=t.officeJsUrl,this._enableOfficeJsUrlParam=t.enableOfficeJsUrlParam,this._hostAllowedSdxEmbedding=t.hostAllowedSdxEmbedding||!1,this._hostAllowedOfficeStore=t.hostAllowedOfficeStore||!1,this._enableWopiHostCheck||(this._hostAllowedSdxEmbedding=!0,this._hostAllowedOfficeStore=!0),this._upnCheckResult=e.UpnCheckCode.NotSet,OfficeExt.HostFeatureEnabledInfo.setHostFeatureEnabledInfo(t),this._pageBaseUrl&&"/"!==this._pageBaseUrl.charAt(this._pageBaseUrl.length-1)&&(this._pageBaseUrl=this._pageBaseUrl+"/"),this._localizedResourcesUrl&&"/"!==this._localizedResourcesUrl.charAt(this._localizedResourcesUrl.length-1)&&(this._localizedResourcesUrl=this._localizedResourcesUrl+"/"),this._clientId=e.OUtil.getUniqueId(),this._cachedOsfControls={},this._notReadyOsfControls={},this._notReadyOsfControlsIndex=0,this._iframeAttributeBag={},this._serviceEndPoint=null,this._serviceEndPointInternal=null,this._internalConversationId=null,this._iframeProxies={},this._iframeProxyCount=0,this._iframeNamePrefix="__officeExtensionProxy",this._webUrl=null,this._wsa=null,this._insertDialogDiv=null,this._hasPreloadedOfficeJs=!1,null!=this._externalLogger&&Telemetry.Logger.SetExternalLogger(this._externalLogger),this._contextMgrCorrelationId=t.wacSessionId||e.OUtil.Guid.generateNewGuid(),Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("_contextMgrCorrelationId :"+this._contextMgrCorrelationId,null,523355598),Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("ContextActivationManager Constructor isHostFrameTrusted param:"+t.isHostFrameTrusted,this._contextMgrCorrelationId,523355599),Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("Host is enabled to install AddIns provided by host:"+this._hostInstallAddInsIsEnabled,this._contextMgrCorrelationId,523355600),Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("Host is enabled to use AddIns:"+this._hostAllowedSdxEmbedding,this._contextMgrCorrelationId,523355601),Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("Host is enabled to install AddIns provided by Office Store:"+this._hostAllowedOfficeStore,this._contextMgrCorrelationId,523355602),this._hostType=null,this._hostPlatform=null,this._hostSpecificFileVersion=null,this._requirementsChecker=new e.RequirementsChecker,this._onClickInstallOsfControl=null,this._appTheme=null,this._officeThemeChangedHandler=null,Mos.TaosPayloadAdapter._setAppUILocale(this.getAppUILocale()),OfficeExt.MosRequestHandler._setUserKey(this._loggableUserId),this._osfOmexBaseUrl){var i,o=this._osfOmexBaseUrl.indexOf(e.Constants.ProtocolSeparator);i=o>=0?this._osfOmexBaseUrl.substr(o):e.Constants.ProtocolSeparator+this._osfOmexBaseUrl;var r=e.Constants.Https+i,a=e.Constants.Https+i;e.OUtil.getQueryStringParamValue(window.location.search,e.Constants.OmexForceAnonymousParamName).toLowerCase()==e.Constants.OmexForceAnonymousParamValue.toLowerCase()?(this._omexAuthNStatus=e.OmexAuthNStatus.Anonymous,this._omexForceAnonymous=!0):this._omexAuthNStatus=e.OmexAuthNStatus.NotAttempted,this._omexGatedWSProxy={proxyUrl:r+e.Constants.OmexGatedServiceExtension,proxyName:e.Constants.OmexGatedServiceName,isReady:!1,clientEndPoint:null,pendingCallbacks:[]},this._omexWSProxy={proxyUrl:a+e.Constants.OmexUnGatedServiceExtension,proxyName:e.Constants.OmexUnGatedServiceName,isReady:!1,clientEndPoint:null,pendingCallbacks:[]},this._omexAnonymousWSProxy={proxyUrl:r+e.Constants.OmexAnonymousServiceExtension,proxyName:e.Constants.OmexAnonymousServiceName,isReady:!1,clientEndPoint:null,pendingCallbacks:[]},this._omexBillingMarket=null,this._omexEndPointBaseUrl=a}function s(e,t){try{return JSON.parse(e)[t].toLowerCase()}catch(e){return}}var l=s(t.sessionStartInfoJson,"AudienceGroup"),c=parseInt(s(t.sessionStartInfoJson,"Ring")),u=s(t.sessionStartInfoJson,"SessionOrigin");this._isBlueChicken="bluechicken"===u,"automation"===l||this._isBlueChicken||("number"!=typeof c||c>=-2)&&e.OUtil.pushFlight(e.FlightNames.AddinEnforceHttps),this._enableSetFocusOnTaskpaneOnUserAction&&e.OUtil.pushFlight(e.FlightNames.SetFocusToTaskpaneIsEnabled),this._agaveAddinUploadEnabled=this._agaveAddinUploadEnabled||this.getBooleanAppSetting(this._appSettings,"AgaveAddinUploadEnabled"),this._uiHostSupportsAuthTokenAddinList=this._singleSignOnSettings?this._singleSignOnSettings.UiHostSupportsAuthTokenAddinList:null;try{OfficeExt.SDXCatalog.setDmsSdxPackageFromList(this._appSettings["DmsSdxList"+e.getManifestHostTypeFromAppName(this._appName)])}catch(e){Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Unexpected error parsing DmsSdxList setting.",e,this._appCorrelationId,509350938)}this.addAppSettingAsFlights(this._appSettings,"AddinRibbonIdAllowUnknown",e.FlightNames.AddinRibbonIdAllowUnknown),this.addAppSettingAsFlights(this._appSettings,"AddinActionDefinitionHybridMode",e.FlightNames.AddinActionDefinitionHybridMode),this.addAppSettingAsFlights(this._appSettings,"ManifestParserDevConsoleEnabled",e.FlightNames.ManifestParserDevConsoleLog),this.addAppSettingAsFlights(this._appSettings,"UseActionIdForUILessCommand",e.FlightNames.UseActionIdForUILessCommand),this.addAppSettingAsFlights(this._appSettings,"ShortcutInfoArrayInUserPreferenceData",e.FlightNames.ShortcutInfoArrayInUserPreferenceData);for(var d=e.TestFlightStart;d<=e.TestFlightEnd;d++){var p="OSFTestFlight"+d;this.addAppSettingAsFlights(this._appSettings,p,d)}var f=this._appSettings.FlightingTreatmentVariables;if(f){if("string"==typeof f)try{f=JSON.parse(f)}catch(e){f={};Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Unexpected error parsing flightTreatmentsAppSettings JSON.",e,this._appCorrelationId,523355603)}}else f=this._appSettings.flightingTreatmentVariables||{};try{var m=Object.keys(JSON.parse(this._appSettings.DisabledChangeGates));e.DisabledChangeGates=e.DisabledChangeGates.concat(m)}catch(e){Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("Failed to parse disabled change gates from appSettings.",this._appCorrelationId,509167433)}for(var h in e.FlightTreatmentNames){var g=e.FlightTreatmentNames[h];if(e.OUtil.getBooleanFromDictionary(f,g))e.OUtil.pushFlight(g);else{var y=e.OUtil.getIntFromDictionary(f,g);isNaN(y)||e.OUtil.pushIntFlight(g.toString(),y)}}var v=new RegExp("Microsoft\\.Office\\.SharedOnline\\..+KillSwitch");for(var S in f)v.test(S)&&e.OUtil.getBooleanFromDictionary(f,S)&&e.OUtil.pushFlight(S);if(e.OUtil.getValue(this._flightingTreatmentVariables["Microsoft.Office.OEP.FirstPartyAnonymousProxyReadyCheckTimeoutEnabled"],!1)&&e.OUtil.pushFlight(e.FlightNames.FirstPartyAnonymousProxyReadyCheckTimeout),e.OUtil.getValue(this._flightingTreatmentVariables["Microsoft.Office.OEP.UseStaleCache"],!1)&&e.OUtil.pushFlight("Microsoft.Office.OEP.UseStaleCache"),e.Settings.IsReactRibbonEnabled=this._isReactRibbonEnabled,e.Settings.IsReactMLR=this.getBooleanAppSetting(this._appSettings,"IsReactMLR"),e.Settings.IsSafariWithIndexedDBDisabled=this._isSafariWithIndexedDBDisabled,e.Settings.EnableCustomShortcuts=this._enableCustomShortcuts,e.Settings.ChangeGetModifierKeyStringOutputOrder=this._changeGetModifierKeyStringOutputOrder,e.OUtil.checkFlight(e.FlightNames.ManifestParserDevConsoleLog)&&(e.Settings.DevConsoleEnabled=this.getBooleanAppSetting(this._appSettings,"DevConsoleEnabled")),"RibbonGroupIdMapMLR"in e&&"RibbonGroupIdMapCommonMLR"in e)for(var _ in e.RibbonGroupIdMapMLR)e.RibbonGroupIdMapCommonMLR[_]=e.RibbonGroupIdMapMLR[_];else if("RibbonGroupIdMap"in e&&"RibbonGroupIdMapCommonMLR"in e)for(var _ in e.RibbonGroupIdMap)e.RibbonGroupIdMapCommonMLR[_]=e.RibbonGroupIdMap[_];this._isFromWacAutomation=function(){if(void 0!==n._isFromWacAutomation&&null!==n._isFromWacAutomation)return n._isFromWacAutomation;try{for(var e=window,t=void 0;e!==t;){if(!e.location||!e.location.search)return!1;if(e.location.search.toLowerCase().indexOf("automation=1")>=0)return!0;t=e,e=e.parent}}catch(e){return!1}return!1}(),e.OsfManifestManager._setUILocale(this._appUILocale);var C=this;C.getContextForEmbeddingPage=function(){var e=0;if(C._hostSpecificFileVersion&&-1!=C._hostSpecificFileVersion.indexOf(".")){var t=C._hostSpecificFileVersion.split("."),n=t[1];isNaN(n)||(e=parseInt(t[1]))}var i=C._requirementsChecker._getSupportedSet();return{appName:C._appName,appVersion:C._appVersion,appUILocal:C._appUILocale,dataLocale:C._dataLocale,docUrl:C._docUrl||"",clientMode:C._clientMode,minorVersion:e,requirements:i}};var A=function(e){Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("Silent fail for window.open.",this._contextMgrCorrelationId,520950944)},O=function(t,n){if(!(t.storeType==e.StoreTypeEnum.PrivateCatalog||t.storeType==e.StoreTypeEnum.MarketPlace||t.storeType==e.StoreTypeEnum.WopiCatalog&&e.OUtil.checkFlight(e.FlightTreatmentNames.WopiPreinstalledAddInsEnabled)||t.storeType==e.StoreTypeEnum.Catalog))return OsfMsAjaxFactory.msAjaxDebug.trace("Unknown store type."),void n({errorCode:e.InvokeResultCode.E_GENERIC_ERROR});var i=OfficeExt.ManifestUtil.GetStoreTypeName(t.storeType),o=t.refresh,r=OfficeExt.CatalogFactory.resolve(i),a=e.OUtil.Guid.generateNewGuid(),s=new OfficeExt.InsertDialogTelemetryContext(a);r.getEntitlementAsync(!1,s,(function(i){if(i.status!==OfficeExt.DataServiceResultCode.Succeeded){if(t.storeType==e.StoreTypeEnum.MarketPlace||i.status==OfficeExt.DataServiceResultCode.Unauthenticated)return void n({value:null,errorCode:e.InvokeResultCode.E_USER_NOT_SIGNED_IN});if(t.storeType==e.StoreTypeEnum.PrivateCatalog){var a=i.status==OfficeExt.DataServiceResultCode.UserResolutionNoMailbox?e.InvokeResultCode.E_USER_NO_MAILBOX:e.InvokeResultCode.E_CATALOG_REQUEST_FAILED;return void n({value:null,errorCode:a})}return t.storeType==e.StoreTypeEnum.Catalog?void r.getSPCatalogUrl(s,(function(t){var i;i={value:null,errorCode:t.status!==OfficeExt.DataServiceResultCode.Succeeded?e.InvokeResultCode.E_CATALOG_NO_APPS:e.InvokeResultCode.E_GENERIC_ERROR},n(i)})):void n({value:null,errorCode:e.InvokeResultCode.E_GENERIC_ERROR})}var l,c=C.getRequirementsChecker();if(t.storeType==e.StoreTypeEnum.Catalog){l=[];for(var u=0,d=i.value;u<d.length;u++){var p=d[u];c.isEntitlementFromCorpCatalogSupported(p)&&l.push(p)}}else l=i.value;l.length<=0?n({value:null,errorCode:t.storeType==e.StoreTypeEnum.MarketPlace?e.InvokeResultCode.S_OK:e.InvokeResultCode.E_CATALOG_NO_APPS}):(!o||t.storeType!=e.StoreTypeEnum.MarketPlace&&t.storeType!=e.StoreTypeEnum.WopiCatalog||R(i.value),r.getAppDetails(l,null,s,(function(i){if(i.status!==OfficeExt.DataServiceResultCode.Succeeded||!i.value||!i.value.length||0===i.value.length){if(t.storeType==e.StoreTypeEnum.PrivateCatalog)return void n({value:null,errorCode:e.InvokeResultCode.E_CATALOG_REQUEST_FAILED});if(t.storeType==e.StoreTypeEnum.WopiCatalog)return void n({value:null,errorCode:e.InvokeResultCode.E_GENERIC_ERROR})}var o=[];if(i.status==OfficeExt.DataServiceResultCode.Succeeded&&i.value)for(var r=0,a=i.value;r<a.length;r++){var s=a[r];!0===(t.storeType==e.StoreTypeEnum.Catalog||c.isEntitlementFromOmexSupported(s))&&o.push(s)}o.length<=0&&t.storeType!==e.StoreTypeEnum.MarketPlace?n({errorCode:e.InvokeResultCode.E_CATALOG_NO_APPS,value:null}):n({errorCode:e.InvokeResultCode.S_OK,value:o})}),o))}),o)},T=function(t,n){t.hasOwnProperty("fromInsertDialog")&&!t.fromInsertDialog||null!=C._insertDialogDiv&&2==C._insertDialogDiv.childNodes.length&&C._insertDialogDiv.removeChild(C._insertDialogDiv.lastChild),O(t,(function(i){var o=null;if(i.errorCode==e.InvokeResultCode.S_OK&&i.value&&i.value.length&&i.value.length>0){o=[];for(var r=0,a=i.value;r<a.length;r++){var s=a[r],l=[];l.push(s.name),l.push(s.solutionId),l.push(s.description),l.push(e.OUtilWac.getTargetType(s.appSubType)),l.push(e.OUtilWac.normalizeAppVersion(s.version)),l.push(s.assetId),l.push(s.assetStoreId),l.push(parseInt(s.defaultWidth)),l.push(parseInt(s.defaultHeight)),l.push(s.iconUrl),l.push(s.provider),l.push(s.storeId),l.push(s.storeType),t.storeType!=e.StoreTypeEnum.MarketPlace&&t.storeType!=e.StoreTypeEnum.WopiCatalog||l.push(s.webApplicationId),o.push(l)}}var c={value:o,errorCode:i.errorCode};n(c)}))};this._onClickInstallOsfControl=function(t,n){if(C._enableUploadFileDevCatalog){OsfMsAjaxFactory.msAjaxDebug.trace("onClickInstallOsfControl!");try{var i;e.OUtil.validateParamObject(t,{manifest:{type:String,mayBeNull:!1}},null);var o=(i=!e.OUtil.checkFlight(e.FlightTreatmentNames.MosManifestEnabled)||"application/json"!==t.fileType&&"text/json"!==t.fileType?new e.Manifest.Manifest(t.manifest,C.getAppUILocale()):Mos.AppMetadata.fromString(t.manifest,e.PayloadType.MosAcquisition,C.getAppUILocale())).getMarketplaceID(),r=i.getMarketplaceVersion();if(OfficeExt.CatalogFactory.resolve(e.StoreType.UploadFileDevCatalog).validateAndCacheNewManifest(o,r,t.manifest,i)){var a={solutionId:o,version:r,storeType:e.StoreType.UploadFileDevCatalog,storeId:"developer",assetId:null,assetStoreId:null,targetType:i.getTarget(),width:parseInt(i.getDefaultWidth()||"0"),height:parseInt(i.getDefaultHeight()||"0"),isAddinCommands:i._isAddinCommandsManifest(e.getManifestHostType(C._hostType))};e.OUtil.validateParamObject(a,{solutionId:{type:String,mayBeNull:!1},targetType:{type:Number,mayBeNull:!1},version:{type:String,mayBeNull:!1},width:{type:Number,mayBeNull:!0},height:{type:Number,mayBeNull:!0}},null),Telemetry.UploadFileDevCatalogUsageHelper.LogUploadFileDevCatalogUsageAction(this._appCorrelationId,a.storeType,Telemetry.PrivacyRules.GetPrivacyCompliantId(a.solutionId,a.storeType,a.assetId,null,null,a.storeId),a.version,a.targetType,a.isAddinCommands,a.width,a.height),C._notifyHost("0",e.AgaveHostAction.InsertAgave,a)}else C._notifyHost("0",e.AgaveHostAction.NotifyHostError,null)}catch(t){var s="Invalid manifest from addincommands dev catalog.";return OfficeExt.WACUtils.logExceptionToBrowserConsole(s,t),Telemetry.RuntimeTelemetryHelper.LogExceptionTag(s,t,this._appCorrelationId,523355609),void C._notifyHost("0",e.AgaveHostAction.NotifyHostError,null)}}};var I=function(t,n){OsfMsAjaxFactory.msAjaxDebug.trace("onClickRefreshfAddinCommands!"),C._notifyHost("0",e.AgaveHostAction.RefreshAddinCommands,t)},x=function(t,n){if(C._enableSingleSignOnForAddin&&t.webApplicationId&&!e.OUtil.isChangeGateEnabled("OfficeVSO:0_Bug6335018"))F(t,n);else{var i={assetId:t.id,clientVersion:C._getClientVersionForOmex(),clientName:C._getClientNameForOmex(),clientEndPoint:C._omexGatedWSProxy.clientEndPoint},o=C._insertDialogDiv,r={errorCode:e.InvokeResultCode.E_OEM_REMOVED_FAILED,forceRefreshEntitlements:!1},a=e.OUtil.Guid.generateNewGuid(),s=new OfficeExt.InsertDialogTelemetryContext(a);OfficeExt.CatalogFactory.resolve(e.StoreType.OMEX).removeAsync([i.assetId],s,(function(a){var s=0;if(a.status==OfficeExt.DataServiceResultCode.Succeeded&&a.value&&a.value.removedApps&&a.value.removedApps.length>0){for(var l=a.value.removedApps,c=e.InvokeResultCode.E_OEM_REMOVED_FAILED,u=0;u<l.length;u++)if(l[u].assetId==i.assetId){l[u].result==e.OmexRemoveAppStatus.Success&&(c=e.InvokeResultCode.S_OK);break}c==e.InvokeResultCode.S_OK&&(s=C.untrustOsfControls(t),E(i.assetId,t.currentStoreType),M(i.assetId)),r.errorCode=c}var d=!document.documentElement.contains(o);Telemetry.AppManagementMenuHelper.LogAppManagementMenuAction(Telemetry.PrivacyRules.GetPrivacyCompliantId(t.id,t.currentStoreType,null,null,null,null),e.AppManagementAction.Remove,s,d,!1,r.errorCode),r.forceRefreshEntitlements=!0,n(r)}))}},E=function(t,n){var i={solutionId:t,storeType:n};C._appName==e.AppName.ExcelWebApp&&C._notifyHost("0",e.AgaveHostAction.UninstallCustomFunctions,i)},M=function(t){var n=null;for(var i in C._cachedOsfControls){var o=C._cachedOsfControls[i];if(o.getSolutionId().toLowerCase()==t.toLowerCase()){n=o;break}}if(!e.OUtil.isNullOrUndefined(n)&&!e.OUtil.isNullOrUndefined(n._manifest)&&e.OsfManifestManager.manifestContainsExtendedOverrides(n._manifest)){var r=OfficeExt.ManifestUtil.constructAddInId(n.getSolutionId(),n.getVersion(),n.getStoreType(),n.getStoreId());OfficeExt.OsfExtendedManifestCache.clear(r),Common.App.AppsForOffice.AddinShortcutsPreferenceSettingHelper.instance().clearSettingByAddinId(r)}},F=function(t,n){var i=C._hideAppsExtensionUrl+"&"+e.OmexPageParameterKeys.AppName+"="+e.getModernAppVerCode(C._appName)+"&"+e.OmexPageParameterKeys.AssetId+"="+t.id+"&"+e.OmexPageParameterKeys.AppCorrelationId+"="+C._contextMgrCorrelationId,o=document.createElement("iframe");o.setAttribute("id","serviceExtensionIframe"),o.setAttribute("src",i),o.setAttribute("scrolling","auto"),o.setAttribute("border","0"),o.setAttribute("width","0"),o.setAttribute("height","0"),o.setAttribute("style","position: absolute; left: -100px; top:0px;"),document.body.appendChild(o);var r=C._insertDialogDiv,a=function(i){if(i.source==o.contentWindow){var s={errorCode:e.InvokeResultCode.E_OEM_REMOVED_FAILED,forceRefreshEntitlements:!1};document.body.removeChild(o),window.removeEventListener("message",a);var l=0,c=JSON.parse(i.data),u=parseInt(c[e.OmexRemoveAddinMessageKeys.RemoveAddinResultCode]),d=e.InvokeResultCode.E_OEM_REMOVED_FAILED;if(u===e.OmexRemoveAddinResultCode.Success){for(var p=c[e.OmexRemoveAddinMessageKeys.RemoveAddinResultValue],f=0;f<p.length;f++)if(p[f]==t.id){d=e.InvokeResultCode.S_OK;break}d==e.InvokeResultCode.S_OK&&(l=C.untrustOsfControls(t),b(t.id),E(t.id,t.currentStoreType)),s.errorCode=d}var m=!document.documentElement.contains(r);Telemetry.AppManagementMenuHelper.LogAppManagementMenuAction(t.id,e.AppManagementAction.Remove,l,m,!1,s.errorCode),s.forceRefreshEntitlements=!0,n(s)}};window.addEventListener("message",a)},b=function(t){var n=".*",i=[];i.push(new RegExp(e.OUtil.formatString(OfficeExt.WACUtils.CacheConstants.EntitlementsKey,n,n),"i")),i.push(new RegExp(e.OUtil.formatString(OfficeExt.WACUtils.CacheConstants.AuthenticatedAppInstallInfoCacheKey,n,t,n,n),"i")),OfficeExt.WACUtils.removeMatchesFromLocalStorage(i)},R=function(t){for(var n,i=[],o=t.length,r=0;r<o;r++){n=t[r];var a=e.OUtil.formatString(OfficeExt.WACUtils.CacheConstants.AppStateCacheKey,OfficeExt.WACUtils.CacheConstants.GatedCacheKeyPrefix,n.storeId,n.solutionId),s=e.OUtil.formatString(OfficeExt.WACUtils.CacheConstants.AppInstallInfoKey,OfficeExt.WACUtils.CacheConstants.AnonymousCacheKeyPrefix,n.solutionId,n.storeId),l=e.OUtil.isChangeGateEnabled("OfficeVSO:7799078_CultureAwareAppDetailKey")?e.OUtil.formatString(OfficeExt.WACUtils.CacheConstants.AppDetailKey,OfficeExt.WACUtils.CacheConstants.UngatedCacheKeyPrefix,n.solutionId,n.storeId.toUpperCase()):e.OUtil.formatString(OfficeExt.WACUtils.CacheConstants.AppDetailKey,OfficeExt.WACUtils.CacheConstants.UngatedCacheKeyPrefix,n.solutionId),c=e.OUtil.formatString(OfficeExt.WACUtils.CacheConstants.ActivatedCacheKey,n.solutionId.toLowerCase(),e.StoreType.OMEX,n.storeId),u=e.OUtil.formatString("{0}.{1}.{2}",n.solutionId,n.storeId,n.storeId);i[a]=!0,i[s]=!0,i[l]=!0,i[c]=!0,i[u]=!0}for(var d=e.OUtil.getLocalStorage(),p=d.getKeysWithPrefix("__OSF_"),f=(r=0,p.length);r<f;r++){var m=p[r];if(0==m.indexOf(OfficeExt.WACUtils.CacheConstants.GatedCacheKeyPrefix+OfficeExt.WACUtils.CacheConstants.AppState)||0==m.indexOf(OfficeExt.WACUtils.CacheConstants.AnonymousCacheKeyPrefix+OfficeExt.WACUtils.CacheConstants.AppInstallInfo)||0==m.indexOf(OfficeExt.WACUtils.CacheConstants.UngatedCacheKeyPrefix+OfficeExt.WACUtils.CacheConstants.AppDetails)||0==m.indexOf(OfficeExt.WACUtils.CacheConstants.ActivatedCacheKeyPrefix))1!=i[m]&&d.removeItem(m);else if(0==m.indexOf(OfficeExt.WACUtils.CacheConstants.GatedCacheKeyPrefix+OfficeExt.WACUtils.CacheConstants.AppinstallAuthenticated)){var h=m.replace(OfficeExt.WACUtils.CacheConstants.GatedCacheKeyPrefix+OfficeExt.WACUtils.CacheConstants.AppinstallAuthenticated,"");1!=i[h=h.substring(h.indexOf(".")+1)]&&d.removeItem(m)}}};if(this._serviceEndPoint=Microsoft.Office.Common.XdmCommunicationManager.createServiceEndPoint(this._clientId),this._serviceEndPoint._onHandleRequestError=function(t,n){var i,o,r;t&&(i=t._data)&&((o="string"==typeof(o="object"==typeof i&&"object"==typeof i.DdaMethod?i.DdaMethod.ControlId:"object"==typeof i?i[0]:i)?o:null)&&(r=C.getOsfControl(o))&&(r._pageStatus="Failed origin check"===n?e.OsfControlPageStatus.FailedOriginCheck:"Access Denied"===n?e.OsfControlPageStatus.FailedPermissionCheck:e.OsfControlPageStatus.FailedHandleRequest,Telemetry.RuntimeTelemetryHelper.LogExceptionTag(n,null,r.getCorrelationId(),523355610)))},this._serviceEndPoint.registerMethod("ContextActivationManager_getAppContextAsync",(function(t,n,i){void 0===i&&(i=null);var o=(null==i?void 0:i.controlId)||("string"==typeof t?t:"object"==typeof t&&t.length>0?t[0]:null);o&&n||Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Parameter validation error in getAppContextAsync.",null,null,523355604);var r=C.getOsfControl(o);if(!r)throw OsfMsAjaxFactory.msAjaxDebug.trace("osfControl for the given ID doesn't exist."),Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Cannot get osfControl with given ID.",null,null,523355605),OsfMsAjaxFactory.msAjaxError.argument("contextId");r._sdxTelemetryContext.getAppContextStart=performance.now(),r._iframeOnGetAppContextDelegate&&r._iframeOnGetAppContextDelegate(),Telemetry.AppLoadTimeHelper.OfficeJSLoaded(r._telemetryContext),n(r.getAppContext()),r._pageStatus=e.OsfControlPageStatus.Ready,r._pageIsReadyTimerExpired&&Telemetry.RuntimeTelemetryHelper.LogExceptionTag("App attempted to retrieve context after app activation error has occured.",null,r.getCorrelationId(),523355606),r._contextActivationMgr._ErrorUXHelper&&r._contextActivationMgr._ErrorUXHelper.removeProgressDiv(r._div,r._id),r.ensureAgaveEndPoint(),this._enableSetFocusOnTaskpaneOnUserAction?(r._focusOnIframeWhenLoaded||r.getStatus()===e.OsfControlStatus.Activated&&r.getPageStatus()===e.OsfControlPageStatus.Ready&&r.getInitializationReason()===Microsoft.Office.WebExtension.InitializationReason.Inserted)&&r._frame.contentWindow.focus():r._focusOnIframeWhenLoaded&&r._frame.contentWindow.focus(),Telemetry.AppLoadTimeHelper.ActivationEnd(r._telemetryContext),r._sdxTelemetryContext.getAppContextEnd=performance.now(),r._timer&&(window.clearTimeout(r._timer),r._timer=null),r._iframeIsLoaded&&r._notifyHostIFrameOnLoaded()}),Microsoft.Office.Common.InvokeType.async,!1),this._serviceEndPoint.registerMethod("ContextActivationManager_notifyHost",(function(t,n,i){(void 0===n&&(n=null),void 0===i&&(i=null),t&&2==t.length)||(t&&3==t.length&&(t[1]===e.AgaveHostAction.UpdateTargetUrl||t[1]===e.AgaveHostAction.SendTelemetryEvent||t[1]===e.AgaveHostAction.SendCustomerContent||t[1]===e.AgaveHostAction.SendMessage||t[1]===e.AgaveHostAction.LaunchExtensionComponent||t[1]===e.AgaveHostAction.StopExtensionComponent||t[1]===e.AgaveHostAction.RestartExtensionComponent||t[1]===e.AgaveHostAction.EnableTaskPaneHeaderButton||t[1]===e.AgaveHostAction.DisableTaskPaneHeaderButton||t[1]===e.AgaveHostAction.RefreshRibbonGallery||t[1]===e.AgaveHostAction.OfficeJsReady||t[1]===e.AgaveHostAction.KeyboardShortcuts)||OsfMsAjaxFactory.msAjaxDebug.trace("ContextActivationManager_notifyHost params is wrong."));var o=(null==i?void 0:i.controlId)||t[0],r=t[1],a=C.getOsfControl(o);if(a)if(r===e.AgaveHostAction.TabExitShift||r===e.AgaveHostAction.ExitNoFocusableShift)C._ErrorUXHelper.focusOnNotificationUxShiftIn(o,r);else if(r===e.AgaveHostAction.UpdateTargetUrl){var s=t[2];a.checkAppDomains(s)&&a.updateAgaveEndPointTargetUrl(s)}else if(r===e.AgaveHostAction.SendTelemetryEvent||r===e.AgaveHostAction.SendCustomerContent){var l=t[2];a._contextActivationMgr._notifyHost(o,r,l)}else if(r===e.AgaveHostAction.LaunchExtensionComponent){if(a.isFirstParty()){var c=t[2];a._contextActivationMgr._notifyHost(o,r,c)}}else if(r===e.AgaveHostAction.RestartExtensionComponent){if(a.isFirstParty()){var u=t[2];if(u.InstanceToken){var d=a._contextActivationMgr._cachedOsfControls[u.InstanceToken];if(d)d.refresh();else if(u.LaunchProperties&&u.LaunchProperties.OptionalProperties){var p=u.Id.Id,f=u.LaunchProperties.OptionalProperties.SourceLocationOverrideResourceId;a._contextActivationMgr.refreshOsfControl(p,f)}}}}else if(r===e.AgaveHostAction.StopExtensionComponent){if(a.isFirstParty()){var m=t[2];a._contextActivationMgr._notifyHost(o,r,m)}}else if(r==e.AgaveHostAction.SendMessage){for(var h in a._contextActivationMgr._cachedOsfControls)if(h!=a.getID()){var g=a._contextActivationMgr._cachedOsfControls[h];if(g.getStoreId()==a.getStoreId()&&g.getStoreType()==a.getStoreType()){var y=t[2];(null!=g.getOwnerAddinSolutionId()&&g.getOwnerAddinSolutionId()==a.getOwnerAddinSolutionId()||g.getSolutionId()==a.getSolutionId())&&g.notifyAgave(e.AgaveHostAction.SendMessage,y)}}}else if(r==e.AgaveHostAction.EnableTaskPaneHeaderButton){var v=t[2];a._contextActivationMgr._notifyHost(o,r,v)}else if(r==e.AgaveHostAction.RefreshRibbonGallery){var S=t[2];a._contextActivationMgr._notifyHost(o,r,S)}else if(r==e.AgaveHostAction.OfficeJsReady){var _=t[2];a._sdxTelemetryContext.officeJsReadyDate=_,a._iframeOnGetAppContextDelegate&&a._iframeOnGetAppContextDelegate()}else if(r==e.AgaveHostAction.KeyboardShortcuts){var A=t[2];a._contextActivationMgr._notifyHost(o,r,A)}else a._contextActivationMgr._notifyHost?a._contextActivationMgr._notifyHost(o,r):OsfMsAjaxFactory.msAjaxDebug.trace("No notifyHost provided by the host.");else OsfMsAjaxFactory.msAjaxDebug.trace("osfControl for the given ID doesn't exist.")}),Microsoft.Office.Common.InvokeType.async,!1),this._serviceEndPoint.registerMethod("ContextActivationManager_openWindowInHost",A,Microsoft.Office.Common.InvokeType.async,!1),this._serviceEndPointInternal=Microsoft.Office.Common.XdmCommunicationManager.createServiceEndPoint(this._clientId+e.Constants.EndPointInternalSuffix),this._serviceEndPointInternal.registerMethod("ContextActivationManager_getEntitlementsForInsertDialog",T,Microsoft.Office.Common.InvokeType.async,!1),this._serviceEndPointInternal.registerMethod("ContextActivationManager_invokeSignIn",(function(t){if(t&&t.storeType!=e.StoreTypeEnum.PrivateCatalog){var n=window.location.href,i=C._osfOmexBaseUrl+e.Constants.SignInRedirectUrl+encodeURIComponent(n);window.location.assign(i)}else OfficeExt.PrivateCatalogService.authenticationProxy.getSignInUrl((function(e){window.top.location.replace(e)}),(function(){C._notifyHost("0",e.AgaveHostAction.NotifyHostError,null)}))}),Microsoft.Office.Common.InvokeType.async,!1),this._serviceEndPointInternal.registerMethod("ContextActivationManager_invokeSignOut",(function(t){t&&t.storeType==e.StoreTypeEnum.PrivateCatalog&&OfficeExt.PrivateCatalogService.SignOutUser(),I(t,null)}),Microsoft.Office.Common.InvokeType.async,!1),this._serviceEndPointInternal.registerMethod("ContextActivationManager_invokeWindowOpen",(function(t){if(e.OUtil.isChangeGateEnabled("OfficeVSO:0_Bug7083046")){if(t&&t.pageUrl){var n=e.OUtil.parseUrl(t.pageUrl);if(n&&("http:"==n.protocol||"https:"==n.protocol))return void window.open(t.pageUrl,"")}Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("invokeWindowOpen:Silent fail for window.open.",this._contextMgrCorrelationId,512268233)}else if(t.pageUrl){t.pageUrl;A()}}),Microsoft.Office.Common.InvokeType.async,!1),this._serviceEndPointInternal.registerMethod("ContextActivationManager_onClickInsertOsfControl",(function(t,n){OsfMsAjaxFactory.msAjaxDebug.trace("onClickInsertOsfControl!"),C._notifyHost("0",e.AgaveHostAction.InsertAgave,t)}),Microsoft.Office.Common.InvokeType.async,!1),this._serviceEndPointInternal.registerMethod("ContextActivationManager_onClickInstallOsfControl",this._onClickInstallOsfControl,Microsoft.Office.Common.InvokeType.async,!1),this._serviceEndPointInternal.registerMethod("ContextActivationManager_onClickRefreshAddinCommands",I,Microsoft.Office.Common.InvokeType.async,!1),this._serviceEndPointInternal.registerMethod("ContextActivationManager_onClickCancelDialog",(function(t,n){OsfMsAjaxFactory.msAjaxDebug.trace("onClickCancelDialog!"),C._notifyHost("0",e.AgaveHostAction.CancelDialog),C._internalConversationId&&(C._serviceEndPointInternal.unregisterConversation(C._internalConversationId),C._internalConversationId=null)}),Microsoft.Office.Common.InvokeType.async,!1),this._serviceEndPointInternal.registerMethod("ContextActivationManager_removeAppForInsertDialog",x,Microsoft.Office.Common.InvokeType.async,!1),this._serviceEndPointInternal.registerMethod("ContextActivationManager_logTelemetryDataForInsertDialog",(function(t,n){switch(t.datapointName){case e.DataPointNames.AppManagementMenu:e.OUtil.validateParamObject(t,{id:{type:String,mayBeNull:!1},operationMetadata:{type:Number,mayBeNull:!1},hrStatus:{type:Number,mayBeNull:!1}},null),Telemetry.AppManagementMenuHelper.LogAppManagementMenuAction(t.id,t.operationMetadata,0,!1,!1,t.hrStatus);break;case e.DataPointNames.InsertionDialogSession:e.OUtil.validateParamObject(t,{id:{type:String,mayBeNull:!1},totalSessionTime:{type:Number,mayBeNull:!1},trustPageSessionTime:{type:Number,mayBeNull:!1},appInserted:{type:Boolean,mayBeNull:!1},lastActiveTab:{type:Number,mayBeNull:!1},lastActiveTabCount:{type:Number,mayBeNull:!1}},null);var i=Telemetry.PrivacyRules.GetPrivacyCompliantId(t.id,t.currentStoreType,t.assetId,null,null,t.storeId);if(Telemetry.InsertionDialogSessionHelper.LogInsertionDialogSession(i,t.totalSessionTime,t.trustPageSessionTime,t.appInserted,t.lastActiveTab,t.lastActiveTabCount),e.OUtil.isChangeGateEnabled("OfficeVSO:0_AddinAcquiredTelemetry")&&t.appInserted&&"undefined"!=typeof otel&&void 0!==otel.sendTelemetryEvent){var o=window.g_InstallOrigin;otel.sendTelemetryEvent({name:"Office.Extensibility.Host.AddinAcquired",dataFields:[{name:"SolutionId",string:i},{name:"StoreType",string:t.currentStoreType},{name:"InstallOrigin",string:o}]})}break;case e.DataPointNames.UploadFileDevCatelog:e.OUtil.validateParamObject(t,{operationMetadata:{type:Number,mayBeNull:!1},hrStatus:{type:Number,mayBeNull:!1}},null),Telemetry.UploadFileDevCatelogHelper.LogUploadFileDevCatelogAction(this._appCorrelationId,t.operationMetadata,0,!1,!1,t.hrStatus);break;case e.DataPointNames.UploadFileDevCatalogUsage:e.OUtil.validateParamObject(t,{currentStoreType:{type:String,mayBeNull:!1},id:{type:String,mayBeNull:!0},appVersion:{type:String,mayBeNull:!0},appTargetType:{type:Number,mayBeNull:!1},isAppCommand:{type:String,mayBeNull:!1},appSizeWidth:{type:Number,mayBeNull:!0},appSizeHeight:{type:Number,mayBeNull:!0}},null),Telemetry.UploadFileDevCatalogUsageHelper.LogUploadFileDevCatalogUsageAction(this._appCorrelationId,t.currentStoreType,null,t.appVersion,t.appTargetType,t.isAppCommand,t.appSizeWidth,t.appSizeHeight)}}),Microsoft.Office.Common.InvokeType.async,!1),this._serviceEndPointInternal.registerMethod("ContextActivationManager_removeAppCommandsAddin",(function(t){var n=C.getOsfControl(t.id);n?n._isAddinCommands((function(n){n&&C._notifyHost("0",e.AgaveHostAction.RemoveAppCommandsAddin,{solutionId:t.id})})):OsfMsAjaxFactory.msAjaxDebug.trace("osfControl for the given ID doesn't exist:"+Telemetry.PrivacyRules.GetPrivacyCompliantId(t.id,t.currentStoreType,null,null,null,t.storeId))}),Microsoft.Office.Common.InvokeType.async,!1),e.AppSpecificSetup._setupFacade(this._hostControl,this,this._serviceEndPoint,this._serviceEndPointInternal),t.hostType=this._hostType,t.spBaseUrl=this._spBaseUrl,t.wopiHostAddinList=this._hostInstallAddIns,t.approvedAddinList=this._approvedAddIns,t.enableWopiCatalog=this._hostInstallAddInsIsEnabled,OfficeExt.CatalogFactory.setHostContext(t),this._localeStringLoadingPendingCallbacks=[],this._localizedScriptsUrl&&"null/"!=this._localizedScriptsUrl){this._loadLocaleString(Function.createDelegate(this,(function(){this._ErrorUXHelper=new e._ErrorUXHelper(this)})))}this.queryAppDetails=function(n,i,o,r,a){!function(t,n,i,o,r){if(t!=e.StoreTypeEnum.MarketPlace)return OsfMsAjaxFactory.msAjaxDebug.trace("Unknown store type."),void r(e.InvokeResultCode.E_GENERIC_ERROR,[]);var a=OfficeExt.ManifestUtil.GetStoreTypeName(t.toString()),s=o,l=OfficeExt.CatalogFactory.resolve(a),c=e.OUtil.Guid.generateNewGuid(),u=new OfficeExt.InsertDialogTelemetryContext(c),d=i.map((function(e){return{solutionId:e,storeId:n}}));0!=d.length?(s&&R(d),l.getAppDetails(d,null,u,(function(t){var n=[];t.status==OfficeExt.DataServiceResultCode.Succeeded&&t.value&&(n=t.value),r(e.InvokeResultCode.S_OK,n)}),s)):r(e.InvokeResultCode.S_OK,[])}(n,i,o,r,(function(n,i){var o=null;n==e.InvokeResultCode.S_OK&&i&&i.length&&i.length>0&&(o=w(t.storeType,i)),a(n,o)}))},this.queryEntitlementDetails=function(e){T(e,e.callbackFunc)},this.getEntitlementDetails=function(t,n){O(t,(function(i){var o=null;i.errorCode==e.InvokeResultCode.S_OK&&i.value&&i.value.length&&i.value.length>0&&(o=w(t.storeType,i.value));var r={value:o,errorCode:i.errorCode};n(r)}))},this._removeAppForInsertDialog=function(e){x(e,e.callbackFunc)};var P,N,D,U,w=function(t,n){for(var i=[],o=0,r=n;o<r.length;o++){var a=r[o],s={displayName:a.name,solutionId:a.solutionId,description:a.description,targetType:e.OUtilWac.getTargetType(a.appSubType),version:e.OUtilWac.normalizeAppVersion(a.version),assetId:a.assetId,assetStoreId:a.assetStoreId,width:parseInt(a.defaultWidth),height:parseInt(a.defaultHeight),iconUrl:a.iconUrl,provider:a.provider,storeId:a.storeId,storeType:a.storeType,highResolutionIconUrl:a.highResolutionIconUrl,webApplicationId:null,licenseUrl:a.licenseUrl,privacyUrl:a.privacyUrl};t!=e.StoreTypeEnum.MarketPlace&&t!=e.StoreTypeEnum.WopiCatalog||(s.webApplicationId=a.webApplicationId),i.push(s)}return i};this._enableUpnCheck&&this._enableMyOrg&&null!=this._spBaseUrl&&!OfficeExt.WACUtils.isTeamsWebView()&&(P=this._wacUpn,N=function(t){n._upnCheckResult=t?e.UpnCheckCode.Match:e.UpnCheckCode.NotMatch},D=function(e){var t=!0;OfficeExt.WACUtils.logExceptionToBrowserConsole("Check UPN result: "+e.value,null),e.status===OfficeExt.DataServiceResultCode.Succeeded?t=e.value:Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("Upn Check failed.",null,523355611),N(t)},null!=(U=OfficeExt.CatalogFactory.resolve(e.StoreType.SPCatalog))&&null!=P?U.isUpnMatchAsync(P,new OfficeExt.SimpleTelemetryContext,D):(null==P&&(OfficeExt.WACUtils.logExceptionToBrowserConsole("wacUpn is null.",null),Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("wacUpn is null.",null,523355612)),null==P&&Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("spcatalog is null.",null,523355613),D({status:OfficeExt.DataServiceResultCode.Failed,value:!1})))}return t.prototype.insertOsfControl=function(t){var n;void 0===t.solutionId&&(Telemetry.RuntimeTelemetryHelper.LogExceptionTag("insertOsfControl solutionId is not defined",null,null,509658067),t.solutionId=t.marketplaceID),void 0===t.version&&(Telemetry.RuntimeTelemetryHelper.LogExceptionTag("insertOsfControl version is not defined",null,null,509658066),t.version=t.marketplaceVersion),void 0===t.storeId&&(Telemetry.RuntimeTelemetryHelper.LogExceptionTag("insertOsfControl storeId is not defined",null,null,509658065),t.storeId=t.store),void 0===t.ownerAddinSolutionId&&(void 0!==t.ownerAddinAssetId&&Telemetry.RuntimeTelemetryHelper.LogExceptionTag("insertOsfControl ownerAddinSolutionId is not defined",null,null,509658064),t.ownerAddinSolutionId=t.ownerAddinAssetId),e.OUtil.validateParamObject(t,{div:{type:Object,mayBeNull:!1},id:{type:String,mayBeNull:!1},solutionId:{type:String,mayBeNull:!1},version:{type:String,mayBeNull:!1},storeType:{type:String,mayBeNull:!1},storeId:{type:String,mayBeNull:!1},assetId:{type:String,mayBeNull:!0},assetStoreId:{type:String,mayBeNull:!0},alternateReference:{type:Object,mayBeNull:!0},settings:{type:Object,mayBeNull:!0},reason:{type:String,mayBeNull:!0},osfControlType:{type:Number,mayBeNull:!0},snapshotUrl:{type:String,mayBeNull:!0},preactivationCallback:{type:Object,mayBeNull:!0},virtualOsfControlActivationCallback:{type:Object,mayBeNull:!0},isvirtualOsfControl:{type:Boolean,mayBeNull:!0},isDialog:{type:Boolean,mayBeNull:!0},hostCustomMessage:{type:String,mayBeNull:!0},isForUILessAction:{type:Boolean,mayBeNull:!0},ownerAddinSolutionId:{type:String,mayBeNull:!0},ownerAddinStoreType:{type:String,mayBeNull:!0},sourceLocationOverrideUrl:{type:String,mayBeNull:!0},focusOnIframeWhenLoaded:{type:Boolean,mayBeNull:!0},featureGates:{type:Object,mayBeNull:!0},activationStart:{type:Number,mayBeNull:!0},hostInfoFlags:{type:Number,mayBeNull:!0},sharedRuntimeId:{type:String,mayBeNull:!0},initialDisplayMode:{type:Number,mayBeNull:!0},containsShortcuts:{type:String,mayBeNull:!0},exchangeExtensionProviderName:{type:String,mayBeNull:!0},exchangeExtensionType:{type:String,mayBeNull:!0},titleOverride:{type:String,mayBeNull:!0},isFirstPartyOptOutAppContextOptmization:{type:Boolean,mayBeNull:!0},hostSettings:{type:Object,mayBeNull:!0},onExtensionLaunchCallback:{type:Function,mayBeNull:!0}},null);var i=e.OsfControl.isFirstPartyStoreString(t.storeType);if(!this._disableAppsForOfficeThirdParty||i){n={div:t.div,id:t.id,solutionId:t.solutionId,version:t.version,storeId:t.storeId,storeType:t.storeType,settings:t.settings,reason:t.reason,osfControlType:t.osfControlType,snapshotUrl:t.snapshotUrl,contextActivationMgr:this,preactivationCallback:t.preactivationCallback,virtualOsfControlActivationCallback:t.virtualOsfControlActivationCallback,isvirtualOsfControl:t.isvirtualOsfControl,isDialog:t.isDialog,hostCustomMessage:t.hostCustomMessage,isForUILessAction:t.isForUILessAction,ownerAddinSolutionId:t.ownerAddinSolutionId,sourceLocationOverrideResourceId:t.sourceLocationOverrideResourceId,sourceLocationOverrideUrl:t.sourceLocationOverrideUrl,ownerAddinStoreType:t.ownerAddinStoreType,focusOnIframeWhenLoaded:t.focusOnIframeWhenLoaded,featureGates:t.featureGates,activationStart:t.activationStart,hostInfoFlags:t.hostInfoFlags,sharedRuntimeId:t.sharedRuntimeId,initialDisplayMode:t.initialDisplayMode,containsShortcuts:t.containsShortcuts,exchangeExtensionProviderName:t.exchangeExtensionProviderName,exchangeExtensionType:t.exchangeExtensionType,titleOverride:t.titleOverride,isFirstPartyOptOutAppContextOptmization:t.isFirstPartyOptOutAppContextOptmization,hostSettings:t.hostSettings,onExtensionLaunchCallback:t.onExtensionLaunchCallback};var o=this.getSQMAgaveUsage(t.ownerAddinStoreType||n.storeType,n.osfControlType,n.reason,t.solutionId),r=new e.OsfControl(n);r._sqmDWords[0]=o[0],r._sqmDWords[1]=o[1],r._contextActivationMgr._ErrorUXHelper&&r._contextActivationMgr._ErrorUXHelper.showProgress(r._div,r._id);return this._loadLocaleString(Function.createDelegate(this,(function(){r.activate({isInsertOsfControl:!0}),Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("OsfControl activation lifecycle: OsfControl active got called for controlId: "+Telemetry.PrivacyRules.GetPrivacyCompliantId(n.solutionId,n.ownerAddinStoreType||n.storeType,n.assetId,null,null,n.storeId),this._contextMgrCorrelationId,523355614)}))),r}},t.prototype.insertDialogControl=function(t){var n;void 0===t.solutionId&&(Telemetry.RuntimeTelemetryHelper.LogExceptionTag("insertDialogControl solutionId is not defined",null,null,509658063),t.solutionId=t.marketplaceID),void 0===t.version&&(Telemetry.RuntimeTelemetryHelper.LogExceptionTag("insertDialogControl version is not defined",null,null,509658062),t.version=t.marketplaceVersion),void 0===t.storeId&&(Telemetry.RuntimeTelemetryHelper.LogExceptionTag("insertDialogControl storeId is not defined",null,null,509658061),t.storeId=t.store),void 0===t.ownerAddinSolutionId&&(void 0!==t.ownerAddinAssetId&&Telemetry.RuntimeTelemetryHelper.LogExceptionTag("insertDialogControl ownerAddinSolutionId is not defined",null,null,509658060),t.ownerAddinSolutionId=t.ownerAddinAssetId),e.OUtil.validateParamObject(t,{div:{type:Object,mayBeNull:!1},id:{type:String,mayBeNull:!1},dialogUrl:{type:String,mayBeNull:!1},appDomains:{type:Array,mayBeNull:!1},solutionId:{type:String,mayBeNull:!1},version:{type:String,mayBeNull:!1},storeType:{type:String,mayBeNull:!1},storeId:{type:String,mayBeNull:!1},assetId:{type:String,mayBeNull:!0},assetStoreId:{type:String,mayBeNull:!0},ownerAddinSolutionId:{type:String,mayBeNull:!0},ownerAddinStoreType:{type:String,mayBeNull:!0},agaveName:{type:String,mayBeNull:!0}},null),n={div:t.div,id:t.id,solutionId:t.solutionId,version:t.version,storeType:t.storeType,storeId:t.storeId,assetId:t.assetId,assetStoreId:t.assetStoreId,ownerAddinSolutionId:t.ownerAddinSolutionId,ownerAddinStoreType:t.ownerAddinStoreType,isDialog:!0,contextActivationMgr:this},new e.OsfControl(n).createIframeForDialogControl(t.agaveName,t.dialogUrl,t.appDomains)},t.prototype.insertBlankControlWithErrorUX=function(t,n){var i,o=this;void 0===t.solutionId&&(Telemetry.RuntimeTelemetryHelper.LogExceptionTag("insertBlankControlWithErrorUX solutionId is not defined",null,null,509658059),t.solutionId=t.marketplaceID),void 0===t.version&&(Telemetry.RuntimeTelemetryHelper.LogExceptionTag("insertBlankControlWithErrorUX version is not defined",null,null,509658058),t.version=t.marketplaceVersion),void 0===t.storeId&&(Telemetry.RuntimeTelemetryHelper.LogExceptionTag("insertBlankControlWithErrorUX storeId is not defined",null,null,509658057),t.storeId=t.store),void 0===t.ownerAddinSolutionId&&(void 0!==t.ownerAddinAssetId&&Telemetry.RuntimeTelemetryHelper.LogExceptionTag("insertBlankControlWithErrorUX ownerAddinSolutionId is not defined",null,null,509658056),t.ownerAddinSolutionId=t.ownerAddinAssetId),e.OUtil.validateParamObject(t,{div:{type:Object,mayBeNull:!1},id:{type:String,mayBeNull:!1},solutionId:{type:String,mayBeNull:!1},version:{type:String,mayBeNull:!1},storeType:{type:String,mayBeNull:!1},storeId:{type:String,mayBeNull:!1},assetId:{type:String,mayBeNull:!0},assetStoreId:{type:String,mayBeNull:!0},osfControlType:{type:Number,mayBeNull:!0}},null),i={div:t.div,id:t.id,solutionId:t.solutionId,version:t.version,storeType:t.storeType,storeId:t.storeId,assetId:t.assetId,assetStoreId:t.assetStoreId,osfControlType:t.osfControlType,contextActivationMgr:this,isvirtualOsfControl:!1};var r=new e.OsfControl(i);r._contextActivationMgr.registerOsfControl(r);var a=OfficeExt.OmexUtils.getOmexEndPointPageUrl(this.getOsfOmexBaseUrl(),t.solutionId,t.storeId),s=OfficeExt.CatalogFactory.resolve(t.storeType.toLowerCase());if(null!=s){var l={solutionId:t.solutionId,version:t.version,storeType:t.storeType,storeId:t.storeId,assetId:t.assetId,assetStoreId:t.assetStoreId,targetType:null},c=e.OmexClientNames[this._appName];s.getAndCacheManifest(l,this._storeLocator,new OfficeExt.AddinCommandsTelemetryContext(r.getCorrelationId()),(function(t){!function(e,t){var n,i="",o="",r="",a=!1;e.status===OfficeExt.DataServiceResultCode.Succeeded&&e.value&&(i=(n=e.value).getDefaultDisplayName(),o=n.getProviderName(),r=n.getDefaultIconUrl(),a=n.isSSOAddin()),t(i,o,r,a)}(t,(function(t,i,s,l){e.OUtil.checkFlight(e.FlightTreatmentNames.EnsureStringsBeforeTrustErrorKill)?r._showTrustError(c,t,i,s,n,a,l):o._loadLocaleString(Function.createDelegate(o,(function(){r._showTrustError(c,t,i,s,n,a,l)})))}))}))}},t.prototype.purgeDialogControl=function(e){var t=Function._validateParams(arguments,[{name:"id",type:String,mayBeNull:!1}]);if(t)throw t;var n=this._cachedOsfControls[e];void 0!==n&&(n._conversationId&&this._getServiceEndPoint().unregisterConversation(n._conversationId),this.unregisterOsfControl(n))},t.prototype.dispose=function(){this._serviceEndPoint&&(this._serviceEndPoint.dispose(),Microsoft.Office.Common.XdmCommunicationManager.deleteServiceEndPoint(this._clientId),this._serviceEndPoint=null),this._serviceEndPointInternal&&(this._serviceEndPointInternal.dispose(),Microsoft.Office.Common.XdmCommunicationManager.deleteServiceEndPoint(this._clientId+e.Constants.EndPointInternalSuffix),this._serviceEndPointInternal=null)},t.prototype.setLocalizedUrl=function(t,n,i){var o=Function._validateParams(arguments,[{name:"scriptUrl",type:String,mayBeNull:!1},{name:"imageUrl",type:String,mayBeNull:!1},{name:"styleUrl",type:String,mayBeNull:!1}]);if(o)throw o;if(this._localizedScriptsUrl=t,this._localizedImagesUrl=n,this._localizedStylesUrl=i,this._localizedScriptsUrl&&"null/"!=this._localizedScriptsUrl){var r=function(){this._ErrorUXHelper||(this._ErrorUXHelper=new e._ErrorUXHelper(this))};this._loadLocaleString(Function.createDelegate(this,r))}},t.prototype.getOsfControlStatus=function(t){var n=this._cachedOsfControls[t];return n?n.getStatus():e.OsfControlStatus.InvalidOsfControl},t.prototype.hostCheckReadyHandler=function(e,t){if(null!=this._isHostFrameTrusted&&null!=this._notReadyOsfControlsIndex){null!=t&&(this._isHostFrameTrusted=t),Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("Host frame check set :"+JSON.stringify(t),this._contextMgrCorrelationId,523355615);for(var n=0;n<this._notReadyOsfControlsIndex;n++){var i=this._notReadyOsfControls[n];i&&i.refresh()}}},t.prototype.activateOsfControl=function(e){var t=Function._validateParams(arguments,[{name:"id",type:String,mayBeNull:!1}]);if(t)throw t;var n=this._cachedOsfControls[e];void 0!==n&&n.activate()},t.prototype.deActivateOsfControl=function(e){var t=Function._validateParams(arguments,[{name:"id",type:String,mayBeNull:!1}]);if(t)throw t;var n=this._cachedOsfControls[e];void 0!==n&&n.deActivate()},t.prototype.purgeOsfControl=function(e,t){var n=Function._validateParams(arguments,[{name:"id",type:String,mayBeNull:!1},{name:"purgeManifest",type:Boolean,mayBeNull:!1}]);if(n)throw n;var i=this._cachedOsfControls[e];void 0!==i&&(Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("OsfControl activation lifecycle: purgeOsfControl",this._contextMgrCorrelationId,523355616),i.purge(t))},t.prototype.purgeOsfControlNotifications=function(){for(var e in this._cachedOsfControls)this._ErrorUXHelper.purgeOsfControlNotification(e)},t.prototype.untrustOsfControls=function(t){var n=0,i=function(e){return function(){e.activate({hasConsent:!0})}},o=e.OUtil.formatString(e.Constants.ActivatedCacheKey,t.id.toLowerCase(),t.currentStoreType,t.storeId);for(var r in this._deleteCachedFlag(o),this._cachedOsfControls){var a=this._cachedOsfControls[r];if(a.getSolutionId().toLowerCase()==t.id.toLowerCase()){this._ErrorUXHelper.purgeOsfControlNotification(a._id),a.deActivate();var s=OfficeExt.OmexUtils.getOmexEndPointPageUrl(this.getOsfOmexBaseUrl(),a.getSolutionId(),t.storeId),l=e.OmexClientNames[this._appName];a._showTrustError(l,t.displayName,t.providerName,t.iconUrl,i(a),s),n++}}return n},t.prototype.retryAll=function(e){for(var t in this._cachedOsfControls){var n=this._cachedOsfControls[t];n.getSolutionId().toLowerCase()==e.toLowerCase()&&n._retryActivate&&(this._ErrorUXHelper.purgeOsfControlNotification(n._id),this._ErrorUXHelper.removeInfoBarDiv(t,!1),n._retryActivate(),n._retryActivate=null)}},t.prototype.validateAndCacheNewDevAddinManifest=function(e){this._getDevAddinManifestContent(e,this._validateAndCacheNewDevAddinManifest.bind(this),this._notifyHost.bind(this))},t.prototype._getDevAddinManifestContent=function(t,n,i){var o;try{(o=new XMLHttpRequest).onreadystatechange=function(){return 4==o.readyState&&200==o.status?n(o.responseText):4==o.readyState&&0==o.status?i("0",e.AgaveHostAction.InsertDevManifestError,{manifestUrl:t}):void 0},o.open("GET",t,!0),o.send()}catch(n){var r="Cannot access developer manifest url.";return OfficeExt.WACUtils.logExceptionToBrowserConsole(r,n),Telemetry.RuntimeTelemetryHelper.LogExceptionTag(r,n,this._appCorrelationId,523355617),i("0",e.AgaveHostAction.InsertDevManifestError,{manifestUrl:t})}},t.prototype._validateAndCacheNewDevAddinManifest=function(t){try{var n=new e.Manifest.Manifest(t,this.getAppUILocale()),i=n.getMarketplaceID(),o=n.getMarketplaceVersion(),r=OfficeExt.CatalogFactory.resolve(e.StoreType.UploadFileDevCatalog);if(r.validateAndCacheNewManifest(i,o,t,n)){var a={solutionId:i,version:o,storeType:e.StoreType.UploadFileDevCatalog,storeId:"developer",assetId:null,assetStoreId:null,targetType:n.getTarget(),width:parseInt(n.getDefaultWidth()||"0"),height:parseInt(n.getDefaultHeight()||"0"),isAddinCommands:n._isAddinCommandsManifest(e.getManifestHostType(this._hostType))};return e.OUtil.validateParamObject(a,{solutionId:{type:String,mayBeNull:!1},version:{type:String,mayBeNull:!1},targetType:{type:Number,mayBeNull:!1},width:{type:Number,mayBeNull:!0},height:{type:Number,mayBeNull:!0}},null),r.localCacheAddinCommands(i,o,"developer"),e.OUtil.getLocalStorage().setItem(i,"true"),this._notifyHost("0",e.AgaveHostAction.InsertDevManifest,a)}return this._notifyHost("0",e.AgaveHostAction.NotifyHostError,null)}catch(t){var s="Invalid developer addin manifest.";return OfficeExt.WACUtils.logExceptionToBrowserConsole(s,t),Telemetry.RuntimeTelemetryHelper.LogExceptionTag(s,t,this._appCorrelationId,523355618),this._notifyHost("0",e.AgaveHostAction.NotifyHostError,null)}},t.prototype.getOsfControl=function(e){var t=Function._validateParams(arguments,[{name:"id",type:String,mayBeNull:!1}]);if(t)throw t;return this._cachedOsfControls[e]},t.prototype.getOsfControls=function(){var e=[];for(var t in this._cachedOsfControls)e.push(this._cachedOsfControls[t]);return e},t.prototype.getOsfOmexBaseUrl=function(){return this._osfOmexBaseUrl},t.prototype.getAppName=function(){return this._appName},t.prototype.getClientMode=function(){return this._clientMode},t.prototype.getClientId=function(){return this._clientId},t.prototype.getFormFactor=function(){return this._formFactor},t.prototype.getDocUrl=function(){return this._docUrl},t.prototype.getAppUILocale=function(){return this._appUILocale},t.prototype.getDataLocale=function(){return this._dataLocale},t.prototype.getPageBaseUrl=function(){return this._pageBaseUrl},t.prototype.getLcid=function(){return this._lcid},t.prototype.isExternalMarketplaceAllowed=function(){return this._allowExternalMarketplace},t.prototype.isStoreDisabled=function(t){this._loadLocaleString(Function.createDelegate(this,(function(){var n=OfficeExt.CatalogFactory.resolve(e.StoreType.OMEX),i=e.OUtil.Guid.generateNewGuid(),o=new OfficeExt.InsertDialogTelemetryContext(i);if(n instanceof OfficeExt.OmexCatalog)n.isStoreDisabled(o,t);else{t({value:!1,status:200})}})))},t.prototype.getLocalizedScriptsUrl=function(){return this._localizedScriptsUrl?this._localizedScriptsUrl:""},t.prototype.getLocalizedImagesUrl=function(){return this._localizedImagesUrl?this._localizedImagesUrl:""},t.prototype.getLocalizedStylesUrl=function(){return this._localizedStylesUrl?this._localizedStylesUrl:""},t.prototype.raiseOsfControlStatusChange=function(e){this._controlStatusChanged&&this._controlStatusChanged(e)},t.prototype.registerOsfControl=function(e){var t=Function._validateParams(arguments,[{name:"osfControl",type:Object,mayBeNull:!1}]);if(t)throw t;this._cachedOsfControls[e.getID()]=e},t.prototype.registerNotReadyOsfControl=function(e){var t=Function._validateParams(arguments,[{name:"osfControl",type:Object,mayBeNull:!1}]);if(t)throw t;this._notReadyOsfControls[this._notReadyOsfControlsIndex]=e,this._notReadyOsfControlsIndex++},t.prototype.unregisterOsfControl=function(e){var t=Function._validateParams(arguments,[{name:"osfControl",type:Object,mayBeNull:!1}]);if(t)throw t;delete this._cachedOsfControls[e.getID()]},t.prototype.setIframeAttributeBag=function(e){this._iframeAttributeBag=e},t.prototype.displayNotification=function(t){e.OUtil.validateParamObject(t,{infoType:{type:Number,mayBeNull:!1},id:{type:String,mayBeNull:!1},title:{type:String,mayBeNull:!1},description:{type:String,mayBeNull:!1},url:{type:String,mayBeNull:!0},icon:{type:String,mayBeNull:!0},buttonTxt:{type:String,mayBeNull:!0},buttonCallback:{type:Function,mayBeNull:!0},dismissCallback:{type:Function,mayBeNull:!0},"displayDeactive ":{type:Boolean,mayBeNull:!0},highPriority:{type:Boolean,mayBeNull:!0},detailView:{type:Boolean,mayBeNull:!0},reDisplay:{type:Boolean,mayBeNull:!0},logAsError:{type:Boolean,mayBeNull:!0},errorCode:{type:Number,mayBeNull:!0},retryAll:{type:Boolean,mayBeNull:!0},iframeNotificationUrl:{type:String,mayBeNull:!0},notificationType:{type:Number,mayBeNull:!0}},null),t.errorCode||(t.errorCode=0);var n=this._cachedOsfControls[t.id];if(n)if(n._isvirtualOsfControl){if(t.errorCode==e.ErrorStatusCodes.E_OEM_OMEX_EXTENSION_KILLED||t.errorCode==e.ErrorStatusCodes.E_OEM_EXTENSION_KILLED)return void this.purgeOsfControl(t.id,!0);if(null==t.highPriority&&(t.highPriority=t.infoType===e.InfoType.Error),!1===t.highPriority)n._notificationParams.push(t);else{for(var i=n._notificationParams,o=0;o<i.length;o++)if(!i[o].highPriority){i.splice(o,0,t),i=null;break}null!=i&&i.push(t)}n._isvirtualOsfControlCallbackInvoked||n.ensureToGetVirtualOsfControlManifest((function(e){n.invokeVirtualOsfControlActivationCallback(e)})),n._isManifestProcessedForCustomFunctions||n.ensureToGetVirtualOsfControlManifest((function(e){n.processManifestForCustomFunctions(e)}))}else{if(n._onExtensionLaunchCallback&&t.infoType==e.InfoType.Error){var r={id:t.id,description:t.description,errorCode:t.errorCode};n._onExtensionLaunchCallback(r)}if(t.logAsError&&(Telemetry.AppLoadTimeHelper.SetErrorResult(n._telemetryContext,t.errorCode),this._notifyHostError)){var a={errorCode:t.errorCode};this._notifyHostError(t.id,e.AgaveHostAction.NotifyHostError,a)}(t.displayDeactive||null!=t.iframeNotificationUrl)&&(t.detailView=!0),t.div=n._div,this._ErrorUXHelper&&this._ErrorUXHelper.showNotification(t)}},t.prototype.dismissMessages=function(e){this._ErrorUXHelper&&this._ErrorUXHelper.dismissMessages(e)},t.prototype.notifyAgave=function(t,n){var i=Function._validateParams(arguments,[{name:"id",type:String,mayBeNull:!1},{name:"actionId",type:Number,mayBeNull:!1}]);if(i)throw i;var o=this._cachedOsfControls[t];void 0!==o&&(n===e.AgaveHostAction.CtrlF6In||n===e.AgaveHostAction.TabIn||n===e.AgaveHostAction.Select?this._ErrorUXHelper.focusOnNotificationUx(t,n):n===e.AgaveHostAction.TabInShift&&o._pageStatus!==e.OsfControlPageStatus.Ready?this._ErrorUXHelper.focusOnNotificationUxShiftIn(t,n):o.notifyAgave(n))},t.prototype.setWSA=function(t){this._wsa=t,this._wsa&&(this._wsa.createStreamUnobfuscated(e.SQMDataPoints.DATAID_APPSFOROFFICEUSAGE,e.BWsaStreamTypes.Static,2,e.BWsaConfig.defaultMaxStreamRows),this._wsa.createStreamUnobfuscated(e.SQMDataPoints.DATAID_APPSFOROFFICENOTIFICATIONS,e.BWsaStreamTypes.Static,4,e.BWsaConfig.defaultMaxStreamRows))},t.prototype.getWSA=function(){return this._wsa},t.prototype.getSQMAgaveUsage=function(t,n,i,o){var r,a;switch(t.toLowerCase()){case e.StoreType.OMEX:r=0;break;case e.StoreType.SPCatalog:r=1;break;case e.StoreType.FileSystem:r=2;break;case e.StoreType.Registry:r=3;break;case e.StoreType.Exchange:r=4;break;case e.StoreType.SPApp:r=5;break;case e.StoreType.FirstParty:r=6;break;case e.StoreType.Sdx:r=7;break;case e.StoreType.InMemory:r=8;break;case e.StoreType.PrivateCatalog:r=10;break;case e.StoreType.HardCodedPreinstall:r=11;break;case e.StoreType.UploadFileDevCatalog:r=12;break;case e.StoreType.WopiCatalog:r=13;break;default:r=15}switch(n){case e.OsfControlType.DocumentLevel:a=1;break;case e.OsfControlType.ContainerLevel:a=0;break;default:a=2}var s=7;if(i&&i.toLowerCase)switch(i.toLowerCase()){case Microsoft.Office.WebExtension.InitializationReason.Inserted.toLowerCase():s=0;break;case Microsoft.Office.WebExtension.InitializationReason.DocumentOpened.toLowerCase():s=1}var l=0;!o||0!==o.toLowerCase().indexOf("wa")&&0!==o.toLowerCase().indexOf("fa")||(l=o&&o.length>2?parseInt(o.substring(2),10):0,isNaN(l)&&(l=0));return[s<<8|a<<4|r,l]},t.prototype.openInputUrlDialog=function(t){var n=document.createElement("p"),i="title-p";n.setAttribute("id",i),"ltr"==document.documentElement.getAttribute("dir")?n.setAttribute("style","padding: 26px 0px 10px 26px;"):n.setAttribute("style","padding: 26px 26px 10px 0px;"),n.textContent="DevCatalog server Url is configured in settings.xml - Enter manifest file name only (AppId.xml):",t.appendChild(n);var o=document.createElement("div"),r=document.createElement("input");r.setAttribute("type","url"),r.setAttribute("id","url-input"),r.setAttribute("aria-labelledby",i),r.setAttribute("data-lpignore","true"),"ltr"==document.documentElement.getAttribute("dir")?r.setAttribute("style","margin-left: 26px; height: 18px; width: calc(100% - 141px); vertical-align: middle;"):r.setAttribute("style","margin-right: 26px; height: 18px; width: calc(100% - 141px); vertical-align: middle;"),o.appendChild(r);var a=this,s=function(t,n){var i=new e.Manifest.Manifest(t,a.getAppUILocale());e.OsfManifestManager.hasManifest(i.getMarketplaceID(),i.getMarketplaceVersion())||e.OsfManifestManager.cacheManifest(i.getMarketplaceID(),i.getMarketplaceVersion(),i);var o={solutionId:i.getMarketplaceID(),version:i.getMarketplaceVersion(),storeType:e.StoreType.Registry,storeId:"developer",assetId:null,assetStoreId:null,targetType:i.getTarget(),width:i.getDefaultWidth()||0,height:i.getDefaultHeight()||0,isAddinCommands:i._isAddinCommandsManifest(e.getManifestHostType(a._hostType))};Telemetry.UploadFileDevCatalogUsageHelper.LogUploadFileDevCatalogUsageAction(this._appCorrelationId,o.storeType,Telemetry.PrivacyRules.GetPrivacyCompliantId(o.solutionId,o.storeType,o.assetId,null,null,o.storeId),o.version,o.targetType,o.isAddinCommands,o.width,o.height),a._notifyHost("0",e.AgaveHostAction.InsertAgave,o)},l=function(e){alert("Error when requesting manifest file: "+e)},c=document.createElement("input");c.setAttribute("type","button"),c.setAttribute("id","devcat-insert-button"),c.setAttribute("value","Insert"),c.setAttribute("class","WACButton WACDialogButtonNormal"),e.OUtil.addEventListener(c,"click",(function(){e.OUtil.xhrGet(a._devCatalogUrl+"/"+r.value,s,l)})),o.appendChild(c),t.appendChild(o)},t.prototype.launchInsertDialog=function(t,n,i){0!=t.childNodes.length&&t.removeChild(t.childNodes.item(0));var o,r=e.OUtil.Guid.generateNewGuid(),a=new OfficeExt.InsertDialogTelemetryContext(r);if(this._enableDevCatalog){(o=document.createElement("div")).style.width="100%",o.style.height="80%",t.appendChild(o);var s=document.createElement("div");s.style.width="100%",s.style.height="20%",t.appendChild(s),this.openInputUrlDialog(s)}else o=t;var l=this;l._insertDialogDiv=o;var c=document.createElement("div");c.style.width="100%",c.style.height="100%",c.style.backgroundImage="url("+l.getLocalizedImageFilePath("progress.gif")+")",c.style.backgroundRepeat="no-repeat",c.style.backgroundPosition="center",o.appendChild(c);!function(t,n){if(l._enableMyOrg)try{e.OUtil.validateParamObject(t,{webUrl:{type:String,mayBeNull:!1}},n),OfficeExt.CatalogFactory.resolve(e.StoreType.SPCatalog).getSPCatalogUrl(a,(function(e){n({statusCode:e.status,value:e.value})}))}catch(i){return Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Error when getting corporate catalog url:",i,this._appCorrelationId,523355619),void n({statusCode:e.InvokeResultCode.E_GENERIC_ERROR,value:null,context:t})}else n({statusCode:e.InvokeResultCode.E_CATALOG_NO_APPS,value:null,context:t})}({webUrl:l._spBaseUrl},(function(t){var r=this,a=document.createElement("iframe");a.setAttribute("id","InsertDialog"),a.setAttribute("src","about:blank"),a.setAttribute("width","100%"),a.setAttribute("height","100%"),a.setAttribute("marginHeight","0"),a.setAttribute("marginWidth","0"),a.setAttribute("frameBorder","0"),a.setAttribute("sandbox","allow-scripts allow-forms allow-same-origin ms-allow-popups allow-popups"),"undefined"!=typeof Strings&&Strings&&Strings.OsfRuntime&&a.setAttribute("title",Strings.OsfRuntime.L_InsertionDialogTile_TXT);var s=null,c=[];l.isStoreDisabled((function(u){l._hostAllowedOfficeStore||(u.value=!0);var d='{ "IsUploadFileDevCatalogEnabled":'+l._enableUploadFileDevCatalog+',"isStoreDisabled":'+u.value+',"showSignOutFromPrivateCatalogMessage":'+l._showSignOutFromPrivateCatalogMessage+',"enableInsertDialogAccessibilityFix":'+l._enableInsertDialogAccessibilityFix+',"insertionDialogFixesEnabled":'+e.OUtil.checkFlight(e.FlightTreatmentNames.InsertionDialogFixesEnabled)+',"isBlackForestRedirectEnabled":'+l._enableBlackForestRedirect+',"isHostDocumentDomain":'+l._isHostDocumentDomain+',"agaveAddinUploadEnabled":'+l._agaveAddinUploadEnabled+" }";if(l.isExternalMarketplaceAllowed()){var p='{ "provValues":[0,0,0,'+(l._enableMyApps?e.InvokeResultCode.S_OK.toString():e.InvokeResultCode.S_HIDE_PROVIDER.toString())+'], "url":"'+l._osfOmexBaseUrl+'", "client":"'+l._getClientNameForOmex()+'", "'+e.OmexPageParameterKeys.AuthType+'":'+l._getAuthTypeForHideAppsExtensionUrl()+"}";c.push('"myApp":'+p),Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("isExternalMarketplaceAllowed is true, myApp tab show firstly.",l._contextMgrCorrelationId,523355648)}if(t&&null!=t.value&&l._enableMyOrg){var f='{ "provValues":[1,1,0,'+t.statusCode+'], "url":"'+t.value+'"}';c.push('"myOrg":'+f)}if(l._enablePrivateCatalog){var m='{"provValues":[10,10,0,0], "client":"'+l._getClientNameForOmex()+'"}';c.push('"privateCatalog":'+m)}if(e.OUtil.checkFlight(e.FlightTreatmentNames.WopiPreinstalledAddInsEnabled)&&l._hostInstallAddInsIsEnabled){var h='{"provValues":[16,16,0,0], "client":"'+l._getClientNameForOmex()+'"}';c.push('"wopiCatalog":'+h)}c.length>0&&(s="{"+c.join(", ")+"}"),l._internalConversationId&&l._serviceEndPointInternal.unregisterConversation(l._internalConversationId);var g=l.getClientId()+"_"+l.getDocUrl(),y=e.OUtil.getFrameName(g),v=e.OUtil.generateConversationId();l._internalConversationId=e.OUtil.generateConversationId(),a.setAttribute("name",y);var S=null;null!=i&&(S='{ "navigationMode":'+i.navigationMode+', "navigationModeParameter": "'+i.assetId+'", "category":"'+i.category+'"}');var _=window.location.origin,C="",A=[v,encodeURIComponent(_),l._appVersion,e.getAppVerCode(l._appName),l.getLcid(),e.Constants.FileVersion,encodeURIComponent(s),n,encodeURIComponent(d),encodeURIComponent(S),l._contextMgrCorrelationId],O=e.Constants.FileVersion;try{var T=JSON.parse(l._sessionStartInfoJson);if("string"!=typeof T.WFEVersion)throw new Error("WFEVersion is unavailable in session start info.");O=T.WFEVersion}catch(e){Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Could not get the web frontend version.",e,l._contextMgrCorrelationId,523355649)}C=l._localizedResourcesUrl?l._localizedResourcesUrl+"WefGallery.htm?b="+encodeURIComponent(O):l._pageBaseUrl+l.getLcid()+"/WefGallery.htm?b="+encodeURIComponent(O);var I,x=e.OUtil.addXdmInfoAsHash(C,A.join("|"));for(var E in x=e.OUtil.addFlightsAsHash(x,JSON.stringify(e.Flights)),x=e.OUtil.addDisabledChangeGatesAsHash(x,JSON.stringify(e.DisabledChangeGates)),r._cachedOsfControls){if(v===r._cachedOsfControls[E]._getConversationId()){I=E;break}}l._serviceEndPointInternal.registerConversation(v,x,null,I),a.setAttribute("src",x),l._insertDialogDiv?(0!=o.childNodes.length&&o.removeChild(o.childNodes.item(0)),o.appendChild(a)):(o.insertBefore(a,o.firstChild),l._insertDialogDiv=o)}))}))},t.prototype.activateAgavesBlockedBySandboxNotSupport=function(){for(var t in this._cachedOsfControls){var n=this._cachedOsfControls[t];n._status===e.OsfControlStatus.NotSandBoxSupported&&n.activate()}},t.prototype.setRequirementsChecker=function(e){this._requirementsChecker=e},t.prototype.getRequirementsChecker=function(){return this._requirementsChecker},t.prototype.appHasNotifications=function(e){return!!this._ErrorUXHelper&&this._ErrorUXHelper.appHasNotifications(e)},t.prototype.refreshOsfControl=function(e,t){for(var n in this._cachedOsfControls)if(this._cachedOsfControls[n]&&e==this._cachedOsfControls[n].getSolutionId()&&t==this._cachedOsfControls[n]._sourceLocationOverrideResourceId){this._cachedOsfControls[n].refresh();break}},t.prototype.changeIframeTitle=function(e,t){if(null!=t){var n=this._cachedOsfControls[e];n&&n._frame&&(n._frame.setAttribute("title",t),n._titleOverride=t)}},t.prototype.setAppTheme=function(e){if(this._appTheme=e,this._officeThemeChangedHandler){var t={primaryBackgroundColor:this._appTheme.semanticColors.bodyBackground,primaryFontColor:this._appTheme.semanticColors.bodyText,secondaryBackgroundColor:this._appTheme.semanticColors.buttonBackground,secondaryFontColor:this._appTheme.semanticColors.buttonText};this._officeThemeChangedHandler(t)}},t.prototype.setOfficeThemeChangedHandler=function(e){this._officeThemeChangedHandler=e},t.prototype.removeOfficeThemeChangedHandler=function(){this._officeThemeChangedHandler=null},t.prototype._loadLocaleString=function(e){if("undefined"!=typeof Strings&&Strings&&Strings.OsfRuntime){for(var t=this._localeStringLoadingPendingCallbacks.length,n=0;n<t;n++){this._localeStringLoadingPendingCallbacks.shift()()}e()}else{this._localeStringLoadingPendingCallbacks.push(e);var i=this._localeStringLoadingPendingCallbacks;if(1===i.length){this._loadStringScript((function(){for(var e=i.length,t=0;t<e;t++){var n=i.shift();"function"==typeof n&&n()}}))}}},t.prototype._loadStringScript=function(t){var n=this,i=this.getLocalizedScriptsUrl();i+=e.Constants.StringResourceFile;var o=0,r=function(){if("undefined"!=typeof Strings&&Strings&&Strings.OsfRuntime){if(o>0){a=e.OUtil.formatString("osfruntime_strings loaded after {0} retries.",o);Telemetry.RuntimeTelemetryHelper.LogExceptionTag(a,null,null,523355651)}t()}else{if(++o<3)return void setTimeout((function(){e.OUtil.loadScript(i,r)}),750*o);n._localeStringLoadingPendingCallbacks.length=0;var a=e.OUtil.formatString("The locale, {0}, provided by the host app is not supported. Url: {1}",n.getLcid(),i);Telemetry.RuntimeTelemetryHelper.LogExceptionTag(a,null,null,523355650)}};e.OUtil.loadScript(i,r)},t.prototype._getServiceEndPoint=function(){return this._serviceEndPoint},t.prototype._getOmexEndPointPageUrl=function(t,n){return e.OUtil.formatString("{0}/{1}/downloads/{2}.aspx",this._omexEndPointBaseUrl,n,t)},t.prototype._getManifestAndTargetByConversationId=function(t){for(var n in this._cachedOsfControls){var i=this._cachedOsfControls[n];if(t===i._getConversationId()){var o=i.getStoreType()==e.StoreType.FirstParty?"":i.getVersion();return{manifest:i.getManifest()||e.OsfManifestManager.getCachedManifest(i.getSolutionId()),version:o,target:i.getOsfControlType()}}}return null},t.prototype._createSharePointIFrameProxy=function(t,n){if(e.OUtil.doesUrlHaveSupportedProtocol(t)){var i=t.length;"/"===t.charAt(i-1)&&(t=t.substr(0,i-1));var o=this._iframeProxies[t];if(o)o.isReady?n(o.clientEndPoint):o.pendingCallbacks.push(n);else{var r=e.OUtil.generateConversationId(),a=document.createElement("iframe");this._iframeProxyCount=this._iframeProxyCount+1;var s=this._iframeNamePrefix+this._iframeProxyCount;a.setAttribute("id",s),a.setAttribute("name",s),a.setAttribute("role","none");var l=t+"/_layouts/15/OfficeExtensionManager.aspx?"+r,c=window.location.origin;l=e.OUtil.addXdmInfoAsHash(l,r+"|"+s+"|"+c),l=e.OUtil.addSerializerVersionAsHash(l,e.SerializerVersion.Browser),a.setAttribute("scrolling","auto"),a.setAttribute("border","0"),a.setAttribute("width","0"),a.setAttribute("height","0"),a.setAttribute("style","position: absolute; left: -100px; top:0px;"),a.setAttribute("title",Strings.OsfRuntime.L_AddinsCatalogIframeTitle_TXT);var u=this,d=function(n,i){var o,s=u._iframeProxies[t];if(s&&0===n&&i.status?(s.isReady=!0,o=s.clientEndPoint):(delete u._iframeProxies[t],Microsoft.Office.Common.XdmCommunicationManager.getClientEndPoint(r)?(Microsoft.Office.Common.XdmCommunicationManager.deleteClientEndPoint(r),e.OUtil.removeEventListener(a,"load",p),a.parentNode.removeChild(a)):Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Unexpected error occured with SharePoint proxy.",null,null,523355652),o=null),s)for(var l=s.pendingCallbacks.length,c=0;c<l;c++){s.pendingCallbacks.shift()(o)}},p=function(){u._iframeProxies[t]&&(u._iframeProxies[t].clientEndPoint=Microsoft.Office.Common.XdmCommunicationManager.connect(r,a.contentWindow,t),u._iframeProxies[t].clientEndPoint.invoke("OEM_isProxyReady",d,{__timeout__:2e3}))};document.body.appendChild(a),e.OUtil.addEventListener(a,"load",p),a.setAttribute("src",l),this._iframeProxies[t]={clientEndPoint:null,isReady:!1,pendingCallbacks:[n]}}}else n(null)},t.prototype._getClientVersionForOmex=function(){if(this._appVersion){var t=this._appVersion.split("."),n=parseInt(t[0],10),i=parseInt(t[1],10)||0;if(!(n<=15&&i<=0)){var o=e.Constants.FileVersion.split(".");return n+"."+i+"."+o[2]+"."+o[3]}}},t.prototype._getClientNameForOmex=function(){return e.OmexClientNames[this._appName]},t.prototype._getAppVersionForOmex=function(){return e.OmexAppVersions[this._appName]},t.prototype._setCachedFlag=function(t){var n=e.OUtil.getLocalStorage();n&&n.setItem(t,"true")},t.prototype._getCachedFlag=function(t){var n=e.OUtil.getLocalStorage();if(n)return!!n.getItem(t)},t.prototype._deleteCachedFlag=function(t){var n=e.OUtil.getLocalStorage();n&&n.removeItem(t)},t.prototype._getAuthTypeForHideAppsExtensionUrl=function(){var t=e.OUtil.getQueryStringParamValue(this._hideAppsExtensionUrl,e.OmexPageParameterKeys.AuthType);return t||e.AuthType.Anonymous},t.prototype.queryStoreDisabled=function(t,n){var i=t.toLowerCase();if(e.StoreType.OMEX===i){var o=OfficeExt.CatalogFactory.resolve(i),r=e.OUtil.Guid.generateNewGuid(),a=new OfficeExt.InsertDialogTelemetryContext(r);if(o instanceof OfficeExt.OmexCatalog)return void o.isStoreDisabled(a,(function(e){n(e.status===OfficeExt.DataServiceResultCode.Succeeded&&e.value)}))}n(!1)},t.prototype.isAddinCommandsAsync=function(e,t){this.isAddinCommandsExAsync(e,(function(e,n,i,o){t(e,n,i)}))},t.prototype.isAddinCommandsExAsync=function(t,n){void 0===t.solutionId&&(t.solutionId=t.marketplaceId,Telemetry.RuntimeTelemetryHelper.LogExceptionTag("DefaultControlActionBinder isAddinCommandsExAsync params solutionId is not defined",null,null,509740627)),void 0===t.version&&(t.version=t.marketplaceVersion,Telemetry.RuntimeTelemetryHelper.LogExceptionTag("DefaultControlActionBinder isAddinCommandsExAsync params version is not defined",null,null,509740626)),e.OUtil.validateParamObject(t,{solutionId:{type:String,mayBeNull:!1},version:{type:String,mayBeNull:!1},storeType:{type:String,mayBeNull:!1},storeId:{type:String,mayBeNull:!1},targetData:{type:Object,mayBeNull:!1},clearCache:{type:Boolean,mayBeNull:!0}},null);var i=t.storeType.toLowerCase(),o={contextActivationMgr:null,referenceInUse:null},r={targetType:-1},a=t.clearCache||!1;try{o.referenceInUse={solutionId:t.solutionId,version:t.version,storeType:t.storeType,storeId:t.storeId},o.contextActivationMgr=this;if(e.StoreType.OMEX===i||e.StoreType.UploadFileDevCatalog===i||e.StoreType.SPCatalog===i||e.StoreType.PrivateCatalog===i||e.StoreType.WopiCatalog===i){var s=OfficeExt.CatalogFactory.resolve(i),l={solutionId:o.referenceInUse.solutionId,version:o.referenceInUse.version,storeType:i,storeId:o.referenceInUse.storeId,assetId:null,assetStoreId:null,targetType:null},c=e.OUtil.Guid.generateNewGuid(),u=new OfficeExt.AddinCommandsTelemetryContext(c);s.getAndCacheManifest(l,l.storeId,u,(function(i){!function(i){null!=i&&i.statusCode==OfficeExt.DataServiceResultCode.Succeeded&&null!=i.value?(r.targetType=i.value._target,n(!0,i.value._isAddinCommandsManifest(e.getManifestHostType(o.contextActivationMgr._hostType)),t,r)):n(!1,!1,t,r)}({statusCode:i.status,value:i.value})}),a)}else n(!0,!1,t,r)}catch(e){Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Error for checking is addincommands or not",e,null,523355653),n(!1,!1,t,r)}},t.prototype.setOAuthManager=function(e){this._oAuthManager=e},t.prototype.getManifestInvaildErrorString=function(){return Strings.OsfRuntime.L_AddinCommands_AddinNotSupported_Message},t.prototype.getDevManifestInvalidUrlErrorString=function(t){return e.OUtil.formatString(Strings.OsfRuntime.L_DeveloperAddinManifestInvalidUrl_Message,t)},t.prototype.getUserNameHashCode=function(){return this._userNameHashCode},t.prototype.setActivationCompletedStatus=function(e,t){},t.prototype.ownerAddinControlRecreated=function(e,t){for(var n in this._cachedOsfControls){var i=this._cachedOsfControls[n];i.getOwnerAddinSolutionId()&&i.getOwnerAddinStoreType()&&i.getOwnerAddinSolutionId()==e&&i.getOwnerAddinStoreType()==t&&i.setOwnerAddinControlRecreated(!0)}},t}();e.ContextActivationManager=t}(OSF||(OSF={})),function(e){var t=function(){function t(t){void 0===t.solutionId&&(Telemetry.RuntimeTelemetryHelper.LogExceptionTag("OsfControl solutionId is not defined",null,null,509658055),t.solutionId=t.marketplaceID),void 0===t.version&&(Telemetry.RuntimeTelemetryHelper.LogExceptionTag("OsfControl version is not defined",null,null,509658054),t.version=t.marketplaceVersion),void 0===t.storeId&&(Telemetry.RuntimeTelemetryHelper.LogExceptionTag("OsfControl storeId is not defined",null,null,509658053),t.storeId=t.store),void 0===t.ownerAddinSolutionId&&(void 0!==t.ownerAddinAssetId&&Telemetry.RuntimeTelemetryHelper.LogExceptionTag("OsfControl ownerAddinSolutionId is not defined",null,null,509658052),t.ownerAddinSolutionId=t.ownerAddinAssetId),e.OUtil.validateParamObject(t,{div:{type:Object,mayBeNull:!1},contextActivationMgr:{type:Object,mayBeNull:!1},id:{type:String,mayBeNull:!1},solutionId:{type:String,mayBeNull:!1},version:{type:String,mayBeNull:!1},storeType:{type:String,mayBeNull:!1},storeId:{type:String,mayBeNull:!1},assetId:{type:String,mayBeNull:!0},assetStoreId:{type:String,mayBeNull:!0},ownerAddinSolutionId:{type:String,mayBeNull:!0},ownerAddinStoreType:{type:String,mayBeNull:!0},settings:{type:Object,mayBeNull:!0},reason:{type:String,mayBeNull:!0},osfControlType:{type:Number,mayBeNull:!0},snapshotUrl:{type:String,mayBeNull:!0},preactivationCallback:{type:Object,mayBeNull:!0},virtualOsfControlActivationCallback:{type:Object,mayBeNull:!0},isvirtualOsfControl:{type:Boolean,mayBeNull:!0},isDialog:{type:Boolean,mayBeNull:!0},hostCustomMessage:{type:String,mayBeNull:!0},isForUILessAction:{type:Boolean,mayBeNull:!0},sourceLocationOverrideResourceId:{type:String,mayBeNull:!0},sourceLocationOverrideUrl:{type:String,mayBeNull:!0},focusOnIframeWhenLoaded:{type:Boolean,mayBeNull:!0},featureGates:{type:Object,mayBeNull:!0},hostInfoFlags:{type:Number,mayBeNull:!0},sharedRuntimeId:{type:String,mayBeNull:!0},initialDisplayMode:{type:Number,mayBeNull:!0},exchangeExtensionProviderName:{type:String,mayBeNull:!0},exchangeExtensionType:{type:String,mayBeNull:!0},titleOverride:{type:String,mayBeNull:!0},isFirstPartyOptOutAppContextOptmization:{type:Boolean,mayBeNull:!0},hostSettings:{type:Object,mayBeNull:!0},onExtensionLaunchCallback:{type:Function,mayBeNull:!0}},null),this._div=t.div,this._sourceLocationOverrideResourceId=t.sourceLocationOverrideResourceId,this._sourceLocationOverrideUrl=t.sourceLocationOverrideUrl,this._contextActivationMgr=t.contextActivationMgr,this._id=t.id,this._solutionId=t.solutionId,this._version=t.version,this._storeId=t.storeId,this._storeType=t.storeType.toLowerCase(),this._assetId=t.assetId||null,this._assetStoreId=t.assetStoreId||null,this._ownerAddinSolutionId=t.ownerAddinSolutionId||null,this._ownerAddinStoreType=t.ownerAddinStoreType||null,this._settings=t.settings||{},this._hostSettings=t.hostSettings||{},this._reason=null==t.reason?Microsoft.Office.WebExtension.InitializationReason.DocumentOpened:t.reason,this._osfControlType=null==t.osfControlType?e.OsfControlType.DocumentLevel:t.osfControlType,this._snapshotUrl=t.snapshotUrl,this._status=e.OsfControlStatus.NotActivated,this._iframeIsLoaded=!1,this._iframeLoadedNotified=!1,this._notificationParams=[],this._iframeUrl=null,this._permission=null,this._conversationId=null,this._manifestUrl=null,this._pageStatus=e.OsfControlPageStatus.NotStarted,this._pageIsReadyTimerExpired=!1,this._timer=null,this._retryLoadingNum=2,this._timer1=null,this._retryCheckingNum=2,this._autoRetryCheckingNum=2,this._frame=null,this._agaveEndPoint=null,this._etoken="",this._sqmDWords=[0,0],this._preactivationCallback=t.preactivationCallback,this._telemetryContext={},this._controlFocus=!1,this._agavePageUrl=null,this._agaveWindowName=null,this._manifest=null,this._virtualOsfControlActivationCallback=t.virtualOsfControlActivationCallback,this._isvirtualOsfControl=null!=t.isvirtualOsfControl&&t.isvirtualOsfControl,this._isvirtualOsfControlCallbackInvoked=!1,this._isManifestProcessedForCustomFunctions=!1,this._processManifestForExtendedOverridesPromise=null,this._isDialog=null!=t.isDialog&&t.isDialog,this._hostCustomMessage=t.hostCustomMessage,this._isUpgrading=!1,this._isUpgradingFailed=!1,this._focusOnIframeWhenLoaded=null!=t.focusOnIframeWhenLoaded&&t.focusOnIframeWhenLoaded,this._featureGates=t.featureGates||{},this._hostInfoFlags="number"==typeof t.hostInfoFlags?t.hostInfoFlags:0,this._sharedRuntimeId=null==t.sharedRuntimeId?null:t.sharedRuntimeId,this._initialDisplayMode=null==t.initialDisplayMode?0:t.initialDisplayMode,this._appContextIsSetToIframeName=!1,this._sdxTelemetryContext={},this._isUILessAddInCommands=!!t.isForUILessAction,this._isMos=!1,this._isInsertOsfControl=!1,this._hasRegisteredNotReady=!1,this._onExtensionLaunchCallback=t.onExtensionLaunchCallback,e.OUtil.isiOS()&&(this._div.style.webkitOverflowScrolling="touch",this._div.style.overflow="auto"),this._appCorrelationId=this._contextActivationMgr._contextMgrCorrelationId||e.OUtil.Guid.generateNewGuid(),this._iframeOnLoadDelegate=Function.createDelegate(this,this._iframeOnLoad),this._retryActivate=null,this._onKeyDownEventDelegate=Function.createDelegate(this,this._onKeydownEvent),this._ownerAddinControlRecreated=!1,this._exchangeExtensionProviderName=t.exchangeExtensionProviderName,this._exchangeExtensionType=t.exchangeExtensionType,this._titleOverride=t.titleOverride,this._isFirstPartyOptOutAppContextOptmization=!!t.isFirstPartyOptOutAppContextOptmization}return t.isFirstPartyStoreEnum=function(t){return!!t&&(t==e.StoreTypeEnum.FirstParty||t==e.StoreTypeEnum.HardCodedPreinstall||t==e.StoreTypeEnum.Sdx)},t.isFirstPartyStoreString=function(t){if(t){var n=t.toLowerCase();return n===e.StoreType.FirstParty||n===e.StoreType.HardCodedPreinstall||n===e.StoreType.Sdx}return!1},t.prototype.activate=function(t){if(this._status!==e.OsfControlStatus.Activated)if(this._contextActivationMgr.registerOsfControl(this),e.OUtil.addEventListener(this._div,"keydown",this._onKeyDownEventDelegate),(t=t||{}).hostType=this._contextActivationMgr._hostType,t.osfControl=t.osfControl||this,t.referenceInUse=t.referenceInUse||{solutionId:this._solutionId,version:this._version,storeType:this._storeType,storeId:this._storeId},t.correlationId=t.osfControl._appCorrelationId,t.isInsertOsfControl=t.isInsertOsfControl?t.isInsertOsfControl:this._isInsertOsfControl,1==t.isInsertOsfControl){if(this._isInsertOsfControl=t.isInsertOsfControl,!this._contextActivationMgr._hostAllowedSdxEmbedding||this._checkWopiHost(this._contextActivationMgr._enableWopiHostCheck))return void this.invokePreactivationCompletedCallback();var n=OfficeExt.ManifestUtil.constructAddInId(this._solutionId,this._version,this._storeType,this._storeId),i=new e.AddinIdInfo(n);if(this._contextActivationMgr._enableMyOrg&&null!=this._contextActivationMgr._spBaseUrl&&null==this._contextActivationMgr._wacUpn&&Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("WAC UPN in Sharepoint is null, solutionId:"+i.getPrivacyCompliantSolutionId(),this._contextActivationMgr._contextMgrCorrelationId,523642499),this._contextActivationMgr._enableUpnCheck&&this._contextActivationMgr._enableMyOrg&&null!=this._contextActivationMgr._spBaseUrl)if(null==this._contextActivationMgr._wacUpn&&(Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("CheckUpnInSPO failed because WAC UPN is null, solutionId: "+i.getPrivacyCompliantSolutionId(),this._contextActivationMgr._contextMgrCorrelationId,523642500),this._showActivationError(e.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_SPO_NotSignIn_Error_ERR,null,null,null,null,null,null,e.ErrorStatusCodes.WAC_WopiHostCheckStatusNotTrusted)),this._contextActivationMgr._upnCheckResult===e.UpnCheckCode.NotMatch){Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("CheckUpnInSPO failed, solutionId: "+i.getPrivacyCompliantSolutionId(),this._contextActivationMgr._contextMgrCorrelationId,523642501);var o=this.isFirstParty()?Strings.OsfRuntime.L_UntrustedHost_Error_ERR_FirstParty:Strings.OsfRuntime.L_UntrustedHost_Error_ERR;this._showActivationError(e.OsfControlStatus.ActivationFailed,o,null,null,null,null,null,null,e.ErrorStatusCodes.WAC_WopiHostCheckStatusNotTrusted)}else this.activateInternal(t);else this.activateInternal(t)}else this.activateInternal(t);else this.invokePreactivationCompletedCallback()},t.prototype.activateInternal=function(t){var n=this;try{if(!this._doesBrowserSupportRequiredFeatures())return this._contextActivationMgr._enableFirstPartySDXErrorMessages&&this.isFirstParty()?this._showActivationError(e.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveUnsupportedBroswer_ERR_FirstParty,Strings.OsfRuntime.L_RetryButton_TXT,Function.createDelegate(this,this._refresh),null,null,null,!0,e.ErrorStatusCodes.E_BROWSER_VERSION):this._showActivationError(e.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveUnsupportedBroswer_ERR,Strings.OsfRuntime.L_RetryButton_TXT,Function.createDelegate(this,this._refresh),null,null,null,!0,e.ErrorStatusCodes.E_BROWSER_VERSION),void this.invokePreactivationCompletedCallback();this.startActivate();var i=this,o=t.referenceInUse;if(o.storeType===e.StoreType.InMemory&&this._ownerAddinSolutionId){var r=this._contextActivationMgr.getOsfControls();for(var a in r){var s=r[a];if(s.getSolutionId()==this._ownerAddinSolutionId&&s.getStoreType()==this._ownerAddinStoreType){this._assetId=s._assetId,this._assetStoreId=s._assetStoreId;break}}}if(o.storeType===e.StoreType.OMEX||o.storeType===e.StoreType.UploadFileDevCatalog||o.storeType===e.StoreType.SPCatalog||o.storeType===e.StoreType.PrivateCatalog||o.storeType===e.StoreType.FirstParty||o.storeType===e.StoreType.Sdx||o.storeType===e.StoreType.WopiCatalog){var l=new OfficeExt.OsfControlLoader(this,t.hasConsent),c=new OfficeExt.ActivationTelemetryContext(this.getCorrelationId(),this._telemetryContext,this._sqmDWords[0],this._sqmDWords[1],this._id);if(o.storeType===e.StoreType.Sdx){if(o.solutionId.toLowerCase()===e.SdxAssetIds.ExperimentationSdx){var u=this._contextActivationMgr._flightingTreatmentVariables["Microsoft.Office.OEP.FA000000059.SourceLocationOverrideResourceId"];null!=u&&(this._sourceLocationOverrideResourceId=u),this._sdxTelemetryContext.sourceLocationOverrideResourceId=this._sourceLocationOverrideResourceId}1==this._initialDisplayMode&&(this._sdxTelemetryContext.isPreload=!0);var d={solutionId:o.solutionId,version:o.version,storeType:o.storeType,storeId:o.storeId,assetId:null,assetStoreId:null,targetType:""};OfficeExt.SDXCatalog.activateAsync(d,l,c,this._contextActivationMgr.getRequirementsChecker(),{clientId:this._contextActivationMgr._loggableUserId,sessionStartInfoJson:this._contextActivationMgr._sessionStartInfoJson},this._sdxTelemetryContext)}else{var p=t.noTargetType||t.osfControl.getOsfControlType()===e.OsfControlTarget.TaskPane?null:t.osfControl.getOsfControlType(),f=OfficeExt.CatalogFactory.resolve(o.storeType);d={solutionId:o.solutionId,version:o.version,storeType:o.storeType,storeId:o.storeId,assetId:null,assetStoreId:null,targetType:o.storeType===e.StoreType.SPCatalog?p:""};f.activateAsync(d,l,c)}return void this.invokePreactivationCompletedCallback()}if("1B4CD97F-DBFE-4C1A-B4C4-FC163B4F9693"===o.solutionId&&Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("ONO_Onboarding_CorrelationId :"+this.getCorrelationId(),null,523642502),Telemetry.AppLoadTimeHelper.ActivationStart(this._telemetryContext,this._sqmDWords[0],this._sqmDWords[1],this.getCorrelationId(),this._id,e.ActivationTypes.V2Enabled),Telemetry.AppLoadTimeHelper.ServerCallStart(this._telemetryContext),o.storeType===e.StoreType.InMemory&&this._ownerAddinStoreType===e.StoreType.OMEX)this._contextActivationMgr.isStoreDisabled((function(i){i.value?n._showActivationError(e.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_OmexStoreDisabledByAdmin,null,null,null,null,null,null,e.ErrorStatusCodes.E_TRUSTCENTER_CATALOG_UNTRUSTED_ADMIN_CONTROLLED):e.OsfManifestManager.getManifestAsync(t,(function(t){t.statusCode===e.ProxyCallStatusCode.Succeeded&&t.value&&!n._etoken&&(n._etoken=t.value.getInMemoryEToken()||""),n._onGetManifestCompleted(t)}))}));else if(o.storeType===e.StoreType.Exchange||o.storeType===e.StoreType.InMemory)e.OsfManifestManager.getManifestAsync(t,(function(t){t.statusCode===e.ProxyCallStatusCode.Succeeded&&t.value&&!n._etoken&&(n._etoken=t.value.getInMemoryEToken()||""),n._onGetManifestCompleted(t)}));else if(o.storeType===e.StoreType.Registry&&this._contextActivationMgr._enableDevCatalog||o.storeType===e.StoreType.HardCodedPreinstall)if(t.osfControl.getReason()==Microsoft.Office.WebExtension.InitializationReason.DocumentOpened||o.storeType===e.StoreType.Registry&&this._contextActivationMgr._enableDevCatalog&&!e.OsfManifestManager.hasManifestForControl(t)){e.OUtil.xhrGet(this._contextActivationMgr._devCatalogUrl+"/"+o.solutionId+".xml",(function(n){var o=new e.Manifest.Manifest(n,i._contextActivationMgr.getAppUILocale());if(null!=t.osfControl&&null!=t.osfControl._sharedRuntimeId&&t.osfControl._sharedRuntimeId.length>0){var r=e.OsfManifestManager.getSharedRuntimeManifestCacheKey(t.osfControl._solutionId,t.osfControl._sharedRuntimeId);e.OsfManifestManager.hasManifest(r,t.osfControl._version)||e.OsfManifestManager.cacheManifest(r,t.osfControl._version,o)}e.OsfManifestManager.hasManifest(o.getMarketplaceID(),o.getMarketplaceVersion())||e.OsfManifestManager.cacheManifest(o.getMarketplaceID(),o.getMarketplaceVersion(),o),e.OsfManifestManager.getManifestAsync(t,Function.createDelegate(i,i._onGetManifestCompleted))}),(function(e){alert("Error when requesting manifest file: "+e)}))}else{if(null!=t.osfControl&&null!=t.osfControl._sharedRuntimeId&&t.osfControl._sharedRuntimeId.length>0){var m=e.OsfManifestManager.getSharedRuntimeManifestCacheKey(t.osfControl._solutionId,t.osfControl._sharedRuntimeId);if(!e.OsfManifestManager.hasManifest(m,t.osfControl._version)){var h=e.OsfManifestManager.getCachedManifest(t.osfControl._solutionId,t.osfControl._version);e.OsfManifestManager.cacheManifest(m,t.osfControl._version,h)}}e.OsfManifestManager.getManifestAsync(t,Function.createDelegate(this,this._onGetManifestCompleted))}else o.storeType===e.StoreType.SPApp?(Telemetry.AppLoadTimeHelper.EntitlementCheckStart(this._telemetryContext),t.baseUrl=this._contextActivationMgr.getPageBaseUrl(),t.pageUrl=this._contextActivationMgr._docUrl,t.webUrl=this._contextActivationMgr._webUrl,t.appWebUrl=this._contextActivationMgr._webUrl,e.OsfManifestManager.getSPAppEntitlementsAsync(t,Function.createDelegate(this,this._onGetEntitlementsCompleted))):o.storeType===e.StoreType.FileSystem||o.storeType===e.StoreType.Registry||o.storeType===e.StoreType.HardCodedPreinstall?this._showActivationWarning(e.OsfControlStatus.UnsupportedStore,Strings.OsfRuntime.L_AgaveUnsupportedStoreType_ERR,null,null,null,null,e.ErrorStatusCodes.WAC_AgaveUnsupportedStoreType):this._showActivationError(e.OsfControlStatus.UnknownStore,Strings.OsfRuntime.L_AgaveUnknownStoreType_ERR,null,null,null,null,null,null,e.ErrorStatusCodes.E_MANIFEST_REFERENCE_INVALID)}catch(t){var g="Error getting app data.";OfficeExt.WACUtils.logExceptionToBrowserConsole(g,t),Telemetry.RuntimeTelemetryHelper.LogExceptionTag(g,t,this.getCorrelationId(),523642503),this._contextActivationMgr._enableFirstPartySDXErrorMessages&&this.isFirstParty()?this._showActivationError(e.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveServerConnectionFailed_ERR_FirstParty,Strings.OsfRuntime.L_RetryButton_TXT,Function.createDelegate(this,this._refresh),null,null,null,null,e.ErrorStatusCodes.WAC_AgaveOsfControlActivationError,"activateInternal exception first party"):this._showActivationError(e.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveServerConnectionFailed_ERR,Strings.OsfRuntime.L_RetryButton_TXT,Function.createDelegate(this,this._refresh),null,null,null,null,e.ErrorStatusCodes.WAC_AgaveOsfControlActivationError,"activateInternal exception not first party")}this.invokePreactivationCompletedCallback()},t.prototype.createIframeForDialogControl=function(t,n,i){if(!e.OUtil.doesUrlHaveSupportedProtocol(n)){var o="Invalid protocol detected in dialogUrl. Please use http/https.";throw Telemetry.RuntimeTelemetryHelper.LogExceptionTag(o,null,this.getCorrelationId(),523269398),o}for(;this._div.childNodes.length>0;)this._div.removeChild(this._div.childNodes.item(0));var r=this._createIframeForControl(t);this._iframeUrl=n,this._appDomains=i,this._setIframeAttribute(r,n),this._div.appendChild(r),this._contextActivationMgr.registerOsfControl(this)},t.prototype.deActivate=function(){try{if(e.OUtil.writeProfilerMark(e.OsfControlActivationPerfMarker.DeactivationStart),this._contextActivationMgr.dismissMessages(this._id),this._retryActivate=null,this._status!==e.OsfControlStatus.NotActivated){for(this._agaveEndPoint&&(Microsoft.Office.Common.XdmCommunicationManager.deleteClientEndPoint(this._agaveEndPoint._conversationId),this._agaveEndPoint=null),this._frame&&(e.OUtil.removeEventListener(this._frame,"load",this._iframeOnLoadDelegate),this._frame=null),this._timer&&(window.clearTimeout(this._timer),this._timer=null);this._div.childNodes.length>0;)this._div.removeChild(this._div.childNodes.item(0));this._status=e.OsfControlStatus.NotActivated,this._conversationId&&this._contextActivationMgr._getServiceEndPoint().unregisterConversation(this._conversationId),this._contextActivationMgr.raiseOsfControlStatusChange(this)}this._controlFocus=!1,e.OUtil.removeEventListener(this._div,"keydown",this._onKeyDownEventDelegate),this._iframeIsLoaded=!1,this._iframeLoadedNotified=!1,e.OUtil.writeProfilerMark(e.OsfControlActivationPerfMarker.DeactivationEnd)}catch(e){var t="Deactivate failed.";OfficeExt.WACUtils.logExceptionToBrowserConsole(t,e),Telemetry.RuntimeTelemetryHelper.LogExceptionTag(t,e,this.getCorrelationId(),523642504)}},t.prototype.startActivate=function(){for(this._controlFocus=!0,this._pageStatus=e.OsfControlPageStatus.Loading,this._sdxTelemetryContext={activationStart:performance.now(),performanceTimestampOrigin:Date.now()-performance.now(),osfControlId:this._id},e.OUtil.writeProfilerMark(e.OsfControlActivationPerfMarker.ActivationStart),this._frame&&(e.OUtil.removeEventListener(this._frame,"load",this._iframeOnLoadDelegate),this._frame=null);this._div.childNodes.length>0;)this._div.removeChild(this._div.childNodes.item(0));this._contextActivationMgr._ErrorUXHelper.showProgress(this._div,this._id)},t.prototype.refresh=function(){this._refresh()},t.prototype._restartActivate=function(){this.deActivate(),this.startActivate(),this.invokePreactivationCompletedCallback()},t.prototype.purge=function(t){var n=Function._validateParams(arguments,[{name:"purgeManifest",type:Boolean,mayBeNull:!1}]);if(n)throw n;try{this._contextActivationMgr._ErrorUXHelper.purgeOsfControlNotification(this._id),this.deActivate(),t&&e.OsfManifestManager.purgeManifest(this._solutionId,this._version),this._contextActivationMgr.unregisterOsfControl(this)}catch(e){var i="Purge failed.";OfficeExt.WACUtils.logExceptionToBrowserConsole(i,e),Telemetry.RuntimeTelemetryHelper.LogExceptionTag(i,e,this.getCorrelationId(),523642505)}},t.prototype.invokeVirtualOsfControlActivationCallback=function(e){try{this._virtualOsfControlActivationCallback&&(this._virtualOsfControlActivationCallback(this,e),this._isvirtualOsfControlCallbackInvoked=!0)}catch(e){var t="invokeVirtualOsfControlActivationCallback failed.";OfficeExt.WACUtils.logExceptionToBrowserConsole(t,e),Telemetry.RuntimeTelemetryHelper.LogExceptionTag(t,e,this.getCorrelationId(),523642506)}},t.prototype.ensureToGetVirtualOsfControlManifest=function(t){var n=this;if(this._manifest)t(this._manifest);else{var i={solutionId:this._solutionId,version:this._version,storeType:this._storeType,storeId:this._storeId,assetId:this._assetId,assetStoreId:this._assetStoreId,targetType:null},o=function(i){var o=null;i.status===OfficeExt.DataServiceResultCode.Succeeded&&i.value?o=i.value:n._status=e.OsfControlStatus.ActivationFailed,t(o)},r=OfficeExt.CatalogFactory.resolve(i.storeType);null!=r?r.getAndCacheManifest(i,this._storeId,new OfficeExt.AddinCommandsTelemetryContext(this.getCorrelationId()),o):(Telemetry.Logger.SendULSTraceTag(Telemetry.ULSCat.msoulscat_Osf_Latency,Telemetry.ULSTraceLevel.warning,"Failed to resolve catalog for the "+i.storeType+" provider.",523642507),o({status:OfficeExt.DataServiceResultCode.Failed,value:null}))}},t.prototype.invokePreactivationCompletedCallback=function(){this._preactivationCallback&&this._preactivationCallback()},t.prototype.getSolutionId=function(){return this._solutionId},t.prototype.getVersion=function(){return this._version},t.prototype.getContainingDiv=function(){return this._div},t.prototype.getID=function(){return this._id},t.prototype.getAssetId=function(){return this._assetId},t.prototype.getAssetStoreId=function(){return this._assetStoreId},t.prototype.getSettings=function(){return this._settings},t.prototype.setSettings=function(e){this._settings=e},t.prototype.getHostSettings=function(){return this._hostSettings},t.prototype.setHostSettings=function(e){this._hostSettings=e},t.prototype.getReason=function(){return this._reason==Microsoft.Office.WebExtension.InitializationReason.DocumentOpened?Microsoft.Office.WebExtension.InitializationReason.DocumentOpened:Microsoft.Office.WebExtension.InitializationReason.Inserted},t.prototype.getInitializationReason=function(){return this._reason},t.prototype.getManifest=function(){return this._manifest},t.prototype.getOsfControlType=function(){return this._osfControlType},t.prototype.getSharedRuntimeId=function(){return this._sharedRuntimeId},t.prototype.getSnapshotUrl=function(){return this._snapshotUrl},t.prototype.getStoreType=function(){return this._storeType},t.prototype.isFirstParty=function(){return e.OsfControl.isFirstPartyStoreString(this._storeType)},t.prototype.hostInfoFlags=function(){return this._hostInfoFlags},t.prototype.isFirstPartyOptOutAppContextOptimization=function(){return this._isFirstPartyOptOutAppContextOptmization},t.prototype.updateAgaveEndPointTargetUrl=function(e){this.ensureAgaveEndPoint(),this._agaveEndPoint&&(this._agaveEndPoint._targetUrl=e)},t.prototype.getStoreId=function(){return this._storeId},t.prototype.getHostCustomMessage=function(){return this._hostCustomMessage},t.prototype.getProperty=function(e){var t=Function._validateParams(arguments,[{name:"name",type:String,mayBeNull:!1}]);if(t)throw t;return this._settings[e]},t.prototype.addProperty=function(e,t){var n=Function._validateParams(arguments,[{name:"name",type:String,mayBeNull:!1},{name:"value",type:String,mayBeNull:!1}]);if(n)throw n;this._settings[e]=t},t.prototype.getHostProperty=function(e){var t=Function._validateParams(arguments,[{name:"name",type:String,mayBeNull:!1}]);if(t)throw t;return this._hostSettings[e]},t.prototype.removeProperty=function(e){var t=Function._validateParams(arguments,[{name:"name",type:String,mayBeNull:!1}]);if(t)throw t;delete this._settings[e]},t.prototype.getStatus=function(){return this._status},t.prototype.getPageStatus=function(){return this._pageStatus},t.prototype.checkAppDomains=function(e){var t=Microsoft.Office.Common.XdmCommunicationManager.checkUrlWithAppDomains(this._appDomains,e);return t||this.isTargetSubdomainOfSourceLocation(e)},t.prototype.isTargetSubdomainOfSourceLocation=function(e){return Microsoft.Office.Common.XdmCommunicationManager.isTargetSubdomainOfSourceLocation(this._agavePageUrl,e)},t.prototype.getNotificationParams=function(){return this._notificationParams},t.prototype.removeFirstNotification=function(){this._notificationParams.shift()},t.prototype.getIframeUrl=function(){return this._iframeUrl},t.prototype.getPermission=function(){return this._permission},t.prototype.getTrustNoPrompt=function(){return!1},t.prototype.getEToken=function(){return this._etoken},t.prototype.getCorrelationId=function(){return this._appCorrelationId},t.prototype.getAgavePageUrl=function(){return this._agavePageUrl},t.prototype.getAgaveWindowName=function(){return this._agaveWindowName},t.prototype.notifyAgave=function(e,t){this._agaveEndPoint&&this._agaveEndPoint.invoke("Office_notifyAgave",null,[e,t])},t.prototype.sendMessageToSdx=function(e,t){this._agaveEndPoint&&this._agaveEndPoint.invoke("Office_sendMessageToSdx",t,e)},t.prototype.isUILessAddInCommands=function(){return this._isUILessAddInCommands},t.prototype.getOwnerAddinSolutionId=function(){return this._ownerAddinSolutionId},t.prototype.getOwnerAddinStoreType=function(){return this._ownerAddinStoreType},t.prototype.getFeatureGates=function(){return this._featureGates},t.prototype.getOwnerAddinControlRecreated=function(){return this._ownerAddinControlRecreated},t.prototype.setOwnerAddinControlRecreated=function(e){this._ownerAddinControlRecreated=e},t.prototype._onKeydownEvent=function(t){if(t.preventDefault=t.preventDefault||function(){t.returnValue=!1},117==t.keyCode&&(t.ctrlKey||t.metaKey)){t.preventDefault(),t.stopPropagation();var n=e.AgaveHostAction.CtrlF6Exit;t.shiftKey&&(n=e.AgaveHostAction.CtrlF6ExitShift),this._contextActivationMgr._notifyHost(this._id,n)}else if(9==t.keyCode){t.preventDefault(),t.stopPropagation();var i=this._div.querySelectorAll("input, button, a");if(0==i.length)return;e.OUtil.focusToNextTabbable(i,t.target||t.srcElement,t.shiftKey)||(t.shiftKey?this._contextActivationMgr._notifyHost(this._id,e.AgaveHostAction.TabExitShift):this._agaveEndPoint?this.notifyAgave(e.AgaveHostAction.TabIn):this._contextActivationMgr._notifyHost(this._id,e.AgaveHostAction.TabExit))}else if(27==t.keyCode)t.preventDefault(),this._contextActivationMgr._notifyHost(this._id,e.AgaveHostAction.EscExit);else if(113==t.keyCode)t.preventDefault(),this._contextActivationMgr._notifyHost(this._id,e.AgaveHostAction.F2Exit);else if(13==t.keyCode||32==t.keyCode)for(var o=this._div.querySelectorAll("input, button, a"),r=0;r<o.length;r++){var a=t.target||t.srcElement;if(o[r]===a)return t.preventDefault(),t.stopPropagation(),void a.click()}else t.preventDefault(),t.stopPropagation()},t.prototype._onGetEntitlementsCompleted=function(t){if(t.statusCode===e.ProxyCallStatusCode.Succeeded&&t.value){Telemetry.AppLoadTimeHelper.EntitlementCheckEnd(this._telemetryContext);for(var n,i=t.context.referenceInUse,o=t.value.entitlements,r=o.length,a=null,s=0;s<r;s++)(n=o[s]).OfficeExtensionID&&i.solutionId&&n.OfficeExtensionID.toLowerCase()===i.solutionId.toLowerCase()&&(a&&!this._lessThan(a.OfficeExtensionVersion,n.OfficeExtensionVersion)||(a=n));(n=a)?n.OfficeExtensionKillbit?this._showActivationError(e.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveDisabledByAdmin_ERR,null,null,null,null,null,null,e.ErrorStatusCodes.E_OEM_EXTENSION_KILLED):(t.context.manifestUrl=n.EncodedAbsUrl,t.context.appInstanceId=n.AppInstanceID,t.context.productId=n.ProductID,t.context.appInstanceId?e.OsfManifestManager.getAppInstanceInfoByIdAsync(t.context,Function.createDelegate(this,this._onGetAppInstanceInfoByIdCompleted)):e.OsfManifestManager.getManifestAsync(t.context,Function.createDelegate(this,this._onGetManifestCompleted))):this._showActivationError(e.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveNotExist_ERR,Strings.OsfRuntime.L_RetryButton_TXT,Function.createCallback((function(e){e.osfControl._refresh(e)}),{clearCache:!0,referenceInUse:t.context.referenceInUse,osfControl:t.context.osfControl}),null,null,null,null,e.ErrorStatusCodes.E_MANIFEST_DOES_NOT_EXIST)}else this._showActivationError(e.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveServerConnectionFailed_ERR,Strings.OsfRuntime.L_RetryButton_TXT,Function.createDelegate(this,this._refresh),null,null,null,null,e.ErrorStatusCodes.E_MANIFEST_SERVER_UNAVAILABLE,"_onGetEntitlementsCompleted")},t.prototype._onGetAppInstanceInfoByIdCompleted=function(t){if(t.statusCode===e.ProxyCallStatusCode.Succeeded&&t.value){var n=t.value,i=t.context;n.AppWebFullUrl&&(i.appWebUrl=n.AppWebFullUrl),i.clientId=n.AppPrincipalId,i.remoteAppUrl=n.RemoteAppUrl,i.appWebUrl&&i.productId?e.OsfManifestManager.getSPTokenByProductIdAsync(i,Function.createDelegate(this,this._onGetSPTokenByProductIdCompleted)):e.OsfManifestManager.getManifestAsync(i,Function.createDelegate(this,this._onGetManifestCompleted))}else this._showActivationError(e.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveServerConnectionFailed_ERR,Strings.OsfRuntime.L_RetryButton_TXT,Function.createDelegate(this,this._refresh),null,null,null,null,e.ErrorStatusCodes.E_MANIFEST_SERVER_UNAVAILABLE,"_onGetAppInstanceInfoByIdCompleted")},t.prototype._onGetSPTokenByProductIdCompleted=function(t){t.statusCode===e.ProxyCallStatusCode.Succeeded&&t.value&&(this._etoken=t.value),e.OsfManifestManager.getManifestAsync(t.context,Function.createDelegate(this,this._onGetManifestCompleted))},t.prototype._retryActivation=function(){this._retryLoadingNum--,this._pageStatus===e.OsfControlPageStatus.Ready||this._retryLoadingNum<=0?(this._contextActivationMgr._ErrorUXHelper.removeProgressDiv(this._div,this._id),this._retryLoadingNum=2):this._refresh()},t.prototype._iframeOnLoad=function(){var t=this;this._iframeIsLoaded=!0,this._appContextIsSetToIframeName&&t._contextActivationMgr._ErrorUXHelper&&(t._contextActivationMgr._ErrorUXHelper.removeProgressDiv(t._div,t._id),t._pageStatus=e.OsfControlPageStatus.Ready,this._contextActivationMgr._enableSetFocusOnTaskpaneOnUserAction?t._frame&&t._frame.contentWindow&&(t._focusOnIframeWhenLoaded||t.getStatus()===e.OsfControlStatus.Activated&&t.getPageStatus()===e.OsfControlPageStatus.Ready&&t.getInitializationReason()===Microsoft.Office.WebExtension.InitializationReason.Inserted)&&t._frame.contentWindow.focus():t._focusOnIframeWhenLoaded&&t._frame&&t._frame.contentWindow&&t._frame.contentWindow.focus(),t.ensureAgaveEndPoint(),this._telemetryContext.Timers&&this._telemetryContext.Timers.Stage11Time&&!this._telemetryContext.Timers.Stage11Time.Finished&&Telemetry.AppLoadTimeHelper.OfficeJSLoaded(this._telemetryContext)),Telemetry.AppLoadTimeHelper.PageLoaded(this._telemetryContext),this._appContextIsSetToIframeName&&t._contextActivationMgr._ErrorUXHelper&&this._telemetryContext.Timers&&this._telemetryContext.Timers.Stage1Time&&!this._telemetryContext.Timers.Stage1Time.Finished&&Telemetry.AppLoadTimeHelper.ActivationEnd(this._telemetryContext);t._pageStatus!==e.OsfControlPageStatus.Ready?t._timer=window.setTimeout((function(){!function(t){if(t){if(t._contextActivationMgr._ErrorUXHelper&&(e.OUtil.writeProfilerMark(e.OsfControlActivationPerfMarker.SelectionTimeout),t._contextActivationMgr._ErrorUXHelper.removeProgressDiv(t._div,t._id)),t._pageStatus!==e.OsfControlPageStatus.Ready)if(2===t._retryLoadingNum){var n=e.ErrorStatusCodes.WAC_AgaveActivationError;switch(t._pageStatus){case e.OsfControlPageStatus.FailedOriginCheck:n=e.ErrorStatusCodes.WAC_AgaveOriginCheckError;break;case e.OsfControlPageStatus.FailedPermissionCheck:n=e.ErrorStatusCodes.WAC_AgavePermissionCheckError;break;case e.OsfControlPageStatus.FailedHandleRequest:n=e.ErrorStatusCodes.WAC_AgaveHostHandleRequestError}if(t._contextActivationMgr._enableFirstPartySDXErrorMessages&&t.isFirstParty()){var i="Timeout loading contents in iframe. Error: "+n;t._storeType.toLowerCase()==e.StoreType.FirstParty.toLowerCase()?OfficeExt.FirstPartyCatalog.LogFirstPartyCatalogMonitoringError(i,t._solutionId):t._storeType.toLowerCase()==e.StoreType.Sdx.toLowerCase()&&OfficeExt.SDXCatalog.LogSDXCatalogMonitoringError(i,t._solutionId),t._showActivationError(e.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveActivationError_ERR_FirstParty,Strings.OsfRuntime.L_RetryButton_TXT,Function.createDelegate(t,t._retryActivation),null,null,null,null,n)}else t._showActivationError(e.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveActivationError_ERR,Strings.OsfRuntime.L_RetryButton_TXT,Function.createDelegate(t,t._retryActivation),null,null,null,null,n)}else 1===t._retryLoadingNum&&(t._contextActivationMgr._enableFirstPartySDXErrorMessages&&t.isFirstParty()?(i="User retry failed to load contents in iframe.",t._storeType.toLowerCase()==e.StoreType.FirstParty.toLowerCase()?OfficeExt.FirstPartyCatalog.LogFirstPartyCatalogMonitoringError(i,t._solutionId):t._storeType.toLowerCase()==e.StoreType.Sdx.toLowerCase()&&OfficeExt.SDXCatalog.LogSDXCatalogMonitoringError(i,t._solutionId),t._showActivationError(e.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_ActivateAttempLoading_ERR_FirstParty,Strings.OsfRuntime.L_ActivateButton_TXT,Function.createDelegate(t,t._retryActivation),null,null,null,null,e.ErrorStatusCodes.WAC_ActivateAttempLoading)):t._showActivationError(e.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_ActivateAttempLoading_ERR,Strings.OsfRuntime.L_ActivateButton_TXT,Function.createDelegate(t,t._retryActivation),null,null,null,null,e.ErrorStatusCodes.WAC_ActivateAttempLoading));else t._notifyHostIFrameOnLoaded();t._timer&&(window.clearTimeout(t._timer),t._timer=null),t._pageIsReadyTimerExpired=!0}}(t)}),5e3*(t._retryLoadingNum+1)):t._notifyHostIFrameOnLoaded()},t.prototype._handleNotReady=function(){var t=this,n=!0;if(t._contextActivationMgr._isHostFrameTrusted===e.HostFrameTrustState.NotInitialized||t._contextActivationMgr._isHostFrameTrusted===e.HostFrameTrustState.NotReady)t._hasRegisteredNotReady||(t._contextActivationMgr.registerNotReadyOsfControl(t),t._hasRegisteredNotReady=!0),t._timer1=window.setTimeout((function(){!function(t){t._timer1&&(window.clearTimeout(t._timer1),t._timer1=null),t&&(t._contextActivationMgr._isHostFrameTrusted===e.HostFrameTrustState.NotInitialized||t._contextActivationMgr._isHostFrameTrusted===e.HostFrameTrustState.NotReady?t._autoRetryCheckingNum>=0?(t._autoRetryCheckingNum--,Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("CheckWopiHost IsHostFrameTrusted Value:"+t._contextActivationMgr._isHostFrameTrusted,t._contextActivationMgr._contextMgrCorrelationId,523642508),t._refresh()):t._retryCheckingNum>=0?(t._retryCheckingNum--,Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("CheckWopiHost IsHostFrameTrusted Value:"+t._contextActivationMgr._isHostFrameTrusted,t._contextActivationMgr._contextMgrCorrelationId,523642509),e.ErrorStatusCodes.WAC_WopiHostCheckStatusNotReady,t._showActivationError(e.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_UnknownHost_Error_ERR,Strings.OsfRuntime.L_RetryButton_TXT,Function.createDelegate(t,t._refresh),null,null,null,null,e.ErrorStatusCodes.WAC_WopiHostCheckStatusNotReady)):(Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("CheckWopiHost IsHostFrameTrusted Value:"+t._contextActivationMgr._isHostFrameTrusted,t._contextActivationMgr._contextMgrCorrelationId,523642510),e.ErrorStatusCodes.WAC_WopiHostCheckStatusNotReady,t._showActivationError(e.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_UnknownHost_Error_ERR,null,null,null,null,null,null,e.ErrorStatusCodes.WAC_WopiHostCheckStatusNotReady)):(Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("CheckWopiHost IsHostFrameTrusted Value:"+t._contextActivationMgr._isHostFrameTrusted,t._contextActivationMgr._contextMgrCorrelationId,523642511),t._status==e.OsfControlStatus.NotActivated&&t._refresh()))}(t)}),5e3*(t._retryCheckingNum+1));else if(t._contextActivationMgr._isHostFrameTrusted===e.HostFrameTrustState.NotTrusted||t._contextActivationMgr._isHostFrameTrusted===e.HostFrameTrustState.NotImplemented){Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("CheckWopiHost IsHostFrameTrusted Value:"+t._contextActivationMgr._isHostFrameTrusted,t._contextActivationMgr._contextMgrCorrelationId,523642512);var i=this.isFirstParty()?Strings.OsfRuntime.L_UntrustedHost_Error_ERR_FirstParty:Strings.OsfRuntime.L_UntrustedHost_Error_ERR;t._showActivationError(e.OsfControlStatus.ActivationFailed,i,null,null,null,null,null,null,e.ErrorStatusCodes.WAC_WopiHostCheckStatusNotTrusted),t._timer1&&(window.clearTimeout(t._timer1),t._timer1=null)}else Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("CheckWopiHost IsHostFrameTrusted Value:"+t._contextActivationMgr._isHostFrameTrusted,t._contextActivationMgr._contextMgrCorrelationId,523642513),n=!1,t._timer1&&(window.clearTimeout(t._timer1),t._timer1=null);return n},t.prototype._checkWopiHost=function(t){var n=!1,i=this;if(t)if(i._contextActivationMgr._isHostFrameTrusted===e.HostFrameTrustState.NotTrusted||i._contextActivationMgr._isHostFrameTrusted===e.HostFrameTrustState.NotImplemented){Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("CheckWopiHost IsHostFrameTrusted Value:"+i._contextActivationMgr._isHostFrameTrusted,i._contextActivationMgr._contextMgrCorrelationId,523642514);var o=this.isFirstParty()?Strings.OsfRuntime.L_UntrustedHost_Error_ERR_FirstParty:Strings.OsfRuntime.L_UntrustedHost_Error_ERR;i._showActivationError(e.OsfControlStatus.ActivationFailed,o,null,null,null,null,null,null,e.ErrorStatusCodes.WAC_WopiHostCheckStatusNotTrusted),n=!0,i._timer1&&(window.clearTimeout(i._timer1),i._timer1=null)}else i._contextActivationMgr._isHostFrameTrusted===e.HostFrameTrustState.NotInitialized||i._contextActivationMgr._isHostFrameTrusted===e.HostFrameTrustState.NotReady?n=i._handleNotReady():(Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("CheckWopiHost IsHostFrameTrusted Value:"+i._contextActivationMgr._isHostFrameTrusted,i._contextActivationMgr._contextMgrCorrelationId,509875223),i._timer1&&(window.clearTimeout(i._timer1),i._timer1=null));return Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("CheckWopiHost IsHostFrameTrusted Value:"+this._contextActivationMgr._isHostFrameTrusted,this._contextActivationMgr._contextMgrCorrelationId,523642515),n},t.prototype._isOsfControlInEmbeddingMode=function(e){var t=!1;try{t=null!=e.getContainingDiv().parentNode.parentNode.id.match(/^(m_excelEmbedRenderer_|ewaSynd).+$/gi)}catch(e){OfficeExt.WACUtils.logExceptionToBrowserConsole("_isOsfControlInEmbeddingMode error.",e)}return t},t.prototype._createIframeAndActivateOsfControl=function(e){Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("IFrame Created"+this._iframeUrl,this._contextActivationMgr._contextMgrCorrelationId,523642516);var t=this._createIframeForControl(e);this._activate(t,this._iframeUrl)},t.prototype._createIframeForControl=function(e){var t,n=document.createElement("iframe");for(var i in n.setAttribute("id",this._id),n.setAttribute("width","100%"),n.setAttribute("height","100%"),n.setAttribute("frameborder","0"),n.setAttribute("allowfullscreen","true"),t=this._contextActivationMgr._enableFirstPartySDXErrorMessages&&this.isFirstParty()?this._titleOverride?this._titleOverride:e:Strings.OsfRuntime.L_IframeTitle_TXT+" "+e,n.setAttribute("title",t),n.style.msUserSelect="element",this._setSandboxAttribute(n),this._contextActivationMgr._iframeAttributeBag)n.setAttribute(i,this._contextActivationMgr._iframeAttributeBag[i]);return this._frame=n,n},t.prototype._setSandboxAttribute=function(t){var n,i=["allow-scripts","allow-forms","allow-same-origin","allow-popups","allow-popups-to-escape-sandbox","allow-modals","allow-downloads","allow-storage-access-by-user-activation"],o="";o=t.sandbox&&t.sandbox.supports?i.filter((function(e){return t.sandbox.supports(e)})).join(" "):i.join(" "),t.setAttribute("sandbox",o);var r="geolocation;camera";if(this._contextActivationMgr._disableMicrophonePermission||(r+=";microphone"),this._contextActivationMgr._accessibilityAllowFocusAddinTaskpane&&(r+=";focus-without-user-activation *"),e.OUtil.isChangeGateEnabled("OfficeVSO:7822286_AllowDisplayCaptureForWordCopilot")&&this.isFirstParty()){var a=(null===(n=(this._contextActivationMgr._appSettings||{}).AllowDisplayCaptureSdxIds)||void 0===n?void 0:n.toLowerCase())||e.DefaultAllowDisplayCaptureSdxIds,s=this._solutionId.toLowerCase();-1!==a.indexOf(s)&&(r+=";display-capture")}t.setAttribute("allow",r)},t.prototype._onGetManifestCompleted=function(t){if(t.statusCode===e.ProxyCallStatusCode.Succeeded&&t.value){Telemetry.AppLoadTimeHelper.ManifestRequestEnd(this._telemetryContext),Telemetry.AppLoadTimeHelper.ServerCallEnd(this._telemetryContext);var n=t.value,i=t.context,o=i.referenceInUse,r=o.storeType,a=n.getDefaultDisplayName();if(this._manifest=n,i.manifestCached&&!i.retried){var s=n.getMarketplaceVersion();if(this._lessThan(s,o.version)&&r===e.StoreType.SPApp)return void this._refresh({clearCache:!0,referenceInUse:o,osfControl:i.osfControl,retried:!0})}if(!1===n.requirementsSupported||void 0===n.requirementsSupported&&!this._contextActivationMgr.getRequirementsChecker().isManifestSupported(n)){n.requirementsSupported=!1;var l,c;return l=Strings.OsfRuntime.L_AgaveManifestRequirementsError_ERR||Strings.OsfRuntime.L_AgaveManifestError_ERR,c=e.ErrorStatusCodes.WAC_AgaveRequirementsError,void this._showActivationError(e.OsfControlStatus.ActivationFailed,l,null,null,null,null,null,!0,c)}if(n.requirementsSupported=!0,this._iframeUrl=n.getDefaultSourceLocation(this._contextActivationMgr.getFormFactor()),this._permission=n.getPermission(),this._appDomains=n.getAppDomains(),e.OUtil.isChangeGateEnabled("OfficeVSO:0_IsMosFlag")&&(this._isMos=n.getPayloadType()===e.PayloadType.MosAcquisition),r===e.StoreType.SPApp&&this._iframeUrl&&(i.clientId&&(this._iframeUrl=this._iframeUrl.replace(/~clientid/gi,i.clientId)),i.appWebUrl&&(this._iframeUrl=this._iframeUrl.replace(/~appweburl/gi,i.appWebUrl)),i.remoteAppUrl&&(this._iframeUrl=this._iframeUrl.replace(/~remoteappurl/gi,i.remoteAppUrl))),!e.OUtil.doesUrlHaveSupportedProtocol(this._iframeUrl))return void this._showActivationError(e.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveManifestError_ERR,null,null,null,null,null,null,e.ErrorStatusCodes.E_MANIFEST_INVALID_VALUE_FORMAT);this.processManifestForCustomFunctions(n),this._isvirtualOsfControl?i.showNewerVersion||this.invokeVirtualOsfControlActivationCallback(n):this._createIframeAndActivateOsfControl(a)}else Telemetry.RuntimeTelemetryHelper.LogExceptionTag("GetManifest failed:"+OfficeExt.WACUtils.serializeObjectToString(t),null,null,523642517),this._showActivationError(e.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveManifestRetrieve_ERR,Strings.OsfRuntime.L_RetryButton_TXT,Function.createDelegate(this,this._refresh),null,null,null,null,e.ErrorStatusCodes.E_MANIFEST_SERVER_UNAVAILABLE)},t.prototype.isCurrentLocaleDefaultLocale=function(e){return e.getDefaultLocale().toLowerCase()!=this._contextActivationMgr.getAppUILocale().toLowerCase()},t.prototype.processMosShortcuts=function(t){var n=this,i=OfficeExt.ExtendedManifestUtility.constructExtendedManifestFromAppMetadata(t);if(!i){var o="Did not get a validated extended manifest.";throw Telemetry.RuntimeTelemetryHelper.LogExceptionTag(o,null,this.getCorrelationId(),523642518),o}var r=OfficeExt.ManifestUtil.constructAddInId(this._solutionId,this._version,this._storeType,this._storeId);OfficeExt.ShortcutsMappingTableManager.validateExtendedManifestShortcutKeys(i,r,!0).then((function(){OfficeExt.OsfExtendedManifestCache.set(r,JSON.stringify(i));var t=new e.AddinIdInfo(r);n.sendParseExtendedManifestTelemetry(i.shortcuts,t.getPrivacyCompliantSolutionId(),n._storeType)}))},t.prototype.processManifestForExtendedOverrides=function(e,t){return this._processManifestForExtendedOverridesPromise&&!this._isUpgrading||(this._processManifestForExtendedOverridesPromise=this.processManifestForExtendedOverridesInternal(e,t)),this._processManifestForExtendedOverridesPromise},t.prototype.processManifestForExtendedOverridesInternal=function(t,n){var i=this;if(this._isManifestProcessedForExtendedOverrides&&!this._isUpgrading)return Promise.resolve(null);if(!t)return Promise.resolve(null);if(this.getInitializationReason()!==Microsoft.Office.WebExtension.InitializationReason.Inserted&&this.getInitializationReason()!==Microsoft.Office.WebExtension.InitializationReason.DocumentOpened)return Promise.resolve(null);this._isManifestProcessedForExtendedOverrides=!0;try{if(!t.getExtendedOverrides().url){var o="Missing extendedOverrides url info for manifest contains ExtendedOverrides node";return Telemetry.RuntimeTelemetryHelper.LogExceptionTag(o,null,this.getCorrelationId(),523642519),Promise.reject(o)}OfficeExt.ExtendedManifestUtility.ensureFinalExtendedOverridesUrls(t,this._contextActivationMgr)}catch(e){o="Failed to construct ExtendedOverrides";return Telemetry.RuntimeTelemetryHelper.LogExceptionTag(o,e,this.getCorrelationId(),523642520),Promise.reject(o)}if(t.getExtendedOverrides().hasFinalUrls&&!OfficeExt.OsfExtendedManifestCache.wasExtendedManifestAlreadyFetched(t._id)){var r=[OfficeExt.ExtendedManifestUtility.downloadContent(t.getExtendedOverrides().url)];return t.getExtendedOverrides().resourcesUrl&&t.getDefaultLocale().toLowerCase()!=this._contextActivationMgr.getAppUILocale().toLowerCase()&&r.push(OfficeExt.ExtendedManifestUtility.downloadContent(t.getExtendedOverrides().resourcesUrl)),Promise.all(r).then((function(t){if(t.length<1||t.length>2){var o="Invalid number of files fetched.";throw Telemetry.RuntimeTelemetryHelper.LogExceptionTag(o,null,i.getCorrelationId(),523642521),o}var r=JSON.parse(t[0]),a=null;2==t.length&&(a=JSON.parse(t[1]));var s=OfficeExt.ExtendedManifestUtility.validateAndSubstituteExtendedManifestTokens(r,a);if(!s){o="Did not get a validated extended manifest.";throw Telemetry.RuntimeTelemetryHelper.LogExceptionTag(o,null,i.getCorrelationId(),523642522),o}var l=OfficeExt.ManifestUtil.constructAddInId(i._solutionId,i._version,i._storeType,i._storeId);return OfficeExt.ShortcutsMappingTableManager.validateExtendedManifestShortcutKeys(s,l,!0).then((function(){n&&OfficeExt.AddinShortcutsPreferenceSettingHelper.clearSettingsByExtendedManifest(s),OfficeExt.OsfExtendedManifestCache.set(l,JSON.stringify(s));var t=new e.AddinIdInfo(l);i.sendParseExtendedManifestTelemetry(s.shortcuts,t.getPrivacyCompliantSolutionId(),i._storeType)})),null})).catch((function(e){throw Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Promise rejected.",e,i.getCorrelationId(),523642523),e}))}return Promise.resolve(null)},t.prototype.sendParseExtendedManifestTelemetry=function(t,n,i){"undefined"!=typeof otel&&void 0!==otel.sendTelemetryEvent?e.OUtil.sendTelemetryEvent("Office.Extensibility.ExtendedManifest.ParseExtendedManifest",[{name:"ContainsShortcut",bool:t},{name:"SolutionId",string:n},{name:"StoreType",string:i}])||otel.sendTelemetryEvent({name:"Office.Extensibility.ExtendedManifest.ParseExtendedManifest",dataFields:[{name:"ContainsShortcut",bool:t},{name:"SolutionId",string:n},{name:"StoreType",string:i}]}):Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("The Otel isn't available, couldn't call sendOtelEvent for logging the shortcuts telemetry",null,523642524)},t.prototype.isCustomFunctionSandbox=function(){if("object"==typeof this._settings&&"number"==typeof this._settings.length)for(var e=0;e<this._settings.length;e++)if("object"==typeof this._settings[e]&&"number"==typeof this._settings[e].length&&"string"==typeof this._settings[e][0]&&"string"==typeof this._settings[e][1]&&"customfunctionaddinid"==this._settings[e][0].toLowerCase())return!0;return!1},t.prototype.processManifestForCustomFunctions=function(t){var n=this;if((!this._isManifestProcessedForCustomFunctions||this._isUpgrading)&&(this._isManifestProcessedForCustomFunctions=!0,t&&t.containsCustomFunctionsForAppHost(this._contextActivationMgr._hostType))){var i=e.getManifestHostType(this._contextActivationMgr._hostType),o=this._contextActivationMgr.getFormFactor(),r=new OfficeExt.Parser.ParsingContext(i,o,null,t),a=new OfficeExt.Parser.AddinCommandsManifestParser(i,o),s={solutionId:this._solutionId,version:this._version,storeType:this._storeType,storeId:this._storeId,assetId:this._assetId,assetStoreId:this._assetStoreId,targetType:null},l={setErrorMessageForAddin:function(e,t){OsfMsAjaxFactory.msAjaxDebug.trace("Error parsing app manifest: "+t)}},c=a.parseExtensions(s,t,l);if("object"==typeof c.ExtensionPoints&&"number"==typeof c.ExtensionPoints.length)for(var u=t.isXLLCompatible(),d=0;d<c.ExtensionPoints.length;d++)if("CustomFunctions"===c.ExtensionPoints[d].type){var p=c.ExtensionPoints[d],f=function(){var i={osfControl:n,locale:n._getCustomFunctionsLocale(t),invariantNamespace:n._getCustomFunctionsInvariantNamespace(r,p.namespaceResId),namespace:r.resources.ShortStrings[p.namespaceResId],metadataUrl:r.resources.Urls[p.metadataResId],title:t.getDefaultDisplayName(),isXllCompatible:u,manifest:t._xmlProcessor.getNodeXml(t._xmlProcessor.getDocumentElement())};n._contextActivationMgr._notifyHost(n._id,e.AgaveHostAction.InstallCustomFunctions,i)};this.isCustomFunctionSandbox()?(this._iframeUrl=r.resources.Urls[p.pageResId],this._isUpgrading&&f()):f();break}}},t.prototype.setIsUpgrading=function(e){this._isUpgrading=e},t.prototype.getIsUpgrading=function(){return this._isUpgrading},t.prototype.setUpgradingFailed=function(e){this._isUpgradingFailed=e},t.prototype.getUpgradingFailed=function(){return this._isUpgradingFailed},t.prototype.updateUrlsForSdx=function(e){if(this.isFirstParty()&&!/^(?:[a-z]+:)?\/\//i.test(this._iframeUrl)){var t=void 0,n=this._iframeUrl;if(e){var i=e.lastIndexOf("/");-1!==i&&(t=e.substr(0,i)+"/"+n)}this._iframeUrl=t}},t.prototype.getIsMos=function(){return this._isMos||!1},t.prototype._getCustomFunctionsLocale=function(e){return e._UILocale?e._UILocale.toLocaleLowerCase():e._defaultLocale?e._defaultLocale.toLocaleLowerCase():""},t.prototype._getCustomFunctionsInvariantNamespace=function(e,t){var n=e.manifest._xmlProcessor.selectSingleNode("o:OfficeApp"),i=e.selectSingleNode(n,["ov:VersionOverrides","ov:Resources","bt:ShortStrings","bt:String [@id = '"+t+"']"]);return i?i.getAttribute("DefaultValue"):null},t.prototype._lessThan=function(t,n){return e.OsfManifestManager.versionLessThan(t,n)},t.prototype._getTrustUXCatalogString=function(){var t=Strings.OsfRuntime.L_AgaveOmexCatalogName;switch(this._storeType){case e.StoreType.OMEX:case e.StoreType.WopiCatalog:t=Strings.OsfRuntime.L_AgaveOmexCatalogName;break;case e.StoreType.SPCatalog:var n=OfficeExt.WACUtils.getHostSecure(this._storeId);e.OUtil.isNullOrUndefined(n)?(t=Strings.OsfRuntime.L_TrustSPCatalogFallbackString,Telemetry.Logger.SendULSTraceTag(Telemetry.ULSCat.msoulscat_Osf_Latency,Telemetry.ULSTraceLevel.warning,"null SPCatalog location returned",523642526)):t=e.OUtil.formatString(Strings.OsfRuntime.L_TrustSPCatalogString,n);break;case e.StoreType.SPApp:t=Strings.OsfRuntime.L_TrustSPAppCatalogString;break;default:Telemetry.Logger.SendULSTraceTag(Telemetry.ULSCat.msoulscat_Osf_Latency,Telemetry.ULSTraceLevel.warning,"Unexpected storeType:"+this._storeType,523642527)}return t},t.prototype._showTrustError=function(t,n,i,o,r,a,s){var l=this,c=e.OUtil.formatString(Strings.OsfRuntime.L_AgaveName_INFO,n||"");c=this._contextActivationMgr._ErrorUXHelper.getHTMLEncodedString(c);var u=e.OUtil.formatString(Strings.OsfRuntime.L_AgaveProvider_INFO,i||"");u=this._contextActivationMgr._ErrorUXHelper.getHTMLEncodedString(u),s=null==s?!!this.getManifest()&&this.getManifest().isSSOAddin():s;var d=Strings.OsfRuntime.L_AgaveTrustAddIn_Improved_Title_INFO,p=Strings.OsfRuntime.L_AgaveTrustAddIn_INFO,f=Strings.OsfRuntime.L_AgaveTrustAddIn_Improved_AllowContinueButton_TXT,m=Telemetry.PrivacyRules.GetPrivacyCompliantId(this._solutionId,this._storeType,this._assetId),h=function(){l._logTrustUXTelemetry("ClickTrust",m),e.OUtil.checkFlight(e.FlightTreatmentNames.AddinDetailsServiceSupportEnabled)&&l._contextActivationMgr._notifyHost&&l._contextActivationMgr._notifyHost("_showTrustError",e.AgaveHostAction.ClickTrust,{solutionId:l._solutionId,version:l._version,storeType:l._storeType,storeId:l._storeId,assetId:l._assetId,assetStoreId:l._assetStoreId,targetType:null}),r()};if(this._storeType==e.StoreType.OMEX){var g=OfficeExt.CatalogFactory.resolve(e.StoreType.OMEX),y=new OfficeExt.SimpleTelemetryContext,v=[{solutionId:this._solutionId,version:this._version,storeType:this._storeType,storeId:this._storeId,assetId:this._assetId,assetStoreId:this._assetStoreId}];g.getAppDetails(v,null,y,(function(s){if(s.status==OfficeExt.DataServiceResultCode.Succeeded&&null!=s.value&&s.value.length>0&&""!=s.value[0].privacyUrl&&""!=s.value[0].licenseUrl){var c=e.OUtil.formatString(Strings.OsfRuntime.L_AgaveTrustAddIn_Improved_Description2_INFO,"<br>"+Strings.OsfRuntime.L_AgaveTrustAddIn_Improved_Description2_license_INFO+"<br>","<br>"+Strings.OsfRuntime.L_AgaveTrustAddIn_Improved_Description2_privacy_INFO+"<br>");p=Strings.OsfRuntime.L_AgaveTrustAddIn_Improved_Title1_INFO.concat("<br>",Strings.OsfRuntime.L_AgaveTrustAddIn_Improved_Description1_INFO,"<br>",c,"<br>",s.value[0].licenseUrl,"<br>",s.value[0].privacyUrl),f=Strings.OsfRuntime.L_AgaveTrustAddIn_Improved_AcceptContinueButton_TXT,l._logTrustUXTelemetry("Show",m)}else Telemetry.Logger.SendULSTraceTag(Telemetry.ULSCat.msoulscat_Osf_Latency,Telemetry.ULSTraceLevel.warning,"Failed to get app details with "+s.status,523642528),l._logTrustUXTelemetry("Show",m,"OriginalUI");l._displayNotificationWith(r,t,n,i,d,p,o,f,a,m,h)}),!1)}else{var S=this._getTrustUXCatalogString();p=e.OUtil.formatString(Strings.OsfRuntime.L_AgaveTrustAddIn_INFO_NonOmex,S),this._displayNotificationWith(r,t,n,i,d,p,o,f,a,m,h),this._logTrustUXTelemetry("Show",m,this._storeType)}},t.prototype._displayNotificationWith=function(t,n,i,o,r,a,s,l,c,u,d){void 0===u&&(u=null),void 0===d&&(d=null);var p=this._osfControlType===e.OsfControlType.DocumentLevel?e.NotificationType.TrustPromptContent:e.NotificationType.TrustPromptTaskpane;this._retryActivate=t,this._contextActivationMgr.displayNotification({id:this._id,infoType:e.InfoType.SecurityInfo,clientName:n,name:i||null,provider:o,title:r,description:a,icon:s||null,buttonTxt:l,buttonCallback:null==d?t:d,url:c||null,dismissCallback:null,reDisplay:!0,displayDeactive:!0,logAsError:!0,retryAll:!0,errorCode:e.ErrorStatusCodes.E_TRUSTCENTER_MOE_UNACTIVATED,iframeNotificationUrl:null,notificationType:p,telemetryId:u})},t.prototype._logTrustUXTelemetry=function(t,n,i){void 0===i&&(i=null),"undefined"!=typeof otel&&void 0!==otel.sendTelemetryEvent&&(null==i?e.OUtil.sendTelemetryEvent("Office.Extensibility.Host.TrustUX",[{name:"TrustUXAction",string:t},{name:"SDX.Id",string:n},{name:"SDX.TargetType",int64:this._osfControlType}])||otel.sendTelemetryEvent({name:"Office.Extensibility.Host.TrustUX",dataFields:[{name:"TrustUXAction",string:t},{name:"SDX.Id",string:n},{name:"SDX.TargetType",int64:this._osfControlType}]}):e.OUtil.sendTelemetryEvent("Office.Extensibility.Host.TrustUX",[{name:"TrustUXAction",string:t},{name:"SDX.Id",string:n},{name:"SDX.FeatureFlags",string:i},{name:"SDX.TargetType",int64:this._osfControlType}])||otel.sendTelemetryEvent({name:"Office.Extensibility.Host.TrustUX",dataFields:[{name:"TrustUXAction",string:t},{name:"SDX.Id",string:n},{name:"SDX.FeatureFlags",string:i},{name:"SDX.TargetType",int64:this._osfControlType}]}))},t.prototype._showActivationError=function(t,n,i,o,r,a,s,l,c,u){if(void 0===u&&(u=void 0),this._status=t,this._contextActivationMgr._enableFirstPartySDXErrorMessages&&this.isFirstParty())var d={id:this._id,infoType:e.InfoType.Error,status:t,title:s||Strings.OsfRuntime.L_AgaveErrorTile_TXT_FirstParty,description:n,icon:null,buttonTxt:i||Strings.OsfRuntime.L_OkButton_TXT,buttonCallback:o||null,url:r||null,dismissCallback:a||null,reDisplay:!a,displayDeactive:!0,detailView:!!l,logAsError:!0,errorCode:c||0};else d={id:this._id,infoType:e.InfoType.Error,status:t,title:s||Strings.OsfRuntime.L_AgaveErrorTile_TXT,description:n,icon:null,buttonTxt:i||Strings.OsfRuntime.L_OkButton_TXT,buttonCallback:o||null,url:r||null,dismissCallback:a||null,reDisplay:!a,displayDeactive:!0,detailView:!!l,logAsError:!0,errorCode:c||0};this._contextActivationMgr.displayNotification(d),this._contextActivationMgr.raiseOsfControlStatusChange(this)},t.prototype._showActivationWarning=function(t,n,i,o,r,a,s){if(this._status=t,this._contextActivationMgr._enableFirstPartySDXErrorMessages&&this.isFirstParty())var l={id:this._id,infoType:e.InfoType.Warning,status:t,title:Strings.OsfRuntime.L_AgaveWarningTitle_TXT_FirstParty,description:n,icon:null,buttonTxt:i||Strings.OsfRuntime.L_OkButton_TXT,buttonCallback:o||null,url:r||null,dismissCallback:a||null,reDisplay:!a,displayDeactive:!0,logAsError:!0,errorCode:s||0};else l={id:this._id,infoType:e.InfoType.Warning,status:t,title:Strings.OsfRuntime.L_AgaveWarningTitle_TXT,description:n,icon:null,buttonTxt:i||Strings.OsfRuntime.L_OkButton_TXT,buttonCallback:o||null,url:r||null,dismissCallback:a||null,reDisplay:!a,displayDeactive:!0,logAsError:!0,errorCode:s||0};this._contextActivationMgr.displayNotification(l),this._contextActivationMgr.raiseOsfControlStatusChange(this)},t.prototype._refresh=function(e){this.deActivate(),this.activate(e)},t.prototype._setCachedFlag=function(e){this._contextActivationMgr._setCachedFlag(e)},t.prototype._getCachedFlag=function(e){return this._contextActivationMgr._getCachedFlag(e)},t.prototype._deleteCachedFlag=function(e){this._contextActivationMgr._deleteCachedFlag(e)},t.prototype._notifyHostIFrameOnLoaded=function(){this._contextActivationMgr._notifyHost&&!this._iframeLoadedNotified&&(this._contextActivationMgr._notifyHost(this._id,e.AgaveHostAction.PageIsReady),this._iframeLoadedNotified=!0)},t.prototype._addETokenAsQueryParameter=function(t){var n=document.createElement("a");n.href=t;var i=this.getEToken(),o=e.Constants.ETokenParameterName+"="+encodeURIComponent(e.OUtil.encodeBase64(i)),r=n.search.length>1?n.search.substr(1)+"&":"";n.search=r+o;var a=n.href;return n=null,a},t.prototype._addAsQueryParameter=function(e,t,n){var i=document.createElement("a");i.href=e;var o=encodeURIComponent(t)+"="+encodeURIComponent(n),r=i.search.length>1?i.search.substr(1)+"&":"";i.search=r+o;var a=i.href;return i=null,a},t.prototype._activate=function(t,n){var i=this;if(Telemetry.AppLoadTimeHelper.PageStart(this._telemetryContext),this._storeType===e.StoreType.Sdx){var o=performance.now(),r=!1,a=!1,s=!1,l=function(){s||(s=!0,Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("SDX Activation Duration = "+(performance.now()-i._sdxTelemetryContext.activationStart)+".",null,523642530),OfficeExt.SDXCatalog.recordActivationActivity(!0,i._sdxTelemetryContext),i._solutionId.toLowerCase()===e.SdxAssetIds.ExperimentationSdx&&setTimeout((function(){return i.deActivate()}),6e4))};this._iframeOnLoadDelegate=Function.createDelegate(this,(function(){this._sdxTelemetryContext.iframeOnLoadReceived=performance.now(),r||(r=!0,OfficeExt.SDXCatalog.recordActivity("PageLoad",o,!0,[{name:"OsfControlId",string:this._id},{name:"AssetId",string:this._solutionId}]),a&&l()),this._iframeOnLoad.apply(this,arguments)})),this._iframeOnGetAppContextDelegate=function(){a||(a=!0,OfficeExt.SDXCatalog.recordActivity("OfficeJsReady",o,!0,[{name:"OsfControlId",string:i._id},{name:"AssetId",string:i._solutionId}]),r&&l())}}this._setIframeAttribute(t,n),this._pageIsReadyTimerExpired=!1,e.OUtil.addEventListener(t,"load",this._iframeOnLoadDelegate),this._div.appendChild(t),this._status=e.OsfControlStatus.Activated,e.OUtil.writeProfilerMark(e.OsfControlActivationPerfMarker.ActivationEnd),this._contextActivationMgr.raiseOsfControlStatusChange(this),Telemetry.AppLoadTimeHelper.OfficeJSStartToLoad(this._telemetryContext)},t.prototype._setIframeAttribute=function(t,n){this._storeType!==e.StoreType.Sdx&&(n=this._addETokenAsQueryParameter(n));var i=this._contextActivationMgr.getClientId()+"_"+this._contextActivationMgr.getDocUrl()+"_"+this._id,o=e.OUtil.getFrameName(i);this._conversationId=e.OUtil.generateConversationId();var r=this._hostInfoFlags;Telemetry.PrivacyRules.IsPrivateAddin(this._ownerAddinStoreType||this._storeType,this._assetId,this._exchangeExtensionProviderName,this._exchangeExtensionType,this._storeId)||(r|=e.HostInfoFlags.PublicAddin),e.OUtil.isChangeGateEnabled("OfficeVSO:0_IsMosFlag")&&this.getIsMos()&&(r|=e.HostInfoFlags.IsMos);var a=[this._contextActivationMgr._hostType,this._contextActivationMgr._hostPlatform,this._contextActivationMgr._hostSpecificFileVersion,this._contextActivationMgr._appUILocale,this.getCorrelationId(),this._isDialog?"isDialog":null,this._contextActivationMgr._disableLogging?"disableLogging":null,r].join("|"),s=n,l=window.location.origin;if(void 0===l||l&&"null"===l){var c=e.OUtil.parseUrl(window.location.href);l=c.protocol+"//"+c.hostname+(c.port?":"+c.port:"")}var u=this._conversationId+"|"+this._id+"|"+(l.indexOf("$")>=0?encodeURIComponent(l):l),d={};if(d[e.WindowNameItemKeys.BaseFrameName]=o,d[e.WindowNameItemKeys.HostInfo]=a,d[e.WindowNameItemKeys.XdmInfo]=u,d[e.WindowNameItemKeys.SerializerVersion]=e.SerializerVersion.Browser,d[e.WindowNameItemKeys.Flights]=JSON.stringify(e.Flights),d[e.WindowNameItemKeys.DisabledChangeGates]=JSON.stringify(e.DisabledChangeGates),this._contextActivationMgr._enableOfficeJsUrlParam&&this._contextActivationMgr._officeJsUrl&&(this.isFirstParty()||this._contextActivationMgr._isBlueChicken)&&(d[e.WindowNameItemKeys.OfficeJsUrl]=this._contextActivationMgr._officeJsUrl),this._solutionId.toLowerCase()===e.SdxAssetIds.ExperimentationSdx&&this.addProperty("sdxTelemetryContext",JSON.stringify(this._sdxTelemetryContext)),this._contextActivationMgr._enable3rdPartySetAppContextInIframeName||this.isFirstParty()&&!this.isFirstPartyOptOutAppContextOptimization()){var p=this.getAppContext(),f=JSON.stringify(p).length;Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("AppContext length is: "+f,this.getCorrelationId(),523642531),f<e.MaxAppContextLength?(d[e.WindowNameItemKeys.AppContext]=p,this._appContextIsSetToIframeName=!0):Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("We got a huge appContext exceeding maximum, appContext length is: "+f,this.getCorrelationId(),523642560)}var m=e.OUtil.getLocalStorage();if(m){var h="CustomFunctionsRuntimeLogging",g=m.getItem(h);g&&(d[h]=g)}this._contextActivationMgr._getServiceEndPoint().registerConversation(this._conversationId,s,this._appDomains,this._id),t.setAttribute("src",s),this._sdxTelemetryContext.iframeUrl=s,this._agaveWindowName=OfficeExt.WACUtils.serializeObjectToString(d),t.setAttribute("name",this._agaveWindowName),e.OUtil.addClass(t,"AddinIframe"),this._agavePageUrl=s},t.prototype.getAppContext=function(){var t=this.getEToken(),n=0;if(this._contextActivationMgr._hostSpecificFileVersion&&-1!=this._contextActivationMgr._hostSpecificFileVersion.indexOf(".")){var i=this._contextActivationMgr._hostSpecificFileVersion.split("."),o=i[1];isNaN(o)||(n=parseInt(i[1]))}var r=this._contextActivationMgr._requirementsChecker._getSupportedSet(),a=void 0;this._contextActivationMgr._appTheme&&(a={bodyBackgroundColor:this._contextActivationMgr._appTheme.semanticColors.bodyBackground,bodyForegroundColor:this._contextActivationMgr._appTheme.semanticColors.bodyText,controlBackgroundColor:this._contextActivationMgr._appTheme.semanticColors.buttonBackground,controlForegroundColor:this._contextActivationMgr._appTheme.semanticColors.buttonText});var s=new e.OfficeAppContext(this.getSolutionId(),this._contextActivationMgr._appName,this._contextActivationMgr._appVersion,this._contextActivationMgr._appUILocale,this._contextActivationMgr._dataLocale,this._contextActivationMgr._docUrl||"",this._contextActivationMgr._clientMode,this.getSettings(),this.getReason(),this.getOsfControlType(),t,this._appCorrelationId,this.getID(),!1,!0,n,r,this.getHostCustomMessage(),this._contextActivationMgr._hostFullVersion||e.Constants.FileVersion,window.innerHeight,window.innerWidth,this.getManifest()?this.getManifest().getDefaultDisplayName():null,this._appDomains,void 0,this.getFeatureGates(),a,this._initialDisplayMode,this.getHostSettings());if(s._wacHostEnvironment=this._contextActivationMgr._wacHostEnvironment||"0",s._isFromWacAutomation=!!this._contextActivationMgr._isFromWacAutomation,s._addInSourceLocationSubdomainAllowedIsEnabled=!0,s._addInSourceUrl=this._agavePageUrl,s._isPowerPointModernSlideShowEnabled=!1,this._contextActivationMgr._appSettings&&void 0!==this._contextActivationMgr._appSettings.PowerPointModernSlideShowEnabled&&(s._isPowerPointModernSlideShowEnabled=this._contextActivationMgr._appSettings.PowerPointModernSlideShowEnabled),s._marketplaceType=this._ownerAddinStoreType||this._storeType,e.OUtil.checkFlight(e.FlightTreatmentNames.ContextSlideShowEnvironmentEnabled)&&s._isPowerPointModernSlideShowEnabled&&s._appName==e.AppName.PowerpointWebApp&&s._clientMode==e.ClientMode.ReadOnly&&s._osfControlType==e.OsfControlType.DocumentLevel&&this._contextActivationMgr._appSettings){var l=this._contextActivationMgr._appSettings.PowerPointModernSlideShowUiHost||e.PowerPointSlideShowUIHostType.Unknown,c=this._contextActivationMgr._appSettings.PowerPointModernSlideShowCurrentRole||e.PowerPointSlideShowRole.Presenter,u=this._contextActivationMgr._appSettings.PowerPointModernSlideShowTeamsCallId||"",d=(l==e.PowerPointSlideShowUIHostType.MSTeams||l==e.PowerPointSlideShowUIHostType.TeamsAndroid||l==e.PowerPointSlideShowUIHostType.TeamsiOS)&&""!=u;s._slideShowEnvironment={uiHostType:l,currentRole:c,teamsCallId:u,isTeamsPPTLive:d}}var p=this._contextActivationMgr._uiHostSupportsAuthTokenAddinList;if(p){var f=this.getSolutionId();f&&(f=f.toLowerCase());for(var m=0;m<p.length;m++)if(f===p[m]){s._wopiHostOriginForSingleSignOn=this._contextActivationMgr._wopiHostOriginFromWacPropBag;break}}return s},t.prototype.ensureAgaveEndPoint=function(){if(!this._agaveEndPoint){var t=this._conversationId+e.SharedConstants.NotificationConversationIdSuffix;this._agaveEndPoint=Microsoft.Office.Common.XdmCommunicationManager.connect(t,this._frame.contentWindow,this._iframeUrl)}},t.prototype._getConversationId=function(){return this._conversationId},t.prototype._doesBrowserSupportRequiredFeatures=function(){var e=!1;if(Object.defineProperty)try{Object.defineProperty({},"myTestProperty",{get:function(){return this.desc},set:function(e){this.desc=e}}),e=!0}catch(e){}return e},t.prototype._isAddinCommands=function(e){if(this._isvirtualOsfControl)e(!0);else if(this._contextActivationMgr._enableAddinCommands&&this._contextActivationMgr._enableTaskpaneUpgradeToAppCommand&&null!=this._virtualOsfControlActivationCallback){var t={solutionId:this._solutionId,version:this._version,storeType:this._storeType,storeId:this._storeId,targetData:{}};this._contextActivationMgr.isAddinCommandsAsync(t,(function(t,n,i){e(n)}))}else e(!1)},t}();e.OsfControl=t}(OSF||(OSF={})),function(e){var t=function(){function t(){}return t.getAll=function(){var n=[],i=[];return e.OsfCache.get(e.OsfCache.c_osfCacheTableName,t.c_osfExtendedManifestIdsCacheKey).then((function(t){return t?(JSON.parse(t).forEach((function(t){i.push(e.OsfCache.get(e.OsfCache.c_extendedManifestTableName,t).then((function(e){if(e){var i={addinId:t,extendedManifest:JSON.parse(e)};n.push(i)}})))})),Promise.all(i)):null})).then((function(){return n}))},t.get=function(t){return e.OsfCache.get(e.OsfCache.c_extendedManifestTableName,t).then((function(e){return e?{addinId:t,extendedManifest:JSON.parse(e)}:null}))},t.set=function(n,i){var o=this,r=JSON.stringify(JSON.parse(i)),a=[];return e.OsfCache.get(e.OsfCache.c_osfCacheTableName,t.c_osfExtendedManifestIdsCacheKey).then((function(e){return e?(a=JSON.parse(e)).indexOf(n)<0?(a.push(n),o.setExtendedManifestHelper(a,n,r,!1)):o.setExtendedManifestHelper(a,n,r,!0):(a.push(n),o.setExtendedManifestHelper(a,n,r,!1))}))},t.clear=function(n){var i=this,o=[];return e.OsfCache.get(e.OsfCache.c_osfCacheTableName,t.c_osfExtendedManifestIdsCacheKey).then((function(e){if(e){var t=(o=JSON.parse(e)).indexOf(n);if(!(t<0))return o.splice(t,1),i.clearExtendedManifestHelper(o,n);Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("The addin to be removed isn't in cache",null,572926110)}else Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("The addin to be removed isn't in cache",null,572926111)}))},t.wasExtendedManifestAlreadyFetched=function(e){return t.s_fetchedExtendedManifestIdsInMemory&&t.s_fetchedExtendedManifestIdsInMemory.indexOf(e)>=0},t.onChanged=function(e){t.s_onCacheChangedCallbacks.push(e)},t.clearExtendedManifestHelper=function(n,i){return e.OsfCache.remove(e.OsfCache.c_extendedManifestTableName,i).then((function(){var o=t.s_fetchedExtendedManifestIdsInMemory.indexOf(i);return t.s_fetchedExtendedManifestIdsInMemory.splice(o,1),e.OsfCache.set(e.OsfCache.c_osfCacheTableName,t.c_osfExtendedManifestIdsCacheKey,JSON.stringify(n)).then((function(){t.processCallbacks()}))}))},t.setExtendedManifestHelper=function(n,i,o,r){return r?e.OsfCache.get(e.OsfCache.c_extendedManifestTableName,i).then((function(n){if(o!=n)return e.OsfCache.set(e.OsfCache.c_extendedManifestTableName,i,o).then((function(){t.processCallbacks()}))})):e.OsfCache.set(e.OsfCache.c_extendedManifestTableName,i,o).then((function(){return t.s_fetchedExtendedManifestIdsInMemory.push(i),e.OsfCache.set(e.OsfCache.c_osfCacheTableName,t.c_osfExtendedManifestIdsCacheKey,JSON.stringify(n)).then((function(){t.processCallbacks()}))}))},t.processCallbacks=function(){t.s_onCacheChangedCallbacks.forEach((function(e){e()}))},t.c_osfExtendedManifestIdsCacheKey="OsfExtendedManifestIds",t.s_fetchedExtendedManifestIdsInMemory=[],t.s_onCacheChangedCallbacks=[],t}();e.OsfExtendedManifestCache=t,t.onChanged((function(){e.ActionMetadataManager.init(!1)}))}(OfficeExt||(OfficeExt={})),function(e){e[e.Short=0]="Short",e[e.Long=1]="Long"}(RuntimeLifeTime||(RuntimeLifeTime={})),function(e){!function(t){var n=function(){};t.RuntimeOverride=n,t.Runtime=function(){this.Resid=null,this.LifeTime=RuntimeLifeTime.Short,this.Overrides=[]};var i=function(){function e(e){this._appName=e,this._minVersion=null}return e.prototype.getAppName=function(){return this._appName},e.prototype.getMinVersion=function(){return this._minVersion},e.prototype._setMinVersion=function(e){this._minVersion=e},e}();t.HostApp=i;var o=function(){function e(){this._sourceLocations={},this._defaultHeight=null,this._defaultWidth=null}return e.prototype.getDefaultHeight=function(){return this._defaultHeight},e.prototype.getDefaultWidth=function(){return this._defaultWidth},e.prototype.getSourceLocations=function(){return this._sourceLocations},e.prototype._addSourceLocation=function(e,t){this._sourceLocations[e.toLocaleLowerCase()]=t},e.prototype._setDefaultWidth=function(e){this._defaultWidth=e},e.prototype._setDefaultHeight=function(e){this._defaultHeight=e},e}();t.ExtensionSettings=o;var r=function(){function e(){this._resource=null,this._scopes=null}return e.prototype.getResource=function(){return this._resource},e.prototype.getScopes=function(){return this._scopes},e}();t.WebAppInfoAuthorization=r;var a=function(){function e(){this._equivalentAddins=[]}return e.prototype.isXLLCompatible=function(){for(var e=0;e<this._equivalentAddins.length;e++)if(this._equivalentAddins[e].isXLLCompatible())return!0;return!1},e.prototype.add=function(e){this._equivalentAddins.push(e)},e.prototype.getEquivalentAddins=function(){return this._equivalentAddins},e}();t.EquivalentAddins=a;var s=function(){function e(){this._progId=null,this._displayName=null,this._fileName=null,this._type=null}return e.prototype.getProgId=function(){return this._progId},e.prototype.getDisplayName=function(){return this._displayName},e.prototype.getFileName=function(){return this._fileName},e.prototype.getType=function(){return this._type},e.prototype.isXLLCompatible=function(){return"XLL"==this._type},e.prototype.isComAddin=function(){return"COM"==this._type},e}();t.EquivalentAddin=s;var l=function(){function e(){this._runtimes=[]}return e.prototype.getSharedRuntime=function(e){if(null==e||null==this._runtimes)return null;for(var t=0;t<this._runtimes.length;t++)if(null!=this._runtimes[t]&&this._runtimes[t].Resid===e)return this._runtimes[t];return null},e.prototype.add=function(e){if(null!=e&&null!=this._runtimes){if(null!=this.getSharedRuntime(e.Resid))throw OsfMsAjaxFactory.msAjaxError.argument("Manifest parser failure: cannot have same Resid for different runtime.");this._runtimes.push(e)}},e.prototype.getRuntimes=function(){return this._runtimes},e}();t.Runtimes=l;var c=function(){function t(t,n,i,o){if(this._UILocale=n||"en-us",e.OUtil.isNullOrUndefined(o)||(this._solutionRef=o),i&&i===e.PayloadType.MosAcquisition)this._payloadType=e.PayloadType.MosAcquisition;else{if(this._payloadType=e.PayloadType.OfficeAddin,"string"!=typeof t)return void t(this);var r;this._displayNames={},this._descriptions={},this._iconUrls={},this._supportUrls={},this._extensionSettings={},this._highResolutionIconUrls={},this._versionOverrides={},this._ribbonExtensionControls={},this._localesSeen={},this._xmlProcessor=new e.XmlProcessor(t,e.ManifestNamespaces[1.1]),this._xmlProcessor.selectSingleNode("o:OfficeApp")?(r=function(){var e=this._xmlProcessor.selectSingleNode("o:Hosts",s);this._hosts=this._parseHosts(e),e&&(this._hostsXml=e.xml||e.outerHTML);e=this._xmlProcessor.selectSingleNode("o:Requirements",s),this._requirements=this._parseRequirements(e),e&&(this._requirementsXml=e.xml||e.outerHTML);(e=this._xmlProcessor.selectSingleNode("o:HighResolutionIconUrl",s))&&this._parseLocaleAwareSettings(e,Function.createDelegate(this,this._addHighResolutionIconUrl))},this._manifestSchemaVersion=e.ManifestSchemaVersion[1.1]):(this._xmlProcessor=new e.XmlProcessor(t,e.ManifestNamespaces["1.0"]),r=function(){var e=this._xmlProcessor.selectSingleNode("o:Capabilities",s),t=this._xmlProcessor.selectNodes("o:Capability",e);this._capabilities=this._parseCapabilities(t)},this._manifestSchemaVersion=e.ManifestSchemaVersion["1.0"]);var a=this._xmlProcessor.getDocumentElement();this._target=e.OUtil.parseEnum(this.getNodeXsiType(a),e.OfficeAppType);var s=this._xmlProcessor.selectSingleNode("o:OfficeApp");if(a=this._xmlProcessor.selectSingleNode("o:Id",s),this._id=this._xmlProcessor.getNodeValue(a),this.isForOfficeAppManifest()&&(this._id=this._id.replace(/\{|\}/gi,"")),!new RegExp("^[a-f0-9]{8}(-[a-f0-9]{4}){3}-[a-f0-9]{12}$","i").test(this._id))throw OsfMsAjaxFactory.msAjaxError.argument("Manifest");a=this._xmlProcessor.selectSingleNode("o:Version",s);try{this._version=this.complementVersion(this._xmlProcessor.getNodeValue(a))}catch(e){this._version=this._xmlProcessor.getNodeValue(a)}if(a=this._xmlProcessor.selectSingleNode("o:ProviderName",s),this._providerName=this._xmlProcessor.getNodeValue(a),a=this._xmlProcessor.selectSingleNode("o:IdIssuer",s),this._idIssuer=this._parseIdIssuer(a),(a=this._xmlProcessor.selectSingleNode("o:AlternateId",s))&&(this._alternateId=this._xmlProcessor.getNodeValue(a)),a=this._xmlProcessor.selectSingleNode("o:DefaultLocale",s),this._defaultLocale=this._xmlProcessor.getNodeValue(a),a=this._xmlProcessor.selectSingleNode("o:DisplayName",s),this._parseLocaleAwareSettings(a,Function.createDelegate(this,this._addDisplayName)),a=this._xmlProcessor.selectSingleNode("o:Description",s),this._parseLocaleAwareSettings(a,Function.createDelegate(this,this._addDescription)),a=this._xmlProcessor.selectSingleNode("o:AppDomains",s),this._appDomains=this._parseAppDomains(a),(a=this._xmlProcessor.selectSingleNode("o:IconUrl",s))&&this._parseLocaleAwareSettings(a,Function.createDelegate(this,this._addIconUrl)),this.isForOfficeAppManifest()&&(a=this._xmlProcessor.selectSingleNode("o:SupportUrl",s))&&this._parseLocaleAwareSettings(a,Function.createDelegate(this,this._addSupportUrl)),(a=this._xmlProcessor.selectSingleNode("o:Signature",s))&&(this._signature=this._xmlProcessor.getNodeValue(a)),this._parseExtensionSettings(),a=this._xmlProcessor.selectSingleNode("o:Permissions",s),this._permissions=this._parsePermission(a),this._allowSnapshot=!0,(a=this._xmlProcessor.selectSingleNode("o:AllowSnapshot",s))&&(this._allowSnapshot=this._parseBooleanNode(a)),this._manifestSchemaVersion===e.ManifestSchemaVersion[1.1]&&this._target!==e.OfficeAppType.MailApp){var l="ov:";this._target==e.OfficeAppType.ContentApp&&(l="c:"),(a=this._xmlProcessor.selectSingleNode(l+"VersionOverrides",s))&&this._parseWebApplicationInfo(this,a,l)}if(this._manifestSchemaVersion===e.ManifestSchemaVersion[1.1]&&this._target==e.OfficeAppType.TaskPaneApp){l="ov:";if(a=this._xmlProcessor.selectSingleNode(l+"VersionOverrides",s)){var c=this._xmlProcessor.selectSingleNode(l+"EquivalentAddins",a);this._equivalentAddins=this._parseEquivalentAddins(c,l)}}if(this._manifestSchemaVersion===e.ManifestSchemaVersion[1.1])(u=this._xmlProcessor.selectSingleNode("ov:VersionOverrides",s))&&(this._manifestSourceLocationOverrides=this._parseSourceLocationOverrides(u));if(this._manifestSchemaVersion===e.ManifestSchemaVersion[1.1]&&this._target==e.OfficeAppType.TaskPaneApp){var u,d=this._xmlProcessor.selectSingleNode("o:ExtendedOverrides",s);if(null!=d&&this._parseExtendedOverrides(d),null!==(u=this._xmlProcessor.selectSingleNode("ov:VersionOverrides",s))){var p=this._xmlProcessor.selectSingleNode("ov:Hosts",u);if(null!==p){var f=this._xmlProcessor.selectNodes("ov:Host",p);if(null!==f)for(var m=f.length,h=0;h<m;h++){var g=this.getNodeXsiType(f[h]);if("Document"===g||"Workbook"===g||"Presentation"===g){this._versionOverrides[g]={};var y=this._xmlProcessor.selectSingleNode("ov:Runtimes",f[h]);y&&(this._versionOverrides[g]._runtimes=this._parseRuntimes(y));var v=new OfficeExt.Parser.AddinCommandsManifestParser(g,"DesktopFormFactor"),S=new OfficeExt.Parser.AddinCommandsManifestParser(g,"AllFormFactors"),_={setErrorMessageForAddin:function(e){OsfMsAjaxFactory.msAjaxDebug.trace("Error parsing app manifest: "+e)}},C=void 0;C=e.OUtil.isChangeGateEnabled("OfficeVSO:0_ParseExtensionSolutionReference")?this._getEntitlement(this._solutionRef):{solutionId:this._id,version:this._version,storeType:null,storeId:null,assetId:null,assetStoreId:null,targetType:null};var A=v.parseExtensions(C,this,_),O=S.parseExtensions(C,this,_);this._versionOverrides[g]._addinCommandsExtensionPoints=A.ExtensionPoints,this._versionOverrides[g]._functionFileResid=A.functionFileResid,this._versionOverrides[g]._customFunctionExtensionPoint=O.ExtensionPoints[0],this._versionOverrides[g]._showTaskpaneControls=this._retrieveAppCommandShowTaskpaneControls(g),this.isForOfficeAppManifest()&&(this._versionOverrides[g]._getStartedNode=A.getStartedNode,this._versionOverrides[g]._resources=A.resources),this._validateShowTaskpaneSharedRuntime(g),this._generateRibbonExtensionControlMap(g)}}}}}r.apply(this)}}return t.prototype.getNodeXsiType=function(t){if(e.OUtil.isChangeGateEnabled("OfficeVSO:0_FixManifestXsiTypeNamespace")){var n=this._xmlProcessor.getNamespaceMapping(),i=e.OUtil.isNullOrUndefined(n)?null:n.xsi;if(!e.OUtil.isNullOrUndefined(i))return t.getAttributeNS(i,"type")}return t.getAttribute("xsi:type")},t.prototype.getSourceLocationOverrideByResourceId=function(e){return e&&this._manifestSourceLocationOverrides?this._manifestSourceLocationOverrides[e]:null},t.prototype.getManifestSchemaVersion=function(){return this._manifestSchemaVersion},t.prototype.getMarketplaceID=function(){return this._id},t.prototype.getMarketplaceVersion=function(){return this._version},t.prototype.getDefaultLocale=function(){return this._defaultLocale},t.prototype.getLocale=function(){return this._UILocale},t.prototype.getProviderName=function(){return this._providerName},t.prototype.getIdIssuer=function(){return this._idIssuer},t.prototype.getAlternateId=function(){return this._alternateId},t.prototype.getSignature=function(){return this._signature},t.prototype.getCapabilities=function(){return this._capabilities},t.prototype.getDisplayName=function(e){return this._displayNames[e.toLocaleLowerCase()]},t.prototype.getDefaultDisplayName=function(){return this._getDefaultValue(this._displayNames)},t.prototype.getDescription=function(e){return e=this._fixLocaleCasing(e),this._descriptions[e]},t.prototype.getDefaultDescription=function(){return this._getDefaultValue(this._descriptions)},t.prototype.getIconUrl=function(e){return e=this._fixLocaleCasing(e),this._iconUrls[e]},t.prototype.getDefaultIconUrl=function(){return this._getDefaultValue(this._iconUrls)},t.prototype.getSupportUrl=function(e){return e=this._fixLocaleCasing(e),this._supportUrls[e]},t.prototype.getDefaultSupportUrl=function(){return this._getDefaultValue(this._supportUrls)},t.prototype.getSourceLocation=function(e,t){return this._getExtensionSetting(t).getSourceLocations()[e.toLocaleLowerCase()]},t.prototype.getDefaultSourceLocation=function(e){var t=this._getExtensionSetting(e).getSourceLocations();return this._getDefaultValue(t)},t.prototype.getDefaultWidth=function(e){return this._getExtensionSetting(e).getDefaultWidth()},t.prototype.getDefaultHeight=function(e){return this._getExtensionSetting(e).getDefaultHeight()},t.prototype.getTarget=function(){return this._target},t.prototype.getOmexTargetCode=function(){switch(this._target){case e.OfficeAppType.ContentApp:return 2;case e.OfficeAppType.TaskPaneApp:return 1;case e.OfficeAppType.MailApp:return 3;default:return 0}},t.prototype.getPermission=function(){return this._permissions},t.prototype.hasPermission=function(e){return(this._permissions&e)===e},t.prototype.getHosts=function(){return this._hosts},t.prototype.getHostsXml=function(){return this._hostsXml},t.prototype.getPayloadType=function(){return this._payloadType},t.prototype.getRequirements=function(){return this._requirements},t.prototype.getRequirementsXml=function(){return this._requirementsXml},t.prototype.getHighResolutionIconUrl=function(e){return e=this._fixLocaleCasing(e),this._highResolutionIconUrls[e]},t.prototype.getDefaultHighResolutionIconUrl=function(){return this._getDefaultValue(this._highResolutionIconUrls)},t.prototype.getAppDomains=function(){return this._appDomains},t.prototype.getInMemoryEToken=function(){return this._inMemoryEToken},t.prototype.isAllowSnapshot=function(){return this._allowSnapshot},t.prototype.addManifestUrl=function(e){var t=OfficeExt.WACUtils.getDomainForUrl(e);-1===this._appDomains.indexOf(t)&&this._appDomains.push(t)},t.prototype.getWebApplicationResource=function(){return this._webApplicationResource},t.prototype.getWebApplicationId=function(){return this._webApplicationId},t.prototype.getWebApplicationMsaId=function(){return this._webApplicationMsaId},t.prototype.getWebApplicationScopes=function(){return this._webApplicationScopes},t.prototype.getWebApplicationAuthorizations=function(){return this._webApplicationAuthorizations},t.prototype.getEquivalentAddins=function(){return this._equivalentAddins?this._equivalentAddins.getEquivalentAddins():[]},t.prototype.isXLLCompatible=function(){return!!this._equivalentAddins&&this._equivalentAddins.isXLLCompatible()},t.prototype.isSSOAddin=function(){return!!this._webApplicationResource&&!!this._webApplicationId},t.prototype.containsAddinCommands=function(e){var t=this._getCurrentHostTypeNode(e);if(null!==t&&null!=this._xmlProcessor.selectSingleNode("ov:DesktopFormFactor",t))return!0;return!1},t.prototype.getRibbonExtensionControlMap=function(){return this._ribbonExtensionControls},t.prototype.getExtendedOverrides=function(){return this._extendedOverrides},t.prototype.getExtendedOverridesTokens=function(){return this._extendedOverridesTokens?this._extendedOverridesTokens:[]},t.prototype.containsCustomFunctions=function(e){var t=this._getCurrentHostTypeNode(e);if(null!==t){var n=this._xmlProcessor.selectSingleNode("ov:AllFormFactors",t);if(null!==n){var i=this._xmlProcessor.selectNodes("ov:ExtensionPoint",n);if(null!==i)for(var o=i.length,r=0;r<o;r++){if("CustomFunctions"===this.getNodeXsiType(i[r]))return!0}}}return!1},t.prototype.containsCustomFunctionsForAppHost=function(t){var n=e.getManifestHostType(t);return t!=e.HostType.Outlook&&this.containsCustomFunctions(n)},t.prototype.getSharedRuntimeForCustomFunctions=function(e){if(null==e||null==this._versionOverrides)return null;var t=this._versionOverrides[e];return null==t||null==t._customFunctionExtensionPoint||null==t._runtimes?null:t._runtimes.getSharedRuntime(t._customFunctionExtensionPoint.pageResId)},t.prototype.getSharedRuntimeForTaskpane=function(e,t){if(null==e||null==t||null==this._versionOverrides)return null;var n=this._versionOverrides[e];if(null==n||null==n._showTaskpaneControls||null==n._runtimes)return null;var i=null;return this._iterateAppCommandShowTaskpaneControls(n._showTaskpaneControls,(function(e){return null!=e&&null!=e.action&&((e.action.taskpaneId===t||e.id===t)&&(i=e.action.sourceLocationResid,!0))})),null==i?null:n._runtimes.getSharedRuntime(i)},t.prototype.getTaskpaneIdByRuntimeId=function(e,t){if(null==e||null==t||null==this._versionOverrides)return null;var n=this._versionOverrides[e];if(null==n||null==n._showTaskpaneControls||null==n._runtimes)return null;var i=null;return this._iterateAppCommandShowTaskpaneControls(n._showTaskpaneControls,(function(e){return null!=e&&null!=e.action&&(e.action.sourceLocationResid===t&&(i=e.action.taskpaneId,!0))})),i},t.prototype.getSharedRuntimeById=function(e,t){if(null==this._versionOverrides)return null;var n=this._versionOverrides[e];return null==n||null==n._runtimes?null:n._runtimes.getSharedRuntime(t)},t.prototype.getSharedRuntimeForAppCmdsExecuteFunction=function(e){if(null==e||null==this._versionOverrides)return null;var t=this._versionOverrides[e];return null==t||null==t._runtimes?null:t._runtimes.getSharedRuntime(t._functionFileResid)},t.prototype.getSharedRuntimeId=function(e,t,n){var i=t?this.getSharedRuntimeForAppCmdsExecuteFunction(e):this.getSharedRuntimeForTaskpane(e,n);return null!==i?i.Resid:null},t.prototype.sharedRuntimeHasShortLifeTime=function(e,t){if(null===e||null===t||null===this._versionOverrides)return!1;var n=this._versionOverrides[e];if(null===n||null===n._runtimes)return!1;var i=n._runtimes.getSharedRuntime(t);return null!==i&&i.LifeTime===RuntimeLifeTime.Short},t.prototype.complementVersion=function(e){return RegExp("^[0-9]{1,5}(\\.[0-9]{1,5}){3}$").test(e)||(RegExp("^[0-9]{1,5}(\\.[0-9]{1,5}){2}$").test(e)?e+=".0":RegExp("^[0-9]{1,5}\\.[0-9]{1,5}$").test(e)?e+=".0.0":RegExp("^[0-9]{1,5}$").test(e)&&(e+=".0.0.0")),e},t.prototype.isForOfficeAppManifest=function(){return!1},t.prototype.converterLogging=function(){return!1},t.prototype.getSolutionReference=function(){return this._solutionRef},t.prototype.addLocaleSeen=function(t){e.OUtil.isNullOrUndefined(t)||(this._localesSeen[t.toLowerCase()]=!0)},t.prototype._iterateAppCommandShowTaskpaneControls=function(e,t){if(null!=e&&null!=t)for(var n=0;n<e.length&&!t(e[n]);n++);},t.prototype._generateRibbonExtensionControlMap=function(e){if(null==e||null==this._versionOverrides)return null;var t=this._versionOverrides[e];if(null!=t&&null!=t._addinCommandsExtensionPoints)for(var n=t._addinCommandsExtensionPoints.length,i=0;i<n;i++){var o=t._addinCommandsExtensionPoints[i];if("PrimaryCommandSurface"===o.type&&o.tabs)for(var r=0;r<o.tabs.length;r++){var a=o.tabs[r];this._ribbonExtensionControls[a.id]=a,this._addRibbonControlsToMap(a)}}},t.prototype._addRibbonControlsToMap=function(e){if(e&&e.children)for(var t=0;t<e.children.length;t++){var n=e.children[t];!n||n instanceof OfficeExt.Parser.MenuControl||(this._ribbonExtensionControls[n.id]=n),this._addRibbonControlsToMap(n)}},t.prototype._retrieveAppCommandShowTaskpaneControls=function(e){if(null==e||null==this._versionOverrides)return null;var t=this._versionOverrides[e],n=[];if(null!=t&&null!=t._addinCommandsExtensionPoints)for(var i=t._addinCommandsExtensionPoints.length,o=0;o<i;o++){var r=t._addinCommandsExtensionPoints[o];if(null!=r)if("PrimaryCommandSurface"===r.type){if(null==r.tabs)continue;for(var a=0;a<r.tabs.length;a++){var s=r.tabs[a];if(null!=s&&null!=s.children)for(var l=0;l<s.children.length;l++){var c=s.children[l];null!=c&&null!=c.children&&this._getShowTaskpaneControlsFromControlsParent(c,n)}}}else if("ContextMenu"===r.type){if(null==r.children)continue;var u=r.children[0];if(null==u||null==u.children)continue;this._getShowTaskpaneControlsFromControlsParent(u,n)}}return n},t.prototype._getShowTaskpaneControlsFromControlsParent=function(e,t){if(null!=e&&null!=e.children&&null!=t)for(var n=0;n<e.children.length;n++){var i=e.children[n];if(null!=i)if("Button"===i.controlType)null!=i.action&&"ShowTaskpane"===i.actionType&&t.push(i);else{if(null==i.children)continue;for(var o=0;o<i.children.length;o++){var r=i.children[o];null!=r&&null!=r.action&&"ShowTaskpane"===r.actionType&&t.push(r)}}}},t.prototype._validateShowTaskpaneSharedRuntime=function(e){if(null!=e&&null!=this._versionOverrides){var t=this._versionOverrides[e];if(null!=t&&null!=t._runtimes&&null!=t._showTaskpaneControls){var n=[];this._iterateAppCommandShowTaskpaneControls(t._showTaskpaneControls,(function(e){if(null==e||null==e.action)return!1;var i=t._runtimes.getSharedRuntime(e.action.sourceLocationResid),o=null;if(null==i||i.LifeTime!=RuntimeLifeTime.Long){if(null==e.action.taskpaneId)return!1}else o=i.Resid;for(var r=new Array(e.action.taskpaneId,o),a=!0,s=0;s<n.length;s++){if(n[s][0]==r[0]&&n[s][1]==r[1]){if(null==r[0])throw OsfMsAjaxFactory.msAjaxError.argument("Manifest parser failure: resid and taskpaneid not correct");a=!1;break}if(n[s][1]==r[1]&&null!=n[s][1]||n[s][0]==r[0]&&null!=n[s][0])throw a=!1,OsfMsAjaxFactory.msAjaxError.argument("Manifest parser failure: resid and taskpaneid not correct")}return a&&n.push(r),!1}))}}},t.prototype._getDefaultValue=function(e){var t;if(this._UILocale&&(t=e[this._UILocale]||e[this._UILocale.toLocaleLowerCase()]||void 0),!t&&this._defaultLocale&&(t=e[this._defaultLocale]||e[this._defaultLocale.toLocaleLowerCase()]||void 0),!t){var n;for(var i in e){n=i;break}t=e[n]}return t},t.prototype._getExtensionSetting=function(e){var t;if(void 0!==this._extensionSettings[e])t=this._extensionSettings[e];else for(var n in this._extensionSettings){t=this._extensionSettings[n];break}return t},t.prototype._addDisplayName=function(e,t){this._displayNames[e.toLocaleLowerCase()]=t},t.prototype._addDescription=function(e,t){e=this._fixLocaleCasing(e),this._descriptions[e]=t},t.prototype._addIconUrl=function(e,t){e=this._fixLocaleCasing(e),this._iconUrls[e]=t},t.prototype._addSupportUrl=function(e,t){e=this._fixLocaleCasing(e),this._supportUrls[e]=t},t.prototype._fixLocaleCasing=function(t){return this.isForOfficeAppManifest()&&!e.OUtil.isNullOrUndefined(t)?t.toLowerCase():t},t.prototype._parseLocaleAwareSettings=function(e,t){if(!e)throw OsfMsAjaxFactory.msAjaxError.argument("Manifest");var n=e.getAttribute("DefaultValue");t(this._defaultLocale,n);var i=this._xmlProcessor.selectNodes("o:Override",e);if(i)for(var o=i.length,r=0;r<o;r++){var a=i[r],s=a.getAttribute("Locale");this.addLocaleSeen(s),t(s,a.getAttribute("Value"))}},t.prototype._parseBooleanNode=function(e){if(e){var t=this._xmlProcessor.getNodeValue(e).toLowerCase();return"true"===t||"1"===t}return!1},t.prototype._parseIdIssuer=function(t){if(t){var n=this._xmlProcessor.getNodeValue(t);return e.OUtil.parseEnum(n,e.ManifestIdIssuer)}return e.ManifestIdIssuer.Custom},t.prototype._parseCapabilities=function(t){for(var n,i=[],o=0;o<t.length;o++){n=t[o].getAttribute("Name"),n=e.OUtil.parseEnum(n,e.Capability),i.push(n)}return i},t.prototype._parsePermission=function(t){if(!t)throw OsfMsAjaxFactory.msAjaxError.argument("Manifest");var n=this._xmlProcessor.getNodeValue(t);return e.OUtil.parseEnum(n,e.OsfControlPermission)},t.prototype._parseExtensionSettings=function(){var t,n,i,o=this;for(var r in e.FormFactor){var a=this._xmlProcessor.selectSingleNode("o:OfficeApp");if(n=this._xmlProcessor.selectSingleNode("o:"+e.FormFactor[r],a)){t=new e.Manifest.ExtensionSettings,i=this._xmlProcessor.selectSingleNode("o:SourceLocation",n);this._parseLocaleAwareSettings(i,(function(e,n){t._addSourceLocation(e,n),o.addManifestUrl(n)})),(i=this._xmlProcessor.selectSingleNode("o:RequestedWidth",n))&&t._setDefaultWidth(this._xmlProcessor.getNodeValue(i)),(i=this._xmlProcessor.selectSingleNode("o:RequestedHeight",n))&&t._setDefaultHeight(this._xmlProcessor.getNodeValue(i)),this._extensionSettings[r]=t}}if(!t)throw OsfMsAjaxFactory.msAjaxError.argument("Manifest")},t.prototype._parseHosts=function(e){var t=[];if(e)for(var n=this._xmlProcessor.selectNodes("o:Host",e),i=0;i<n.length;i++)t.push(n[i].getAttribute("Name"));return t},t.prototype._parseWebApplicationInfo=function(e,t,n){var i=this._xmlProcessor.selectSingleNode(n+"WebApplicationInfo",t);if(i){var o=this._xmlProcessor.selectSingleNode(n+"Resource",i);e._webApplicationResource=this._xmlProcessor.getNodeValue(o);var r=this._xmlProcessor.selectSingleNode(n+"Id",i);e._webApplicationId=this._xmlProcessor.getNodeValue(r);var a=this._xmlProcessor.selectSingleNode(n+"MsaId",i);e._webApplicationMsaId=a?this._xmlProcessor.getNodeValue(a):this._webApplicationId;var s=this._xmlProcessor.selectSingleNode(n+"Scopes",i);e._webApplicationScopes=this._parseWebApplicationScopes(s,n),e._webApplicationAuthorizations=this._parseWebAppInfoAuthorizations(i,n)}},t.prototype._parseWebApplicationScopes=function(e,t){var n=[];if(e)for(var i=this._xmlProcessor.selectNodes(t+"Scope",e),o=0;o<i.length;o++)n.push(this._xmlProcessor.getNodeValue(i[o]));return n},t.prototype._parseWebAppInfoAuthorizations=function(t,n){var i=[],o=this._xmlProcessor.selectSingleNode(n+"Authorizations",t);if(o){var r=this._xmlProcessor.selectNodes(n+"Authorization",o);if(r)for(var a=0;a<r.length;a++){var s=r[a],l=new e.Manifest.WebAppInfoAuthorization,c=this._xmlProcessor.selectSingleNode(n+"Resource",s);c&&(l._resource=this._xmlProcessor.getNodeValue(c));var u=this._xmlProcessor.selectSingleNode(n+"Scopes",s);if(u){var d=this._xmlProcessor.selectNodes(n+"Scope",u);if(d){for(var p=[],f=0;f<d.length;f++){var m=d[f];p.push(this._xmlProcessor.getNodeValue(m))}l._scopes=p}}i.push(l)}}return i},t.prototype._parseRequirements=function(t,n){var i={sets:[],methods:[]};if(t){var o=e.OUtil.isNullOrUndefined(n)?"o:":n,r=this._xmlProcessor.selectSingleNode(o+"Sets",t);i.sets=this._parseSets(r,o);var a=this._xmlProcessor.selectSingleNode(o+"Methods",t);i.methods=this._parseMethods(a,o)}return i},t.prototype._parseSets=function(t,n){var i=[];if(t)for(var o=e.OUtil.isNullOrUndefined(n)?"o:":n,r=t.getAttribute("DefaultMinVersion"),a=this._xmlProcessor.selectNodes(o+"Set",t),s=0;s<a.length;s++){var l=a[s],c=l.getAttribute("MinVersion");i.push({name:l.getAttribute("Name"),version:c||r})}return i},t.prototype._parseMethods=function(t,n){var i=[];if(t)for(var o=e.OUtil.isNullOrUndefined(n)?"o:":n,r=this._xmlProcessor.selectNodes(o+"Method",t),a=0;a<r.length;a++)i.push(r[a].getAttribute("Name"));return i},t.prototype._parseSourceLocationOverrides=function(e){var t={};if(e){var n=this._xmlProcessor.selectSingleNode("ov:Resources",e);if(n){var i=this._xmlProcessor.selectSingleNode("bt:Urls",n);if(i){var o=this._xmlProcessor.selectNodes("bt:Url",i);if(o)for(var r=0;r<o.length;r++){var a=o[r],s=a.getAttribute("id"),l=a.getAttribute("DefaultValue");s&&l&&(t[s]=l)}}}}return t},t.prototype._parseAppDomains=function(t){var n=[];if(t)for(var i=this._xmlProcessor.selectNodes("o:AppDomain",t),o=0;o<i.length;o++){var r=this._xmlProcessor.getNodeValue(i[o]);if(e.OUtil.doesUrlHaveSupportedProtocol(r)){var a=OfficeExt.WACUtils.getDomainForUrl(r);-1===n.indexOf(a)&&n.push(a)}}return n},t.prototype._parseRuntimes=function(t){if(null==t)return null;var n=new e.Manifest.Runtimes,i=this._xmlProcessor.selectNodes("ov:Runtime",t);if(null==i)return null;for(var o=0;o<i.length;o++){var r=this._parseRuntime(i[o]);n.add(r)}return n},t.prototype._parseRuntime=function(t){if(null==t)return null;var i=new e.Manifest.Runtime;if(i.Resid=t.getAttribute("resid"),"long"===t.getAttribute("lifetime")?i.LifeTime=RuntimeLifeTime.Long:i.LifeTime=RuntimeLifeTime.Short,this.isForOfficeAppManifest()){var o=this._xmlProcessor.selectNodes("ov:Override",t);if(!e.OUtil.isNullOrUndefined(o)&&Array.isArray(o))for(var r=0;r<o.length;r++){var a=new n;a.Type=t.getAttribute("type"),a.Resid=t.getAttribute("resid"),i.Overrides.add(a)}}return i},t.prototype._parseEquivalentAddins=function(t,n){var i=new e.Manifest.EquivalentAddins;if(t)for(var o=this._xmlProcessor.selectNodes(n+"EquivalentAddin",t),r=0;r<o.length;r++){var a=this._parseEquivalentAddin(o[r],n);i.add(a)}return i},t.prototype._parseEquivalentAddin=function(t,n){var i=new e.Manifest.EquivalentAddin;if(t){var o=this._xmlProcessor.selectSingleNode(n+"ProgId",t);o&&(i._progId=this._xmlProcessor.getNodeValue(o));var r=this._xmlProcessor.selectSingleNode(n+"DisplayName",t);r&&(i._displayName=this._xmlProcessor.getNodeValue(r));var a=this._xmlProcessor.selectSingleNode(n+"FileName",t);a&&(i._fileName=this._xmlProcessor.getNodeValue(a));var s=this._xmlProcessor.selectSingleNode(n+"Type",t);if(!s)throw OsfMsAjaxFactory.msAjaxError.argument("Manifest");var l=""+this._xmlProcessor.getNodeValue(s);i._type=l.toUpperCase()}return i},t.prototype._parseExtendedOverrides=function(t){this._extendedOverrides={url:t.getAttribute("Url"),resourcesUrl:t.getAttribute("ResourcesUrl"),hasFinalUrls:!1};var n=this._xmlProcessor.selectSingleNode("o:Tokens",t);if(null!=n){var i=this._xmlProcessor.selectNodes("o:Token",n);if(null!=i){for(var o=[],r=0;r<i.length;r++){var a=i[r],s=this._xmlProcessor.selectNodes("o:Override",a),l=[],c=this.getNodeXsiType(a);if(c==e.ExtendedManifestSupportTokens.Requirements)for(var u=0;u<s.length;u++){var d=this._xmlProcessor.selectSingleNode("o:Requirements",s[u]),p={value:s[u].getAttribute("Value"),data:this._parseRequirements(d)};l.push(p)}else if(c==e.ExtendedManifestSupportTokens.Locale)for(u=0;u<s.length;u++){p={value:s[u].getAttribute("Value"),data:s[u].getAttribute("Locale").toLowerCase()};l.push(p)}var f={name:a.getAttribute("Name"),defaultValue:a.getAttribute("DefaultValue"),type:this.getNodeXsiType(a),overrides:l};o.push(f)}this._extendedOverridesTokens=o}}},t.prototype._addHighResolutionIconUrl=function(e,t){e=this._fixLocaleCasing(e),this._highResolutionIconUrls[e]=t},t.prototype._isAddinCommandsManifest=function(e){return this.containsAddinCommands(e)||this.containsCustomFunctions(e)},t.prototype._getCurrentHostTypeNode=function(t){if(this._xmlProcessor){var n=this._xmlProcessor.selectSingleNode("o:OfficeApp");if(null!==n&&this.getManifestSchemaVersion()===e.ManifestSchemaVersion[1.1]){var i=this._xmlProcessor.selectSingleNode("ov:VersionOverrides",n);if(null!==i){var o=this._xmlProcessor.selectSingleNode("ov:Hosts",i);if(null!==o){var r=this._xmlProcessor.selectNodes("ov:Host",o);if(null!==r)for(var a=r.length,s=0;s<a;s++){if(this.getNodeXsiType(r[s])===t)return r[s]}}}}}return null},t.prototype._getEntitlement=function(t){if(e.OUtil.isNullOrUndefined(t)){t={solutionId:this._id,version:this._version,storeType:e.StoreType.FileSystem,storeId:this._UILocale,assetId:this._id,assetStoreId:null};this._solutionRef=t}return{solutionId:this._solutionRef.solutionId,version:this._solutionRef.version,storeType:this._solutionRef.storeType,storeId:this._solutionRef.storeId,assetId:this._solutionRef.assetId,assetStoreId:this._solutionRef.assetStoreId,targetType:this._target}},t}();t.Manifest=c}(e.Manifest||(e.Manifest={}))}(OSF||(OSF={})),function(e){var t=function(t){function n(e,n,i,o){var r,a,s=this;if((null===(r=e.titleDefinition.elementDefinitions.officeAddIns)||void 0===r?void 0:r.length)>0){var l=e.titleDefinition.elementDefinitions.officeAddIns[0].xmlDefinition,c=OSF.OUtil.getBOMCodepointLength(l);c>0&&(l=l.substring(c)),(s=t.call(this,l,i,OSF.PayloadType.OfficeAddin,o)||this)._acquisition=e}else(s=t.call(this,"",i,OSF.PayloadType.MosAcquisition,o)||this)._acquisition=e,s._hostInfo=null,s._hostInfo=OfficeExt.CatalogFactory.getHostContext(),OSF.OUtil.isNullOrUndefined(s._hostInfo)||(s._hostType=OSF.getManifestHostType(s._hostInfo.hostType)),(null===(a=e.titleDefinition.elementDefinitions.extensions)||void 0===a?void 0:a.length)>0&&s._populateManifest();return s._actualPayload=n,s}return __extends(n,t),n.fromString=function(t,n,i,o){var r=new e.Acquisition;return r.init(JSON.parse(t)),new this(r,n,i,o)},n.fromAcquisition=function(e,t,n){return new this(e,OSF.PayloadType.MosAcquisition,t,n)},n.prototype._populateManifest=function(){this._initPopulator(),this._populateBaseProperties(),this._populateExtensionSettings(),this._populateAddinCommands(),this._populateWebApplicationInfo()},n.prototype._initPopulator=function(){this._displayNames={},this._descriptions={},this._iconUrls={},this._extensionSettings={},this._highResolutionIconUrls={},this._ribbonExtensionControls={},this._versionOverrides={},this._versionOverrides[this._hostType]={}},n.prototype._populateBaseProperties=function(){this._manifestSchemaVersion="1.1",this._id=this._acquisition.assetId,this._providerName="Microsoft",this._defaultLocale=this._UILocale,this._allowSnapshot=!0,this._idIssuer=OSF.ManifestIdIssuer.Custom,this._addDisplayName(this._UILocale,this._acquisition.titleDefinition.name),this._addDescription(this._UILocale,"Acquisition Sample"),this._populateBaseOfficeAppType(),this._populateBaseVersion(),this._populateBaseDomains(),this._populateBasePermissions(),this._populateRuntimes()},n.prototype._populateBaseOfficeAppType=function(){this._target=OSF.OfficeAppType.TaskPaneApp},n.prototype._populateBaseVersion=function(){try{this._version=this.complementVersion(this._acquisition.titleDefinition.version)}catch(e){this._version=this._acquisition.titleDefinition.version}},n.prototype._populateBasePermissions=function(){this._permissions=OSF.OsfControlPermission.Restricted,this.getControlPermissionsFromMosPermissions()},n.prototype.getControlPermissionsFromMosPermissions=function(){var t=this.getExtensionPermissions();if(!OSF.OUtil.isNullOrUndefined(t))for(var n=0;n<t.resourceSpecific.length;n++){var i=t.resourceSpecific[n];if(i.type===e.ResourceSpecificType.Delegated)switch(i.name){case"Document.Restricted.User":this._permissions<OSF.OsfControlPermission.Restricted&&(this._permissions=OSF.OsfControlPermission.Restricted);break;case"Document.Read.User":this._permissions<OSF.OsfControlPermission.ReadDocument&&(this._permissions=OSF.OsfControlPermission.ReadDocument);break;case"Document.Read.All.User":this._permissions<OSF.OsfControlPermission.ReadAllDocument&&(this._permissions=OSF.OsfControlPermission.ReadAllDocument);break;case"Document.Write.User":this._permissions<OSF.OsfControlPermission.WriteDocument&&(this._permissions=OSF.OsfControlPermission.WriteDocument);break;case"Document.ReadWrite.User":this._permissions<OSF.OsfControlPermission.ReadWriteDocument&&(this._permissions=OSF.OsfControlPermission.ReadWriteDocument)}}},n.prototype._populateBaseDomains=function(){this._appDomains=[]},n.prototype._populateExtensionSettings=function(){var e;for(var t in OSF.FormFactor)(e=new OSF.Manifest.ExtensionSettings)._addSourceLocation(this._UILocale,this._acquisition.titleDefinition.elementDefinitions.extensions[0].runtimes[0].code.page),this.addManifestUrl(this._acquisition.titleDefinition.elementDefinitions.extensions[0].runtimes[0].code.page),this._extensionSettings[t]=e;if(!e)throw OsfMsAjaxFactory.msAjaxError.argument("Manifest")},n.prototype._populateAddinCommands=function(){var e,t=new OfficeExt.Parser.AddinCommandsManifestParser(this._hostType,"DesktopFormFactor"),n={setErrorMessageForAddin:function(e){OsfMsAjaxFactory.msAjaxDebug.trace("Error parsing app manifest: "+e)}};e=OSF.OUtil.isChangeGateEnabled("OfficeVSO:0_ParseExtensionSolutionReference")?this._getEntitlement(this._solutionRef):{solutionId:this._id,version:this._version,storeType:null,storeId:null,assetId:this._id,assetStoreId:null,targetType:null};var i=t.parseExtensions(e,this,n);this._versionOverrides[this._hostType]._addinCommandsExtensionPoints=i.ExtensionPoints,this._versionOverrides[this._hostType]._functionFileResid=i.functionFileResid,this._versionOverrides[this._hostType]._showTaskpaneControls=this._retrieveAppCommandShowTaskpaneControls(this._hostType),this._validateShowTaskpaneSharedRuntime(this._hostType),this._generateRibbonExtensionControlMap(this._hostType)},n.prototype._populateWebApplicationInfo=function(){var e=this.getWebApplicationInfo();OSF.OUtil.isNullOrUndefined(e)||(this._webApplicationResource=e.resource,this._webApplicationId=e.id)},n.prototype._populateRuntimes=function(){var e=this.getExtensionRuntimes(),t=new OSF.Manifest.Runtimes;e.forEach((function(e){var n=new OSF.Manifest.Runtime;n.Resid=e.id,n.LifeTime="long"===e.lifetime?RuntimeLifeTime.Long:RuntimeLifeTime.Short,n.LifeTime===RuntimeLifeTime.Long&&t.add(n)})),this._versionOverrides[this._hostType]._runtimes=t},n.prototype.containsAddinCommands=function(e){return this.containsExtension()?null!=this.getExtensionShortcut()||null!=this.getExtensionRibbon()||null!=this.getExtensionContextMenu()||this.getAddinCommandRuntimes().length>0:!!this.containsOfficeAddin()&&t.prototype.containsAddinCommands.call(this,e)},n.prototype.containsCustomFunctions=function(e){return!1},n.prototype.getAcquisition=function(){return this._acquisition},n.prototype.getExtensionRuntimes=function(){var t=[];if(this.containsExtension()&&!OSF.OUtil.isNullOrUndefined(this._acquisition.titleDefinition.elementDefinitions.extensions[0].runtimes))for(var n=0,i=this._acquisition.titleDefinition.elementDefinitions.extensions[0].runtimes;n<i.length;n++){var o=i[n];e.AppMetadata.checkRequirements(o.requirements)&&t.push(o)}return t},n.prototype.getLegacyExtensionRuntime=function(){var t;if(this.containsExtension())for(var n=0,i=this.getExtensionRuntimes();n<i.length;n++){var o=i[n];if(t=o,e.AppMetadata.isLegacyRuntime(o))return o}return t},n.prototype.getAddinCommandRuntimes=function(){var t=[];if(this.containsExtension()&&!OSF.OUtil.isNullOrUndefined(this._acquisition.titleDefinition.elementDefinitions.extensions[0].runtimes))for(var n=0,i=this._acquisition.titleDefinition.elementDefinitions.extensions[0].runtimes;n<i.length;n++){var o=i[n];e.AppMetadata.checkRequirements(o.requirements)&&!e.AppMetadata.isLegacyRuntime(o)&&t.push(o)}return t},n.prototype.getExtensionGetStartedMessage=function(){if(this.containsExtension()&&!OSF.OUtil.isNullOrUndefined(this._acquisition.titleDefinition.elementDefinitions.extensions[0].getStartedMessages))for(var t=0,n=this._acquisition.titleDefinition.elementDefinitions.extensions[0].getStartedMessages;t<n.length;t++){var i=n[t];if(e.AppMetadata.checkRequirements(i.requirements))return i}return null},n.prototype.getExtensionShortcut=function(){if(this.containsExtension()&&!OSF.OUtil.isNullOrUndefined(this._acquisition.titleDefinition.elementDefinitions.extensions[0].shortcuts))for(var t=0,n=this._acquisition.titleDefinition.elementDefinitions.extensions[0].shortcuts;t<n.length;t++){var i=n[t];if(e.AppMetadata.checkRequirements(i.requirements))return i}return null},n.prototype.getExtensionRibbon=function(){if(this.containsExtension()&&!OSF.OUtil.isNullOrUndefined(this._acquisition.titleDefinition.elementDefinitions.extensions[0].ribbons))for(var t=0,n=this._acquisition.titleDefinition.elementDefinitions.extensions[0].ribbons;t<n.length;t++){var i=n[t];if(e.AppMetadata.checkRequirements(i.requirements))return i}return null},n.prototype.getExtensionContextMenu=function(){if(this.containsExtension()&&!OSF.OUtil.isNullOrUndefined(this._acquisition.titleDefinition.elementDefinitions.extensions[0].contextMenus))for(var t=0,n=this._acquisition.titleDefinition.elementDefinitions.extensions[0].contextMenus;t<n.length;t++){var i=n[t];if(e.AppMetadata.checkRequirements(i.requirements))return i}return null},n.prototype.getExtensionAlternatives=function(){if(this.containsExtension()&&!OSF.OUtil.isNullOrUndefined(this._acquisition.titleDefinition.elementDefinitions.extensions[0].alternatives))for(var t=0,n=this._acquisition.titleDefinition.elementDefinitions.extensions[0].alternatives;t<n.length;t++){var i=n[t];if(e.AppMetadata.checkRequirements(i.requirements))return i}return null},n.prototype.getExtensionPermissions=function(){var e,t;return null===(t=null===(e=this._acquisition.titleDefinition)||void 0===e?void 0:e.authorization)||void 0===t?void 0:t.permissions},n.prototype.getExtensionActionById=function(e){for(var t=this.getExtensionRuntimes(),n=0;n<t.length;n++)for(var i=0;i<t[n].actions.length;i++)if(t[n].actions[i].id===e)return t[n].actions[i];return null},n.prototype.getExtensionRuntimeByActionId=function(e){for(var t=0,n=this.getExtensionRuntimes();t<n.length;t++)for(var i=n[t],o=0,r=i.actions;o<r.length;o++){if(r[o].id===e)return i}return null},n.prototype.getSource=function(){return this._acquisition.titleDefinition.ingestionSource},n.prototype.getState=function(){return this._acquisition.acquisitionState},n.prototype.getTitleId=function(){return this._acquisition.titleId},n.prototype.getAssetId=function(){return this._acquisition.assetId},n.prototype.getManifestId=function(){return this._acquisition.manifestId},n.prototype.getScope=function(){return this._acquisition.titleDefinition.scope},n.prototype.getVersion=function(){return this._version},n.prototype.toJSON=function(){return this._acquisition.toJSON()},n.prototype.getWebApplicationInfo=function(){var e,t;return null===(t=null===(e=this._acquisition)||void 0===e?void 0:e.titleDefinition)||void 0===t?void 0:t.webApplicationInfo},n.checkRequirements=function(e){return!0},n.isLegacyRuntime=function(e){var t,n;return!((null===(t=e.actions)||void 0===t?void 0:t.length)>0||(null===(n=e.functions)||void 0===n?void 0:n.length)>0)},n.prototype.containsExtension=function(){var e,t,n;return(null===(n=null===(t=null===(e=this._acquisition)||void 0===e?void 0:e.titleDefinition)||void 0===t?void 0:t.elementDefinitions.extensions)||void 0===n?void 0:n.length)>0},n.prototype.containsOfficeAddin=function(){var e,t,n;return(null===(n=null===(t=null===(e=this._acquisition)||void 0===e?void 0:e.titleDefinition)||void 0===t?void 0:t.elementDefinitions.officeAddIns)||void 0===n?void 0:n.length)>0},n}(OSF.Manifest.Manifest);e.AppMetadata=t}(Mos||(Mos={})),function(e){e.AddinIdInfo=function(t){var n=t.split("|");8!=n.length&&Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("OSF.AddinIdInfo.constructor: Unexpected format of the addinId",null,523355592);var i=n[0],o=n[1],r=n[2],a=n[3],s=n[4],l=null;return"2"!=i&&Telemetry.RuntimeTelemetryHelper.LogCommonMessageTag("OSF.AddinIdInfo.constructor: Unexpected format version: "+i+".",null,523355593),{getSolutionId:function(){return o},getSolutionVersion:function(){return r},getFormatVersion:function(){return i},getStoreTypeId:function(){return a},getStoreLocation:function(){return s},getPrivacyCompliantSolutionId:function(){return null==l&&(l=Telemetry.PrivacyRules.GetPrivacyCompliantId(o,OfficeExt.ManifestUtil.GetStoreTypeName(a),null,null,null,s)),null==l?o:l},needToRestoreManifest:function(){return a==e.StoreTypeEnum.Registry.toString()}}},e.OsfManifestManager=function(){var t={},n="en-us",i={};function o(e,t){return e+"_"+t}return{getManifestAsync:function(n,i){e.OUtil.validateParamObject(n,{osfControl:{type:Object,mayBeNull:!1},referenceInUse:{type:Object,mayBeNull:!1}},i);var r=this,a=n.referenceInUse,s=a.solutionId;null!=n.osfControl&&null!=n.osfControl._sharedRuntimeId&&n.osfControl._sharedRuntimeId.length>0&&(s=e.OsfManifestManager.getSharedRuntimeManifestCacheKey(a.solutionId,n.osfControl._sharedRuntimeId));var l=o(s,a.version),c=t[l];if(n.manifestCached=!1,c)n.manifestCached=!0,r.manifestContainsDownloadResources(c)?r.downloadResourcesAsync(n,i,c,l):i({statusCode:e.ProxyCallStatusCode.Succeeded,value:c,context:n});else if(n.clientEndPoint&&n.manifestUrl){Telemetry.AppLoadTimeHelper.ManifestRequestStart(n.osfControl._telemetryContext);var u={manifestUrl:n.manifestUrl,id:a.solutionId,version:a.version,clearCache:n.clearCache||!1};this._invokeProxyMethodAsync(n,"OEM_getManifestAsync",(function(t){var o;if(t.statusCode===e.ProxyCallStatusCode.Succeeded&&t.value)try{var s;o=t.context.osfControl,"string"==typeof t.value?(t.context.manifestCached=!0,s=t.value):(t.context.manifestCached=t.value.cached,s=t.value.manifest),Telemetry.AppLoadTimeHelper.SetManifestDataCachedFlag(o._telemetryContext,t.value.cached),t.value=new e.Manifest.Manifest(s,o._contextActivationMgr.getAppUILocale()),e.OsfManifestManager.cacheManifest(a.solutionId,a.version,t.value)}catch(e){var u;t.value=null,o&&(u=o._appCorrelationId);var d="Invalid manifest in getManifestAsync.";OfficeExt.WACUtils.logExceptionToBrowserConsole(d,e),Telemetry.RuntimeTelemetryHelper.LogExceptionTag(d,e,u,523355594)}else Telemetry.RuntimeTelemetryHelper.LogExceptionTag("getManifestAsync failed:"+OfficeExt.WACUtils.serializeObjectToString(t),null,null,523355595);r.manifestContainsDownloadResources(c)?r.downloadResourcesAsync(n,i,t.value,l):i(t)}),u)}else i({statusCode:e.ProxyCallStatusCode.Failed,value:null,context:n})},manifestContainsDownloadResources:function(e){return this.manifestContainsExtendedOverrides(e)},manifestContainsExtendedOverrides:function(e){return"object"==typeof e&&"function"==typeof e.getExtendedOverrides&&"object"==typeof e.getExtendedOverrides()},downloadResourcesAsync:function(e,t,n,i){this.manifestContainsExtendedOverrides(n)&&this.downloadExtendedOverridesAsync(e,t,n,i)},downloadExtendedOverridesAsync:function(t,n,i,o){var r=this,a=function(t,n,i,a){var s=t.osfControl._appCorrelationId;OfficeExt.WACUtils.logExceptionToBrowserConsole(a,i),Telemetry.RuntimeTelemetryHelper.LogExceptionTag(a,i,s,523355596),r._cachedManifests&&r._cachedManifests[o]&&(r._cachedManifests[o]=void 0),n({statusCode:e.ProxyCallStatusCode.Failed,value:null,context:t})};this.manifestContainsExtendedOverrides(i)||a(t,n,"Unreachable","Unreachable code path executed!");try{var s=t.osfControl.getInitializationReason()==Microsoft.Office.WebExtension.InitializationReason.Inserted;t.osfControl.processManifestForExtendedOverrides(i,s).then((function(){return function(t,n,i){n({statusCode:e.ProxyCallStatusCode.Succeeded,value:i,context:t})}(t,n,i)})).catch((function(e){return a(t,n,e,"Invalid ExtendedOverrides content.")}))}catch(e){a(t,n,e,"Unexpected exception from OsfControlV2.processManifestForExtendedOverrides()")}},getAppInstanceInfoByIdAsync:function(t,n){e.OUtil.validateParamObject(t,{webUrl:{type:String,mayBeNull:!1},appInstanceId:{type:String,mayBeNull:!1},clientEndPoint:{type:Object,mayBeNull:!1}},n);var i={webUrl:t.webUrl,appInstanceId:t.appInstanceId,clearCache:t.clearCache||!1};this._invokeProxyMethodAsync(t,"OEM_getSPAppInstanceInfoByIdAsync",n,i)},getSPTokenByProductIdAsync:function(t,n){e.OUtil.validateParamObject(t,{appWebUrl:{type:String,mayBeNull:!1},productId:{type:String,mayBeNull:!1}},n);var i=this;t.osfControl._contextActivationMgr._createSharePointIFrameProxy(t.appWebUrl,(function(o){if(o){var r={webUrl:t.appWebUrl,productId:t.productId,clearCache:t.clearCache||!1,clientEndPoint:o};i._invokeProxyMethodAsync(t,"OEM_getSPTokenByProductIdAsync",n,r)}else n({statusCode:e.ProxyCallStatusCode.ProxyNotReady,value:null,context:t})}))},getSPAppEntitlementsAsync:function(t,n){if(e.OUtil.validateParamObject(t,{osfControl:{type:Object,mayBeNull:!1},referenceInUse:{type:Object,mayBeNull:!1},baseUrl:{type:String,mayBeNull:!1},pageUrl:{type:String,mayBeNull:!1},webUrl:{type:String,mayBeNull:!0}},n),t.webUrl)this.getCorporateCatalogEntitlementsAsync(t,n);else{var i=document.createElement("a");i.href=t.pageUrl;var o=i.pathname,r=o.split("/"),a=r.length-1,s=i.href.substring(0,i.href.length-o.length);s&&"/"!==s.charAt(s.length-1)&&(s+="/");for(var l=[s],c=0;c<a;c++)r[c]&&(s=s+r[c]+"/",l.push(s));i=null;var u=this,d=t.osfControl._contextActivationMgr,p=l.pop(),f=function(t){if(t.statusCode===e.ProxyCallStatusCode.Succeeded){var i=t.value;i&&"/"!==i.charAt(i.length-1)&&(i+="/"),d._webUrl=i,t.context.webUrl=i,t.context.appWebUrl=i,u.getCorporateCatalogEntitlementsAsync(t.context,n)}else n(t)},m=function(i){if(i){t.clientEndPoint=i;var o={pageUrl:t.pageUrl,baseUrl:p,clearCache:t.clearCache||!1};u._invokeProxyMethodAsync(t,"OEM_getSPAppWebUrlFromPageUrlAsync",f,o)}else l.length>0?(p=l.pop(),d._createSharePointIFrameProxy(p,m)):n({statusCode:e.ProxyCallStatusCode.Failed,value:null,context:t})};d._createSharePointIFrameProxy(p,m)}},getCorporateCatalogEntitlementsAsync:function(t,n){e.OUtil.validateParamObject(t,{osfControl:{type:Object,mayBeNull:!1},referenceInUse:{type:Object,mayBeNull:!1},webUrl:{type:String,mayBeNull:!1}},n),Telemetry.AppLoadTimeHelper.AuthenticationStart(t.osfControl._telemetryContext);var i=this,o=0,r=function(a){if(a){Telemetry.AppLoadTimeHelper.AuthenticationEnd(t.osfControl._telemetryContext),t.clientEndPoint=a;var s={webUrl:t.webUrl,applicationName:e.HostCapability[t.hostType],officeExtentionTarget:t.noTargetType||t.osfControl.getOsfControlType()===e.OsfControlTarget.TaskPane?null:t.osfControl.getOsfControlType(),clearCache:t.clearCache||!1,supportedManifestVersions:{"1.0":!0,1.1:!0}};i._invokeProxyMethodAsync(t,"OEM_getEntitlementSummaryAsync",n,s)}else o<e.Constants.AuthenticatedConnectMaxTries?(o++,setTimeout((function(){t.osfControl._contextActivationMgr._createSharePointIFrameProxy(t.webUrl,r)}),500)):n({statusCode:e.ProxyCallStatusCode.ProxyNotReady,value:null,context:t})};t.osfControl._contextActivationMgr._createSharePointIFrameProxy(t.webUrl,r)},_invokeProxyMethodAsync:function(t,n,o,r){var a,s=[r.clientEndPoint?r.clientEndPoint._targetUrl:t.clientEndPoint._targetUrl,n];for(var l in r)"string"!==(a=typeof r[l])&&"number"!==a&&"boolean"!==a||s.push(r[l]);var c=s.join("."),u=i,d={onCompleted:o,context:t,methodName:n},p=u[c];if(p)p.push(d);else{u[c]=[d];var f=t.clientEndPoint;r.clientEndPoint&&(f=r.clientEndPoint,delete r.clientEndPoint),t.referenceInUse&&t.referenceInUse.storeType===e.StoreType.OMEX&&(r.officeVersion=e.Constants.ThreePartsFileVersion),f.invoke(n,(function(t,n){var i=null,o=e.ProxyCallStatusCode.Failed;0===t&&n.status&&(i=n.result,o=e.ProxyCallStatusCode.Succeeded);var r=u[c];delete u[c];for(var a=r.length,s=0;s<a;s++){var l,d=r.shift();try{d.context&&d.context.osfControl&&(l=d.context.osfControl._appCorrelationId),n&&n.failureInfo&&Telemetry.RuntimeTelemetryHelper.LogProxyFailure(l,d.methodName,n.failureInfo),d.onCompleted({statusCode:o,value:i,context:d.context})}catch(e){var p="_invokeProxyMethodAsync failed.";OfficeExt.WACUtils.logExceptionToBrowserConsole(p,e),Telemetry.RuntimeTelemetryHelper.LogExceptionTag(p,e,l,523355597)}}}),r)}},removeOmexCacheAsync:function(t,n){e.OUtil.validateParamObject(t,{osfControl:{type:Object,mayBeNull:!1},referenceInUse:{type:Object,mayBeNull:!1},clientEndPoint:{type:Object,mayBeNull:!1}},n);var i=t.referenceInUse,o={applicationName:t.hostType,assetID:i.solutionId,officeExtentionTarget:t.osfControl.getOsfControlType(),clearEntitlement:t.clearEntitlement||!1,clearToken:t.clearToken||!1,clearAppState:t.clearAppState||!1,clearManifest:t.clearManifest||!1,appVersion:t.appVersion};t.anonymous?o.contentMarket=i.storeId:(o.assetContentMarket=t.osfControl._omexEntitlement.contentMarket,o.userContentMarket=i.storeId),this._invokeProxyMethodAsync(t,"OMEX_removeCacheAsync",n,o)},purgeManifest:function(e,n){var i=Function._validateParams(arguments,[{name:"marketplaceID",type:String,mayBeNull:!1},{name:"marketplaceVersion",type:String,mayBeNull:!1}]);if(i)throw i;var r=o(e,n);void 0!==t[r]&&delete t[r]},cacheManifestFromXml:function(t,n,i,o){var r=Function._validateParams(arguments,[{name:"marketplaceID",type:String,mayBeNull:!1},{name:"marketplaceVersion",type:String,mayBeNull:!1},{name:"manifestXml",type:String,mayBeNull:!1},{name:"uiLocale",type:String,mayBeNull:!1}]);if(r)throw r;this.cacheManifest(t,n,new e.Manifest.Manifest(i,o))},cacheManifest:function(e,i,r){var a=Function._validateParams(arguments,[{name:"marketplaceID",type:String,mayBeNull:!1},{name:"marketplaceVersion",type:String,mayBeNull:!1},{name:"manifest",type:Object,mayBeNull:!1}]);if(a)throw a;var s=o(e,i);r._UILocale=r._UILocale||n,t[s]=r},hasManifest:function(e,n){var i=Function._validateParams(arguments,[{name:"marketplaceID",type:String,mayBeNull:!1},{name:"marketplaceVersion",type:String,mayBeNull:!1}]);if(i)throw i;var r=o(e,n);return void 0!==t[r]},hasManifestForControl:function(t){return e.OUtil.validateParamObject(t,{referenceInUse:{type:Object,mayBeNull:!1}},null),this.hasManifest(t.referenceInUse.solutionId,t.referenceInUse.version)},getCachedManifest:function(e,n){var i=Function._validateParams(arguments,[{name:"marketplaceID",type:String,mayBeNull:!1},{name:"marketplaceVersion",type:String,mayBeNull:!1}]);if(i)throw i;var r=o(e,n);return t[r]},getSharedRuntimeManifestCacheKey:function(e,t){var n=Function._validateParams(arguments,[{name:"marketplaceID",type:String,mayBeNull:!1},{name:"sharedRuntimeId",type:String,mayBeNull:!1}]);if(n)throw n;return e+t},versionLessThan:function(e,t){var n,i,o,r=e.split("."),a=t.split("."),s=Math.min(r.length,a.length);for(o=0;o<s;o++)try{if((n=parseFloat(r[o]))!=(i=parseFloat(a[o])))return n<i}catch(e){}if(r.length>=a.length)return!1;s=a.length;var l=0;for(o=r.length;o<s;o++){try{i=parseFloat(a[o])}catch(e){i=0}l+=i}return l>0},_setUILocale:function(e){n=e}}}()}(OSF||(OSF={})),function(e){!function(e){e[e.Invalid=0]="Invalid",e[e.tokenError=1]="tokenError",e[e.invalidExtendedOverride=2]="invalidExtendedOverride",e[e.invalidKeyCode=3]="invalidKeyCode",e[e.downloadError=4]="downloadError",e[e.invalidParameter=5]="invalidParameter",e[e.missingModifierKey=6]="missingModifierKey"}(e.OsfRuntimeErrorCode||(e.OsfRuntimeErrorCode={}));var t=function(e){function t(n,i){var o=e.call(this,i)||this;return Object.setPrototypeOf(o,t.prototype),o.code=n,o.name="OsfRuntimeError",o}return __extends(t,e),t}(Error);e.OsfRuntimeError=t;var n=function(e){function t(n,i){var o=e.call(this,n,"Multiple Errors")||this;return Object.setPrototypeOf(o,t.prototype),o.messages=i,i.forEach((function(e){console.error(e)})),o}return __extends(t,e),t}(t);e.OsfMultiError=n}(OfficeExt||(OfficeExt={})),function(e){!function(e){e[e.DefaultMode=0]="DefaultMode",e[e.CategoryMode=1]="CategoryMode",e[e.TrustPageMode=2]="TrustPageMode",e[e.QueryResultMode=3]="QueryResultMode"}(e.OsfNavigationMode||(e.OsfNavigationMode={})),e.ManifestNamespaces={"1.0":'xmlns="http://schemas.microsoft.com/office/appforoffice/1.0" xmlns:o="http://schemas.microsoft.com/office/appforoffice/1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"',1.1:'xmlns="http://schemas.microsoft.com/office/appforoffice/1.1" xmlns:o="http://schemas.microsoft.com/office/appforoffice/1.1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:bt="http://schemas.microsoft.com/office/officeappbasictypes/1.0" xmlns:ov="http://schemas.microsoft.com/office/taskpaneappversionoverrides" xmlns:c="http://schemas.microsoft.com/office/contentappversionoverrides" xmlns:mailappor="http://schemas.microsoft.com/office/mailappversionoverrides"'},e.ManifestSchemaVersion={"1.0":"1.0",1.1:"1.1"};var t=function(){function t(e,t,n,i,o){this.defaultMinMaxVersion="1.1",this.setCapabilities(e),this.setHosts(t),this.setRequirements(n),this.setSupportedControlTargets(i),this.setSupportedOmexAppVersions(o),this.setFilteringEnabled(!1)}return t.prototype.isManifestSupported=function(t){if(!this.isFilteringEnabled())return!0;if(!t)return!1;switch(t.getManifestSchemaVersion()||e.ManifestSchemaVersion["1.0"]){case e.ManifestSchemaVersion["1.0"]:return this._checkManifest1_0(t);case e.ManifestSchemaVersion[1.1]:return this._checkManifest1_1(t);default:return!1}},t.prototype.isEntitlementFromOmexSupported=function(t){if(!this.isFilteringEnabled())return!0;if(!t)return!1;var n;switch(t.appSubType){case"1":n=e.OsfControlTarget.TaskPane;break;case"2":n=e.OsfControlTarget.InContent;break;case"3":n=e.OsfControlTarget.Contextual;break;case"4":n=e.OsfControlTarget.TaskPane;break;default:return!1}if(!this._checkControlTarget(n))return!1;if(!t.requirements&&!t.hosts)return!t.hasOwnProperty("appVersions")||void 0===t.appVersions||this._checkOmexAppVersions(t.appVersions);var i,o,r,a,s=new e.Manifest.Manifest((function(){}));return t.requirements&&(s._xmlProcessor=new e.XmlProcessor(t.requirements,e.ManifestNamespaces[1.1]),o=s._xmlProcessor.getDocumentElement()),i=s._parseRequirements(o),t.hosts&&(s._xmlProcessor=new e.XmlProcessor(t.hosts,e.ManifestNamespaces[1.1]),a=s._xmlProcessor.getDocumentElement()),r=s._parseHosts(a),this._checkHosts(r)&&this._checkSets(i.sets)&&this._checkMethods(i.methods)},t.prototype.isEntitlementFromCorpCatalogSupported=function(t){if(!this.isFilteringEnabled())return!0;if(!t)return!1;var n=e.OfficeAppType[t.OEType];if(!this._checkControlTarget(n))return!1;var i,o,r,a,s,l=new e.Manifest.Manifest((function(){}));t.OfficeExtensionCapabilitiesXML&&(l._xmlProcessor=new e.XmlProcessor(t.OfficeExtensionCapabilitiesXML,e.ManifestNamespaces[1.1]),a=l._xmlProcessor.getDocumentElement(),o=(s=l._parseRequirements(a)).sets,r=s.methods,i=l._parseHosts(a));return this._checkHosts(i)&&this._checkSets(o)&&this._checkMethods(r)},t.prototype.setCapabilities=function(e){this._supportedCapabilities=this._scalarArrayToObject(e)},t.prototype.setHosts=function(e){this._supportedHosts=this._scalarArrayToObject(e)},t.prototype.setRequirements=function(e){this._supportedSets=e&&this._arrayToSetsObject(e.sets)||{},this._supportedMethods=e&&this._scalarArrayToObject(e.methods)||{}},t.prototype.setSupportedControlTargets=function(e){this._supportedControlTargets=this._scalarArrayToObject(e)},t.prototype.setSupportedOmexAppVersions=function(e){this._supportedOmexAppVersions=e&&e.slice?e.slice(0):[]},t.prototype.setFilteringEnabled=function(e){this._filteringEnabled=!!e},t.prototype.isFilteringEnabled=function(){return this._filteringEnabled},t.prototype._checkManifest1_0=function(e){return this._checkCapabilities(e.getCapabilities())},t.prototype._checkCapabilities=function(e){if(!e||0===e.length)return!0;for(var t=0;t<e.length;t++)if(this._supportedCapabilities[e[t]])return!0;return!1},t.prototype._checkManifest1_1=function(e){var t=e.getRequirements()||{};return this._checkHosts(e.getHosts())&&this._checkSets(t.sets)&&this._checkMethods(t.methods)},t.prototype._checkHosts=function(e){if(!e||0===e.length)return!0;for(var t=0;t<e.length;t++)if(this._supportedHosts[e[t]])return!0;return!1},t.prototype._checkSets=function(e){if(!e||0===e.length)return!0;for(var t=0;t<e.length;t++){var n=e[t],i=this._supportedSets[n.name.toLowerCase()];if(!i)return!1;if(n.version&&(this._compareVersionStrings(i.minVersion||this.defaultMinMaxVersion,n.version)>0||this._compareVersionStrings(i.maxVersion||this.defaultMinMaxVersion,n.version)<0))return!1}return!0},t.prototype._checkMethods=function(e){if(!e||0===e.length)return!0;for(var t=0;t<e.length;t++)if(!this._supportedMethods[e[t]])return!1;return!0},t.prototype._checkControlTarget=function(e){return null!=e&&this._supportedControlTargets[e]},t.prototype._checkOmexAppVersions=function(e){if(!e)return!1;for(var t=0;t<this._supportedOmexAppVersions.length;t++)if(e.indexOf(this._supportedOmexAppVersions[t])>=0)return!0;return!1},t.prototype._scalarArrayToObject=function(e){var t={};if(e&&e.length)for(var n=0;n<e.length;n++)null!=e[n]&&(t[e[n]]=!0);return t},t.prototype._arrayToSetsObject=function(e){var t={};if(e&&e.length)for(var n=0;n<e.length;n++){var i=e[n];i&&null!=i.name&&(t[i.name.toLowerCase()]=i)}return t},t.prototype._getSupportedSet=function(){for(var e={},t=Object.getOwnPropertyNames(this._supportedSets),n=0;n<t.length;n++){var i=this._supportedSets[t[n]];e[i.name.toLowerCase()]=i.maxVersion||this.defaultMinMaxVersion}return"undefined"!=typeof JSON?JSON.stringify(e):e},t.prototype._getSupportedSetAsCapabilities=function(){var e=this;return Object.getOwnPropertyNames(this._supportedSets).map((function(t){var n=e._supportedSets[t];return{Name:n.name.toLowerCase(),Version:n.maxVersion||e.defaultMinMaxVersion}}))},t.prototype._compareVersionStrings=function(e,t){e=e.split("."),t=t.split(".");for(var n=Math.max(e.length,t.length),i=0;i<n;i++){var o=parseInt(e[i],10)||0,r=parseInt(t[i],10)||0;if(o!==r)return o-r}return 0},t}();e.RequirementsChecker=t}(OSF||(OSF={})),function(e){!function(e){e["Application.createDocumentAsync"]="Application.createDocumentAsync",e["Auth.getAccessTokenAsync"]="Auth.getAccessTokenAsync",e["Binding.addHandlerAsync"]="Binding.addHandlerAsync",e["Binding.removeHandlerAsync"]="Binding.removeHandlerAsync",e["Bindings.addFromNamedItemAsync"]="Bindings.addFromNamedItemAsync",e["Bindings.addFromPromptAsync"]="Bindings.addFromPromptAsync",e["Bindings.addFromSelectionAsync"]="Bindings.addFromSelectionAsync",e["Bindings.getAllAsync"]="Bindings.getAllAsync",e["Bindings.getByIdAsync"]="Bindings.getByIdAsync",e["Bindings.releaseByIdAsync"]="Bindings.releaseByIdAsync",e["CustomXmlNode.getNodesAsync"]="CustomXmlNode.getNodesAsync",e["CustomXmlNode.getNodeValueAsync"]="CustomXmlNode.getNodeValueAsync",e["CustomXmlNode.getTextAsync"]="CustomXmlNode.getTextAsync",e["CustomXmlNode.getXmlAsync"]="CustomXmlNode.getXmlAsync",e["CustomXmlNode.setNodeValueAsync"]="CustomXmlNode.setNodeValueAsync",e["CustomXmlNode.setTextAsync"]="CustomXmlNode.setTextAsync",e["CustomXmlNode.setXmlAsync"]="CustomXmlNode.setXmlAsync",e["CustomXmlPart.deleteAsync"]="CustomXmlPart.deleteAsync",e["CustomXmlPart.getNodesAsync"]="CustomXmlPart.getNodesAsync",e["CustomXmlPart.getXmlAsync"]="CustomXmlPart.getXmlAsync",e["CustomXmlParts.addAsync"]="CustomXmlParts.addAsync",e["CustomXmlParts.getByIdAsync"]="CustomXmlParts.getByIdAsync",e["CustomXmlParts.getByNamespaceAsync"]="CustomXmlParts.getByNamespaceAsync",e["CustomXmlPrefixMappings.addNamespaceAsync"]="CustomXmlPrefixMappings.addNamespaceAsync",e["CustomXmlPrefixMappings.getNamespaceAsync"]="CustomXmlPrefixMappings.getNamespaceAsync",e["CustomXmlPrefixMappings.getPrefixAsync"]="CustomXmlPrefixMappings.getPrefixAsync",e["Dialog.addEventHandler"]="Dialog.addEventHandler",e["Dialog.close"]="Dialog.close",e["Dialog.sendMessage"]="Dialog.sendMessage",e["Document.addHandlerAsync"]="Document.addHandlerAsync",e["Document.getActiveViewAsync"]="Document.getActiveViewAsync",e["Document.getFileAsync"]="Document.getFileAsync",e["Document.getFilePropertiesAsync"]="Document.getFilePropertiesAsync",e["Document.getSelectedDataAsync"]="Document.getSelectedDataAsync",e["Document.goToByIdAsync"]="Document.goToByIdAsync",e["Document.insertFormAsync"]="Document.insertFormAsync",e["Document.removeHandlerAsync"]="Document.removeHandlerAsync",e["Document.setSelectedDataAsync"]="Document.setSelectedDataAsync",e["File.closeAsync"]="File.closeAsync",e["File.getSliceAsync"]="File.getSliceAsync",e["MatrixBinding.getDataAsync"]="MatrixBinding.getDataAsync",e["MatrixBinding.setDataAsync"]="MatrixBinding.setDataAsync",e["Settings.addHandlerAsync"]="Settings.addHandlerAsync",e["Settings.get"]="Settings.get",e["Settings.refreshAsync"]="Settings.refreshAsync",e["Settings.remove"]="Settings.remove",e["Settings.removeHandlerAsync"]="Settings.removeHandlerAsync",e["Settings.saveAsync"]="Settings.saveAsync",e["Settings.set"]="Settings.set",e["TableBinding.addColumnsAsync"]="TableBinding.addColumnsAsync",e["TableBinding.addRowsAsync"]="TableBinding.addRowsAsync",e["TableBinding.clearFormatsAsync"]="TableBinding.clearFormatsAsync",e["TableBinding.deleteAllDataValuesAsync"]="TableBinding.deleteAllDataValuesAsync",e["TableBinding.getDataAsync"]="TableBinding.getDataAsync",e["TableBinding.setDataAsync"]="TableBinding.setDataAsync",e["TableBinding.setFormatsAsync"]="TableBinding.setFormatsAsync",e["TableBinding.setTableOptionsAsync"]="TableBinding.setTableOptionsAsync",e["TextBinding.getDataAsync"]="TextBinding.getDataAsync",e["TextBinding.setDataAsync"]="TextBinding.setDataAsync",e["CustomXmlPart.addHandlerAsync"]="CustomXmlPart.addHandlerAsync",e["CustomXmlPart.removeHandlerAsync"]="CustomXmlPart.removeHandlerAsync",e["Ui.displayDialogAsync"]="Ui.displayDialogAsync",e["Ui.messageParent"]="Ui.messageParent",e["Ui.addEventHandler"]="Ui.addEventHandler",e["WebAuth.getAuthContextAsync"]="WebAuth.getAuthContextAsync"}(e.RequirementMethodNames||(e.RequirementMethodNames={})),function(e){e.ActiveView="ActiveView",e.AddinCommands="AddinCommands",e.AugLoopSharedSession="AugLoopSharedSession",e.BindingEvents="BindingEvents",e.biplatVisualRichApi="biplatVisualRichApi",e.CompressedFile="CompressedFile",e.CustomFunctions="CustomFunctions",e.CustomFunctionsRuntime="CustomFunctionsRuntime",e.CustomXmlParts="CustomXmlParts",e.DataFromPicture="DataFromPicture",e.DelayForCellEdit="DelayForCellEdit",e.DialogApi="DialogApi",e.DialogOrigin="DialogOrigin",e.DocumentEvents="DocumentEvents",e.ExcelApi="ExcelApi",e.ExcelApiOnline="ExcelApiOnline",e.ExcelApiUndo="ExcelApiUndo",e.File="File",e.FirstPartyAuthentication="FirstPartyAuthentication",e.HtmlCoercion="HtmlCoercion",e.IdentityApi="IdentityApi",e.ImageCoercion="ImageCoercion",e.KeyboardShortcuts="KeyboardShortcuts",e.Mailbox="Mailbox",e.MatrixBindings="MatrixBindings",e.MatrixCoercion="MatrixCoercion",e.NumberFormatting="NumberFormatting",e.OneNoteApi="OneNoteApi",e.OoxmlCoercion="OoxmlCoercion",e.PartialTableBindings="PartialTableBindings",e.PdfFile="PdfFile",e.Pivot="Pivot",e.PowerPointApi="PowerPointApi",e.Selection="Selection",e.RedirectV1Api="RedirectV1Api",e.RibbonApi="RibbonApi",e.RichApiRuntime="RichApiRuntime",e.RichApiRuntimeFlag="RichApiRuntimeFlag",e.Settings="Settings",e.SharedRuntime="SharedRuntime",e.SharedRuntimeInternal="SharedRuntimeInternal",e.TableBindings="TableBindings",e.TableCoercion="TableCoercion",e.TableStyle="TableStyle",e.TextBindings="TextBindings",e.TextCoercion="TextCoercion",e.TextFile="TextFile",e.VisioApi="VisioApi",e.WebAuth="WebAuth",e.WordApi="WordApi",e.WordApiOnline="WordApiOnline",e.WordApiSearchFlags="WordApiSearchFlags"}(e.RequirementSetNames||(e.RequirementSetNames={}))}(OSF||(OSF={})),function(e){!function(e){!function(e){e[e.Allowed=0]="Allowed",e[e.ThrottledUnspecified=10]="ThrottledUnspecified",e[e.ThrottledThrottleNotInitialized=11]="ThrottledThrottleNotInitialized",e[e.ThrottledTooManyIncompleteRequests=12]="ThrottledTooManyIncompleteRequests",e[e.ThrottledRequestTokensUnavailable=13]="ThrottledRequestTokensUnavailable"}(e.ThrottleRequestStatus||(e.ThrottleRequestStatus={}))}(e.Throttling||(e.Throttling={}))}(OsfRuntime||(OsfRuntime={})),function(e){!function(e){var t=function(){function t(e,t){void 0===t&&(t=-1),this._maxIncompleteRequestCount=e,this._timeoutInMilliSec=t,this.reset()}return t.prototype.tryRequest=function(t){return this._shouldRequestBeAllowed()?(t(),e.ThrottleRequestStatus.Allowed):e.ThrottleRequestStatus.ThrottledTooManyIncompleteRequests},t.prototype.tryAsyncRequest=function(t){var n=this;if(!this._shouldRequestBeAllowed())return e.ThrottleRequestStatus.ThrottledTooManyIncompleteRequests;var i=this._addRequestAndGetToken();return t((function(){n._removeRequestWithToken(i)})),e.ThrottleRequestStatus.Allowed},t.prototype.reset=function(){this._currentlyExecutingRequestsToTimeoutIDMapping={},this._currentlyExecutingRequestCount=0,this._requestToken=0},t.prototype._shouldRequestBeAllowed=function(){return this._currentlyExecutingRequestCount<this._maxIncompleteRequestCount},t.prototype._addRequestAndGetToken=function(){var e=this,t=this._requestToken;if(this._timeoutInMilliSec>=0)var n=setTimeout((function(){return e._removeRequestWithToken(t)}),this._timeoutInMilliSec);return this._currentlyExecutingRequestsToTimeoutIDMapping[t]=n,this._currentlyExecutingRequestCount++,this._requestToken++,t},t.prototype._removeRequestWithToken=function(e){if(this._currentlyExecutingRequestsToTimeoutIDMapping.hasOwnProperty(e.toString())){var t=this._currentlyExecutingRequestsToTimeoutIDMapping[e];delete this._currentlyExecutingRequestsToTimeoutIDMapping[e],this._currentlyExecutingRequestCount--,clearTimeout(t)}},t}();e.IncompleteRequestThrottle=t}(e.Throttling||(e.Throttling={}))}(OsfRuntime||(OsfRuntime={})),function(e){!function(e){var t=function(){function t(e,t){this._bucketCapacity=e,this._tokenFillingIntervalInMilliSec=t,this.reset()}return t.prototype.tryRequest=function(e){return this._tryRequestInternal(e,!1)},t.prototype.tryAsyncRequest=function(e){return this._tryRequestInternal(e,!0)},t.prototype.reset=function(){this._lastCallStartedAt=0,this._tokenCountAfterLastCall=this._bucketCapacity},t.prototype._tryRequestInternal=function(t,n){var i=(new Date).getTime(),o=this._getTokenCountAtTime(i);if(o<1)return e.ThrottleRequestStatus.ThrottledRequestTokensUnavailable;this._lastCallStartedAt=i,this._tokenCountAfterLastCall=o-1;var r=n?[function(){}]:[];return t.apply(void 0,r),e.ThrottleRequestStatus.Allowed},t.prototype._getTokenCountAtTime=function(e){return e<this._lastCallStartedAt?0:Math.min(this._bucketCapacity,this._tokenCountAfterLastCall+(e-this._lastCallStartedAt)/this._tokenFillingIntervalInMilliSec)},t}();e.TokenBucketThrottle=t}(e.Throttling||(e.Throttling={}))}(OsfRuntime||(OsfRuntime={})),function(e){!function(e){var t=function(){function t(){}return t.prototype.createIncompleteRequestThrottle=function(t,n){return new e.IncompleteRequestThrottle(t,n)},t.prototype.createTokenBucketThrottle=function(t,n){return new e.TokenBucketThrottle(t,n)},t.prototype.createChainedThrottle=function(t){return new e.ChainedThrottle(t)},t}();e.ThrottleFactory=t}(e.Throttling||(e.Throttling={}))}(OsfRuntime||(OsfRuntime={})),function(e){!function(e){var t=function(){function t(e){this._throttles=e,this._throttles=e||[]}return t.prototype.tryRequest=function(t){var n=this._throttles.length;if(0===n)return t(),e.ThrottleRequestStatus.Allowed;var i=0;function o(){++i===n&&t()}for(var r=0;r<n;++r){var a=this._throttles[r].tryRequest(o);if(a!==e.ThrottleRequestStatus.Allowed)break}return a},t.prototype.tryAsyncRequest=function(t){var n=this._throttles.length;if(0===n)return t((function(){})),e.ThrottleRequestStatus.Allowed;var i=0,o=!1,r=new Array(n);function a(){for(var e=0;e<n;++e)r[e]&&r[e]()}function s(e){return function(s){o&&s(),r[e]=s,++i===n&&t(a)}}for(var l=0;l<n;++l){var c=this._throttles[l].tryAsyncRequest(s(l));if(c!==e.ThrottleRequestStatus.Allowed){o=!0,a();break}}return c},t.prototype.reset=function(){for(var e=0,t=this._throttles.length;e<t;++e)this._throttles[e].reset()},t}();e.ChainedThrottle=t}(e.Throttling||(e.Throttling={}))}(OsfRuntime||(OsfRuntime={})),function(e){!function(e){!function(e){!function(e){e.Error="Error"}(e.ApiResponseKeys||(e.ApiResponseKeys={})),function(e){e.Data="Data",e.GetData="DdaGetBindingData",e.SetData="DdaSetBindingData",e.SettingsRequest="DdaSettingsMethod",e.Properties="Properties",e.BindingRequest="DdaBindingsMethod",e.BindingResponse="Bindings",e.ArrayData="ArrayData",e.AddRowsColumns="DdaAddRowsColumns"}(e.UniqueArgumentKeys||(e.UniqueArgumentKeys={}))}(e.Marshaling||(e.Marshaling={}))}(e.DDA||(e.DDA={}))}(OSF||(OSF={})),function(e){e[e.Table=1]="Table",e[e.Text=2]="Text",e[e.Matrix=3]="Matrix"}(OSF_DDA_Marshaling_BindingType||(OSF_DDA_Marshaling_BindingType={})),function(e){!function(e){!function(e){e.BindingType=OSF_DDA_Marshaling_BindingType,function(e){e.TableSubset="subset",e.StartRow="startRow",e.StartColumn="startColumn",e.RowCount="rowCount",e.ColumnCount="columnCount"}(e.TableSubsetKeys||(e.TableSubsetKeys={})),function(e){e.BindingId="Name",e.BindingType="BindingType",e[e.BindingProperties=0]="BindingProperties",e.BindingEventSource="ddaBinding",e.RowCount="RowCount",e.ColumnCount="ColCount",e.HasHeaders="HasHeaders"}(e.AppBindingKeys||(e.AppBindingKeys={})),function(e){e.TableHeaders="TableHeaders",e.TableRows="TableRows"}(e.TableBindingParameterKeys||(e.TableBindingParameterKeys={})),function(e){e.Id="BindingId",e.BindingType="BindingType",e.ItemName="ItemName",e.StartRow="StartRow",e.StartCol="StartCol",e.RowCount="RowCount",e.ColCount="ColCount"}(e.BindingParameterKeys||(e.BindingParameterKeys={}))}(e.Marshaling||(e.Marshaling={}))}(e.DDA||(e.DDA={}))}(OSF||(OSF={})),function(e){!function(e){!function(e){!function(e){e.Html="html",e.Ooxml="ooxml",e.SlideRange="slideRange",e.Text="text",e.Table="table",e.Matrix="matrix",e.Image="image",e.XmlSvg="xmlSvg"}(e.CoercionTypeKeys||(e.CoercionTypeKeys={})),function(e){e.CoercionType="CoerceType",e.Data="Data",e.ImageLeft="ImageLeft",e.ImageTop="ImageTop",e.ImageWidth="ImageWidth",e.ImageHeight="ImageHeight"}(e.SetDataKeys||(e.SetDataKeys={})),function(e){e.CoercionType="CoerceType"}(e.GetDataKeys||(e.GetDataKeys={}))}(e.Marshaling||(e.Marshaling={}))}(e.DDA||(e.DDA={}))}(OSF||(OSF={})),function(e){e[e.Properties=0]="Properties",e[e.Url=1]="Url"}(OSF_DDA_Marshaling_FilePropertiesKeys||(OSF_DDA_Marshaling_FilePropertiesKeys={})),function(e){!function(e){!function(e){e.FilePropertiesKeys=OSF_DDA_Marshaling_FilePropertiesKeys}(e.Marshaling||(e.Marshaling={}))}(e.DDA||(e.DDA={}))}(OSF||(OSF={})),function(e){e[e.Handle=0]="Handle",e[e.FileSize=1]="FileSize"}(OSF_DDA_Marshaling_File_FilePropertiesKeys||(OSF_DDA_Marshaling_File_FilePropertiesKeys={})),function(e){e[e.Data=0]="Data",e[e.SliceSize=1]="SliceSize"}(OSF_DDA_Marshaling_File_SlicePropertiesKeys||(OSF_DDA_Marshaling_File_SlicePropertiesKeys={})),function(e){e[e.Text=0]="Text",e[e.Compressed=1]="Compressed",e[e.Pdf=2]="Pdf"}(OSF_DDA_Marshaling_File_FileType||(OSF_DDA_Marshaling_File_FileType={})),function(e){e[e.FileType=0]="FileType",e[e.SliceSize=1]="SliceSize",e[e.Handle=2]="Handle",e[e.SliceIndex=3]="SliceIndex"}(OSF_DDA_Marshaling_File_ParameterKeys||(OSF_DDA_Marshaling_File_ParameterKeys={})),function(e){!function(e){!function(e){!function(e){e.ParameterKeys=OSF_DDA_Marshaling_File_ParameterKeys,e.FileType=OSF_DDA_Marshaling_File_FileType,e.SlicePropertiesKeys=OSF_DDA_Marshaling_File_SlicePropertiesKeys,e.FilePropertiesKeys=OSF_DDA_Marshaling_File_FilePropertiesKeys}(e.File||(e.File={}))}(e.Marshaling||(e.Marshaling={}))}(e.DDA||(e.DDA={}))}(OSF||(OSF={})),function(e){!function(e){!function(e){!function(e){e.SerializedSettings="Properties"}(e.SettingsKeys||(e.SettingsKeys={}))}(e.Marshaling||(e.Marshaling={}))}(e.DDA||(e.DDA={}))}(OSF||(OSF={})),function(e){!function(e){!function(e){!function(e){e.OldNode="OldNode",e.NewNode="NewNode",e.NextSiblingNode="NextSiblingNode",e.InUndoRedo="InUndoRedo"}(e.DataNodeEventProperties||(e.DataNodeEventProperties={})),function(e){e.DataPartList="DataPartList",e.DataNodeList="DataNodeList"}(e.ListDescriptors||(e.ListDescriptors={})),function(e){e.Handle="DataNodeHandle",e.BaseName="DataNodeBaseName",e.NamespaceUri="DataNodeNamespaceUri",e.NodeType="DataNodeType"}(e.DataNodeProperties||(e.DataNodeProperties={})),function(e){e.DataPartProperties="DataPartProperties",e.DataNodeProperties="DataNodeProperties"}(e.PropertyDescriptors||(e.PropertyDescriptors={})),function(e){e.Id="id",e.BuiltIn="DataPartBuiltIn"}(e.DataPartProperties||(e.DataPartProperties={})),function(e){e.Id="id",e.Namespace="namespace",e.Xml="xml",e.XPath="xpath",e.Prefix="prefix"}(e.CustomXmlPartsKeys||(e.CustomXmlPartsKeys={}))}(e.Marshaling||(e.Marshaling={}))}(e.DDA||(e.DDA={}))}(OSF||(OSF={})),function(e){e[e.Binding=0]="Binding",e[e.NamedItem=1]="NamedItem",e[e.Slide=2]="Slide",e[e.Index=3]="Index"}(OSF_DDA_Marshaling_GoToType||(OSF_DDA_Marshaling_GoToType={})),function(e){e[e.Default=0]="Default",e[e.Selected=1]="Selected",e[e.None=2]="None"}(OSF_DDA_Marshaling_SelectionMode||(OSF_DDA_Marshaling_SelectionMode={})),function(e){!function(e){!function(e){e.SelectionMode=OSF_DDA_Marshaling_SelectionMode,e.GoToType=OSF_DDA_Marshaling_GoToType,function(e){e.NavigationRequest="DdaGoToByIdMethod",e.Id="Id",e.GoToType="GoToType",e.SelectionMode="SelectionMode"}(e.NavigationKeys||(e.NavigationKeys={}))}(e.Marshaling||(e.Marshaling={}))}(e.DDA||(e.DDA={}))}(OSF||(OSF={})),function(e){!function(e){!function(e){!function(e){e.MessageContent="messageContent",e.TargetOrigin="targetOrigin"}(e.SendMessageKeys||(e.SendMessageKeys={})),function(e){e.DialogNotificationShown="dialogNotificationShown"}(e.DialogNotificationShownEventType||(e.DialogNotificationShownEventType={})),function(e){e.MessageToParent="messageToParent",e.TargetOrigin="targetOrigin"}(e.MessageParentKeys||(e.MessageParentKeys={})),function(e){!function(e){e.MessageType="messageType",e.MessageContent="messageContent",e.MessageOrigin="messageOrigin",e.TargetOrigin="targetOrigin"}(e.DialogParentMessageReceivedEventKeys||(e.DialogParentMessageReceivedEventKeys={})),function(e){e.MessageType="messageType",e.MessageContent="messageContent",e.MessageOrigin="messageOrigin",e.TargetOrigin="targetOrigin"}(e.DialogMessageReceivedEventKeys||(e.DialogMessageReceivedEventKeys={}))}(e.Dialog||(e.Dialog={}))}(e.Marshaling||(e.Marshaling={}))}(e.DDA||(e.DDA={}))}(OSF||(OSF={})),function(e){!function(e){!function(e){!function(e){!function(e){e.AccessToken="accessToken"}(e.AccessTokenResultKeys||(e.AccessTokenResultKeys={})),function(e){e.ForceConsent="forceConsent",e.ForceAddAccount="forceAddAccount",e.AuthChallenge="authChallenge",e.AllowConsentPrompt="allowConsentPrompt",e.ForMSGraphAccess="forMSGraphAccess",e.AllowSignInPrompt="allowSignInPrompt",e.EnableNewHosts="enableNewHosts",e.AccountTypeFilter="accountTypeFilter",e.AddinTrustId="addinTrustId"}(e.GetAccessTokenKeys||(e.GetAccessTokenKeys={}))}(e.SingleSignOn||(e.SingleSignOn={}))}(e.Marshaling||(e.Marshaling={}))}(e.DDA||(e.DDA={}))}(OSF||(OSF={})),function(e){!function(e){!function(e){!function(e){!function(e){e.AuthContext="authContext",e.AppId="appId",e.MsaAppId="msaAppId",e.Upn="upn",e.UserId="userId",e.Authority="authority",e.AuthorityType="authorityType",e.IsAnonymous="isAnonymous",e.TenantId="tenantId",e.Error="error",e.SupportsAuthToken="supportsAuthToken"}(e.GetAuthContextResultKeys||(e.GetAuthContextResultKeys={})),e.GetAuthContextKeys||(e.GetAuthContextKeys={})}(e.WebAuth||(e.WebAuth={}))}(e.Marshaling||(e.Marshaling={}))}(e.DDA||(e.DDA={}))}(OSF||(OSF={})),function(e){var t;!function(e){e[e.TakeSnapshot=1]="TakeSnapshot",e[e.SetHostThemeButtonStyle=2]="SetHostThemeButtonStyle",e[e.RemoveEventListenersForDialog=3]="RemoveEventListenersForDialog"}(t=e.AddinNativeActionIds||(e.AddinNativeActionIds={}));var n=function(){function e(){this.actionDict={}}return e.getInstance=function(){return null==e.instance&&(e.instance=new e),e.instance},e.prototype.getNativeActionName=function(e){return this.actionDict[e]},e.prototype.registerNativeAction=function(e,t){this.actionDict[e]=t},e}();e.AddinNativeActionRuntimeManager=n,e.AddinNativeActionRuntimeManager.getInstance().registerNativeAction(t.TakeSnapshot,"OfficeExt.AddinNativeAction.Snapshot.generateLatestSnapshot"),e.AddinNativeActionRuntimeManager.getInstance().registerNativeAction(t.SetHostThemeButtonStyle,"OfficeExt.AddinNativeAction.Dialog.setHostThemeButtonStyle"),e.AddinNativeActionRuntimeManager.getInstance().registerNativeAction(t.RemoveEventListenersForDialog,"OfficeExt.AddinNativeAction.Dialog.removeEventListenersForDialog")}(OfficeExt||(OfficeExt={}));var Microsoft,OsfRuntime,RichApiRequestArrayIndex_RequestFlags=6,RichApiRequestFlag_WriteOperation=1;!function(e){!function(e){!function(e){e.FULSSupported=!0,function(e){e.BindingSelectionChanged="bindingSelectionChanged",e.BindingDataChanged="bindingDataChanged",e.DataNodeDeleted="nodeDeleted",e.DataNodeInserted="nodeInserted",e.DataNodeReplaced="nodeReplaced"}(e.EventType||(e.EventType={}))}(e.WebExtension||(e.WebExtension={}))}(e.Office||(e.Office={}))}(Microsoft||(Microsoft={})),function(e){var t=function(){function e(e,t){var n,i,o=Function._validateParams(arguments,[{name:"contextActivationMgr",type:Object,mayBeNull:!1},{name:"registeredActions",type:Object,mayBeNull:!1}]);if(o)throw o;for(var r in this._contextActivationManager=e,this._registeredActions={},t){if(n=!0,"object"==typeof(i=t[r])){for(var a in i)if(!(n=this.validatePermissionInput(i[a])))break}else n=this.validatePermissionInput(i);if(!n)throw OsfMsAjaxFactory.msAjaxError.argument("registeredActions");this._registeredActions[r]=i}}return e.prototype.checkPermission=function(e,t,n){var i=this._registeredActions[t];if(!i)return!1;if("object"==typeof i){if(!(n&&n.DdaMethod&&n.DdaMethod.DispatchId&&i[n.DdaMethod.DispatchId]))return!1;i=i[n.DdaMethod.DispatchId]}if(i===OSF.OsfControlPermission.Restricted)return!0;if(n.DdaMethod&&n.DdaMethod.DispatchId==OSF.DDA.MethodDispId.dispidExecuteRichApiRequestMethod){var o=n.ArrayData;if(!OSF.OUtil.isArray(o))return!1;(o[RichApiRequestArrayIndex_RequestFlags]&RichApiRequestFlag_WriteOperation)==RichApiRequestFlag_WriteOperation&&(i|=OSF.OsfControlPermission.ReadWriteDocument)}var r=this._contextActivationManager._getManifestAndTargetByConversationId(e);return!(!r||!r.manifest)&&r.manifest.hasPermission(i)},e.prototype.validatePermissionInput=function(e){var t=!1;for(var n in OSF.OsfControlPermission)if(OSF.OsfControlPermission[n]===e){t=!0;break}return t},e}();e.PolicyManager=t}(OsfRuntime||(OsfRuntime={}));var OSF,WordWACRuntime,ContextActivationManagerBuilderBase=function(){function e(e,t){this._params={},this._addParams(e),this._addParams(t)}return e.prototype.setHostInfo=function(e){return this},e.prototype.setLocaleInfo=function(e){return this},e.prototype.setUrlInfo=function(e){return this._addParams(e),this},e.prototype.setHostControlInfo=function(e){return this._addParams(e),this},e.prototype.setMiscellaneousActivationParameters=function(e){return this._addParams(e),this},e.prototype.setUserInfo=function(e){return this._addParams(e),this},e.prototype.construct=function(){return new OSF.ContextActivationManager(this._params)},e.prototype._addParams=function(e){for(var t in e)e.hasOwnProperty(t)&&(this._params[t]=e[t])},e}();!function(e){!function(t){t.ErrorCodeManager=e.DDA.ErrorCodeManager||{errorCodes:{ooeSuccess:0,ooeCoercionTypeNotSupported:1e3,ooeGetSelectionNotMatchDataType:1001,ooeCoercionTypeNotMatchBinding:1002,ooeSelectionNotSupportCoercionType:1004,ooeInvalidGetStartRowColumn:1005,ooeNonUniformPartialGetNotSupported:1006,ooeFileTypeNotSupported:1009,ooeCannotWriteToSelection:2001,ooeDataNotMatchBindingSize:2004,ooeInvalidSetStartRowColumn:2005,ooeInvalidDataFormat:2006,ooeInvalidGetRowColumnCounts:2010,ooeDataNotMatchCoercionType:2007,ooeDataNotMatchBindingType:2008,ooeBindingNotExist:3002,ooeInvalidSelectionForBindingType:3004,ooeOperationNotSupportedOnThisBindingType:3005,ooeNamedItemNotFound:3006,ooeMultipleNamedItemFound:3007,ooeInvalidNamedItemForBindingType:3008,ooeUnknownBindingType:3009,ooeInternalError:5001,ooeDocumentReadOnly:5002,ooeUnsupportedEnumeration:5007,ooeIndexOutOfRange:5008,ooeBrowserAPINotSupported:5009,ooeRequestTimeout:5011,ooeTooManyIncompleteRequests:5100,ooeRequestTokenUnavailable:5101,ooeCustomXmlNodeNotFound:6e3,ooeCustomXmlError:6100,ooeCustomXmlExceedQuota:6101,ooeCustomXmlOutOfDate:6102,ooeCannotNavTo:7001,ooeSpecifiedIdNotExist:7002,ooeNavOutOfBound:7004,ooeMemoryFileLimit:11e3,ooeNetworkProblemRetrieveFile:11001,ooeInvalidSliceSize:11002,ooeInvalidWidth:12e3,ooeInvalidHeight:12001,ooeNavigationError:12002,ooeInvalidScheme:12003,ooeAppDomains:12004,ooeRequireHTTPS:12005,ooeWebDialogClosed:12006,ooeDialogAlreadyOpened:12007,ooeEndUserAllow:12008,ooeEndUserIgnore:12009,ooeNotUILessDialog:12010,ooeCrossZone:12011,ooeNotSSOAgave:13e3,ooeSSOUserNotSignedIn:13001,ooeSSOUserAborted:13002,ooeSSOUnsupportedUserIdentity:13003,ooeSSOInvalidResourceUrl:13004,ooeSSOInvalidGrant:13005,ooeSSOClientError:13006,ooeSSOServerError:13007,ooeAddinIsAlreadyRequestingToken:13008,ooeSSOConnectionLost:13010,ooeResourceNotAllowed:13011,ooeSSOUnsupportedPlatform:13012,ooeSSOCallThrottled:13013,ooeAccessDenied:13990,ooeGeneralException:13991}}}(e.DDA||(e.DDA={})),e.ContextActivationManagerBuilder=ContextActivationManagerBuilderBase,e.PolicyManager=OsfRuntime.PolicyManager}(OSF||(OSF={})),function(e){var t=function(){function e(e,t){this.wnd=e,this.hostControl=t;var n=this;this.executeMethod=function(e,i){t.invokeDdaMethod(e,(function(t){!function(e,t){if(0==e.Error){var i=t.DdaMethod.DispatchId;if(i==OSF.DDA.MethodDispId.dispidAddBindingFromSelectionMethod||i==OSF.DDA.MethodDispId.dispidAddBindingFromPromptMethod||i==OSF.DDA.MethodDispId.dispidAddBindingFromNamedItemMethod||i==OSF.DDA.MethodDispId.dispidGetBindingMethod||i==OSF.DDA.MethodDispId.dispidGetAllBindingsMethod)n.registerBindingEvents(n,Microsoft.Office.WebExtension.EventType.BindingSelectionChanged,e.Bindings),n.registerBindingEvents(n,Microsoft.Office.WebExtension.EventType.BindingDataChanged,e.Bindings);else if(i==OSF.DDA.MethodDispId.dispidAddDataPartMethod||i==OSF.DDA.MethodDispId.dispidGetDataPartByIdMethod||i==OSF.DDA.MethodDispId.dispidGetDataPartsByNamespaceMethod){if(e.DataPartProperties)n.registerNodeEventsForCustomXmlFile(n,e.DataPartProperties.id);else if(e.DataPartList)for(var o in e.DataPartList)n.registerNodeEventsForCustomXmlFile(n,e.DataPartList[o].id)}else i==OSF.DDA.MethodDispId.dispidDeleteDataPartMethod&&n.unregisterNodeEventsForCustomXmlFile(n,t.id)}}(t,e),i&&i(t)}),null)},this.registerEvent=function(e,n,i,o){void 0===o&&(o=null),t.registerDdaEventAsync(i.eventDispId,(null==o?void 0:o.controlId)||i.controlId,i.targetId,e,n)},this.unregisterEvent=function(e,n,i,o){void 0===o&&(o=null),t.unregisterDdaEventAsync(i.eventDispId,(null==o?void 0:o.controlId)||i.controlId,i.targetId,e,n)}}return e.prototype.registerBindingEvents=function(e,t,n){for(var i in n){var o=n[i].Name,r=OSF.DDA.getXdmEventName(o,t),a=e.serviceEndpoint._policyManager._registeredActions;a[r]||(e.serviceEndpoint.registerEventEx(r,e.registerEvent,Microsoft.Office.Common.InvokeType.asyncRegisterEvent,e.unregisterEvent,Microsoft.Office.Common.InvokeType.asyncUnregisterEvent),a[r]=OSF.OsfControlPermission.Restricted)}},e.prototype.registerNodeEventsForCustomXmlFile=function(e,t){for(var n=e.getNodeEventNamesForCustomXmlFile(t),i=e.serviceEndpoint._policyManager._registeredActions,o=0;o<n.length;o++)i[n[o]]||(e.serviceEndpoint.registerEventEx(n[o],e.registerEvent,Microsoft.Office.Common.InvokeType.asyncRegisterEvent,e.unregisterEvent,Microsoft.Office.Common.InvokeType.asyncUnregisterEvent),i[n[o]]=OSF.OsfControlPermission.Restricted)},e.prototype.unregisterNodeEventsForCustomXmlFile=function(e,t){for(var n=e.getNodeEventNamesForCustomXmlFile(t),i=e.serviceEndpoint._policyManager._registeredActions,o=0;o<n.length;o++)i[n[o]]&&(e.serviceEndpoint.unregisterEvent(n[o]),delete i[n[o]])},e.prototype.getNodeEventNamesForCustomXmlFile=function(e){var t=[],n=OSF.DDA.getXdmEventName(e,Microsoft.Office.WebExtension.EventType.DataNodeInserted),i=OSF.DDA.getXdmEventName(e,Microsoft.Office.WebExtension.EventType.DataNodeReplaced),o=OSF.DDA.getXdmEventName(e,Microsoft.Office.WebExtension.EventType.DataNodeDeleted);return t[0]=n,t[1]=i,t[2]=o,t},e}();e.BaseWACFacade=t;var n=function(t){function n(i,o){var r=t.call(this,i,o)||this;if(!o.getThrottleForCall)return r;var a=r.executeMethod;return r.executeMethod=function(t,i){var r=o.getThrottleForCall(t);if(r){var s=r.tryAsyncRequest((function(e){a(t,(function(t){e(),i&&i(t)}))}));if(s!==e.Throttling.ThrottleRequestStatus.Allowed){var l=n._throttleStatusToErrorCodeMapping,c=l.hasOwnProperty(s.toString())?l[s]:OSF.DDA.ErrorCodeManager.errorCodes.ooeInternalError,u={};u[OSF.DDA.Marshaling.ApiResponseKeys.Error]=c,i&&i(u)}}else a(t,i)},r}return __extends(n,t),n._getThrottleStatusToErrorCodeMapping=function(){var t={};return t[e.Throttling.ThrottleRequestStatus.ThrottledRequestTokensUnavailable]=OSF.DDA.ErrorCodeManager.errorCodes.ooeRequestTokenUnavailable,t[e.Throttling.ThrottleRequestStatus.ThrottledTooManyIncompleteRequests]=OSF.DDA.ErrorCodeManager.errorCodes.ooeTooManyIncompleteRequests,t},n._throttleStatusToErrorCodeMapping=n._getThrottleStatusToErrorCodeMapping(),n}(t);e.ThrottledWACFacade=n}(OsfRuntime||(OsfRuntime={})),function(e){function t(){var e=[OSF.Capability.Document],t=[OSF.Capability.Document],n=[{name:OSF.RequirementSetNames.AddinCommands,maxVersion:"1.1"},{name:OSF.RequirementSetNames.AugLoopSharedSession,maxVersion:"1.1"},{name:OSF.RequirementSetNames.BindingEvents},{name:OSF.RequirementSetNames.CompressedFile},{name:OSF.RequirementSetNames.CustomXmlParts},{name:OSF.RequirementSetNames.DialogApi,maxVersion:"1.2"},{name:OSF.RequirementSetNames.DialogOrigin,maxVersion:"1.2"},{name:OSF.RequirementSetNames.DocumentEvents},{name:OSF.RequirementSetNames.File},{name:OSF.RequirementSetNames.FirstPartyAuthentication},{name:OSF.RequirementSetNames.HtmlCoercion},{name:OSF.RequirementSetNames.IdentityApi,maxVersion:"1.3"},{name:OSF.RequirementSetNames.ImageCoercion},{name:OSF.RequirementSetNames.MatrixBindings},{name:OSF.RequirementSetNames.MatrixCoercion},{name:OSF.RequirementSetNames.OoxmlCoercion},{name:OSF.RequirementSetNames.PdfFile},{name:OSF.RequirementSetNames.Selection},{name:OSF.RequirementSetNames.Settings},{name:OSF.RequirementSetNames.SharedRuntime,maxVersion:"1.1"},{name:OSF.RequirementSetNames.TableBindings},{name:OSF.RequirementSetNames.TableCoercion},{name:OSF.RequirementSetNames.TextBindings},{name:OSF.RequirementSetNames.TextCoercion},{name:OSF.RequirementSetNames.TextFile},{name:OSF.RequirementSetNames.WebAuth},{name:OSF.RequirementSetNames.WordApi,maxVersion:"1.5"},{name:OSF.RequirementSetNames.WordApiOnline},{name:OSF.RequirementSetNames.WordApiSearchFlags}],i=OSF.RequirementMethodNames,o=[i["Auth.getAccessTokenAsync"],i["Bindings.addFromNamedItemAsync"],i["Bindings.addFromSelectionAsync"],i["Binding.addHandlerAsync"],i["Binding.removeHandlerAsync"],i["Bindings.getAllAsync"],i["Bindings.getByIdAsync"],i["Bindings.releaseByIdAsync"],i["Binding.getDataAsync"],i["Binding.setDataAsync"],i["CustomXmlParts.addAync"],i["CustomXmlParts.getByIdAsync"],i["CustomXmlParts.getByNamespaceAsync"],i["CustomXmlPart.getXmlAsync"],i["CustomXmlPart.getNodesAsync"],i["CustomXmlPart.deleteAsync"],i["CustomXmlPart.addHandlerAsync"],i["CustomXmlPart.removeHandlerAsync"],i["CustomXmlNode.getNodesAsync"],i["CustomXmlNode.getNodeValueAsync"],i["CustomXmlNode.getXmlAsync"],i["CustomXmlNode.getTextAsync"],i["CustomXmlNode.setNodeValueAsync"],i["CustomXmlNode.setXmlAsync"],i["CustomXmlNode.setTextAsync"],i["CustomXmlPrefixMappings.addNamespaceAsync"],i["CustomXmlPrefixMappings.getNamespaceAsync"],i["CustomXmlPrefixMappings.getPrefixAsync"],i["Dialog.addEventHandler"],i["Dialog.close"],i["Dialog.sendMessage"],i["Document.addHandlerAsync"],i["Document.getFileAsync"],i["Document.getFilePropertiesAsync"],i["Document.getSelectedDataAsync"],i["Document.setSelectedDataAsync"],i["Document.removeHandlerAsync"],i["Document.goToByIdAsync"],i["File.getSliceAsync"],i["File.closeAsync"],i["MatrixBinding.getDataAsync"],i["MatrixBinding.setDataAsync"],i["Settings.get"],i["Settings.set"],i["Settings.saveAsync"],i["Settings.refreshAsync"],i["Settings.addHandlerAsync"],i["Settings.removeHandlerAsync"],i["TableBinding.addColumnsAsync"],i["TableBinding.addRowsAsync"],i["TableBinding.deleteAllDataValuesAsync"],i["TableBinding.getDataAsync"],i["TableBinding.setDataAsync"],i["TextBinding.getDataAsync"],i["TextBinding.setDataAsync"],i["Ui.displayDialogAsync"],i["Ui.messageParent"],i["Ui.addEventHandler"],i["WebAuth.getAuthContextAsync"]],r=[OSF.OsfControlTarget.TaskPane,OSF.OsfControlTarget.InContent],a=new OSF.RequirementsChecker(e,t,{sets:n,methods:o},r,["WAW160"]);return a.setFilteringEnabled(!0),a}e.BuildRequirementsChecker=t,e._setupFacade=function(e,n,i,o){var r,a=new OsfRuntime.ThrottledWACFacade(window,e);a.serviceEndpoint=i,(r={ContextActivationManager_getAppContextAsync:OSF.OsfControlPermission.Restricted,ContextActivationManager_notifyHost:OSF.OsfControlPermission.Restricted,ContextActivationManager_openWindowInHost:OSF.OsfControlPermission.Restricted,documentSelectionChanged:OSF.OsfControlPermission.ReadDocument,nodeInserted:OSF.OsfControlPermission.Restricted,nodeReplaced:OSF.OsfControlPermission.Restricted,nodeDeleted:OSF.OsfControlPermission.Restricted,richApiMessage:OSF.OsfControlPermission.Restricted,settingsChanged:OSF.OsfControlPermission.Restricted,appCommandInvoked:OSF.OsfControlPermission.Restricted,dialogMessageReceived:OSF.OsfControlPermission.Restricted,dialogNotificationShown:OSF.OsfControlPermission.Restricted,dialogParentMessageReceived:OSF.OsfControlPermission.Restricted,officeThemeChanged:OSF.OsfControlPermission.Restricted,executeMethod:{}}).executeMethod[OSF.DDA.MethodDispId.dispidAddDataPartMethod]=OSF.OsfControlPermission.WriteDocument,r.executeMethod[OSF.DDA.MethodDispId.dispidGetDataPartByIdMethod]=OSF.OsfControlPermission.ReadDocument,r.executeMethod[OSF.DDA.MethodDispId.dispidGetDataPartsByNamespaceMethod]=OSF.OsfControlPermission.ReadDocument,r.executeMethod[OSF.DDA.MethodDispId.dispidGetDataPartXmlMethod]=OSF.OsfControlPermission.ReadDocument,r.executeMethod[OSF.DDA.MethodDispId.dispidGetDataPartNodesMethod]=OSF.OsfControlPermission.ReadDocument,r.executeMethod[OSF.DDA.MethodDispId.dispidDeleteDataPartMethod]=OSF.OsfControlPermission.WriteDocument,r.executeMethod[OSF.DDA.MethodDispId.dispidGetDataNodeValueMethod]=OSF.OsfControlPermission.ReadDocument,r.executeMethod[OSF.DDA.MethodDispId.dispidGetDataNodeXmlMethod]=OSF.OsfControlPermission.ReadDocument,r.executeMethod[OSF.DDA.MethodDispId.dispidGetDataNodeTextMethod]=OSF.OsfControlPermission.ReadDocument,r.executeMethod[OSF.DDA.MethodDispId.dispidGetDataNodesMethod]=OSF.OsfControlPermission.ReadDocument,r.executeMethod[OSF.DDA.MethodDispId.dispidSetDataNodeValueMethod]=OSF.OsfControlPermission.WriteDocument,r.executeMethod[OSF.DDA.MethodDispId.dispidSetDataNodeXmlMethod]=OSF.OsfControlPermission.WriteDocument,r.executeMethod[OSF.DDA.MethodDispId.dispidSetDataNodeTextMethod]=OSF.OsfControlPermission.WriteDocument,r.executeMethod[OSF.DDA.MethodDispId.dispidAddDataNamespaceMethod]=OSF.OsfControlPermission.WriteDocument,r.executeMethod[OSF.DDA.MethodDispId.dispidGetDataUriByPrefixMethod]=OSF.OsfControlPermission.ReadDocument,r.executeMethod[OSF.DDA.MethodDispId.dispidGetDataPrefixByUriMethod]=OSF.OsfControlPermission.ReadDocument,r.executeMethod[OSF.DDA.MethodDispId.dispidGetSelectedDataMethod]=OSF.OsfControlPermission.ReadDocument,r.executeMethod[OSF.DDA.MethodDispId.dispidSetSelectedDataMethod]=OSF.OsfControlPermission.WriteDocument,r.executeMethod[OSF.DDA.MethodDispId.dispidGetFilePropertiesMethod]=OSF.OsfControlPermission.ReadDocument,r.executeMethod[OSF.DDA.MethodDispId.dispidGetDocumentCopyMethod]=OSF.OsfControlPermission.ReadAllDocument,r.executeMethod[OSF.DDA.MethodDispId.dispidGetDocumentCopyChunkMethod]=OSF.OsfControlPermission.ReadAllDocument,r.executeMethod[OSF.DDA.MethodDispId.dispidReleaseDocumentCopyMethod]=OSF.OsfControlPermission.ReadDocument,r.executeMethod[OSF.DDA.MethodDispId.dispidSaveSettingsMethod]=OSF.OsfControlPermission.Restricted,r.executeMethod[OSF.DDA.MethodDispId.dispidLoadSettingsMethod]=OSF.OsfControlPermission.Restricted,r.executeMethod[OSF.DDA.MethodDispId.dispidGetBindingMethod]=OSF.OsfControlPermission.ReadDocument,r.executeMethod[OSF.DDA.MethodDispId.dispidGetAllBindingsMethod]=OSF.OsfControlPermission.ReadDocument,r.executeMethod[OSF.DDA.MethodDispId.dispidExecuteRichApiRequestMethod]=OSF.OsfControlPermission.ReadDocument,r.executeMethod[OSF.DDA.MethodDispId.dispidReleaseBindingMethod]=OSF.OsfControlPermission.WriteDocument,r.executeMethod[OSF.DDA.MethodDispId.dispidAddBindingFromSelectionMethod]=OSF.OsfControlPermission.WriteDocument,r.executeMethod[OSF.DDA.MethodDispId.dispidAddBindingFromNamedItemMethod]=OSF.OsfControlPermission.WriteDocument,r.executeMethod[OSF.DDA.MethodDispId.dispidGetBindingDataMethod]=OSF.OsfControlPermission.ReadDocument,r.executeMethod[OSF.DDA.MethodDispId.dispidSetBindingDataMethod]=OSF.OsfControlPermission.WriteDocument,r.executeMethod[OSF.DDA.MethodDispId.dispidNavigateToMethod]=OSF.OsfControlPermission.ReadDocument,r.executeMethod[OSF.DDA.MethodDispId.dispidAppCommandInvocationCompletedMethod]=OSF.OsfControlPermission.Restricted,r.executeMethod[OSF.DDA.MethodDispId.dispidAddRowsMethod]=OSF.OsfControlPermission.WriteDocument,r.executeMethod[OSF.DDA.MethodDispId.dispidAddColumnsMethod]=OSF.OsfControlPermission.WriteDocument,r.executeMethod[OSF.DDA.MethodDispId.dispidClearAllRowsMethod]=OSF.OsfControlPermission.WriteDocument,r.executeMethod[OSF.DDA.MethodDispId.dispidMessageParentMethod]=OSF.OsfControlPermission.Restricted,r.executeMethod[OSF.DDA.MethodDispId.dispidSendMessageMethod]=OSF.OsfControlPermission.Restricted,r.executeMethod[OSF.DDA.MethodDispId.dispidGetAccessTokenMethod]=OSF.OsfControlPermission.ReadDocument,r.executeMethod[OSF.DDA.MethodDispId.dispidGetAuthContextMethod]=OSF.OsfControlPermission.ReadDocument,r.executeMethod[OSF.DDA.MethodDispId.dispidGetNestedAppAuthContextMethod]=OSF.OsfControlPermission.ReadDocument;var s=new OSF.PolicyManager(n,r);i.setPolicyManager(s),i.registerMethod("executeMethod",a.executeMethod,Microsoft.Office.Common.InvokeType.async,!1),i.registerEventEx("documentSelectionChanged",a.registerEvent,Microsoft.Office.Common.InvokeType.asyncRegisterEvent,a.unregisterEvent,Microsoft.Office.Common.InvokeType.asyncUnregisterEvent),i.registerEventEx("bindingSelectionChanged",a.registerEvent,Microsoft.Office.Common.InvokeType.asyncRegisterEvent,a.unregisterEvent,Microsoft.Office.Common.InvokeType.asyncUnregisterEvent),i.registerEventEx("richApiMessage",a.registerEvent,Microsoft.Office.Common.InvokeType.asyncRegisterEvent,a.unregisterEvent,Microsoft.Office.Common.InvokeType.asyncUnregisterEvent),i.registerEventEx("settingsChanged",a.registerEvent,Microsoft.Office.Common.InvokeType.asyncRegisterEvent,a.unregisterEvent,Microsoft.Office.Common.InvokeType.asyncUnregisterEvent),i.registerEventEx("appCommandInvoked",OfficeExt.AddinCommandsRuntimeManager.registerEvent,Microsoft.Office.Common.InvokeType.asyncRegisterEvent,OfficeExt.AddinCommandsRuntimeManager.unregisterEvent,Microsoft.Office.Common.InvokeType.asyncUnregisterEvent),i.registerEventEx("dialogMessageReceived",a.registerEvent,Microsoft.Office.Common.InvokeType.asyncRegisterEvent,a.unregisterEvent,Microsoft.Office.Common.InvokeType.asyncUnregisterEvent),i.registerEventEx("dialogNotificationShown",a.registerEvent,Microsoft.Office.Common.InvokeType.asyncRegisterEvent,a.unregisterEvent,Microsoft.Office.Common.InvokeType.asyncUnregisterEvent),i.registerEventEx("dialogParentMessageReceived",a.registerEvent,Microsoft.Office.Common.InvokeType.asyncRegisterEvent,a.unregisterEvent,Microsoft.Office.Common.InvokeType.asyncUnregisterEvent),i.registerEventEx("officeThemeChanged",a.registerEvent,Microsoft.Office.Common.InvokeType.asyncRegisterEvent,a.unregisterEvent,Microsoft.Office.Common.InvokeType.asyncUnregisterEvent);var l={ContextActivationManager_onClickInsertOsfControl:OSF.OsfControlPermission.Restricted,ContextActivationManager_onClickInstallOsfControl:OSF.OsfControlPermission.Restricted,ContextActivationManager_onClickRefreshAddinCommands:OSF.OsfControlPermission.Restricted,ContextActivationManager_onClickCancelDialog:OSF.OsfControlPermission.Restricted,ContextActivationManager_getEntitlementsForInsertDialog:OSF.OsfControlPermission.Restricted,ContextActivationManager_invokeSignIn:OSF.OsfControlPermission.Restricted,ContextActivationManager_invokeSignOut:OSF.OsfControlPermission.Restricted,ContextActivationManager_invokeWindowOpen:OSF.OsfControlPermission.Restricted,ContextActivationManager_removeAppForInsertDialog:OSF.OsfControlPermission.Restricted,ContextActivationManager_logTelemetryDataForInsertDialog:OSF.OsfControlPermission.Restricted,ContextActivationManager_removeAppCommandsAddin:OSF.OsfControlPermission.Restricted},c=new OSF.PolicyManager(n,l);o.setPolicyManager(c),n.getLocalizedImageFilePath=function(e){return this.getLocalizedImagesUrl()+e},n.getLocalizedCSSFilePath=function(e){return this.getLocalizedStylesUrl()+e},n._hostType=OSF.HostType.Word,n._hostPlatform=OSF.HostPlatform.Web,n._hostSpecificFileVersion=OSF.HostSpecificFileVersionMap.word.web,n.insertManifestXmlIntoCache=function(e){var t=new OSF.Manifest.Manifest(e,n.getAppUILocale());return OSF.OsfManifestManager.hasManifest(t.getMarketplaceID(),t.getMarketplaceVersion())||OSF.OsfManifestManager.cacheManifest(t.getMarketplaceID(),t.getMarketplaceVersion(),t),t},n.insertAddinWithManifest=function(e,t){OSF.OUtil.xhrGet(e,(function(e){var i=n.insertManifestXmlIntoCache(e),o={solutionId:i.getMarketplaceID(),version:i.getMarketplaceVersion(),storeType:OSF.StoreType.HardCodedPreinstall,storeId:"developer",assetId:null,assetStoreId:null,targetType:i.getTarget(),width:i.getDefaultWidth()||0,height:i.getDefaultHeight()||0,isAddinCommands:i._isAddinCommandsManifest(OSF.getManifestHostType(n._hostType))};null!=t&&t(o,i),Telemetry.UploadFileDevCatalogUsageHelper.LogUploadFileDevCatalogUsageAction(n._appCorrelationId,o.storeType,o.solutionId,o.version,o.targetType,o.isAddinCommands,o.width,o.height),n._notifyHost("0",OSF.AgaveHostAction.InsertAgave,o)}),(function(e){Telemetry.RuntimeTelemetryHelper.LogExceptionTag("Error when requesting manifest file: "+e,null,n._appCorrelationId,523583497)}))};var u=t();n.setRequirementsChecker(u)}}(WordWACRuntime||(WordWACRuntime={})),function(e){e.AppSpecificSetup={BuildRequirementsChecker:WordWACRuntime.BuildRequirementsChecker,_setupFacade:WordWACRuntime._setupFacade}}(OSF||(OSF={}));
//# sourceMappingURL=osfruntimewordwac.js.map
